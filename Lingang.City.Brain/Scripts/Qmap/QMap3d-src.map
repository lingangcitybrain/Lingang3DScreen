{"version":3,"sources":["src/QMap3dV2.js","src/Enums.js","src/util/Util.js","src/util/DomUtil.js","src/util/Browser.js","src/core/Class.js","src/core/Events.js","src/core/Map.js","src/vector/vector2.js","src/vector/vector2I.js","src/vector/vector3.js","src/vector/vector3d.js","src/vector/globalvec3d.js","src/vector/colourvalue.js","src/vector/arcVertex.js","src/app/GlobalCamera.js","src/app/InputManager.js","src/app/LayerGroup.js","src/app/MovieClip.js","src/app/MovieClipInstance.js","src/app/NodeContainer.js","src/app/Map.AnimEffect.js","src/app/Map.InnerUI.js","src/app/Map.ModelNode.js","src/app/Map.POINode.js","src/app/Map.Tool.js","src/app/Map.VectorNode.js"],"names":[],"mappings":";;;;yCAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACrhBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACjZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACzUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACxFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC1zCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACxOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC3NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC3JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC/NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnhBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACrRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC5OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AChXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACtUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC1HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACvtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACzwBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACphBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC9UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC5fA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["\r\nvar Q3D = {\r\n\tversion: \"2.0+\"\r\n};\r\n\r\nfunction expose() {\r\n\tvar oldL = window.Q3D;\r\n\r\n\tQ3D.noConflict = function () {\r\n\t\twindow.Q3D = oldL;\r\n\t\treturn this;\r\n\t};\r\n\r\n\twindow.Q3D = Q3D;\r\n}\r\n\r\n// define QMap3DJS for Node module pattern loaders, including Browserify\r\nif (typeof module === 'object' && typeof module.exports === 'object') {\r\n\tmodule.exports = Q3D;\r\n\r\n// define QMap3DJS as an AMD module\r\n} else if (typeof define === 'function' && define.amd) {\r\n\tdefine(Q3D);\r\n}\r\n\r\n// define QMap3DJS as a global Q3D variable, saving the original Q3D to restore later if needed\r\nif (typeof window !== 'undefined') {\r\n\texpose();\r\n}\r\n","///QMapV2\r\nQ3D.Enums = {\r\n    \r\n    //CLSID\r\n    ValueTypeCLSID: {\r\n        QVector2: \"8974ca38-d123-4516-9f49-c35ab5038a8b\",\r\n        QVector2I: \"b8d6c462-0d1e-41cb-ab4c-0c0bdf090356\",\r\n        QVector3: \"406e2212-9d78-45db-a2d5-cb326e9e7f3f\",\r\n        QVector3d: \"8c53eb01-4520-4793-a4a6-0d1f61e8b51c\",\r\n        QGlobalVec3d: \"bd2e69e3-8bec-46c4-a7db-35944c51bc3d\",\r\n        QColourValue: \"2d90ae9b-31c8-45df-99f3-5af1687e035f\",\r\n    },\r\n    \r\n    //\r\n    device: {\r\n        KEYBOARD: 0,            //\r\n        MOUSE: 1,                  //\r\n        MULTITOUCH: 2       //\r\n    },\r\n    \r\n    //\r\n    mouse: {\r\n        LBUTTON: 0,                 //\r\n        MBUTTON: 1,               //\r\n        RBUTTON: 2,                //\r\n        WHEEL: 4,                     //\r\n        LDCLICK: 5,                  //\r\n        RDCLICK: 6                  //\r\n    },\r\n    \r\n    //\r\n    multiTouch: {\r\n        TRANS: 1,                   //\r\n        CLOSETO: 2,               //\r\n        RAMBLE: 3,                //\r\n        YPS: 4                         //\r\n    },\r\n    \r\n    //\r\n    keyboard: {\r\n        ALL:{ctrlId: -1, wparam: -1},\r\n        NUM_0: {ctrlId: 0, wparam: 48},\r\n        NUM_1: {ctrlId: 1, wparam: 49},\r\n        NUM_2: {ctrlId: 2, wparam: 50},\r\n        NUM_3: {ctrlId: 3, wparam: 51},\r\n        NUM_4: {ctrlId: 4, wparam: 52},\r\n        NUM_5: {ctrlId: 5, wparam: 53},\r\n        NUM_6: {ctrlId: 6, wparam: 54},\r\n        NUM_7: {ctrlId: 7, wparam: 55},\r\n        NUM_8: {ctrlId: 8, wparam: 56},\r\n        NUM_9: {ctrlId: 9, wparam: 57},\r\n\r\n        A: {ctrlId: 10, wparam: 65},\r\n        B: {ctrlId: 11, wparam: 66},\r\n        C: {ctrlId: 12, wparam: 67},\r\n        D: {ctrlId: 13, wparam: 68},\r\n        E: {ctrlId: 14, wparam: 69},\r\n        F: {ctrlId: 15, wparam: 70},\r\n        G: {ctrlId: 16, wparam: 71},\r\n        H: {ctrlId: 17, wparam: 72},\r\n        I: {ctrlId: 18, wparam: 73},\r\n        J: {ctrlId: 19, wparam: 74},\r\n        K: {ctrlId: 20, wparam: 75},\r\n        L: {ctrlId: 21, wparam: 76},\r\n        M: {ctrlId: 22, wparam: 77},\r\n        N: {ctrlId: 23, wparam: 78},\r\n        O: {ctrlId: 24, wparam: 79},\r\n        P: {ctrlId: 25, wparam: 80},\r\n        Q: {ctrlId: 26, wparam: 81},\r\n        R: {ctrlId: 27, wparam: 82},\r\n        S: {ctrlId: 28, wparam: 83},\r\n        T: {ctrlId: 29, wparam: 84},\r\n        U: {ctrlId: 30, wparam: 85},\r\n        V: {ctrlId: 31, wparam: 86},\r\n        W: {ctrlId: 32, wparam: 87},\r\n        X: {ctrlId: 33, wparam: 88},\r\n        Y: {ctrlId: 34, wparam: 89},\r\n        Z: {ctrlId: 35, wparam: 90},\r\n\r\n        F1: {ctrlId: 36, wparam: 112},\r\n        F2: {ctrlId: 37, wparam: 113},\r\n        F3: {ctrlId: 38, wparam: 114},\r\n        F4: {ctrlId: 39, wparam: 115},\r\n        F5: {ctrlId: 40, wparam: 116},\r\n        F6: {ctrlId: 41, wparam: 117},\r\n        F7: {ctrlId: 42, wparam: 118},\r\n        F8: {ctrlId: 43, wparam: 119},\r\n        F9: {ctrlId: 44, wparam: 120},\r\n        F10: {ctrlId: 45, wparam: 121},\r\n        F11: {ctrlId: 46, wparam: 122},\r\n        F12: {ctrlId: 47, wparam: 123},\r\n\r\n        ESCAPE: {ctrlId: 48, wparam: 27},\r\n        ACCENT: {ctrlId: 49, wparam: 192},\r\n        BACK: {ctrlId: 50, wparam: 0},\r\n        ENTER: {ctrlId: 51, wparam: 13},\r\n        SPACE: {ctrlId: 52, wparam: 32},\r\n\r\n        LCTRL: {ctrlId: 53, wparam: 17},\r\n        RCTRL: {ctrlId: 54, wparam: 17},\r\n        LALT: {ctrlId: 55, wparam: 0},\r\n        RALT: {ctrlId: 56, wparam: 0},\r\n        LSHIFT: {ctrlId: 57, wparam: 16},\r\n        RSHIFT: {ctrlId: 58, wparam: 16},\r\n\r\n        INSERT: {ctrlId: 59, wparam: 45},\r\n        DELETE: {ctrlId: 60, wparam: 46},\r\n        HOME: {ctrlId: 61, wparam: 36},\r\n        END: {ctrlId: 62, wparam: 35},\r\n        PAGEUP: {ctrlId: 63, wparam: 33},\r\n        PAGEDOWN : {ctrlId: 64, wparam: 34},\r\n\r\n        LEFT: {ctrlId: 65, wparam: 37},\r\n        RIGHT: {ctrlId: 66, wparam: 39},\r\n        UP: {ctrlId: 67, wparam: 38},\r\n        DOWN: {ctrlId: 68, wparam: 40},\r\n        \r\n        KP_0: {ctrlId: 69, wparam: 96},\r\n        KP_1: {ctrlId: 70, wparam: 97},\r\n        KP_2: {ctrlId: 71, wparam: 98},\r\n        KP_3: {ctrlId: 72, wparam: 99},\r\n        KP_4: {ctrlId: 73, wparam: 100},\r\n        KP_5: {ctrlId: 74, wparam: 101},\r\n        KP_6: {ctrlId: 75, wparam: 102},\r\n        KP_7: {ctrlId: 76, wparam: 103},\r\n        KP_8: {ctrlId: 77, wparam: 104},\r\n        KP_9: {ctrlId: 78, wparam: 105},\r\n        \r\n    },\r\n    \r\n    //\r\n    actionType: {\r\n        //\r\n        TRANS_LEFTX: 6,// \r\n        TRANS_RIGHT: 7,// \r\n        TRANS_FORTH: 9,// \r\n        TRANS_BACKX: 10,// \r\n        TRANS_UPXXX: 11,// \r\n        TRANS_DOWNX: 12,// \r\n        \r\n        //\r\n        TRANS_UDLRX: 25,// (  )\r\n        TRANS_SCENE: 14,//(  )\r\n        TRANS_EARTH: 34,// \r\n        TRANS_ORTHO: 38,// \r\n        \r\n        // ( D:Dynamic; S:Static )\r\n        SCALED_CENTER: 26,// STATIC\r\n        SCALES_CENTER: 27,// \r\n        SCALED_SCREEN: 13,// ( EyeScreenPnt )STATIC\r\n        SCALES_SCREEN: 28,// ( EyeScreenPnt )\r\n        SCALEE_SCREEN: 36, // \r\n        SCALEE_CENTER: 37,// \r\n        SCALEX_ORTHOX: 40,// \r\n        CAMERA_CLOSETO: 22,// \r\n        \r\n        // ( S:Separately; T:Together )\r\n        ROTATES_CAMERA: 15,   // yaw,pitch\r\n        ROTATET_CAMERA: 29,   // yaw,pitch\r\n        ROTATES_SCREEN: 21,   // ,Separately\r\n        ROTATET_SCREEN: 30,   // ,Together\r\n        ROTATES_CENTER: 31,   // basePlane,Separately\r\n        ROTATET_CENTER: 32,   // basePlane,Together\r\n        ROTATES_FIXPNT: 45,\t// yaw,pitch\r\n        ROTATET_FIXPNT: 46,\t// yaw,pitch\r\n        ROTATES_EARTHX: 35,   // ( reserved )\r\n        ROTATET_EARTHX: 36,\t// ( reserved )\r\n        ROTATEX_ORTHOX: 39,   // \r\n        \r\n        //\r\n        RAMBLE_KEEPORI: 20,   // (  )\r\n        RAMBLE_HEADUPX: 33,   // (  )( reserved )\r\n\r\n        //\r\n        OBJECTSELECT_MOVAUX: 17,       \r\n        OBJECTSELECT_ROTAUX: 18,        \r\n        OBJECTSELECT_SCAAUX: 19,     \r\n\r\n        //( YPS:YawPitchScale, S:Separately, T:Together )\r\n        YPSS_CENTER: 41,\t// \r\n        YPSS_SCREEN: 23,\t// \r\n        YPST_CENTER: 43,\t// \r\n        YPST_SCREEN: 44,\t// \r\n        \r\n        //\r\n        THIRD_ROTATE: 100,\r\n        THIRD_WHEEL: 101,\r\n        THIRD_MOVELEFT: 102,//\r\n        THIRD_MOVERIGHT: 103,//\r\n        THIRD_MOVEFORTH: 104,//\r\n        THIRD_MOVEBACK: 105,//\r\n        THIRD_MOVEUP: 106,//\r\n        THIRD_MOVEDOWN: 107,//\r\n        THIRD_MOVETO: 108,//\r\n        THIRD_CAMERAROTATE: 109,//\r\n        THIRD_TURNLEFT: 110,//\r\n        THIRD_TURNRIGHT: 111,//\r\n        THIRD_LOOKUP: 112,//\r\n        THIRD_LOOKDOWN: 113,//\r\n    \r\n    },\r\n\r\n    //\r\n    actionMsg: {\r\n        //\r\n        LIMIT_AUX: 1,               \r\n        LIMIT_SELECT: 2,\r\n        //\r\n        SWITCH_INERTIA: 3,    //\r\n        SWITCH_LOCATOR: 4,    //\r\n        SET_INERTIA_PARAMETER: 5,    //(  )\r\n        SET_INERTIA_DURATION: 6,    //(  )\r\n\r\n        //\r\n        SET_TRANS_LIMITDRAGANGLE: 7,    //\r\n        SET_TRANS_LIMITMAPDISTANCE: 8,    //( d )\r\n        SET_TRANS_LOOKUPMODE: 9,    //\r\n        SET_TRANS_SHORTESTDISTANCE: 10,    //(  )\r\n        SET_TRANS_LIMITDRAGDISTANCE: 11,    //\r\n        SET_TRANS_STATICSPEED: 12,    //( / )\r\n                                          \r\n        //\r\n        SET_SCALE_STATICSPEED: 13,   //( m/ )   \r\n        SET_SCALE_DYNAMICSPEED: 14,   //(  )\r\n        SET_SCALE_FORWARDSPEEDBUMP: 15,   //\r\n        SET_SCALE_BACKWARDSPEEDBUMP: 16,   //\r\n        SET_SCALE_SPEEDBUMPRATE: 17,   //(0,1)\r\n        SET_SCALE_BACKWARDLIMIT: 18,   //\r\n        SET_YPS_SCALERATIO: 19,   //\r\n                                          \r\n        //\r\n        SET_PITCHMIN: 20,   //\r\n        SET_PITCHMAX: 21,   //\r\n        SET_YAW_SPEED: 22,  //\r\n        SET_PITCH_SPEED: 23,   //\r\n        SWITCH_PITCH: 24,   //\r\n        SET_FIXPNT: 25,  //  \r\n                                        \r\n        //\r\n        SET_RAMBLE_TRANSLATESPEED: 26,   //\r\n        SET_RAMBLE_ROTATESPEED: 27,   //\r\n\r\n        SWITCH_USAGE: 28\r\n    },\r\n    \r\n    //\r\n    sceneNodeType: {\r\n        SNODE_Invalid: -1, //\r\n        SNODE_Group: 0, // \r\n        SNODE_LocalCamera: 3, //\r\n        SNODE_Light: 4, //\r\n        SNODE_Model: 5, //\r\n        SNODE_ParticleSystem: 6, //\r\n        SNODE_Billboard: 8, //\r\n        SNODE_POI: 14, //POI\r\n        SNODE_EnvMap: 17, //\r\n        SNODE_Line: 19, //\r\n        SNODE_LocalViewCamera: 20, //,\r\n        SNODE_VecModel: 24, //\r\n        SNODE_CullAreaNode: 26, //\r\n        SNODE_CullPlane: 30, //\r\n        SNODE_Traffic: 31, //\r\n        SNODE_Decal: 32 //\r\n    },\r\n    \r\n    lightType: {\r\n    \tPoint: 0,/**  */\r\n    \tParallel: 1,/**  */\r\n    \tSpotlight: 2/**  */\r\n\t},\r\n    \r\n    //\r\n    vecModelType: {\r\n        QPolygon: 0, //\r\n        QBuilding: 1, //\r\n        QPyramid: 2, //\r\n        QCylinder: 3, //\r\n        QCone: 4, //\r\n        QPipe: 5, //\r\n        QSphere: 6, //\r\n        QArrow: 7, //\r\n        QJunction: 8, //\r\n        QRoadway: 9, //\r\n        QRailway: 10, //\r\n        QWalls: 11, //\r\n        QPrism: 12 //\r\n    },\r\n    //\r\n    resourceType: {\r\n        MESH: 0, //\r\n        GEOMETRY: 1,\r\n        SKELETON: 2, //\r\n        ANINODE: 3,// \r\n        ANISKIN: 4,\r\n        ANITEX: 5,\r\n        PARTISYS: 6,\r\n        MATERIAL: 7,//\r\n        TEXTURE: 8,//\r\n        ANICLR: 9,\r\n        MAX: 10,\r\n        VIDEO: 16, // \r\n    },\r\n    //\r\n    decalModeType: {\r\n        OpBlendAlpha: 0, \r\n        OpBlendColor: 1,\r\n        OpAdd: 2, \r\n        OpModulate: 3,\r\n        DestTarget: 0 << 8,\r\n        DestGBuffer: 1 << 8,\r\n    },\r\n    decalNormalFlipMode: {\r\n        None: 0,\r\n        X: 1,\r\n        Y: 2,\r\n        XY: 0x1 | 0x2\r\n    },\r\n    \r\n    //\r\n    orientationType: {\r\n        Self: 0,//\r\n        Parent: 1,//\r\n        World: 2//\r\n    },\r\n    \r\n    //\r\n    actorTrackType: {\r\n        TransformMove: 0,\r\n        TransformRotate: 1,\r\n        TransformScale: 2,\r\n        ColorDiffuse: 3,\r\n        ColorDiffuseIntensity: 4,\r\n        ColorSpecular: 5,\r\n        ColorEmissive: 6,\r\n        ColorAlpha: 7,\r\n        Visible: 8,\r\n        VisibleDerived: 9,\r\n        TransformMoveAbs: 10,\r\n        TransformRotateAbs: 11,\r\n\t\tOrder: 12\r\n    },\r\n    \r\n    //\r\n    actorKeyType: {\r\n        KeyAuto: 0,\r\n        KeyFloat: 1,\r\n        KeyVector2: 2,\r\n        KeyVector3: 3,\r\n        KeyQuaternion: 4,\r\n        KeyColourValue: 5,\r\n        VecLine: 6,\r\n        VecCircle: 7,\r\n        KeyVector3d: 8\r\n    },\r\n\r\n    //\r\n    curveCtrlType: {\r\n        Point: 0,//\r\n        Linear: 1,//\r\n        Bessel: 2//\r\n    },\r\n    \r\n    //\r\n    timeCtrlType: {\r\n        Linear: 0,//\r\n        EaseIn: 1,//\r\n        EaseOut: 2//\r\n    },\r\n    \r\n    //\r\n    playerType: {\r\n        Node: 0,//\r\n        Material: 1,//\r\n        Sky: 2, //\r\n        Environment: 3\t//\r\n    },\r\n    \r\n    //\r\n    fadeType: {\r\n        fadeIn: 0,\r\n        fadeOut: 1,\r\n        fadeFlash: 2,\r\n    },\r\n    \r\n    //\r\n    nodeContainerType: {\r\n        Alpha: 0,\r\n        Color: 1,\r\n        Visible: 2,\r\n        Material: 3,\r\n    },\r\n    \r\n    //\r\n    materialApplyMode: {\r\n        Multiply: 0,\r\n        Add: 1,\r\n        Subtract: 2,\r\n        Replace: 3,\r\n    },\r\n    \r\n    //\r\n    textureUnit : {\r\n        DIFFUSE: 1684629094,//  \r\n        SPECULAR: 1936745827,// \r\n        NORMAL: 1852797549,//  \r\n        LIGHT: 1818847080,// \r\n        EDGE: 1701078885,\r\n        EMISSIVE: 1701669235//\r\n    },  \r\n    \r\n    //POI\r\n    poiImagePositionType: {\r\n        POI_LOCATE_NONE: 0, //  POI \r\n        POI_LOCATE_LEFT: 1,//  ICON \r\n        POI_LOCATE_HCENTER: 2, //  ICON \r\n        POI_LOCATE_RIGHT: 3,//  ICON  \r\n        POI_LOCATE_TOP: 256, //  ICON  \r\n        POI_LOCATE_VCENTER: 512,//  ICON \r\n        POI_LOCATE_BOTTOM: 768,//  ICON  \r\n        POI_LOCATE_LEFTTOP: 257,//  ICON \r\n        POI_LOCATE_LEFTBOTTOM: 769,//  ICON \r\n        POI_LOCATE_RIGHTTOP: 259,//  ICON \r\n        POI_LOCATE_RIGHTBOTTOM: 771,//  ICON \r\n        POI_LOCATE_CUSTOM: -1   //  setLocationOffset \r\n    },\r\n    \r\n    //\r\n    nodeOrientationType: {\r\n        Self: 0,\r\n        Parent: 1,\r\n        World: 2,\r\n    },\r\n    \r\n    //POI\r\n    poiLayOut: {\r\n        Left: 0,//\r\n        Top: 1,//\r\n        Right: 2,// \r\n        Bottom: 3,//\r\n        Center: 4, //\r\n        \r\n        LeftTop: 0|768,\r\n        LeftBottom: 0|1024,\r\n        RightTop: 2|768,\r\n        RightBottom: 2|1024,\r\n        TopLeft: 1|256,\r\n        TopRight: 1|512,\r\n        BottomLeft: 3|256,\r\n        BottomRight: 3|512,\r\n        \r\n        LeftCustom: 0|1280,\r\n\t\tTopCustom: 1|1280,\r\n\t\tRightCustom: 2|1280,\r\n\t\tBottomCustom: 3|1280\r\n    },\r\n    \r\n   \r\n    \r\n    poiUIType: {\r\n        Normal: 0, //\r\n        CameraOriented: 1, //\r\n        CameraOrientedKeepSize: 2, //\r\n    },\r\n    \r\n    //\r\n    auxControlType : {\r\n        AXIS_X: 1,\r\n        AXIS_Y: 2,\r\n        AXIS_Z: 4,\r\n        PLANE_XOY: 16,\r\n        PLANE_YOZ: 32,\r\n        PLANE_ZOX: 64\r\n    },\r\n\r\n    //\r\n    auxOperateType : {\r\n        Hide: 0,\r\n        Translate: 1,\r\n        Rotate: 2,\r\n        Scale: 3,\r\n    },    \r\n    \r\n    //\r\n    lineType: {\r\n        StraightLine: 0,//\r\n        Bessel: 1,//\r\n        Parabola: 2, //\r\n    },\r\n\r\n    //\r\n    camViewType : {\r\n        Front: 0,//\r\n        Top: 1,//\r\n        Side: 2,//\r\n        Axis: 3,//\r\n    },    \r\n    \r\n    //UI\r\n    videoSourceType: {\r\n        VIDSRC_LOCAL: 0,//\r\n        VIDSRC_NETSTREAM: 1,//\r\n    },\r\n    \r\n    //\r\n\texitType: {\r\n\t\tSaveAndExit: 1,\r\n\t\tDeleteAndExit: 2,\r\n\t},\r\n    \r\n    //\r\n\theatMapCalcType: {\r\n\t\tNearBy: 1, //\r\n\t\tAverage: 2, //\r\n        SquaredWeighted: 3, //\r\n        RangeAttenuation: 4, //        \r\n\t},\r\n    \r\n    //\r\n\tDecalTexFillMode: {\r\n\t\tFillOnly: 1, //\r\n\t\tFrameOnly: 2, //\r\n        FillAndFrame: 3, //+ \r\n\t},\r\n    \r\n    //\r\n\tDecalMode: {\r\n\t\tOpBlendAlpha: 0, //alpha\r\n\t\tOpBlendColor: 1, //\r\n        OpAdd: 3, //\r\n        OpModulate: 4, //\r\n\t},\r\n   \r\n};\r\n","/*\r\n * @namespace Util\r\n *\r\n *  \r\n */\r\n\r\nQ3D.Util = {\r\n\r\n\t// @function extend(dest: Object, src?: Object): Object\r\n\t//   src  dest  dest  `Q3D.extend()`  \r\n\textend: function (dest) {\r\n\t\tvar i, j, len, src;\r\n\r\n\t\tfor (j = 1, len = arguments.length; j < len; j++) {\r\n\t\t\tsrc = arguments[j];\r\n\t\t\tfor (i in src) {                \r\n                dest[i] = src[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn dest;\r\n\t},\r\n    \r\n    deepExtend : function(target, options) {  \r\n        for (name in options) {  \r\n            copy = options[name];  \r\n            if (copy instanceof Array) {  \r\n                this.deepExtend(target[name], copy);  \r\n            } else if (copy instanceof Object) {  \r\n                this.deepExtend(target[name], copy);  \r\n            } else {  \r\n                target[name] = options[name];  \r\n            }  \r\n        }  \r\n        return target;  \r\n    }, \r\n    \r\n    deepCopy: function(source) {\r\n        var result = {};\r\n        for (var key in source) {\r\n            result[key] = typeof source[key] === 'object' ? this.deepCopy(source[key]) : source[key];\r\n        }\r\n        return result;\r\n    },\r\n\r\n    \r\n    //jquery$.extend/\r\n    jQueryExtend: function(){\r\n        // `0`\r\n        var options, name, src, copy, \r\n            target = arguments[0] || {}, // 0\r\n            i = 1,    // i10\r\n            length = arguments.length,\r\n            deep = false;  // \r\n        \r\n        // 00booleantruefalse\r\n        // 1i\r\n        // Handle a deep copy situation\r\n        if ( typeof target === \"boolean\" ) {\r\n            deep = target;        \r\n            // Skip the boolean and the target\r\n            target = arguments[ i ] || {};\r\n            i++;\r\n        }\r\n        \r\n        //  objectfunction \r\n        // Handle case when target is a string or something (possible in deep copy)\r\n        if ( typeof target !== \"object\" && !this.isFunction(target) ) {\r\n            target = {};\r\n        }\r\n        \r\n        // $.extend({_name:'wenzi'}), $.extend(true, {_name:'wenzi'})\r\n        // jQuerytarget\r\n        // Extend jQuery itself if only one argument is passed\r\n        if ( i === length ) {\r\n            target = this;\r\n            i--;\r\n        }\r\n        \r\n        // i\r\n        for ( ; i < length; i++ ) {\r\n            // inull\r\n            // $.extend(target, {}, null);2null\r\n            // Only deal with non-null/undefined values\r\n            if ( (options = arguments[ i ]) != null ) {\r\n        \r\n                // for~in\r\n                // Extend the base object\r\n                for ( name in options ) {\r\n                    src = target[ name ];   // name\r\n                    copy = options[ name ]; // name\r\n        \r\n                    // \r\n                    // \r\n                    // Prevent never-ending loop\r\n                    if ( target === copy ) {\r\n                        continue;\r\n                    }\r\n        \r\n                    // deeptruenameobjectArray\r\n                    // Recurse if we're merging plain objects or arrays\r\n                    //if ( deep && copy && ( this.isPlainObject(copy) || (copyIsArray = this.isArray(copy)) ) ) {\r\n                    if ( deep && copy && typeof copy == \"object\" && !copy.nodeType ) {\r\n                        \r\n                        // nameArray\r\n                        // name\r\n                        if (  this.isArray(copy) ) {\r\n                            //clone = src && this.isArray(src) ? src : [];\r\n                            target[ name ] = copy.concat();\r\n                        }\r\n                        else if ( this.isQMapObj(copy) )\r\n                        {\r\n                            target[ name ] = copy;\r\n                        } else {\r\n                            // \r\n                            //clone = src && this.isPlainObject(src) ? src : {};\r\n                            //\r\n                            target[ name ] = this.jQueryExtend( deep, (src || {}), copy);\r\n                        }\r\n        \r\n                        // 2.2\r\n                        // Never move original objects, clone them                      \r\n                        //target[ name ] = this.jQueryExtend( deep, clone, copy );                           \r\n        \r\n                    // deepfalse\r\n                    // copy\r\n                    // Don't bring in undefined values\r\n                    } else if ( copy !== undefined ) {\r\n                        // name\r\n                        target[ name ] = copy;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        \r\n        // \r\n        // Return the modified object\r\n        return target;\r\n        \r\n    \r\n    },\r\n\r\n\t// @function create(proto: Object): Object\r\n\t// \r\n\tcreate: Object.create || (function () {\r\n\t\tfunction F() {}\r\n\t\treturn function (proto) {\r\n\t\t\tF.prototype = proto;\r\n\t\t\treturn new F();\r\n\t\t};\r\n\t})(),\r\n\r\n\t// @function bind(fn: Function, ): Function\r\n\t//   `Q3D.bind()`  \r\n\tbind: function (fn, obj) {\r\n\t\tvar slice = Array.prototype.slice;\r\n\r\n\t\tif (fn.bind) {\r\n\t\t\treturn fn.bind.apply(fn, slice.call(arguments, 1));\r\n\t\t}\r\n\r\n\t\tvar args = slice.call(arguments, 2);\r\n\r\n\t\treturn function () {\r\n\t\t\treturn fn.apply(obj, args.length ? args.concat(slice.call(arguments)) : arguments);\r\n\t\t};\r\n\t},\r\n\r\n\t// @function stamp(obj: Object): Number\r\n\t//  IDID\r\n\tstamp: function (obj) {\r\n\t\t/*eslint-disable */\r\n\t\tobj._qmap3d_id = obj._qmap3d_id || ++Q3D.Util.lastId;\r\n\t\treturn obj._qmap3d_id;\r\n\t\t/*eslint-enable */\r\n\t},\r\n\r\n\t// @property lastId: Number\r\n\t//  ID\r\n\tlastId: 0,\r\n\r\n\t// \r\n\t// Returns a function which executes function `fn` with the given scope `context`\r\n\t// (so that the `this` keyword refers to `context` inside `fn`'s code). The function\r\n\t// `fn` will be called no more than one time per given amount of `time`. The arguments\r\n\t// received by the bound function will be any arguments passed when binding the\r\n\t// function, followed by any arguments passed when invoking the bound function.\r\n\t// Has an `Q3D.bind` shortcut.\r\n\tthrottle: function (fn, time, context) {\r\n\t\tvar lock, args, wrapperFn, later;\r\n\r\n\t\tlater = function () {\r\n\t\t\t// reset lock and call if queued\r\n\t\t\tlock = false;\r\n\t\t\tif (args) {\r\n\t\t\t\twrapperFn.apply(context, args);\r\n\t\t\t\targs = false;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\twrapperFn = function () {\r\n\t\t\tif (lock) {\r\n\t\t\t\t// called too soon, queue to call later\r\n\t\t\t\targs = arguments;\r\n\r\n\t\t\t} else {\r\n\t\t\t\t// call and lock until later\r\n\t\t\t\tfn.apply(context, arguments);\r\n\t\t\t\tsetTimeout(later, time);\r\n\t\t\t\tlock = true;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn wrapperFn;\r\n\t},\r\n\r\n\t// \r\n\t//  Returns the number `num` modulo `range` in such a way so it lies within\r\n\t// `range[0]` and `range[1]`. The returned value will be always smaller than\r\n\t// `range[1]` unless `includeMax` is set to `true`.\r\n\twrapNum: function (x, range, includeMax) {\r\n\t\tvar max = range[1],\r\n\t\t    min = range[0],\r\n\t\t    d = max - min;\r\n\t\treturn x === max && includeMax ? x : ((x - min) % d + d) % d + min;\r\n\t},\r\n\r\n\t// @function falseFn(): Function\r\n\t//   returns `false`.\r\n\tfalseFn: function () { return false; },\r\n\r\n\t// @function formatNum(num: Number, digits?: Number): Number\r\n\t//   `num`   `digits`   5 \r\n\tformatNum: function (num, digits) {\r\n\t\tvar pow = Math.pow(10, digits || 5);\r\n\t\treturn Math.round(num * pow) / pow;\r\n\t},\r\n\r\n\t// @function trim(str: String): String\r\n\t// \r\n\ttrim: function (str) {\r\n\t\treturn str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\r\n\t},\r\n\r\n\t// @function splitWords(str: String): String[]\r\n\t//  \r\n\tsplitWords: function (str) {\r\n\t\treturn Q3D.Util.trim(str).split(/\\s+/);\r\n\t},\r\n\r\n\t// @function setOptions(obj: Object, options: Object): Object\r\n\t//    `obj`   `options`   `Q3D.setOptions`  \r\n\tsetOptions: function (obj, options) {\r\n\t\tif (!obj.hasOwnProperty('options')) {\r\n\t\t\tobj.options = obj.options ? Q3D.Util.create(obj.options) : {};\r\n\t\t}\r\n\t\tfor (var i in options) {\r\n            obj.options[i] = options[i]; \r\n\t\t}\r\n\t\treturn obj.options;\r\n\t},\r\n\r\n\t    \r\n\t// @function getParamString(obj: Object, existingUrl?: String, uppercase?: Boolean): String\r\n\t//   URL  `{a: \"foo\", b: \"bar\"}`   '?a=foo&b=bar'`\r\n\t//   existingUrl`   `uppercase`  \r\n\tgetParamString: function (obj, existingUrl, uppercase) {\r\n\t\tvar params = [];\r\n\t\tfor (var i in obj) {\r\n\t\t\tparams.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\r\n\t\t}\r\n\t\treturn ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\r\n\t},\r\n\r\n\t// @function template(str: String, data: Object): String\r\n\t//  `'Hello {a}, {b}'`    `{a: 'foo', b: 'bar'}`\r\n    // ('Hello foo, bar')`\r\n\ttemplate: function (str, data) {\r\n\t\treturn str.replace(Q3D.Util.templateRe, function (str, key) {\r\n\t\t\tvar value = data[key];\r\n\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tthrow new Error('No value provided for variable ' + str);\r\n\r\n\t\t\t} else if (typeof value === 'function') {\r\n\t\t\t\tvalue = value(data);\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t});\r\n\t},\r\n\r\n\ttemplateRe: /\\{ *([\\w_\\-]+) *\\}/g,\r\n\r\n\t// @function isArray(obj): Boolean\r\n\t// \r\n\tisArray: Array.isArray || function (obj) {\r\n\t\treturn (Object.prototype.toString.call(obj) === '[object Array]');\r\n\t},\r\n\t// @function isFunction(obj): Boolean\r\n\t//     \r\n    isFunction: function( obj ) {\r\n        return typeof  obj === \"function\";\r\n    },\r\n\t// @function isNumber(obj): Boolean\r\n\t// \r\n    isNumber: function(obj) {\r\n        return typeof obj === 'number' && isFinite(obj);\r\n    },\r\n    // @function isInteger(obj): Boolean\r\n\t// \r\n    isInteger: function(obj) {\r\n        return typeof obj === 'number' && obj % 1 === 0;\r\n    },\r\n    // @function isDefined(obj): Boolean\r\n\t// \r\n    isDefined: function(obj) {\r\n        return typeof obj !== 'undefined';\r\n    },\r\n    isQMapObj: function(obj, clsID) {\r\n        try {\r\n            if (typeof obj.getCLSID() == \"string\") {\r\n                if (clsID === undefined)\r\n                    return true;\r\n                if (typeof (clsID) == \"string\" && obj.getCLSID() == clsID)\r\n                    return true;\r\n                else\r\n                    return false;\r\n            } \r\n        } catch (e) {}\r\n        return false;\r\n    },\r\n    isJson: function(obj) {  \r\n        return typeof(obj) == \"object\" && Object.prototype.toString.call(obj).toLowerCase() == \"[object object]\" && !obj.length;  \r\n    },\r\n\r\n\t// @function indexOf(array: Array, el: Object): Number\r\n\t//   -1\r\n\tindexOf: function (array, el) {\r\n\t\tfor (var i = 0; i < array.length; i++) {\r\n\t\t\tif (array[i] === el) { return i; }\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n    \r\n\t// \r\n\t// Data URI string containing a base64-encoded empty GIF image.\r\n\t// Used as a hack to free memory from unused images on WebKit-powered\r\n\t// mobile devices (by setting image `src` to this string).\r\n\temptyImageUrl: 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='\r\n};\r\n\r\n(function () {\r\n\t// inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n\r\n\tfunction getPrefixed(name) {\r\n\t\treturn window['webkit' + name] || window['moz' + name] || window['ms' + name];\r\n\t}\r\n\r\n\tvar lastTime = 0;\r\n\r\n\t// fallback for IE 7-8\r\n\tfunction timeoutDefer(fn) {\r\n\t\tvar time = +new Date(),\r\n\t\t    timeToCall = Math.max(0, 16 - (time - lastTime));\r\n\r\n\t\tlastTime = time + timeToCall;\r\n\t\treturn window.setTimeout(fn, timeToCall);\r\n\t}\r\n\r\n\tvar requestFn = window.requestAnimationFrame || getPrefixed('RequestAnimationFrame') || timeoutDefer,\r\n\t    cancelFn = window.cancelAnimationFrame || getPrefixed('CancelAnimationFrame') ||\r\n\t               getPrefixed('CancelRequestAnimationFrame') || function (id) { window.clearTimeout(id); };\r\n\r\n\r\n\t// \r\n\t// Schedules `fn` to be executed when the browser repaints. `fn` is bound to\r\n\t// `context` if given. When `immediate` is set, `fn` is called immediately if\r\n\t// the browser doesn't have native support for\r\n\t// [`window.requestAnimationFrame`](https://developer.mozilla.org/docs/Web/API/window/requestAnimationFrame),\r\n\t// otherwise it's delayed. Returns a request ID that can be used to cancel the request.\r\n\tQ3D.Util.requestAnimFrame = function (fn, context, immediate) {\r\n\t\tif (immediate && requestFn === timeoutDefer) {\r\n\t\t\tfn.call(context);\r\n\t\t} else {\r\n\t\t\treturn requestFn.call(window, Q3D.bind(fn, context));\r\n\t\t}\r\n\t};\r\n\r\n\t// \r\n\t// Cancels a previous `requestAnimFrame`. See also [window.cancelAnimationFrame](https://developer.mozilla.org/docs/Web/API/window/cancelAnimationFrame).\r\n\tQ3D.Util.cancelAnimFrame = function (id) {\r\n\t\tif (id) {\r\n\t\t\tcancelFn.call(window, id);\r\n\t\t}\r\n\t};\r\n})();\r\n\r\n// shortcuts for most used utility functions\r\nQ3D.extend = Q3D.Util.extend;\r\nQ3D.bind = Q3D.Util.bind;\r\nQ3D.stamp = Q3D.Util.stamp;\r\nQ3D.setOptions = Q3D.Util.setOptions;\r\n","/*\r\n * @namespace DomUtil\r\n *\r\n * Utility functions to work with the [DOM](https://developer.mozilla.org/docs/Web/API/Document_Object_Model)\r\n * tree, used by QMap3dJS internally.\r\n *\r\n * Most functions expecting or returning a `HTMLElement` also work for\r\n * SVG elements. The only difference is that classes refer to CSS classes\r\n * in HTML and SVG classes in SVG.\r\n */\r\n\r\nQ3D.DomUtil = {\r\n\r\n\t// @function get(id: String|HTMLElement): HTMLElement\r\n\t// Returns an element given its DOM id, or returns the element itself\r\n\t// if it was passed directly.\r\n\tget: function (id) {\r\n\t\treturn typeof id === 'string' ? document.getElementById(id) : id;\r\n\t},\r\n    \r\n    getIdByScript: function (e) {\r\n        var scripts = document.getElementsByTagName(\"script\");\r\n        for (var i = scripts.length - 1; i >= 0 ; i--) {\r\n            if (scripts[i][\"event\"].indexOf(e) > -1)\r\n                return scripts[i].getAttribute(\"for\");\r\n        }\r\n\t\treturn null;\r\n\t},\r\n\r\n\t// @function getStyle(el: HTMLElement, styleAttrib: String): String\r\n\t// Returns the value for a certain style attribute on an element,\r\n\t// including computed values or values set through CSS.\r\n\tgetStyle: function (el, style) {\r\n\r\n\t\tvar value = el.style[style] || (el.currentStyle && el.currentStyle[style]);\r\n\r\n\t\tif ((!value || value === 'auto') && document.defaultView) {\r\n\t\t\tvar css = document.defaultView.getComputedStyle(el, null);\r\n\t\t\tvalue = css ? css[style] : null;\r\n\t\t}\r\n\r\n\t\treturn value === 'auto' ? null : value;\r\n\t},\r\n\r\n\t// @function create(tagName: String, className?: String, container?: HTMLElement): HTMLElement\r\n\t// Creates an HTML element with `tagName`, sets its class to `className`, and optionally appends it to `container` element.\r\n\tcreate: function (tagName, className, container) {\r\n\r\n\t\tvar el = document.createElement(tagName);\r\n\t\tel.className = className || '';\r\n\r\n\t\tif (container) {\r\n\t\t\tcontainer.appendChild(el);\r\n\t\t}\r\n\r\n\t\treturn el;\r\n\t},\r\n\r\n\t// @function remove(el: HTMLElement)\r\n\t// Removes `el` from its parent element\r\n\tremove: function (el) {\r\n\t\tvar parent = el.parentNode;\r\n\t\tif (parent) {\r\n\t\t\tparent.removeChild(el);\r\n\t\t}\r\n\t},\r\n\r\n\t// @function empty(el: HTMLElement)\r\n\t// Removes all of `el`'s children elements from `el`\r\n\tempty: function (el) {\r\n\t\twhile (el.firstChild) {\r\n\t\t\tel.removeChild(el.firstChild);\r\n\t\t}\r\n\t},\r\n\r\n\t// @function toFront(el: HTMLElement)\r\n\t// Makes `el` the last children of its parent, so it renders in front of the other children.\r\n\ttoFront: function (el) {\r\n\t\tel.parentNode.appendChild(el);\r\n\t},\r\n\r\n\t// @function toBack(el: HTMLElement)\r\n\t// Makes `el` the first children of its parent, so it renders back from the other children.\r\n\ttoBack: function (el) {\r\n\t\tvar parent = el.parentNode;\r\n\t\tparent.insertBefore(el, parent.firstChild);\r\n\t},\r\n\r\n\t// @function hasClass(el: HTMLElement, name: String): Boolean\r\n\t// Returns `true` if the element's class attribute contains `name`.\r\n\thasClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\treturn el.classList.contains(name);\r\n\t\t}\r\n\t\tvar className = Q3D.DomUtil.getClass(el);\r\n\t\treturn className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\r\n\t},\r\n\r\n\t// @function addClass(el: HTMLElement, name: String)\r\n\t// Adds `name` to the element's class attribute.\r\n\taddClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\tvar classes = Q3D.Util.splitWords(name);\r\n\t\t\tfor (var i = 0, len = classes.length; i < len; i++) {\r\n\t\t\t\tel.classList.add(classes[i]);\r\n\t\t\t}\r\n\t\t} else if (!Q3D.DomUtil.hasClass(el, name)) {\r\n\t\t\tvar className = Q3D.DomUtil.getClass(el);\r\n\t\t\tQ3D.DomUtil.setClass(el, (className ? className + ' ' : '') + name);\r\n\t\t}\r\n\t},\r\n\r\n\t// @function removeClass(el: HTMLElement, name: String)\r\n\t// Removes `name` from the element's class attribute.\r\n\tremoveClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\tel.classList.remove(name);\r\n\t\t} else {\r\n\t\t\tQ3D.DomUtil.setClass(el, Q3D.Util.trim((' ' + Q3D.DomUtil.getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\r\n\t\t}\r\n\t},\r\n\r\n\t// @function setClass(el: HTMLElement, name: String)\r\n\t// Sets the element's class.\r\n\tsetClass: function (el, name) {\r\n\t\tif (el.className.baseVal === undefined) {\r\n\t\t\tel.className = name;\r\n\t\t} else {\r\n\t\t\t// in case of SVG element\r\n\t\t\tel.className.baseVal = name;\r\n\t\t}\r\n\t},\r\n\r\n\t// @function getClass(el: HTMLElement): String\r\n\t// Returns the element's class.\r\n\tgetClass: function (el) {\r\n\t\treturn el.className.baseVal === undefined ? el.className : el.className.baseVal;\r\n\t},\r\n\r\n\t// @function setOpacity(el: HTMLElement, opacity: Number)\r\n\t// Set the opacity of an element (including old IE support).\r\n\t// `opacity` must be a number from `0` to `1`.\r\n\tsetOpacity: function (el, value) {\r\n\r\n\t\tif ('opacity' in el.style) {\r\n\t\t\tel.style.opacity = value;\r\n\r\n\t\t} else if ('filter' in el.style) {\r\n\t\t\tQ3D.DomUtil._setOpacityIE(el, value);\r\n\t\t}\r\n\t},\r\n\r\n\t_setOpacityIE: function (el, value) {\r\n\t\tvar filter = false,\r\n\t\t    filterName = 'DXImageTransform.Microsoft.Alpha';\r\n\r\n\t\t// filters collection throws an error if we try to retrieve a filter that doesn't exist\r\n\t\ttry {\r\n\t\t\tfilter = el.filters.item(filterName);\r\n\t\t} catch (e) {\r\n\t\t\t// don't set opacity to 1 if we haven't already set an opacity,\r\n\t\t\t// it isn't needed and breaks transparent pngs.\r\n\t\t\tif (value === 1) { return; }\r\n\t\t}\r\n\r\n\t\tvalue = Math.round(value * 100);\r\n\r\n\t\tif (filter) {\r\n\t\t\tfilter.Enabled = (value !== 100);\r\n\t\t\tfilter.Opacity = value;\r\n\t\t} else {\r\n\t\t\tel.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\r\n\t\t}\r\n\t},\r\n\r\n\t// @function testProp(props: String[]): String|false\r\n\t// Goes through the array of style names and returns the first name\r\n\t// that is a valid style name for an element. If no such name is found,\r\n\t// it returns false. Useful for vendor-prefixed styles like `transform`.\r\n\ttestProp: function (props) {\r\n\r\n\t\tvar style = document.documentElement.style;\r\n\r\n\t\tfor (var i = 0; i < props.length; i++) {\r\n\t\t\tif (props[i] in style) {\r\n\t\t\t\treturn props[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t// @function setTransform(el: HTMLElement, offset: Point, scale?: Number)\r\n\t// Resets the 3D CSS transform of `el` so it is translated by `offset` pixels\r\n\t// and optionally scaled by `scale`. Does not have an effect if the\r\n\t// browser doesn't support 3D CSS transforms.\r\n\tsetTransform: function (el, offset, scale) {\r\n\t\tvar pos = offset || new Q3D.Point(0, 0);\r\n\r\n\t\tel.style[Q3D.DomUtil.TRANSFORM] =\r\n\t\t\t(Q3D.Browser.ie3d ?\r\n\t\t\t\t'translate(' + pos.x + 'px,' + pos.y + 'px)' :\r\n\t\t\t\t'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\r\n\t\t\t(scale ? ' scale(' + scale + ')' : '');\r\n\t},\r\n\r\n\t// @function setPosition(el: HTMLElement, position: Point)\r\n\t// Sets the position of `el` to coordinates specified by `position`,\r\n\t// using CSS translate or top/left positioning depending on the browser\r\n\t// (used by Leaflet internally to position its layers).\r\n\tsetPosition: function (el, point) { // (HTMLElement, Point[, Boolean])\r\n\r\n\t\t/*eslint-disable */\r\n\t\tel._leaflet_pos = point;\r\n\t\t/*eslint-enable */\r\n\r\n\t\tif (Q3D.Browser.any3d) {\r\n\t\t\tQ3D.DomUtil.setTransform(el, point);\r\n\t\t} else {\r\n\t\t\tel.style.left = point.x + 'px';\r\n\t\t\tel.style.top = point.y + 'px';\r\n\t\t}\r\n\t},\r\n\r\n\t// @function getPosition(el: HTMLElement): Point\r\n\t// Returns the coordinates of an element previously positioned with setPosition.\r\n\tgetPosition: function (el) {\r\n\t\t// this method is only used for elements previously positioned using setPosition,\r\n\t\t// so it's safe to cache the position for performance\r\n\r\n\t\treturn el._leaflet_pos || new Q3D.Point(0, 0);\r\n\t}\r\n};\r\n\r\n\r\n(function () {\r\n\t// prefix style property names\r\n\r\n\t// @property TRANSFORM: String\r\n\t// Vendor-prefixed fransform style name (e.g. `'webkitTransform'` for WebKit).\r\n\tQ3D.DomUtil.TRANSFORM = Q3D.DomUtil.testProp(\r\n\t\t\t['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\r\n\r\n\r\n\t// webkitTransition comes first because some browser versions that drop vendor prefix don't do\r\n\t// the same for the transitionend event, in particular the Android 4.1 stock browser\r\n\r\n\t// @property TRANSITION: String\r\n\t// Vendor-prefixed transform style name.\r\n\tvar transition = Q3D.DomUtil.TRANSITION = Q3D.DomUtil.testProp(\r\n\t\t\t['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\r\n\r\n\tQ3D.DomUtil.TRANSITION_END =\r\n\t\t\ttransition === 'webkitTransition' || transition === 'OTransition' ? transition + 'End' : 'transitionend';\r\n\r\n\t// @function disableTextSelection()\r\n\t// Prevents the user from generating `selectstart` DOM events, usually generated\r\n\t// when the user drags the mouse through a page with text. Used internally\r\n\t// by Leaflet to override the behaviour of any click-and-drag interaction on\r\n\t// the map. Affects drag interactions on the whole document.\r\n\r\n\t// @function enableTextSelection()\r\n\t// Cancels the effects of a previous [`Q3D.DomUtil.disableTextSelection`](#domutil-disabletextselection).\r\n\tif ('onselectstart' in document) {\r\n\t\tQ3D.DomUtil.disableTextSelection = function () {\r\n\t\t\tQ3D.DomEvent.on(window, 'selectstart', Q3D.DomEvent.preventDefault);\r\n\t\t};\r\n\t\tQ3D.DomUtil.enableTextSelection = function () {\r\n\t\t\tQ3D.DomEvent.off(window, 'selectstart', Q3D.DomEvent.preventDefault);\r\n\t\t};\r\n\r\n\t} else {\r\n\t\tvar userSelectProperty = Q3D.DomUtil.testProp(\r\n\t\t\t['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\r\n\r\n\t\tQ3D.DomUtil.disableTextSelection = function () {\r\n\t\t\tif (userSelectProperty) {\r\n\t\t\t\tvar style = document.documentElement.style;\r\n\t\t\t\tthis._userSelect = style[userSelectProperty];\r\n\t\t\t\tstyle[userSelectProperty] = 'none';\r\n\t\t\t}\r\n\t\t};\r\n\t\tQ3D.DomUtil.enableTextSelection = function () {\r\n\t\t\tif (userSelectProperty) {\r\n\t\t\t\tdocument.documentElement.style[userSelectProperty] = this._userSelect;\r\n\t\t\t\tdelete this._userSelect;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t// @function disableImageDrag()\r\n\t// As [`Q3D.DomUtil.disableTextSelection`](#domutil-disabletextselection), but\r\n\t// for `dragstart` DOM events, usually generated when the user drags an image.\r\n\tQ3D.DomUtil.disableImageDrag = function () {\r\n\t\tQ3D.DomEvent.on(window, 'dragstart', Q3D.DomEvent.preventDefault);\r\n\t};\r\n\r\n\t// @function enableImageDrag()\r\n\t// Cancels the effects of a previous [`Q3D.DomUtil.disableImageDrag`](#domutil-disabletextselection).\r\n\tQ3D.DomUtil.enableImageDrag = function () {\r\n\t\tQ3D.DomEvent.off(window, 'dragstart', Q3D.DomEvent.preventDefault);\r\n\t};\r\n\r\n\t// @function preventOutline(el: HTMLElement)\r\n\t// Makes the [outline](https://developer.mozilla.org/docs/Web/CSS/outline)\r\n\t// of the element `el` invisible. Used internally by Leaflet to prevent\r\n\t// focusable elements from displaying an outline when the user performs a\r\n\t// drag interaction on them.\r\n\tQ3D.DomUtil.preventOutline = function (element) {\r\n\t\twhile (element.tabIndex === -1) {\r\n\t\t\telement = element.parentNode;\r\n\t\t}\r\n\t\tif (!element || !element.style) { return; }\r\n\t\tQ3D.DomUtil.restoreOutline();\r\n\t\tthis._outlineElement = element;\r\n\t\tthis._outlineStyle = element.style.outline;\r\n\t\telement.style.outline = 'none';\r\n\t\tQ3D.DomEvent.on(window, 'keydown', Q3D.DomUtil.restoreOutline, this);\r\n\t};\r\n\r\n\t// @function restoreOutline()\r\n\t// Cancels the effects of a previous [`Q3D.DomUtil.preventOutline`]().\r\n\tQ3D.DomUtil.restoreOutline = function () {\r\n\t\tif (!this._outlineElement) { return; }\r\n\t\tthis._outlineElement.style.outline = this._outlineStyle;\r\n\t\tdelete this._outlineElement;\r\n\t\tdelete this._outlineStyle;\r\n\t\tQ3D.DomEvent.off(window, 'keydown', Q3D.DomUtil.restoreOutline, this);\r\n\t};\r\n})();\r\n","/*\r\n * @namespace Browser\r\n * @aka Q3D.Browser\r\n *\r\n * \r\n *\r\n * @example\r\n *\r\n * ```js\r\n * if (Q3D.Browser.ielt9) {\r\n *   alert('!');\r\n * }\r\n * ```\r\n */\r\n\r\n(function () {\r\n\r\n\tvar ua = navigator.userAgent.toLowerCase(),\r\n\t    //doc = document.documentElement,\r\n\r\n\t    ie = 'ActiveXObject' in window,\r\n\r\n\t    webkit    = ua.indexOf('webkit') !== -1,\r\n\t    //phantomjs = ua.indexOf('phantom') !== -1,\r\n\t    chrome    = ua.indexOf('chrome') !== -1,\r\n\t    gecko     = ua.indexOf('gecko') !== -1  && !webkit && !window.opera && !ie,\r\n\r\n\t    win = navigator.platform.indexOf('Win') === 0,\r\n\r\n\t    msPointer = !window.PointerEvent && window.MSPointerEvent,\r\n\t    pointer = window.PointerEvent || msPointer;\r\n\r\n\r\n\tvar touch = !window.L_NO_TOUCH && (pointer || 'ontouchstart' in window ||\r\n\t\t\t(window.DocumentTouch && document instanceof window.DocumentTouch));\r\n\r\n\tQ3D.Browser = {\r\n\r\n\t\t// @property ie: Boolean\r\n\t\t//   I E  Edge\r\n\t\tie: ie,\r\n\r\n\t\t// @property ielt9: Boolean\r\n\t\t// `true`   IE  < 9\r\n        ielt9: ie && !document.addEventListener,\r\n        \r\n        // @property ie11: Boolean\r\n\t\t// `true`   IE 11\r\n\t\tie11: ie && !document.attachEvent,\r\n\r\n\t\t// @property edge: Boolean\r\n\t\t// `true`   Edge \r\n\t\tedge: 'msLaunchUri' in navigator && !('documentMode' in document),\r\n\r\n\t\t// @property webkit: Boolean\r\n\t\t// `true`   webkit  Chrome  Safari \r\n\t\twebkit: webkit,\r\n\r\n\t\t// @property gecko: Boolean\r\n\t\t// `true`   gecko   Firefox\r\n\t\tgecko: gecko,\r\n\t\t\r\n\t\t// @property chrome: Boolean\r\n\t\t// `true`   Chrome \r\n\t\tchrome: chrome,\r\n\r\n\t\t// @property safari: Boolean\r\n\t\t// `true`   Safari \r\n\t\tsafari: !chrome && ua.indexOf('safari') !== -1,\r\n\r\n\t\t// @property win: Boolean\r\n\t\t// `true`   Windows \r\n\t\twin: win,\r\n\r\n\t// @property touch: Boolean\r\n\t\t// `true`  \r\n\t\ttouch: !!touch,\r\n\r\n\t\t// \r\n\t\t// `true` for browsers implementing the Microsoft touch events model (notably IE10).\r\n\t\tmsPointer: !!msPointer,\r\n\r\n\t\t// \r\n\t\t// `true` for all browsers supporting [pointer events](https://msdn.microsoft.com/en-us/library/dn433244%28v=vs.85%29.aspx).\r\n\t\tpointer: !!pointer\r\n\t};\r\n\r\n}());\r\n","\r\n// @class Class\r\n// @aka Q3D.Class\r\n\r\n// @section\r\n// @uninheritable\r\n\r\nQ3D.Class = function () {};\r\n\r\nQ3D.Class.extend = function (props) {\r\n\r\n\t// @function extend(props: Object): Function\r\n\t// [](#class-inheritance)  \r\n\t//  Javascript  ( `new`  ) \r\n\tvar NewClass = function () {\r\n\r\n\t\t// call the constructor\r\n\t\tif (this.initialize) {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\t// call all constructor hooks\r\n\t\tthis.callInitHooks();\r\n\t};\r\n\r\n\tvar parentProto = NewClass.__super__ = this.prototype;\r\n\r\n\tvar proto = Q3D.Util.create(parentProto);\r\n\tproto.constructor = NewClass;\r\n\r\n\tNewClass.prototype = proto;\r\n\r\n\t// inherit parent's statics\r\n\tfor (var i in this) {\r\n\t\tif (this.hasOwnProperty(i) && i !== 'prototype') {\r\n\t\t\tNewClass[i] = this[i];\r\n\t\t}\r\n\t}\r\n\r\n\t// mix static properties into the class\r\n\tif (props.statics) {\r\n\t\tQ3D.extend(NewClass, props.statics);\r\n\t\tdelete props.statics;\r\n\t}\r\n\r\n\t// mix includes into the prototype\r\n\tif (props.includes) {\r\n\t\tQ3D.Util.extend.apply(null, [proto].concat(props.includes));\r\n\t\tdelete props.includes;\r\n\t}\r\n\r\n\t// merge options\r\n\tif (proto.options) {\r\n\t\tprops.options = Q3D.Util.extend(Q3D.Util.create(proto.options), props.options);\r\n\t}\r\n\r\n\t// mix given properties into the prototype\r\n\tQ3D.extend(proto, props);\r\n\r\n\tproto._initHooks = [];\r\n\r\n\t// add method for calling all hooks\r\n\tproto.callInitHooks = function () {\r\n\r\n\t\tif (this._initHooksCalled) { return; }\r\n\r\n\t\tif (parentProto.callInitHooks) {\r\n\t\t\tparentProto.callInitHooks.call(this);\r\n\t\t}\r\n\r\n\t\tthis._initHooksCalled = true;\r\n\r\n\t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n\t\t\tproto._initHooks[i].call(this);\r\n\t\t}\r\n\t};\r\n\r\n\treturn NewClass;\r\n};\r\n\r\n\r\n// @function include(properties: Object): this\r\n// [](#class-includes) \r\nQ3D.Class.include = function (props) {\r\n\tQ3D.extend(this.prototype, props);\r\n\treturn this;\r\n};\r\n\r\n// @function mergeOptions(options: Object): this\r\n// [ `options`](#class-options) \r\nQ3D.Class.mergeOptions = function (options) {\r\n\tQ3D.extend(this.prototype.options, options);\r\n\treturn this;\r\n};\r\n\r\n// \r\n// Adds a [constructor hook](#class-constructor-hooks) to the class.\r\nQ3D.Class.addInitHook = function (fn) { // (Function) || (String, args...)\r\n\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n\tvar init = typeof fn === 'function' ? fn : function () {\r\n\t\tthis[fn].apply(this, args);\r\n\t};\r\n\r\n\tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n\tthis.prototype._initHooks.push(init);\r\n\treturn this;\r\n};\r\n","\r\n/*\r\n * @class Evented\r\n * @aka Q3D.Evented\r\n * @inherits Class\r\n *\r\n * Evented Map\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * map.on('onCreateArea', function(area) {\r\n * \talert(area.getName());\r\n * } );\r\n * ```\r\n *\r\n * QMap3DJS :\r\n *\r\n * ```js\r\n * function onCreateAreaFn(area) { ... }\r\n *\r\n * map.on('onCreateAreaFn', onCreateAreaFn);\r\n * map.off('onCreateAreaFn', onCreateAreaFn);\r\n * ```\r\n * QMap3DJS :\r\n *\r\n * ```js\r\n * //wparamlparam1: Ctrl , 2: Alt, 4: Shift\r\n * // \r\n * function onKeyUpFn(wparam,lparam) { ... }\r\n *\r\n * //\r\n * map.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.O, onKeyUpFn);\r\n * // \r\n * map.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.O);\r\n * //\r\n * map.detachKeyEvent(\"OnKeyUp\");\r\n * //\r\n * map.setKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.O, false);  \r\n  * //\r\n * mapDiv.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.ALL, onKeyUpFn );       \r\n * ```\r\n *\r\n * QMap3DJS :\r\n *\r\n * ```js\r\n * function onMouseFn1(options) { ... }\r\n * function onMouseFn2(options) { ... }\r\n *\r\n * //\r\n * map.attachMouseEvent(\"OnLButtonDown\", \"test1\", onMouseFn1);\r\n * //\r\n * map.attachMouseEvent(\"OnLButtonDown\", \"test2\", onMouseFn2);\r\n * //\r\n * map.attachMouseEvent(\"OnLButtonDown\", \"test1\");\r\n * //\r\n * map.setMouseEvent(\"OnLButtonDown\", \"test1\", false);\r\n * //\r\n * map.detachMouseEvent(\"OnLButtonDown\", \"test2\"); \r\n * //\r\n * map.detachMouseEvent(\"OnLButtonDown\"); \r\n * ```\r\n *\r\n * QMap3DJS UI:\r\n *\r\n * ```js\r\n * function onUIBtnFn1(widget) { ... }\r\n *\r\n * //\r\n * map.attachUIEvent(\"onNotifyMouseButtonClick\", \"innerUI_Alert\", onUIBtnFn1);\r\n * //\r\n * map.detachUIEvent(\"onNotifyMouseButtonClick\",\"innerUI_Alert\"); \r\n * ```\r\n */\r\n \r\nQ3D.Evented = Q3D.Class.extend({    \r\n    \r\n    _keyUpFn:function (wparam, lparam) {\r\n        var typeListeners = mapObj._keyEvents[\"OnKeyUp\"];\r\n        if (!typeListeners) return;\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].key.wparam == wparam) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(wparam, lparam);\r\n                break;//return;\r\n            }\r\n        }   \r\n\t\tfor (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].key.wparam == -1) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(wparam, lparam);\r\n                return;\r\n            }\r\n        }         \r\n    },\r\n    \r\n    _keyDownFn:function (wparam, lparam) {\r\n        //debugger;\r\n        var typeListeners = mapObj._keyEvents[\"OnKeyDown\"];\r\n        if (!typeListeners) return;\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].key.wparam == wparam) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(wparam, lparam);\r\n                break;//return;\r\n            }\r\n        }     \r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].key.wparam == -1) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(wparam, lparam);\r\n                return;\r\n            }\r\n        }       \r\n    },\r\n    \r\n    _notifyMouseButtonClickFn:function (widget) {\r\n        //debugger;\r\n        var typeListeners = mapObj._widgetEvents[\"onNotifyMouseButtonClick\"];\r\n        if (!typeListeners) return;\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].key == widget.getName()) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(widget);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    \r\n    _movieClipInstancePassFrameFn:function (mci, frameIdx) {\r\n        //debugger;\r\n        var typeListeners = mapObj._widgetEvents[\"onMovieClipInstancePassFrame\"];\r\n        if (!typeListeners) return;\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].key == (mci.getCName()+\"/\"+frameIdx)) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(mci, frameIdx);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n     \r\n\t_actCtrlObjAniEnd:function (aco) {\r\n        //debugger;\r\n        var typeListeners = mapObj._widgetEvents[\"onActCtrlObjAniEnd\"];\r\n        if (!typeListeners) return;\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].key == (aco.getBinderAsNode().getName())) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(aco);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n\t\r\n    _widgetCloseFn:function (widget) {\r\n        //debugger;\r\n        var typeListeners = mapObj._widgetEvents[\"onWidgetClose\"];\r\n        if (!typeListeners) return;\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].key == widget) {\r\n                if (typeListeners[i].enabled) \r\n                    typeListeners[i].fn(widget);\r\n                mapObj.detachUIEvent(\"onWidgetClose\", widget);\r\n                mapObj.detachUIEvent(\"onUserNotifyEX\", widget);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    \r\n    _videoCtrlCloseFn:function (video) {\r\n        //debugger;\r\n        var typeListeners = mapObj._widgetEvents[\"onVideoCtrlClose\"];\r\n        if (!typeListeners) return;\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].key == video) {\r\n                if (typeListeners[i].enabled) \r\n                    typeListeners[i].fn(video);\r\n                mapObj.detachUIEvent(\"onVideoCtrlClose\", video);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    \r\n    _sceneNodeAllResourceCompletedFn:function (node) {\r\n        //debugger;\r\n        var typeListeners = mapObj._widgetEvents[\"onSceneNodeAllResourceCompleted\"];\r\n        if (!typeListeners) return;\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].key == mapObj.getSceneNodeFullName(node)) {\r\n                if (typeListeners[i].enabled) \r\n                    typeListeners[i].fn(node);\r\n                mapObj.detachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(node));\r\n                return;\r\n            }\r\n        }                \r\n    },   \r\n   \r\n    _userNotifyEXFn:function (widget, type, value) {\r\n        //debugger;\r\n        var typeListeners = mapObj._widgetEvents[\"onUserNotifyEX\"];\r\n        if (!typeListeners) return;\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].key == widget) {\r\n                if (typeListeners[i].enabled) \r\n                    typeListeners[i].fn(widget,type, value);                \r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    \r\n    _processInputParam:function (wparam, logx, logy, grdx, grdy, grdz) {\r\n        var shiftPressDown = false;\r\n        var ctrlPressDown = false;\r\n        switch (wparam) {            \r\n            case 5:\r\n            case 6:\r\n            case 20:\r\n                shiftPressDown = true;\r\n                ctrlPressDown = false;\r\n                break;\r\n            case 9:\r\n            case 10:\r\n            case 24:\r\n                shiftPressDown = false;\r\n                ctrlPressDown = true;\r\n                break;\r\n            case 13:\r\n            case 14:\r\n            case 28:\r\n                shiftPressDown = true;\r\n                ctrlPressDown = true;\r\n                break;            \r\n        }\r\n        var screenCoord = Q3D.vector2I(logx, logy).get();\r\n        var mainCam = mapObj._map3d.getWorldManager().getMainCamera(0);\r\n        var groundCoord = mainCam.getCrossCoord(screenCoord,65);//+\r\n        var nearestNode = mainCam.pickNearsetSceneNode(screenCoord, 65);\r\n        var areaCoord =  (nearestNode == null || groundCoord == null) ? null : nearestNode.getArea().toLocalPos(groundCoord);\r\n        var options = {\r\n                    logX: logx,\r\n                    logY: logy,\r\n                    groundX: groundCoord == null ? 0 : groundCoord.x,\r\n                    groundY: groundCoord == null ? 0 : groundCoord.y,\r\n                    groundZ: groundCoord == null ? 0 : groundCoord.z,\r\n                    NearestNode: nearestNode,\r\n                    ScreenCoord: screenCoord,\r\n                    GroundCoord: groundCoord,\r\n                    AreaCoord: areaCoord,\r\n                    ShiftPressDown: shiftPressDown,\r\n                    CtrlPressDown: ctrlPressDown\r\n        };\r\n        if (mapObj._enableDebug && console) {\r\n                    console.log(\"========================================================================================\");\r\n                    var operateTime = new Date();\r\n                    console.log(\"\" + operateTime.getHours() + \":\" + operateTime.getMinutes() + \":\" + operateTime.getSeconds());\r\n                    if (options.GroundCoord != null) {\r\n                        console.log(\"\" + options.GroundCoord.x.toFixed(6) + \",\" + options.GroundCoord.y.toFixed(6) + \",\" + options.GroundCoord.z.toFixed(6));\r\n                        //console.log(\"\" + options.GroundCoord.toQGlobalVec3d().toString());\r\n                        var v3d = Q3D.vector3d(options.GroundCoord);\r\n                        var  gv3d = Q3D.globalVec3d(v3d.toGlobalVec3d());\r\n                        console.log(\"\" + gv3d.longitude.toFixed(6) + \",\" + gv3d.latitude.toFixed(6) + \",\" + gv3d.height.toFixed(6));\r\n                        \r\n                    }\r\n                    if (options.NearestNode != null) {\r\n                        console.log(\"\" + options.NearestNode.getArea().getName());\r\n                        console.log(\"\"  + \"(\\\"\" + options.NearestNode.getArea().getName() + \"/\" + options.NearestNode.getName() + \"\\\")\");\r\n                        console.log(\"\" + (options.NearestNode.getParent() == null ? \"\" : \"(\\\"\" + options.NearestNode.getParent().getArea().getName() + \"/\" + options.NearestNode.getParent().getName() + \"\\\")\"));\r\n                    }\r\n                    console.log(\"========================================================================================\");\r\n        }\r\n\r\n        return options;\r\n    },\r\n    \r\n    _OnLButtonDownFn:function (wparam, logx, logy, grdx, grdy, grdz) {\r\n        //debugger;\r\n        var typeListeners = mapObj._mouseEvents[\"OnLButtonDown\"];\r\n        if (!typeListeners) return;\r\n        \r\n        var options = mapObj._processInputParam(wparam, logx, logy, grdx, grdy, grdz);\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].name == mapObj._mouseEventNames[\"OnLButtonDown\"]) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(options);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    \r\n    _OnRButtonDownFn:function (wparam, logx, logy, grdx, grdy, grdz) {\r\n        //debugger;\r\n        var typeListeners = mapObj._mouseEvents[\"OnRButtonDown\"];\r\n        if (!typeListeners) return;\r\n        \r\n        var options = mapObj._processInputParam(wparam, logx, logy, grdx, grdy, grdz);\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].name == mapObj._mouseEventNames[\"OnRButtonDown\"]) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(options);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    \r\n    _OnMButtonDownFn:function (wparam, logx, logy, grdx, grdy, grdz) {\r\n        //debugger;\r\n        var typeListeners = mapObj._mouseEvents[\"OnMButtonDown\"];\r\n        if (!typeListeners) return;\r\n        \r\n        var options = mapObj._processInputParam(wparam, logx, logy, grdx, grdy, grdz);\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].name == mapObj._mouseEventNames[\"OnMButtonDown\"]) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(options);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    \r\n    _OnLButtonUpFn:function (wparam, logx, logy, grdx, grdy, grdz) {\r\n        //debugger;\r\n        var typeListeners = mapObj._mouseEvents[\"OnLButtonUp\"];\r\n        if (!typeListeners) return;\r\n        \r\n        var options = mapObj._processInputParam(wparam, logx, logy, grdx, grdy, grdz);\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].name == mapObj._mouseEventNames[\"OnLButtonUp\"]) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(options);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    \r\n    _OnRButtonUpFn:function (wparam, logx, logy, grdx, grdy, grdz) {\r\n        //debugger;\r\n        var typeListeners = mapObj._mouseEvents[\"OnRButtonUp\"];\r\n        if (!typeListeners) return;\r\n        \r\n        var options = mapObj._processInputParam(wparam, logx, logy, grdx, grdy, grdz);\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].name == mapObj._mouseEventNames[\"OnRButtonUp\"]) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(options);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    \r\n    _OnMButtonUpFn:function (wparam, logx, logy, grdx, grdy, grdz) {\r\n        //debugger;\r\n        var typeListeners = mapObj._mouseEvents[\"OnMButtonUp\"];\r\n        if (!typeListeners) return;\r\n        \r\n        var options = mapObj._processInputParam(wparam, logx, logy, grdx, grdy, grdz);\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].name == mapObj._mouseEventNames[\"OnMButtonUp\"]) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(options);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    \r\n    _OnLButtonDblClkFn:function (wparam, logx, logy, grdx, grdy, grdz) {\r\n        //debugger;\r\n        var typeListeners = mapObj._mouseEvents[\"OnLButtonDblClk\"];\r\n        if (!typeListeners) return;\r\n        \r\n        var options = mapObj._processInputParam(wparam, logx, logy, grdx, grdy, grdz);\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].name == mapObj._mouseEventNames[\"OnLButtonDblClk\"]) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(options);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    _OnRButtonDblClkFn:function (wparam, logx, logy, grdx, grdy, grdz) {\r\n        //debugger;\r\n        var typeListeners = mapObj._mouseEvents[\"OnRButtonDblClk\"];\r\n        if (!typeListeners) return;\r\n        \r\n        var options = mapObj._processInputParam(wparam, logx, logy, grdx, grdy, grdz);\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].name == mapObj._mouseEventNames[\"OnRButtonDblClk\"]) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(options);\r\n                return;\r\n            }\r\n        }                \r\n    },\r\n    \r\n     _OnMouseWheelFn:function (wparam, logx, logy, grdx, grdy, grdz) {\r\n        \r\n        var typeListeners = mapObj._mouseEvents[\"OnMouseWheel\"];\r\n        if (!typeListeners) return;\r\n        \r\n        var options = mapObj._processInputParam(wparam, logx, logy, grdx, grdy, grdz);\r\n        for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n            if (typeListeners[i].name == mapObj._mouseEventNames[\"OnMouseWheel\"]) {\r\n                if (typeListeners[i].enabled)\r\n                    typeListeners[i].fn(options);\r\n                return;\r\n            }\r\n        }                \r\n    },    \r\n    \r\n    _mouseMoveMethod: function(params){\r\n        var typeListeners = mapObj._mouseEvents[\"OnMouseMove\"];\r\n            if (!typeListeners) return;\r\n            \r\n            var args = params.split(',');\r\n            var options = mapObj._processInputParam(parseInt(args[0]), parseInt(args[1]), parseInt(args[2]), parseInt(args[3]), parseInt(args[4]), parseInt(args[5]));\r\n            for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n                if (typeListeners[i].name == mapObj._mouseEventNames[\"OnMouseMove\"]) {\r\n                    if (typeListeners[i].enabled)\r\n                        typeListeners[i].fn(options);\r\n                    return;\r\n                }\r\n            }    \r\n      },\r\n      \r\n     _OnMouseMoveFn:function (wparam, logx, logy, grdx, grdy, grdz) {\r\n       //debugger;\r\n        var now = new Date().getTime();\r\n        if(now - mapObj._lastMousemoveTime <= mapObj._mousemoveTime) {\r\n          return;\r\n        }\r\n        mapObj._lastMousemoveTime = now;\r\n        setTimeout( \"mapObj._mouseMoveMethod('\" + wparam + \",\" + logx + \",\" + logy + \",\" + grdx + \",\" + grdy + \",\" + grdz + \"')\", \r\n            mapObj._mousemoveTime);      \r\n\r\n    },\r\n  \r\n\r\n    //IE11for event\r\n    _attachEventForIE11: function (obj, _strEventId, _functionCallback) {       \r\n        var nameFromToStringRegex = /^function\\s?([^\\s(]*)/;\r\n        var paramsFromToStringRegex = /\\(\\)|\\(.+\\)/;\r\n        //_functionCallback\r\n        var params = _functionCallback.toString().replace('{', '\\r\\n{').match(paramsFromToStringRegex)[0];\r\n        var functionName = _functionCallback.name;\r\n        if (!functionName) {   \r\n            var names =_functionCallback.toString().match(nameFromToStringRegex);   \r\n            functionName = (names  && names.length > 1) ? names[1] : \"\";\r\n        }\r\n        var handler;\r\n        try {\r\n            handler = document.createElement(\"script\");\r\n            handler.setAttribute(\"for\", obj.id);\r\n        }\r\n        catch(ex) {\r\n            handler = document.createElement('<script for=\"' + obj.id + '\">');\r\n        }\r\n        handler.event = _strEventId + params;\r\n        if (functionName == \"\") \r\n        {\r\n            //var funcText = \"var \" + _strEventId + \"=\" + _functionCallback + \";\" + _strEventId + params + \";\";\r\n            //handler.appendChild(document.createTextNode(funcText));\r\n           handler.appendChild(document.createTextNode(\"(\" + _functionCallback + \")\" + params + \";\"));\r\n        }\r\n        else\r\n            handler.appendChild(document.createTextNode(functionName + params + \";\"));\r\n        document.body.appendChild(handler);\r\n        return handler;\r\n    },\r\n    \r\n    //IE11for event\r\n    _detachEventForIE11: function (obj, _strEventId, _functionCallback) {\r\n        var scripts = document.getElementsByTagName(\"script\");\r\n        for (var i = scripts.length - 1; i >= 0 ; i--) {\r\n            if (scripts[i].getAttribute(\"for\")===obj.id && scripts[i][\"event\"].indexOf(_strEventId) > -1)\r\n                Q3D.DomUtil.remove(scripts[i]);\r\n        }\r\n    },\r\n    \r\n    //\r\n    _eventBind: function (flag, type, fn, context) {\r\n        var newFn = fn;       \r\n        //\r\n        var eventType = type.toUpperCase();\r\n        switch(eventType) {\r\n            case \"ONKEYUP\": newFn = this._keyUpFn; break;\r\n            case \"ONKEYDOWN\": newFn = this._keyDownFn; break;\r\n            case \"ONLBUTTONDOWN\": newFn = this._OnLButtonDownFn; break;\r\n            case \"ONRBUTTONDOWN\": newFn = this._OnRButtonDownFn; break;\r\n            case \"ONMBUTTONDOWN\": newFn = this._OnMButtonDownFn; break;\r\n            case \"ONLBUTTONUP\": newFn = this._OnLButtonUpFn; break;\r\n            case \"ONRBUTTONUP\": newFn = this._OnRButtonUpFn; break;\r\n            case \"ONMBUTTONUP\": newFn = this._OnMButtonUpFn; break;\r\n            case \"ONLBUTTONDBLCLK\": newFn = this._OnLButtonDblClkFn; break;\r\n            case \"ONRBUTTONDBLCLK\": newFn = this._OnRButtonDblClkFn; break;\r\n            case \"ONMOUSEWHEEL\": newFn = this._OnMouseWheelFn; break;\r\n            case \"ONMOUSEMOVE\": newFn = this._OnMouseMoveFn;   this._lastMousemoveTime = 0; this._mousemoveTime = 100; break;\r\n            case \"ONNOTIFYMOUSEBUTTONCLICK\": newFn = this._notifyMouseButtonClickFn; break;\r\n            case \"ONWIDGETCLOSE\": newFn = this._widgetCloseFn; break;\r\n            case \"ONUSERNOTIFYEX\": newFn = this._userNotifyEXFn; break;\r\n            case \"ONMOVIECLIPINSTANCEPASSFRAME\": newFn = this._movieClipInstancePassFrameFn; break;\r\n            case \"ONACTCTRLOBJANIEND\": newFn = this._actCtrlObjAniEnd; break;\t\t\r\n            case \"ONVIDEOCTRLCLOSE\": newFn = this._videoCtrlCloseFn; break;\t\r\n\t\t\tcase \"ONSCENENODEALLRESOURCECOMPLETED\": newFn = this._sceneNodeAllResourceCompletedFn; break;\t       \r\n        }\r\n        \r\n        if (flag) {\r\n            //\r\n            if(Q3D.Browser.ie) {\r\n                if (context.attachEvent) {\r\n                    context.attachEvent(type, newFn);\r\n                } else {\r\n                    this._attachEventForIE11(context, type, newFn);\r\n                }\r\n            }\r\n            else{\r\n                eval(\"window.\" + type + \" = \" + newFn);\r\n            }\r\n        } else {\r\n            //\r\n            if(Q3D.Browser.ie) {\r\n                if (context.detachEvent) {\r\n                    context.detachEvent(type, newFn);\r\n                } else {\r\n                    this._detachEventForIE11(context, type, newFn);\r\n                }\r\n            }\r\n            else{\r\n                eval(\"window.\" + type + \" = null; \");\r\n            }\r\n        }       \r\n       \r\n    },\r\n    \r\n\t/* @method on(type: String, fn: Function): this\r\n\t * \r\n\t *\r\n\t * @alternative\r\n\t * @method on(eventMap: Object): this\r\n\t * / `{onCreateArea: onCreateAreaFn, onCameraFlyToEnd: onCameraFlyToEndFn}`\r\n\t */\r\n\ton: function (types, fn, context) {\r\n\r\n\t\t// types can be a map of types/handlers\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\t// we don't process space-separated events here for performance;\r\n\t\t\t\t// it's a hot path since Layer uses the on(obj) syntax\r\n\t\t\t\tthis._on(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\t// types can be a string of space-separated words\r\n\t\t\ttypes = Q3D.Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._on(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/* @method off(type: String, fn?: Function): this\r\n\t *  \r\n\t *\r\n\t * @alternative\r\n\t * @method off(eventMap: Object): this\r\n\t * /\r\n\t *\r\n\t */\r\n\toff: function (types, fn, context) {\r\n\r\n\t\tif (!types) {\r\n\t\t\t// clear all listeners if called without arguments\r\n\t\t\tdelete this._events;\r\n\r\n\t\t} else if (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis._off(type, types[type], fn);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\ttypes = Q3D.Util.splitWords(types);\r\n\r\n\t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n\t\t\t\tthis._off(types[i], fn, context);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// attach listener (without syntactic sugar now)\r\n\t_on: function (type, fn, context) {\r\n\t\tthis._events = this._events || {};\r\n\r\n\t\t/* get/init listeners for type */\r\n\t\tvar typeListeners = this._events[type];\r\n\t\tif (!typeListeners) {\r\n\t\t\ttypeListeners = [];\r\n\t\t\tthis._events[type] = typeListeners;\r\n\t\t}\r\n\r\n\t\tif (context === this) {\r\n\t\t\t// Less memory footprint.\r\n\t\t\tcontext = undefined;\r\n\t\t} else {\r\n            context = mapObj._map3d;//\r\n        }\r\n                  \r\n\t\tvar newListener = {fn: fn, ctx: context},\r\n\t\t    listeners = typeListeners;\r\n\r\n\t\t// check if fn already there\r\n        /*\r\n        var newfn = fn.toString().replace(/\\s+/g,\"\").replace(/[\\r\\n]/g,\"\").toLowerCase(); //\r\n\t\tfor (var i = 0, len = listeners.length; i < len; i++) {            \r\n            var oldfn = listeners[i].fn.toString().replace(/\\s+/g,\"\").replace(/[\\r\\n]/g,\"\").toLowerCase(); //\r\n\t\t\tif (newfn === oldfn && listeners[i].ctx === context) {\r\n\t\t\t\treturn;\r\n\t\t\t}            \r\n\t\t}\r\n        */\r\n\r\n\t\tif (listeners.length)\r\n            this._off(type, listeners[0].fn, listeners[0].ctx)\r\n        \r\n        listeners.push(newListener);        \r\n        //\r\n        this._eventBind(true, type, newListener.fn, newListener.ctx);              \r\n\t},\r\n\r\n\t_off: function (type, fn, context) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n            \r\n\t\tif (!this._events) { return; }\r\n\r\n\t\tlisteners = this._events[type];\r\n\r\n\t\tif (!listeners) {\r\n\t\t\treturn;\r\n\t\t}\r\n        \r\n        if (context === this) {\r\n\t\t\tcontext = undefined;\r\n\t\t} else {\r\n            context = mapObj._map3d;//\r\n        }\r\n\r\n\t\tif (!fn) {\r\n\t\t\t// Set all removed listeners to noop so they are not called if remove happens in fire\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n                //\r\n                this._eventBind(false, type, listeners[i].fn, context);\r\n\t\t\t\t//listeners[i].fn = Q3D.Util.falseFn;                \r\n\t\t\t}\r\n\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\tdelete this._events[type];\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\r\n\t\tif (listeners) {\r\n\r\n\t\t\t// find fn and remove it\r\n            var newfn = fn.toString().replace(/\\s+/g,\"\").replace(/[\\r\\n]/g,\"\").toLowerCase(); //            \r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tvar l = listeners[i];\r\n                var oldfn = listeners[i].fn.toString().replace(/\\s+/g,\"\").replace(/[\\r\\n]/g,\"\").toLowerCase(); //\r\n\t\t\t\tif (l.ctx !== context) { continue; }\r\n\t\t\t\tif (oldfn === newfn) {\r\n                    //\r\n                    this._eventBind(false, type, l.fn, context);\r\n                    \r\n\t\t\t\t\t// set the removed listener to noop so that's not called if remove happens in fire\r\n\t\t\t\t\tl.fn = Q3D.Util.falseFn;\r\n\r\n\t\t\t\t\tif (this._firingCount) {\r\n\t\t\t\t\t\t/* copy array in case events are being fired */\r\n\t\t\t\t\t\tthis._events[type] = listeners = listeners.slice();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlisteners.splice(i, 1);\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// \r\n\t// Fires an event of the specified type. You can optionally provide an data\r\n\t// object  the first argument of the listener function will contain its\r\n\t// properties. The event might can optionally be propagated to event parents.\r\n\tfire: function (type, data, propagate) {\r\n\t\tif (!this.listens(type, propagate)) { return this; }\r\n\r\n\t\tvar event = Q3D.Util.extend({}, data, {type: type, target: this});\r\n\r\n\t\tif (this._events) {\r\n\t\t\tvar listeners = this._events[type];\r\n\r\n\t\t\tif (listeners) {\r\n\t\t\t\tthis._firingCount = (this._firingCount + 1) || 1;\r\n\t\t\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\tvar l = listeners[i];\r\n\t\t\t\t\tl.fn.call(l.ctx || this, event);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._firingCount--;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (propagate) {\r\n\t\t\t// propagate the event to parents (set with addEventParent)\r\n\t\t\tthis._propagateEvent(event);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method listens(type: String): Boolean\r\n\t//   `true` \r\n\tlistens: function (type, propagate) {\r\n        var listeners = null;\r\n        var eventType = type.toUpperCase();\r\n        switch(eventType) {\r\n            case \"ONKEYUP\": \r\n            case \"ONKEYDOWN\": listeners = this._keyEvents && this._keyEvents[type]; break;\r\n            case \"ONLBUTTONDOWN\": \r\n            case \"ONRBUTTONDOWN\": \r\n            case \"ONMBUTTONDOWN\": \r\n            case \"ONLBUTTONUP\": \r\n            case \"ONRBUTTONUP\": \r\n            case \"ONMBUTTONUP\": \r\n            case \"ONLBUTTONDBLCLK\": \r\n            case \"ONRBUTTONDBLCLK\": \r\n            case \"ONMOUSEWHEEL\": \r\n            case \"ONMOUSEMOVE\": listeners = this._mouseEvents && this._mouseEvents[type]; break;\r\n            case \"ONNOTIFYMOUSEBUTTONCLICK\": \r\n            case \"ONWIDGETCLOSE\": \r\n            case \"ONVIDEOCTRLCLOSE\": \r\n            case \"ONMOVIECLIPINSTANCEPASSFRAME\": \r\n\t\t\tcase \"ONACTCTRLOBJANIEND\": \r\n            case \"ONUSERNOTIFYEX\": listeners = this._widgetEvents && this._widgetEvents[type]; break;\r\n            default: listeners = this._events && this._events[type];\r\n        }\r\n\t\tif (listeners && listeners.length) { return true; }\t\t\r\n\t\treturn false;\r\n\t},\r\n\r\n\t// \r\n\t// Behaves as [`on()`](#evented-on), except the listener will only get fired once and then removed.\r\n\tonce: function (types, fn, context) {\r\n\r\n\t\tif (typeof types === 'object') {\r\n\t\t\tfor (var type in types) {\r\n\t\t\t\tthis.once(type, types[type], fn);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar handler = Q3D.bind(function () {\r\n\t\t\tthis\r\n\t\t\t    .off(types, fn, context)\r\n\t\t\t    .off(types, handler, context);\r\n\t\t}, this);\r\n\r\n\t\t// add a listener that's executed once and removed after that\r\n\t\treturn this\r\n\t\t    .on(types, fn, context)\r\n\t\t    .on(types, handler, context);\r\n\t},\r\n\r\n    /* @method attachKeyEvent(type: String, key: String, fn: Function): this\r\n\t * \r\n\t *\r\n\t */\r\n\tattachKeyEvent: function (type, key, fn) {\r\n        this._keyEvents = this._keyEvents || {};\r\n \r\n\t\t/* get/init listeners for type */\r\n\t\tvar typeListeners = this._keyEvents[type];        \r\n\t\tif (!typeListeners) {\r\n\t\t\ttypeListeners = [];\r\n\t\t\tthis._keyEvents[type] = typeListeners;\r\n\t\t}\r\n\t\t\r\n\t\tvar newListener = {key: key, fn: fn, enabled: true},\r\n\t\t    listeners = typeListeners;\r\n\r\n\t\t// check if key already there\r\n\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\tif (listeners[i].key === key) {\r\n\t\t\t\treturn;\r\n\t\t\t}            \r\n\t\t}\r\n        \r\n        if(listeners.length == 0) {\r\n            //\r\n            this._eventBind(true, type, newListener.fn, mapObj._map3d); \r\n        }\r\n\r\n\t\tlisteners.push(newListener);\r\n\t\t//typeListeners.count++;\r\n        return this;\r\n        \r\n    },\r\n    /* @method detachKeyEvent(type: String, key?: String): this\r\n\t * \r\n\t *\r\n\t */\r\n    detachKeyEvent: function (type, key) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n            \r\n\t\tif (!this._keyEvents) { return; }\r\n\r\n\t\tlisteners = this._keyEvents[type];\r\n\r\n\t\tif (!listeners || !listeners.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!key) {\r\n\t\t\t// Set all removed listeners to noop so they are not called if remove happens in fire\r\n            /*\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {                \r\n\t\t\t\tlisteners[i].fn = Q3D.Util.falseFn;                \r\n\t\t\t}*/\r\n            //\r\n            this._eventBind(false, type, type == \"OnKeyUp\" ? this._keyUpFn:this._keyDownFn, mapObj._map3d);\r\n\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\tdelete this._keyEvents[type];                 \r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (listeners) {\r\n\r\n\t\t\t// find key and remove it\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tvar l = listeners[i];\r\n\t\t\t\tif (l.key === key) {                  \r\n\t\t\t\t\t// set the removed listener to noop so that's not called if remove happens in fire\r\n\t\t\t\t\t//l.fn = Q3D.Util.falseFn;\r\n                    if (listeners.length == 1) {\r\n                        //\r\n                        this._eventBind(false, type, type == \"OnKeyUp\" ? this._keyUpFn:this._keyDownFn, mapObj._map3d);\r\n                    }\r\n\t\t\t\t\tlisteners.splice(i, 1);                   \r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n        \r\n        return this;\r\n\t},\r\n    /* @method setKeyEvent(type: String, key: String, valid: Boolean): this\r\n\t * \r\n\t *\r\n\t */\r\n    setKeyEvent: function (type, key, valid) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n            \r\n\t\tif (!this._keyEvents) { return; }\r\n\r\n\t\tlisteners = this._keyEvents[type];\r\n\r\n\t\tif (!listeners) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// find key and remove it\r\n\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\tvar l = listeners[i];\r\n\t\t\tif (l.key === key) {      \r\n                l.enabled = valid;\t\t\t\t                \r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n        return this;\r\n\t},\r\n    /* @method getKeyEventStatus(type: String, key: String): Boolean\r\n\t * \r\n\t *\r\n\t */\r\n    getKeyEventStatus: function (type, key) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n            \r\n\t\tif (!this._keyEvents) { return null; }\r\n\r\n\t\tlisteners = this._keyEvents[type];\r\n\r\n\t\tif (!listeners) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// find key and remove it\r\n\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\tvar l = listeners[i];\r\n\t\t\tif (l.key === key) {      \t\t                \r\n\t\t\t\treturn l.enabled;\r\n\t\t\t}\r\n\t\t}\r\n        return false;\t\t\r\n\t},\r\n    /* @method attachUIEvent(type: String, widgetName: String, fn: Function): this\r\n\t * UI\r\n\t *\r\n\t */\r\n    attachUIEvent: function (type, widgetName, fn) {\r\n        this._widgetEvents = this._widgetEvents || {};\r\n \r\n\t\t/* get/init listeners for type */\r\n\t\tvar typeListeners = this._widgetEvents[type];        \r\n\t\tif (!typeListeners) {\r\n\t\t\ttypeListeners = [];\r\n\t\t\tthis._widgetEvents[type] = typeListeners;\r\n\t\t}\r\n\t\t\r\n\t\tvar newListener = {key: widgetName, fn: fn, enabled: true},\r\n\t\t    listeners = typeListeners;\r\n\r\n\t\t// check if key already there\r\n\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\tif (listeners[i].key === widgetName) {\r\n\t\t\t\treturn;\r\n\t\t\t}            \r\n\t\t}\r\n        \r\n        if(listeners.length == 0) {\r\n            //\r\n            this._eventBind(true, type, newListener.fn, mapObj._map3d); \r\n        }\r\n\r\n\t\tlisteners.push(newListener);\r\n\t\t//typeListeners.count++;\r\n        return this;\r\n        \r\n    },\r\n    /* @method detachUIEvent(type: String, widgetName?: String): this\r\n\t * UI\r\n\t *\r\n\t */\r\n    detachUIEvent: function (type, widgetName) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n            \r\n\t\tif (!this._widgetEvents) { return; }\r\n\r\n\t\tlisteners = this._widgetEvents[type];\r\n\r\n\t\tif (!listeners || !listeners.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n        \r\n        //\r\n        var _fn = null;\r\n        switch(type) {\r\n            case \"onNotifyMouseButtonClick\": _fn = this._notifyMouseButtonClickFn; break;\r\n            case \"onWidgetClose\": _fn = this._widgetCloseFn; break;\r\n            case \"onUserNotifyEX\": _fn = this._userNotifyEXFn; break;\r\n            case \"onMovieClipInstancePassFrame\": _fn = this._movieClipInstancePassFrameFn; break;\r\n\t\t\tcase \"onActCtrlObjAniEnd\": _fn = this._actCtrlObjAniEnd; break;\r\n            case \"onVideoCtrlClose\": _fn = this._videoCtrlCloseFn; break;\r\n            case \"onSceneNodeAllResourceCompleted\": _fn = this._sceneNodeAllResourceCompletedFn; break;\t         \r\n        }\r\n\r\n\t\tif (!widgetName) {\r\n\t\t\t// Set all removed listeners to noop so they are not called if remove happens in fire\r\n            /*\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {                \r\n\t\t\t\tlisteners[i].fn = Q3D.Util.falseFn;                \r\n\t\t\t}\r\n            */\r\n            \r\n            this._eventBind(false, type, _fn, mapObj._map3d);\r\n\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\tdelete this._widgetEvents[type];                 \r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (listeners) {\r\n\r\n\t\t\t// find key and remove it\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tvar l = listeners[i];\r\n\t\t\t\tif (l.key === widgetName) {                  \r\n\t\t\t\t\t// set the removed listener to noop so that's not called if remove happens in fire\r\n\t\t\t\t\t//l.fn = Q3D.Util.falseFn;\r\n                    if (listeners.length == 1) {\r\n                        //\r\n                        this._eventBind(false, type, _fn, mapObj._map3d);\r\n                    }\r\n\t\t\t\t\tlisteners.splice(i, 1);                   \r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n        \r\n        return this;\r\n\t},\r\n    \r\n    /* @method attachMouseEvent(type: String, key: String, fn?: Function): this\r\n\t * \r\n\t *\r\n\t */\r\n    attachMouseEvent: function (type, name, fn) {\r\n        this._mouseEvents = this._mouseEvents || {};\r\n        \r\n        this._mouseEventNames = this._mouseEventNames || {};\r\n        //\r\n        this._mouseEventNames[type] = name;\r\n \r\n\t\t/* get/init listeners for type */\r\n\t\tvar typeListeners = this._mouseEvents[type];        \r\n\t\tif (!typeListeners) {\r\n\t\t\ttypeListeners = [];\r\n\t\t\tthis._mouseEvents[type] = typeListeners;\r\n\t\t}\r\n        \t\t\r\n\t\tvar newListener = {fn: fn, name:name, enabled: true},\r\n\t\t    listeners = typeListeners;            \r\n        \r\n\t\t// check if name already there\r\n  \t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n \t\t\tif (listeners[i].name === name) {\r\n                if(!fn) {\r\n                    newListener.fn = listeners[i].fn;\r\n                    break;\r\n                }\r\n\t\t\t\treturn;\r\n\t\t\t}            \r\n\t\t} \r\n\r\n        if(listeners.length == 0) {\r\n            //\r\n            this._eventBind(true, type, newListener.fn, mapObj._map3d); \r\n        }\r\n        \r\n        if (fn)\r\n            listeners.push(newListener);\r\n        return this;\r\n    },\r\n    \r\n    /* @method detachMouseEvent(type: String, evtname?: String): this\r\n\t * \r\n\t *\r\n\t */\r\n    detachMouseEvent: function (type,name) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n            \r\n\t\tif (!this._mouseEvents) { return; }\r\n\r\n\t\tlisteners = this._mouseEvents[type];\r\n\r\n\t\tif (!listeners || !listeners.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n        \r\n        //\r\n        if (!name) {\r\n\t\t\t// Set all removed listeners to noop so they are not called if remove happens in fire\r\n            /*\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {                \r\n\t\t\t\tlisteners[i].fn = Q3D.Util.falseFn;       \r\n                if (listeners[i].name == this._mouseEventNames[type])\r\n                    break;\r\n\t\t\t}\r\n            */\r\n            //\r\n            this._eventBind(false, type, listeners[0].fn, mapObj._map3d);\r\n\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\tdelete this._mouseEvents[type];                 \r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (listeners) {\r\n\t\t\t// find name and remove it\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tvar l = listeners[i];\r\n\t\t\t\tif (l.name === name) {                  \r\n\t\t\t\t\t// set the removed listener to noop so that's not called if remove happens in fire\r\n\t\t\t\t\t//l.fn = Q3D.Util.falseFn;\r\n                    //name\r\n                    if (this._mouseEventNames[type]==name) {\r\n                           if (listeners.length == 1) {\r\n                                //\r\n                                this._eventBind(false, type, listeners[i].fn, mapObj._map3d);\r\n                                delete this._mouseEvents[type]; \r\n                            } else {\r\n                                var curPos = i;\r\n                                curPos = --curPos < 0 ? curPos + listeners.length : curPos;\r\n                                this._mouseEventNames[type] = listeners[curPos].name; //\r\n                            }\r\n                    }\r\n                    \r\n\t\t\t\t\tlisteners.splice(i, 1);       \r\n                    if (listeners.length == 0)\r\n                        delete listeners; \r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n        return this;\r\n\t},   \r\n    \r\n     /* @method getMouseEventStatus(type: String, evtname: String): Boolean\r\n\t * \r\n\t *\r\n\t */\r\n    getMouseEventStatus: function (type, name) {\r\n        var listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n            \r\n\t\tif (!this._mouseEvents) { return null; }\r\n\r\n\t\tlisteners = this._mouseEvents[type];\r\n\r\n\t\tif (!listeners) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// find key and remove it\r\n\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\tvar l = listeners[i];\r\n\t\t\tif (l.name === name) {      \t\t                \r\n\t\t\t\treturn l.enabled;\r\n\t\t\t}\r\n\t\t}\r\n        return null;\r\n    },\r\n    /* @method setMouseEvent(type: String, evtname: String, valid: Boolean): this\r\n\t * \r\n\t *\r\n\t */\r\n    setMouseEvent: function (type, name, valid) {\r\n\t\tvar listeners,\r\n\t\t    i,\r\n\t\t    len;\r\n            \r\n\t\tif (!this._mouseEvents) { return; }\r\n\r\n\t\tlisteners = this._mouseEvents[type];\r\n\r\n\t\tif (!listeners) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// find key and remove it\r\n\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\tvar l = listeners[i];\r\n\t\t\tif (l.name === name) {      \r\n                l.enabled = valid;\t\t\t\t                \r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n});\r\n","/*\r\n * @class Map\r\n * @aka Q3D.Map\r\n * @inherits Evented\r\n *\r\n *   \r\n *\r\n * @example\r\n *\r\n * ```js\r\n * //  \"map\"  div JSON\r\n * var map = Q3D.map('map', {\r\n * \tSERVER_PATH: \"http://\" + location.host + \"/mapdata3d/xihongqiao\",\r\n * \tCONFIG_NAME: \"Example\"\r\n * });\r\n * ```\r\n *\r\n */\r\n\r\nwindow.mapObj = null;\r\n\r\nQ3D.Map = Q3D.Evented.extend({\r\n\r\n        options: {\r\n\r\n            //DOMID\r\n            Id: \"map\",\r\n            // @option SERVER_PATH: String = null\r\n            //  url \r\n            SERVER_PATH: null,\r\n            // @option DATA_PATH: String = null\r\n            //  IE \r\n            DATA_PATH: null,\r\n            // \"REAL\"\"SIMULATION\"\r\n            DOWNLOAD_TYPE: \"REAL\",\r\n            // @option CONFIG_NAME: String = null\r\n            //  root \r\n            CONFIG_NAME: null,\r\n            // @option LICENSE_SVR: String = null\r\n            //  url \r\n            LICENSE_SVR: null,\r\n            // @option WINDOWLESS: Boolen = false\r\n            // \r\n            WINDOWLESS: false,            \r\n            // @option LOADING: Boolen = true\r\n            // \r\n            LOADING: true,\r\n            // @option OPACITY: Number = 1.0\r\n            // \r\n            OPACITY: 1.0,\r\n            // @option MarginRightBottom: Array = [0,0]\r\n            // \r\n            MarginRightBottom: [0,0],\r\n            // 2.3+\r\n            // ResourceGroupName: null,\r\n            // @option OnLoadBefore: Function = null\r\n            // \r\n            OnLoadBefore: null,\r\n            // @option OnLoadEnd: Function = null\r\n            // \r\n            OnLoadEnd: null,\r\n            // @option OnUIInitEnd: Function = null\r\n            // UIUI\r\n            OnUIInitEnd: null,\r\n            //\r\n            DefaultMouseEvent: {},\r\n            //\r\n            OnInitialFail: null,\r\n            //\r\n            LowestEngineVersionNeed: {\r\n                version: \"2, 8, 0, 0\",\r\n                callback: null\r\n            }\r\n        },\r\n\r\n        initialize: function (id, options) { // (HTMLElement or String, Object)\r\n            this.options = Q3D.setOptions(this, options);\r\n\r\n            //root\r\n            if (this.options.CONFIG_NAME == null) {\r\n                throw new Error('');\r\n            }\r\n\r\n            //\r\n            if (this.options.SERVER_PATH == null) {\r\n                throw new Error('');\r\n            }\r\n\r\n            //DOM\r\n            this._initContainer(id);\r\n\r\n            //JqueryJqueryJqueryUI\r\n            if (this.options.LOADING) {\r\n            \tthis._mapUI = new Q3D.QMapV2Custom($(\"#\" + this._map3d.id));\r\n            \tthis._mapUI.ProcessLoading(this.options.MarginRightBottom);\r\n            }            \r\n\r\n            setTimeout((function () {\r\n\t\t\t\ttry{\r\n                    //\r\n                    this._map3d.logo = 0;\r\n                    this._map3d.setInitPara(\"SERVER_PATH\", this.options.SERVER_PATH);\r\n                    this._map3d.setInitPara(\"CONFIG_NAME\", this.options.CONFIG_NAME);\r\n                    this._map3d.setInitPara(\"DOWNLOAD_TYPE\", this.options.DOWNLOAD_TYPE);\r\n                    this._map3d.setInitPara(\"THREAD_COUNT\", 4);\r\n                    if (this.options.LICENSE_SVR != null) {\r\n                        this._map3d.setLicenseSvr(this.options.LICENSE_SVR);\r\n                    }\r\n                                        \r\n                    if (this.options.LOADING) {\r\n                        //\r\n                        this._map3d.setHibernateTime(0);\r\n                        \r\n                        //, onCreateArea\r\n                        this._map3d.setCreateAreaListener();\r\n\r\n                        //UIonQUISystemInit\r\n                        this._map3d.setUISystemEventListener();\r\n\r\n                        //\r\n                        this._map3d.setEngineListener();\r\n                    }\r\n\r\n                    //\r\n                    var initStatus = this._map3d.init();                 \r\n                    //\r\n                    if (initStatus != 1 && !Q3D.Browser.gecko) {\r\n                        this.showNotice(\"\", \"\");                        \r\n                        return;\r\n                    }\r\n\r\n                    //\r\n                    if (parseInt(this.options.LowestEngineVersionNeed.version.replace(new RegExp(/,| |/g), \"\")) > parseInt(this._map3d.getVersion().replace(new RegExp(/, /g), \"\"))) {\r\n                        if (Q3D.Util.isFunction(this.options.LowestEngineVersionNeed.callback)) {\r\n                            this.options.LowestEngineVersionNeed.callback();\r\n                        }\r\n                        this.showNotice(\"\", \"\");\r\n                        mapObj._mapUI.InitHelpDiaLog({ MessageHTML: \"\", NeedSetup:true });\r\n                \t\tmapObj._mapUI.ShowHelpDialog();\r\n                        return;\r\n                    }\r\n\r\n                    //\r\n                    if (Q3D.Util.isFunction(this.options.OnLoadBefore)) {\r\n                        this.options.OnLoadBefore();\r\n                    }\r\n                    \r\n                    if (Q3D.Util.isFunction(this.options.OnUIInitEnd)) {\r\n                        this.on(\"onQUISystemInit\", function () { \r\n                            mapObj.options.OnUIInitEnd();\r\n                            mapObj.off(\"onQUISystemInit\");\r\n                        });     \r\n                    }                  \r\n\r\n                    //\r\n                    var im = this._map3d.getInputManager();\r\n                    \r\n                    //\r\n                    im.createActionEx(Q3D.Enums.actionType.TRANS_LEFTX); // \r\n                    im.createActionEx(Q3D.Enums.actionType.TRANS_RIGHT); // \r\n                    im.createActionEx(Q3D.Enums.actionType.TRANS_FORTH); // \r\n                    im.createActionEx(Q3D.Enums.actionType.TRANS_BACKX); // \r\n                    im.createActionEx(Q3D.Enums.actionType.TRANS_UPXXX); // \r\n                    im.createActionEx(Q3D.Enums.actionType.TRANS_DOWNX); // \r\n                    \r\n                    //\r\n                    im.createActionEx(Q3D.Enums.actionType.TRANS_UDLRX); //\r\n                    im.createActionEx(Q3D.Enums.actionType.TRANS_SCENE); //(  )\r\n                    \r\n                     // ( D:Dynamic; S:Static )\r\n                    im.createActionEx(Q3D.Enums.actionType.SCALED_CENTER); // STATIC\r\n                    im.createActionEx(Q3D.Enums.actionType.SCALES_CENTER); // \r\n                    im.createActionEx(Q3D.Enums.actionType.SCALED_SCREEN); // ( EyeScreenPnt )STATIC\r\n                    im.createActionEx(Q3D.Enums.actionType.SCALES_SCREEN);// ( EyeScreenPnt )\r\n                    im.createActionEx(Q3D.Enums.actionType.CAMERA_CLOSETO); //        \r\n                    \r\n                    // ( S:Separately; T:Together )\r\n                    im.createActionEx(Q3D.Enums.actionType.ROTATES_CAMERA); // yaw,pitch\r\n                    im.createActionEx(Q3D.Enums.actionType.ROTATET_CAMERA); // yaw,pitch\r\n                    im.createActionEx(Q3D.Enums.actionType.ROTATES_SCREEN); // ,Separately\r\n                    im.createActionEx(Q3D.Enums.actionType.ROTATET_SCREEN); //,Together\r\n                    im.createActionEx(Q3D.Enums.actionType.ROTATES_CENTER);// basePlane,Separately\r\n                    im.createActionEx(Q3D.Enums.actionType.ROTATET_CENTER);// basePlane,Together\r\n                    im.createActionEX(Q3D.Enums.actionType.ROTATES_FIXPNT);// yaw,pitch\r\n                    im.createActionEX(Q3D.Enums.actionType.ROTATET_FIXPNT); //yaw,pitch\r\n                    \r\n                    //\r\n                    im.createActionEx(Q3D.Enums.actionType.RAMBLE_KEEPORI); //(  )\r\n                    \r\n                    //\r\n                    im.createActionEx(Q3D.Enums.actionType.OBJECTSELECT_MOVAUX);\r\n                    im.createActionEx(Q3D.Enums.actionType.OBJECTSELECT_ROTAUX);\r\n                    im.createActionEx(Q3D.Enums.actionType.OBJECTSELECT_SCAAUX);                    \r\n                    \r\n\t\t\t\t\t //( YPS:YawPitchScale, S:Separately, T:Together )                    \r\n                    im.createActionEx(Q3D.Enums.actionType.YPSS_SCREEN); // \r\n                    im.createActionEx(Q3D.Enums.actionType.YPST_SCREEN);// \r\n                    im.createActionEx(Q3D.Enums.actionType.YPSS_CENTER);// \r\n                    im.createActionEx(Q3D.Enums.actionType.YPST_CENTER);// \r\n                    \r\n                    //\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_ROTATE); //\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_WHEEL); //\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_MOVELEFT); //\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_MOVERIGHT); //\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_MOVEFORTH); //\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_MOVEBACK); //\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_MOVEUP); //\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_MOVEDOWN); //\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_MOVETO); //\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_CAMERAROTATE); //\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_TURNLEFT);\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_TURNRIGHT);\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_LOOKUP);\r\n                    im.createActionEx(Q3D.Enums.actionType.THIRD_LOOKDOWN);\r\n\r\n                    //\r\n                    /*\r\n                    im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.A.ctrlId, Q3D.Enums.actionType.TRANS_LEFTX);\r\n                    im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.D.ctrlId, Q3D.Enums.actionType.TRANS_RIGHT);\r\n                    im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.W.ctrlId, Q3D.Enums.actionType.TRANS_FORTH);\r\n                    im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.S.ctrlId, Q3D.Enums.actionType.TRANS_BACKX);\r\n                    im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.Q.ctrlId, Q3D.Enums.actionType.TRANS_DOWNX);\r\n                    im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.E.ctrlId, Q3D.Enums.actionType.TRANS_UPXXX);\r\n                    im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.SPACE.ctrlId, Q3D.Enums.actionType.CAMERA_CLOSETO);\r\n                    */\r\n                    im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.LEFT.ctrlId, Q3D.Enums.actionType.TRANS_LEFTX);\r\n                    im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.RIGHT.ctrlId, Q3D.Enums.actionType.TRANS_RIGHT);\r\n                    im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.UP.ctrlId, Q3D.Enums.actionType.TRANS_FORTH);\r\n                    im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.DOWN.ctrlId, Q3D.Enums.actionType.TRANS_BACKX);                    \r\n\r\n                    //\r\n                    \r\n                    im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.TRANS_SCENE);\r\n                    im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.MBUTTON, Q3D.Enums.actionType.RAMBLE_KEEPORI);\r\n                    im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.RBUTTON, Q3D.Enums.actionType.ROTATES_SCREEN);\r\n                    im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.WHEEL, Q3D.Enums.actionType.SCALED_SCREEN);\r\n                   \r\n                   /* \r\n                    im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.TRANS_UDLRX);\r\n                    im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.MBUTTON, Q3D.Enums.actionType.RAMBLE_KEEPORI);\r\n                    im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.RBUTTON, Q3D.Enums.actionType.ROTATES_CENTER);\r\n                    im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.WHEEL, Q3D.Enums.actionType.SCALES_CENTER);\r\n                    */\r\n\r\n                    //\r\n                    im.bindControlAction(Q3D.Enums.device.MULTITOUCH, Q3D.Enums.multiTouch.TRANS, Q3D.Enums.actionType.TRANS_SCENE);\r\n                    //im.bindControlAction(Q3D.Enums.device.MULTITOUCH, Q3D.Enums.multiTouch.CLOSETO, Q3D.Enums.actionType.CAMERA_CLOSETO);\r\n                    im.bindControlAction(Q3D.Enums.device.MULTITOUCH, Q3D.Enums.multiTouch.RAMBLE, Q3D.Enums.actionType.RAMBLE_KEEPORI);\r\n                    im.bindControlAction(Q3D.Enums.device.MULTITOUCH, Q3D.Enums.multiTouch.YPS, Q3D.Enums.actionType.YPSS_SCREEN);\r\n\r\n                    /**/\r\n                    if (this.options.LOADING) {\r\n                        //  root  loadSln \r\n                        this.on(\"onPreGroupPrepare\", function (group) {\r\n                            //console.log(new Date() + \":onPreGroupPrepare...\");\r\n                            mapObj._mapUI.TriggerLoading(null, \"...\", 2, 100);\r\n                            mapObj._map3d.setResourceGroupListener(group);\r\n                        });\r\n                        this.on(\"onAllSceneFilesFirstLoadCompleted\", function (wId) {\r\n                            //console.log(new Date() + \":onAllSceneFilesFirstLoadCompleted...\");                        \r\n                            mapObj._mapUI.TriggerLoading(null, \"...\", 90, 100);\t                            \r\n                        });\r\n                        this.on(\"onAreasFirstLoadProcess\", function (wId, currCnt, allCnt) {\r\n                            //console.log(new Date() + \":onAreasFirstLoadProcess...\" + currCnt + \"/\" + allCnt);         \r\n                            mapObj._mapUI.TriggerLoading(null, \"...\", 90 + currCnt / allCnt * 5, 100);                                             \r\n                        });\r\n                        this.on(\"onAllAreasFirstLoadCompleted\", function (wId, isTimeout) {\r\n                            //console.log(new Date() + \":onAllAreasFirstLoadCompleted...\");                        \r\n                            if (isTimeout)\r\n                                mapObj._mapUI.TriggerLoading(null, \"...\", 100, 100);\r\n                            else\r\n                                mapObj._mapUI.TriggerLoading(null, \"...\", 100, 100);\r\n                                                   \r\n                            mapObj.off(\"onResourceLoaded\");\r\n                            mapObj.off(\"onResourceGroupFailed\");\r\n                            mapObj.off(\"onResourceGroupPackResLoaded\");\r\n                            mapObj.off(\"onResourceGroupPackResFailed\");\r\n                            mapObj.off(\"onResourceGroupAllCompleted\");\r\n                            mapObj.off(\"onAllSceneFilesFirstLoadCompleted\");\r\n                            mapObj.off(\"onAreasFirstLoadProcess\");\r\n                            mapObj.off(\"onAllAreasFirstLoadCompleted\");\r\n                            mapObj.off(\"onPreGroupPrepare\");\r\n                            //\r\n                            mapObj._map3d.setHibernateTime(300);\r\n                            \r\n                            if (Q3D.Util.isFunction(mapObj.options.OnLoadEnd)) {\r\n                                mapObj.options.OnLoadEnd();\r\n                            } \r\n                        });\r\n                        \r\n                        //                     \r\n                        this.on(\"onResourceLoaded\", function (group, res, currentCompleted, totalNumber) {\r\n                            mapObj._mapUI.TriggerLoading(group, res.getName(), 5 + currentCompleted / totalNumber * 80, 100);\r\n                            //console.log(new Date() + \":onResourceLoaded...\" + currentCompleted + \"/\" + totalNumber);\r\n                        });\r\n                        this.on(\"onResourceGroupFailed\", function (group, res) {\r\n                            mapObj._mapUI.TriggerLoadingFailed(group, res.getName());\r\n                            //console.log(new Date() + \":onResourceGroupFailed...\");\r\n                        });\r\n                        this.on(\"onResourceGroupPackResLoaded\", function (group, name, currentCompleted, totalNumber) {\r\n                            mapObj._mapUI.TriggerLoading(group, name, 5 + currentCompleted / totalNumber * 80, 100);\r\n                            //console.log(new Date() + \":onResourceGroupPackResLoaded...\" + currentCompleted + \"/\" + totalNumber);\r\n                        });\r\n                        this.on(\"onResourceGroupPackResFailed\", function (group, name, currentCompleted, totalNumber) {\r\n                            mapObj._mapUI.TriggerLoadingFailed(group, name);\r\n                            //console.log(new Date() + \":onResourceGroupPackResFailed...\");\r\n                        });\t\t\t\t\t\r\n                        this.on(\"onResourceGroupAllCompleted\", function (group, currLoadNum, currentFailed, totalNumber) {\r\n                            //console.log(new Date() + \":onResourceGroupAllCompleted...\" + currLoadNum + \"/\" + totalNumber);\r\n                            mapObj._mapUI.TriggerLoading(group, \"...\", 85, 100);\r\n                        });\r\n\r\n                        mapObj._mapUI.TriggerLoading(null, \"...\", 1, 100);\r\n                    }\r\n               \r\n                    var IsLoadSuccess = this._map3d.loadSln();\r\n                    if (IsLoadSuccess == 1) {\r\n                        //console.log(new Date() + \":loadSln...\");\r\n                        \r\n                        //\r\n                        if (this.options.LOADING) {\r\n                        \t//mapObj._mapUI.ProcessLoading();\r\n                        \tmapObj._mapUI.TriggerLoading(null, \"...\", 5, 100);\r\n                             if (this.options.WINDOWLESS) { //position\r\n                                 document.getElementById(\"progressbarWrapper\").style.position = \"absolute\";\r\n                                 document.getElementById(\"progressbarWrapper\").style.opacity = this.options.OPACITY;\r\n                             }\r\n                        }\r\n\r\n                        //\r\n                        // Ctrl + Y FPS\r\n                        this.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.Y, (function (wParam, lParam) {\r\n                                if (lParam == 1) { //Ctrl\r\n                                    var wm = this._map3d.getWorldManager();\r\n                                    if (wm.isFpsEnabled() == 1) {\r\n                                        wm.disableFps();                                        \r\n                                    }\r\n                                    else {\r\n                                        wm.enableFps();\r\n                                                        \r\n                                    }\r\n                                }\r\n                            }).bind(this));\r\n\r\n                        //Ctrl + F2 1: ctrl , 2: alt,  4: shift\r\n                        this.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.F2, (function (wParam, lParam) {\r\n                                if (lParam == 1) //Ctrl\r\n                                    this.showNotice(\"\", \"V\" + this._map3d.getVersion());\r\n                            }).bind(this));\r\n\r\n                        //Ctrl + F9DeBug\r\n                        this.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.F9, (function (wParam, lParam) {\r\n                                if (lParam == 1) { //Ctrl\r\n                                    this._enableDebug = this._enableDebug ? false : true;\r\n                                    if (console) {\r\n                                        console.log(\"\" + (this._enableDebug ? \"\" : \"\"))\r\n                                    }\r\n                                    if (this._enableDebug) {\r\n                                        //\r\n                                        this.attachMouseEvent(\"OnLButtonDown\", \"_justfortest_\", function(options){});   \r\n                                    } else {\r\n                                        this.detachMouseEvent(\"OnLButtonDown\", \"_justfortest_\");   \r\n                                    }\r\n                                        \r\n                                }\r\n                            }).bind(this));\r\n\r\n                        //F8\r\n                        this.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.F8, (function (wParam, lParam) {\r\n                                if (this._enableDebug && console) {\r\n                                    console.log(\"======================================\");\r\n                                    var operateTime = new Date();\r\n                                    var wm = this._map3d.getWorldManager();\r\n                                    var cam = wm.getMainCamera(0);\r\n                                    var campos = Q3D.vector3d(cam.getAbsPos());\r\n                                    var  gv3d = Q3D.globalVec3d(campos.toGlobalVec3d());\r\n                                    var camori = cam.getOrientation(2);\r\n                                    console.log(\" : \" + operateTime.getHours() + \":\" + operateTime.getMinutes() + \":\" + operateTime.getSeconds());\r\n                                    console.log(\"() : \" + campos.x + \",\" + campos.y + \",\" + campos.z);\r\n                                    console.log(\"() : \" + gv3d.longitude.toFixed(6) + \",\" + gv3d.latitude.toFixed(6) + \",\" + gv3d.height.toFixed(6));\r\n                                    console.log(\" : \" + camori.x + \",\" + camori.y + \",\" + camori.z);\r\n                                    console.log(\" : \" + cam.fetchRotPitch() + \",\" + cam.fetchRotYaw() );\r\n                                    console.log(\"======================================\");\r\n                                }\r\n                            }).bind(this));\r\n\r\n                        // \r\n                        /*\r\n                        if (Q3D.Util.isFunction(this.options.OnLoadEnd)) {\r\n                        this.options.OnLoadEnd();\r\n                        }\r\n                         */\r\n                         /*\r\n                          //                          \r\n                        window.onbeforeunload = function () {\r\n                            \r\n                            if (mapObj != null) {\r\n                                mapObj.getOcx().enable(0);\r\n                                mapObj.getOcx().shutdown();\r\n                            }\r\n                            //return \"a\";\r\n                        }\r\n                        */\r\n                        // \r\n                        // \r\n                        var hidden,\r\n                        state,\r\n                        visibilityChange;\r\n                        if (typeof document.hidden !== \"undefined\") {\r\n                            hidden = \"hidden\";\r\n                            visibilityChange = \"visibilitychange\";\r\n                            state = \"visibilityState\";\r\n                        } else if (typeof document.mozHidden !== \"undefined\") {\r\n                            hidden = \"mozHidden\";\r\n                            visibilityChange = \"mozvisibilitychange\";\r\n                            state = \"mozVisibilityState\";\r\n                        } else if (typeof document.msHidden !== \"undefined\") {\r\n                            hidden = \"msHidden\";\r\n                            visibilityChange = \"msvisibilitychange\";\r\n                            state = \"msVisibilityState\";\r\n                        } else if (typeof document.webkitHidden !== \"undefined\") {\r\n                            hidden = \"webkitHidden\";\r\n                            visibilityChange = \"webkitvisibilitychange\";\r\n                            state = \"webkitVisibilityState\";\r\n                        }\r\n\r\n                        // IE10/IE11/FF/Chrome\r\n                        document.addEventListener(visibilityChange, function () {\r\n                            //document.title = document[state];\r\n                            if (\"hidden\" === document[state])\r\n                                mapObj._map3d.enable(0);\r\n                            else\r\n                                mapObj._map3d.enable(1);\r\n                        }, false);\r\n\r\n                    } else {\r\n                        this.showNotice(\"\", \"\");\r\n                        return;\r\n                    }\r\n\t\t\t\t} catch (e) {\r\n            \t\tmapObj._mapUI.InitHelpDiaLog({ MessageHTML: \"\", NeedSetup:true });\r\n                \tmapObj._mapUI.ShowHelpDialog();\r\n        \t\t}\r\n        \t\tfinally {\r\n            \t\treturn;\r\n        \t\t}\r\n                }).bind(this), 500);\r\n                \r\n        },\r\n\r\n        _initContainer: function (id) {\r\n            var container = this._container = Q3D.DomUtil.get(id);\r\n\r\n            if (!container) {\r\n                throw new Error('Map container not found.');\r\n            } else if (container._qmap3d_id) {\r\n                throw new Error('Map container is already initialized.');\r\n            }\r\n\r\n            this._containerId = Q3D.Util.stamp(container);\r\n            //div\r\n            var mapDomId = id + \"_qmap3d\";\r\n\r\n            var axhtmlstr = null;\r\n            if (Q3D.Browser.ie) {\r\n                axhtmlstr = this.AC_AX_RunContent(\"id\", mapDomId,\r\n                        \"classid\", \"CLSID:DB7C6663-F12F-4BEC-960D-194E6EB3BDAA\",\r\n                        \"width\", \"100%\", //container.clientWidth.toString(),\r\n                        \"height\", \"100%\",\r\n                        \"WindowLess\", this.options.WINDOWLESS ? \"1\" : \"0\" );\r\n            } else {\r\n                axhtmlstr = this.AC_AX_RunContent(\"id\", mapDomId,\r\n                        \"clsid\", \"{DB7C6663-F12F-4BEC-960D-194E6EB3BDAA}\",\r\n                        \"type\", \"application/QMap-activex\",\r\n                        \"width\", \"100%\", //container.clientWidth.toString(),\r\n                        \"height\", \"100%\", //container.clientHeight.toString(),\r\n                        \"WindowLess\", this.options.WINDOWLESS ? \"1\" : \"0\" ,\r\n                        'event_OnLButtonDown', 'OnLButtonDown',\r\n                        'event_OnLButtonUp', 'OnLButtonUp',\r\n                        'event_OnRButtonDown', 'OnRButtonDown',\r\n                        'event_OnRButtonUp', 'OnRButtonUp',\r\n                        'event_OnLButtonDblClk', 'OnLButtonDblClk',\r\n                        'event_OnMouseMove', 'OnMouseMove',\r\n                        'event_OnMouseWheel', 'OnMouseWheel',\r\n                        'event_OnRButtonDblClk', 'OnRButtonDblClk',\r\n                        'event_OnMButtonDown', 'OnMButtonDown',\r\n                        'event_OnMButtonUp', 'OnMButtonUp',\r\n                        'event_OnKeyUp', 'OnKeyUp',\r\n                        'event_OnKeyDown', 'OnKeyDown',\r\n                        'event_onCreateArea', 'onCreateArea',\r\n                        'event_onCreateSceneNode', 'onCreateSceneNode',\r\n                        'event_onBuildSceneNode', 'onBuildSceneNode',\r\n                        'event_onDestroySceneNode', 'onDestroySceneNode',\r\n                        'event_onResourceAllCompleted', 'onResourceAllCompleted',\r\n                        'event_onResourceAlreadyAllCompleted', 'onResourceAlreadyAllCompleted',\r\n                        'event_onAnimationEnd', 'onAnimationEnd',\r\n                        'event_onCameraCircleAniEnd', 'onCameraCircleAniEnd',\r\n                        'event_onAnimationKeyFrame', 'onAnimationKeyFrame',\r\n                        'event_onPreGroupPrepare', 'onPreGroupPrepare',\r\n                        'event_onGroupFileComplete', 'onGroupFileComplete',\r\n                        'event_onResourceLoaded', 'onResourceLoaded',\r\n                        'event_onResourceGroupFailed', 'onResourceGroupFailed',\r\n                        'event_onResourceGroupPackResLoaded', 'onResourceGroupPackResLoaded',\r\n                        'event_onResourceGroupPackResFailed', 'onResourceGroupPackResFailed',\r\n                        'event_onResourceGroupAllCompleted', 'onResourceGroupAllCompleted',\r\n                        'event_onAreasFirstLoadProcess', 'onAreasFirstLoadProcess',\r\n                        'event_onAllAreasFirstLoadCompleted', 'onAllAreasFirstLoadCompleted',\r\n                        'event_onTimeTrigger', 'onTimeTrigger',\r\n                        'event_onCameraFlyToEnd', 'onCameraFlyToEnd',\r\n                        'event_onCameraUpdate', 'onCameraUpdate',\r\n                        'event_onSceneNodeAllResourceCompleted', 'onSceneNodeAllResourceCompleted',\r\n                        'event_onSceneNodeDestroyed', 'onSceneNodeDestroyed',\r\n                        'event_OnDestroy', 'OnDestroy',\r\n                        'event_onWidgetClose', 'onWidgetClose',\r\n                        'event_onVideoCtrlClose', 'onVideoCtrlClose',\r\n                        'event_onUserNotify', 'onUserNotify',\r\n                        'event_onUserNotifyEX', 'onUserNotifyEX',\r\n                        'event_onQUISystemInit', 'onQUISystemInit',\r\n                        'event_onNotifyMouseButtonClick', 'onNotifyMouseButtonClick',\r\n                        'event_onMovieClipInstancePassFrame', 'onMovieClipInstancePassFrame',\r\n                        'event_onMovieClipInstanceRewind', 'onMovieClipInstanceRewind',\r\n                        'event_onMovieClipInstanceStop', 'onMovieClipInstanceStop',\r\n                        'event_onActCtrlObjAniEnd', 'onActCtrlObjAniEnd');\r\n            }\r\n\r\n            if (this._container && axhtmlstr) {\r\n                this._container.innerHTML = axhtmlstr;\r\n                this._map3d = Q3D.DomUtil.get(id + \"_qmap3d\");\r\n            }\r\n        },\r\n\r\n        //ocx\r\n        //\r\n\r\n        AC_AddExtension: function (src, ext) {\r\n            if (src.indexOf('?') != -1)\r\n                return src.replace(/\\?/, ext + '?');\r\n            else\r\n                return src + ext;\r\n        },\r\n\r\n        AC_Generateobj: function (objAttrs, params, embedAttrs) {\r\n            var str = '<object ';\r\n            for (var i in objAttrs)\r\n                str += i + '=\"' + objAttrs[i] + '\" ';\r\n            str += '>';\r\n            for (var i in params)\r\n                str += '<param name=\"' + i + '\" value=\"' + params[i] + '\" /> ';\r\n            str += '<embed ';\r\n            for (var i in embedAttrs)\r\n                str += i + '=\"' + embedAttrs[i] + '\" ';\r\n            str += ' ></embed></object>';\r\n            return str;\r\n            //document.write(str);\r\n        },\r\n\r\n        AC_GetArgs: function (args, ext, srcParamName, classid, mimeType) {\r\n            var ret = new Object();\r\n            ret.embedAttrs = new Object();\r\n            ret.params = new Object();\r\n            ret.objAttrs = new Object();\r\n            for (var i = 0; i < args.length; i = i + 2) {\r\n                var currArg = args[i].toLowerCase();\r\n\r\n                switch (currArg) {\r\n                case \"classid\":\r\n                    break;\r\n                case \"pluginspage\":\r\n                    ret.embedAttrs[args[i]] = args[i + 1];\r\n                    break;\r\n                case \"src\":\r\n                case \"movie\":\r\n                    args[i + 1] = AC_AddExtension(args[i + 1], ext);\r\n                    ret.embedAttrs[\"src\"] = args[i + 1];\r\n                    ret.params[srcParamName] = args[i + 1];\r\n                    break;\r\n                case \"onafterupdate\":\r\n                case \"onbeforeupdate\":\r\n                case \"onblur\":\r\n                case \"oncellchange\":\r\n                case \"onclick\":\r\n                case \"ondblClick\":\r\n                case \"ondrag\":\r\n                case \"ondragend\":\r\n                case \"ondragenter\":\r\n                case \"ondragleave\":\r\n                case \"ondragover\":\r\n                case \"ondrop\":\r\n                case \"onfinish\":\r\n                case \"onfocus\":\r\n                case \"onhelp\":\r\n                case \"onmousedown\":\r\n                case \"onmouseup\":\r\n                case \"onmouseover\":\r\n                case \"onmousemove\":\r\n                case \"onmouseout\":\r\n                case \"onkeypress\":\r\n                case \"onkeydown\":\r\n                case \"onkeyup\":\r\n                case \"onload\":\r\n                case \"onlosecapture\":\r\n                case \"onpropertychange\":\r\n                case \"onreadystatechange\":\r\n                case \"onrowsdelete\":\r\n                case \"onrowenter\":\r\n                case \"onrowexit\":\r\n                case \"onrowsinserted\":\r\n                case \"onstart\":\r\n                case \"onscroll\":\r\n                case \"onbeforeeditfocus\":\r\n                case \"onactivate\":\r\n                case \"onbeforedeactivate\":\r\n                case \"ondeactivate\":\r\n                case \"type\":\r\n                case \"codebase\":\r\n                    ret.objAttrs[args[i]] = args[i + 1];\r\n                    break;\r\n                case \"width\":\r\n                case \"height\":\r\n                case \"align\":\r\n                case \"vspace\":\r\n                case \"hspace\":\r\n                case \"class\":\r\n                case \"title\":\r\n                case \"accesskey\":\r\n                case \"name\":\r\n                case \"id\":\r\n                case \"tabindex\":\r\n                    ret.embedAttrs[args[i]] = ret.objAttrs[args[i]] = args[i + 1];\r\n                    break;\r\n                default:\r\n                    ret.embedAttrs[args[i]] = ret.params[args[i]] = args[i + 1];\r\n                }\r\n            }\r\n            ret.objAttrs[\"classid\"] = classid;\r\n            if (mimeType)\r\n                ret.embedAttrs[\"type\"] = mimeType;\r\n            return ret;\r\n        },\r\n\r\n        AC_AX_RunContent: function () {\r\n            var ret = this.AC_AX_GetArgs(arguments);\r\n            return this.AC_Generateobj(ret.objAttrs, ret.params, ret.embedAttrs);\r\n        },\r\n\r\n        AC_AX_GetArgs: function (args) {\r\n            var ret = new Object();\r\n            ret.embedAttrs = new Object();\r\n            ret.params = new Object();\r\n            ret.objAttrs = new Object();\r\n            for (var i = 0; i < args.length; i = i + 2) {\r\n                var currArg = args[i].toLowerCase();\r\n\r\n                switch (currArg) {\r\n                case \"pluginspage\":\r\n                case \"src\":\r\n                    ret.embedAttrs[args[i]] = args[i + 1];\r\n                    break;\r\n                case \"data\":\r\n                case \"codebase\":\r\n                case \"classid\":\r\n                case \"id\":\r\n                case \"onafterupdate\":\r\n                case \"onbeforeupdate\":\r\n                case \"onblur\":\r\n                case \"oncellchange\":\r\n                case \"onclick\":\r\n                case \"ondblClick\":\r\n                case \"ondrag\":\r\n                case \"ondragend\":\r\n                case \"ondragenter\":\r\n                case \"ondragleave\":\r\n                case \"ondragover\":\r\n                case \"ondrop\":\r\n                case \"onfinish\":\r\n                case \"onfocus\":\r\n                case \"onhelp\":\r\n                case \"onmousedown\":\r\n                case \"onmouseup\":\r\n                case \"onmouseover\":\r\n                case \"onmousemove\":\r\n                case \"onmouseout\":\r\n                case \"onkeypress\":\r\n                case \"onkeydown\":\r\n                case \"onkeyup\":\r\n                case \"onload\":\r\n                case \"onlosecapture\":\r\n                case \"onpropertychange\":\r\n                case \"onreadystatechange\":\r\n                case \"onrowsdelete\":\r\n                case \"onrowenter\":\r\n                case \"onrowexit\":\r\n                case \"onrowsinserted\":\r\n                case \"onstart\":\r\n                case \"onscroll\":\r\n                case \"onbeforeeditfocus\":\r\n                case \"onactivate\":\r\n                case \"onbeforedeactivate\":\r\n                case \"ondeactivate\":\r\n                case \"type\":\r\n                case \"clsid\":\r\n                    ret.objAttrs[args[i]] = args[i + 1];\r\n                    break;\r\n                case \"width\":\r\n                case \"height\":\r\n                case \"align\":\r\n                case \"vspace\":\r\n                case \"hspace\":\r\n                case \"class\":\r\n                case \"title\":\r\n                case \"accesskey\":\r\n                case \"name\":\r\n                case \"tabindex\":\r\n                    ret.embedAttrs[args[i]] = ret.objAttrs[args[i]] = args[i + 1];\r\n                    break;\r\n                default:\r\n                    ret.embedAttrs[args[i]] = ret.params[args[i]] = args[i + 1];\r\n                }\r\n            }\r\n            return ret;\r\n        },\r\n\r\n        //ocx\r\n\r\n        // @method getOcx(): Object\r\n        // 3D\r\n        getOcx: function () {\r\n            return mapObj._map3d ? mapObj._map3d : null;\r\n        },\r\n\r\n        // @method showNotice(title: String, msg: String): this\r\n        // \r\n        showNotice: function (title, msg) {\r\n            var Notification = window.Notification || window.mozNotification || window.webkitNotification;\r\n            if (Notification) {\r\n                Notification.requestPermission(function (status) {\r\n                    //status'default' 'denied'  'granted' \r\n                    if (\"granted\" != status) {\r\n                        return;\r\n                    } else {\r\n                        var tag = \"_qmap3d_\" + Math.random();\r\n                        var notify = new Notification(\r\n                                title, {\r\n                                dir: 'auto',\r\n                                lang: 'zh-CN',\r\n                                tag: tag, //notificationid\r\n                                //icon:'http://www.yinshuajun.com/static/img/favicon.ico',//,//icon icopngjpgjpeg\r\n                                body: msg //\r\n                            });\r\n                        notify.onclick = function () {\r\n                            //,\r\n                            window.focus();\r\n                        },\r\n                        notify.onerror = function () {\r\n                            console.log(\"HTML5\");\r\n                        };\r\n                        notify.onshow = function () {\r\n                            setTimeout(function () {\r\n                                notify.close();\r\n                            }, 2000)\r\n                        };\r\n                        notify.onclose = function () {\r\n                            console.log(\"HTML5\");\r\n                        };\r\n                    }\r\n                });\r\n            } else {\r\n                console.log(\"\");\r\n                alert(msg);\r\n            }\r\n            return this;\r\n        },\r\n\r\n        // @method toggleFPS(): this\r\n        // \r\n        toggleFPS: function () {\r\n            var _wm = mapObj._map3d.getWorldManager();\r\n            if (_wm.isFpsEnabled() == 1) {\r\n                _wm.disableFps();\r\n            } else {\r\n                _wm.enableFps();\r\n            }\r\n            return this;\r\n        },\r\n        \r\n        // @method loadArea(areaName: String): this\r\n        //  root  manualLoad = true\r\n        loadArea: function (areaName) {\r\n            mapObj._map3d.getWorldManager().loadIndieArea(0, areaName);\r\n            return this;\r\n        },\r\n        \r\n        // @method unloadArea(areaName: String): this\r\n        //  root  manualLoad = true\r\n        unloadArea: function (areaName) {\r\n            mapObj._map3d.getWorldManager().unloadIndieArea(0, areaName);\r\n            return this;\r\n        },\r\n        \r\n        // @method getArea(areaName: String): QAreaSceneManager\r\n        //  QAreaSceneManager \r\n        getArea: function (areaName) {\r\n            return mapObj._map3d.getWorldManager().getArea(areaName);\r\n        },\r\n\r\n        // @method getSceneNode(areaName: String, nodeName?: String): QSceneNode\r\n        //  QSceneNode \r\n        getSceneNode: function (areaName, nodeName) {\r\n            var nodeFullName = (nodeName === undefined) ? areaName : areaName + '/' + nodeName;\r\n            return mapObj._map3d.getWorldManager().getSceneNode(nodeFullName);\r\n        },\r\n        \r\n        // @method getSceneNodeFullName(node: QSceneNode): String\r\n        // \r\n        getSceneNodeFullName: function (node) {\r\n            var areaName = node.getArea().getName();\r\n            var nodeName = node.getName();\r\n            return areaName + '/' + nodeName;\r\n        },\r\n        \r\n        // @method getAllSceneNodeNames(searchStr: String): Array\r\n        // \r\n        getAllSceneNodeNames: function (searchStr) {\r\n            var nodeNames = [];\r\n            var poilist = mapObj._map3d.getWorldManager().findSceneNodeList(searchStr);\r\n            var obj = poilist.firstNode();\r\n            while(obj) {\r\n                nodeNames.push(obj.getFullName());\r\n                obj = poilist.nextNode();\r\n            }\r\n            poilist.release();\r\n            return nodeNames;\r\n        },\r\n       \r\n        // @method destroySceneNode(areaName: String, nodeName?: String, isDelay?: Boolean): this\r\n        // \r\n        destroySceneNode: function (areaName, nodeName, isDelay) {\r\n\r\n            if (typeof nodeName === 'undefined') {\r\n                var path = areaName.split(\"/\");\r\n                nodeName = path[path.length - 1];\r\n                areaName = path[0];\r\n            }            \r\n            var area = this.getArea(areaName);\r\n            if (!area)\r\n                return null;\r\n            \r\n            isDelay = isDelay || false;\r\n            if (\"destroySceneNodeDelay\" in area && isDelay)\r\n                area.destroySceneNodeDelay(nodeName);//\r\n            else\r\n            \tarea.destroySceneNode(nodeName);\r\n            return this;\r\n        },\r\n\r\n        // @method createCommonNode(nodePath: String, nodeType: Q3D.Enums.sceneNodeType): QSceneNode\r\n        // Node\"/[]/\"\r\n        //  null QSceneNode \r\n        createCommonNode: function (nodePath, nodeType) {\r\n            var path = nodePath.split(\"/\");\r\n            var pathNodeCount = path.length;\r\n            if (pathNodeCount < 2 || pathNodeCount > 3)\r\n                return null;\r\n\r\n            var areaName = path[0];\r\n            var area = this.getArea(areaName);\r\n            if (!area) //\r\n                return null;\r\n\r\n            var parentNodeName = null,\r\n            \tnodeName = null;\r\n            if (pathNodeCount == 2)\r\n                nodeName = path[1];\r\n            else {\r\n                parentNodeName = path[1];\r\n                nodeName = path[2];\r\n            }\r\n\r\n            if ((this.getSceneNode(areaName, nodeName) != null) || //\r\n                (pathNodeCount == 3 && !this.getSceneNode(areaName, parentNodeName))) //\r\n                return null;\r\n\r\n            var vecNodeCreated = null;\r\n            if (pathNodeCount == 2) {\r\n                vecNodeCreated = area.createTopNode(nodeType, nodeName);\r\n            } else {\r\n                var parentNode = this.getSceneNode(areaName, parentNodeName);\r\n                vecNodeCreated = parentNode.createChildNode(nodeType, nodeName, 0);\r\n            }\r\n\r\n            return vecNodeCreated;\r\n        },\r\n\r\n        // @method enableEditMode(nodePath: String, initEditMode?: Q3D.Enums.auxOperateType, options?: Edit options): this\r\n        //  123 \r\n        //  ESCAPE  DELETE  ENTER \r\n        enableEditMode: function (nodePath, initEditMode, options) {\r\n\r\n            var defaultEditModeOption = {\r\n                CustomEditAuxEnable: false,//\r\n                CustomEditAux: {//\r\n                    Translate: {\r\n                        AXIS_X: true,\r\n                        AXIS_Y: true,\r\n                        AXIS_Z: true,\r\n                        PLANE_XOY: true,\r\n                        PLANE_YOZ: true,\r\n                        PLANE_ZOX: true\r\n                    },\r\n                    Rotate: {\r\n                        AXIS_X: true,\r\n                        AXIS_Y: true,\r\n                        AXIS_Z: true,\r\n                        PLANE_XOY: true,\r\n                        PLANE_YOZ: true,\r\n                        PLANE_ZOX: true\r\n                    },\r\n                    Scale: {\r\n                        AXIS_X: true,\r\n                        AXIS_Y: true,\r\n                        AXIS_Z: true,\r\n                        PLANE_XOY: true,\r\n                        PLANE_YOZ: true,\r\n                        PLANE_ZOX: true\r\n                    }\r\n                },\r\n                OnSaved: null, //\r\n                OnCanceled: null, //\r\n                OnDeleted: null, //\r\n            }\r\n            Q3D.Util.jQueryExtend(true,defaultEditModeOption, options);\r\n            \r\n            try {\r\n                var node = this.getSceneNode(nodePath);\r\n                if (!node)\r\n                    return null;\r\n                \r\n                if(!this._editedNodeName)\r\n                    this.exitEditMode(Q3D.Enums.exitType.SaveAndExit);\r\n\t\t\t\t\r\n                //\r\n                this._editedNodePath = nodePath;\r\n                //node\r\n                this.attachMouseEvent(\"OnLButtonDown\", \"_showNode\", (function (options) {\r\n                    var im = this._map3d.getInputManager();\r\n                    if (options.NearestNode != null && options.NearestNode.getName().indexOf(this._editedNodePath.split('/')[1]) > -1) {                        \r\n                        im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, this._editedMode);\r\n                        im.sendActionMsg(this._editedMode, Q3D.Enums.actionMsg.LIMIT_AUX, 1, 0);\r\n                    } else {\r\n                        im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.TRANS_SCENE);\r\n                    }\r\n                }).bind(this));\r\n\r\n                //        \r\n                initEditMode = initEditMode || Q3D.Enums.auxOperateType.Translate;\r\n                switch(initEditMode) {\r\n                    case Q3D.Enums.auxOperateType.Translate:\r\n                    \tthis._editedMode = Q3D.Enums.actionType.OBJECTSELECT_MOVAUX; break;\r\n                    case Q3D.Enums.auxOperateType.Rotate:\r\n                    \tthis._editedMode = Q3D.Enums.actionType.OBJECTSELECT_ROTAUX; break;\r\n                    case Q3D.Enums.auxOperateType.Scale:\r\n                    \tthis._editedMode = Q3D.Enums.actionType.OBJECTSELECT_SCAAUX; break;\r\n                }\r\n                                \r\n                if (defaultEditModeOption.CustomEditAuxEnable) {\r\n                    var currentAuxTypeObj = null;\r\n                    var  mask = null;\r\n                    switch (initEditMode) {\r\n                        case 1:\r\n                            currentAuxTypeObj = defaultEditModeOption.CustomEditAux.Translate;\r\n                            break;\r\n                        case 2:\r\n                            currentAuxTypeObj = defaultEditModeOption.CustomEditAux.Rotate;\r\n                            break;\r\n                        case 3:\r\n                            currentAuxTypeObj = defaultEditModeOption.CustomEditAux.Scale;\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                    if (currentAuxTypeObj != null) {\r\n                        for (var i in currentAuxTypeObj) {\r\n                            if (currentAuxTypeObj[i]) {\r\n                                mask += Q3D.Enums.auxControlType[i];\r\n                            }\r\n                        }\r\n                        node.showAuxEx(initEditMode, mask, 1);\r\n                    }\r\n                    \r\n                } else {\r\n                \tnode.showAux(initEditMode, 1);\r\n                }\r\n\r\n                var im = this._map3d.getInputManager();\r\n                im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.OBJECTSELECT_MOVAUX);\r\n                im.sendActionMsg(this._editedMode, Q3D.Enums.actionMsg.LIMIT_AUX, 1, 0);\r\n                var currentstatus = {\r\n                    Translate: node.getPosition(),\r\n                    Rotate: node.getOrientation(0),\r\n                    Scale: node.getScale(0)\r\n                }\r\n                //\r\n                this.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_1, (function (wParam, lParam) {\r\n                        node.showAux(Q3D.Enums.auxOperateType.Translate, 1);\r\n                        this._editedMode = Q3D.Enums.actionType.OBJECTSELECT_MOVAUX;\r\n                        //var im = this._map3d.getInputManager();\r\n                        //im.bindControlAction( Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.OBJECTSELECT_MOVAUX );\r\n                    }).bind(this));\r\n                this.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_2, (function (wParam, lParam) {\r\n                        node.showAux(Q3D.Enums.auxOperateType.Rotate, 1);\r\n                        this._editedMode = Q3D.Enums.actionType.OBJECTSELECT_ROTAUX;\r\n                        //var im = this._map3d.getInputManager();\r\n                        //im.bindControlAction( Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.OBJECTSELECT_ROTAUX );\r\n                    }).bind(this));\r\n                this.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_3, (function (wParam, lParam) {\r\n                        node.showAux(Q3D.Enums.auxOperateType.Scale, 1);\r\n                        this._editedMode = Q3D.Enums.actionType.OBJECTSELECT_SCAAUX;\r\n                        //var im = this._map3d.getInputManager();\r\n                        //im.bindControlAction( Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.OBJECTSELECT_SCAAUX );\r\n                    }).bind(this));\r\n\r\n                this.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.ESCAPE, (function (wParam, lParam) {\r\n                        node.showAux(Q3D.Enums.auxOperateType.Hide, 1);\r\n                        //\r\n                        node.setPosition(currentstatus.Translate);\r\n                        node.setOrientation(currentstatus.Rotate, 0);\r\n                        node.setScale(currentstatus.Scale);\r\n                        im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.TRANS_SCENE);\r\n                        this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_1);\r\n                        this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_2);\r\n                        this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_3);\r\n                        this.detachMouseEvent(\"OnLButtonDown\", \"_showNode\");\r\n                        this._editedNodeName = null;\r\n                        if (Q3D.Util.isFunction(defaultEditModeOption.OnCanceled)) {\r\n                            defaultEditModeOption.OnCanceled(node);\r\n                        }\r\n                        setTimeout((function () {\r\n                                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.ESCAPE);\r\n                                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.DELETE);\r\n                                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.ENTER);\r\n                            }).bind(this), 50);\r\n                    }).bind(this));\r\n                this.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.DELETE, (function (wParam, lParam) {\r\n                        node.showAux(Q3D.Enums.auxOperateType.Hide, 1);\r\n                        //node.setVisible(0); //\r\n                        this.destroySceneNode(node.getArea().getName(),node.getName());\r\n                        im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.TRANS_SCENE);\r\n                        this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_1);\r\n                        this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_2);\r\n                        this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_3);\r\n                        this.detachMouseEvent(\"OnLButtonDown\", \"_showNode\");\r\n                        this._editedNodeName = null;\r\n                        if (Q3D.Util.isFunction(defaultEditModeOption.OnDeleted)) {\r\n                            defaultEditModeOption.OnDeleted(node);\r\n                        }\r\n                        setTimeout((function () {\r\n                                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.ESCAPE);\r\n                                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.DELETE);\r\n                                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.ENTER);\r\n                            }).bind(this), 50);\r\n                    }).bind(this));\r\n                this.attachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.ENTER, (function (wParam, lParam) {\r\n                        node.showAux(Q3D.Enums.auxOperateType.Hide, 1);\r\n                        im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.TRANS_SCENE);\r\n                        this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_1);\r\n                        this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_2);\r\n                        this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_3);\r\n                        this.detachMouseEvent(\"OnLButtonDown\", \"_showNode\");\r\n                        this._editedNodeName = null;\r\n                        if (Q3D.Util.isFunction(defaultEditModeOption.OnSaved)) {\r\n                            defaultEditModeOption.OnSaved(node);\r\n                        }\r\n                        setTimeout((function () {\r\n                                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.ESCAPE);\r\n                                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.DELETE);\r\n                                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.ENTER);\r\n                            }).bind(this), 50);\r\n                    }).bind(this));\r\n\r\n            } catch (e) {\r\n                return null;\r\n            }\r\n            return this;\r\n        },\r\n\r\n        // @method exitEditMode(exitType: Q3D.Enums.sceneNodeType.exitType): this\r\n        // SaveAndExit -  DeleteAndExit - \r\n        exitEditMode: function (exitType) {\r\n            var editedNodePath = this._editedNodePath;\r\n            if (!editedNodePath)\r\n                return null;\r\n\r\n            var node = this.getSceneNode(editedNodePath);\r\n            if (!node)\r\n                return null;\r\n\r\n            if (mapObj.getMouseEventStatus(\"OnLButtonDown\", \"_showNode\")) {\r\n                if (exitType == Q3D.Enums.exitType.SaveAndExit) {\r\n                    node.showAux(Q3D.Enums.auxOperateType.Hide, 1);\r\n                } else if (exitType == Q3D.Enums.exitType.DeleteAndExit) {\r\n                    var path = editedNodePath.split(\"/\");\r\n                    this.destroySceneNode(path[0], path[1]);\r\n                }\r\n                \r\n                this._map3d.getInputManager().bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.TRANS_SCENE);\r\n                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_1);\r\n                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_2);\r\n                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.NUM_3);\r\n                this.detachMouseEvent(\"OnLButtonDown\", \"_showNode\");\r\n                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.ESCAPE);\r\n                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.DELETE);\r\n                this.detachKeyEvent(\"OnKeyUp\", Q3D.Enums.keyboard.ENTER);\r\n            }\r\n            return this;\r\n        },\r\n\r\n        // @method getHtmlWidget(htmlWidgetName: String): QHtmlWidget\r\n        // QHtmlWidget\r\n        getHtmlWidget: function (htmlWidgetName) {\r\n            if (!htmlWidgetName)\r\n                return null;\r\n            var extUI = mapObj._map3d.getExternUIWidgetSys();\r\n            if(!extUI)\r\n                return  null;\r\n            \r\n            if (\"getHtmlWidget\" in extUI)\r\n                return extUI.getHtmlWidget(htmlWidgetName);\r\n            else\r\n            \treturn extUI.createHtmlWidget(htmlWidgetName, \"\", \"\");\r\n        },\r\n        \r\n        // @method destroyMovieClipInstance(mciName: String): this\r\n        // \r\n        destroyMovieClipInstance: function (mciName) {\r\n            mapObj._map3d.getWorldManager().destroyMovieClipInstance(mciName);\r\n            return this;\r\n        },\r\n        \r\n        // @method destroyAllMovieClipInstances(): this\r\n        // \r\n        destroyAllMovieClipInstances: function () {\r\n            mapObj._map3d.getWorldManager().destroyAllMovieClipInstances();\r\n            return this;\r\n        },\r\n        \r\n        // @method destroyMovieClip(mcName: String): this\r\n        // \r\n        destroyMovieClip: function (mcName) {\r\n            mapObj._map3d.getWorldManager().destroyMovieClip(mcName);\r\n            return this;\r\n        },\r\n        \r\n        // @method destroyAllMovieClips(): this\r\n        // \r\n        destroyAllMovieClips: function () {\r\n            mapObj._map3d.getWorldManager().destroyAllMovieClips();\r\n            return this;\r\n        },\r\n        \r\n        // @method destroyContainer(ctnName: String): this\r\n        // \r\n        destroyContainer: function (ctnName) {\r\n            mapObj._map3d.getWorldManager().destroyContainer(ctnName);\r\n            return this;\r\n        },\r\n        \r\n        // @method destroyAllContainers(): this\r\n        // \r\n        destroyAllContainers: function () {\r\n            mapObj._map3d.getWorldManager().destroyAllContainer();\r\n            return this;\r\n        },\r\n        \r\n        // @method addPOIByJson(pois: String): this\r\n        // JSONPOIJSON\r\n    /*  JSON\r\n        {\r\n        \"AreaName\": \"XHQ\",\r\n        \"FontSize\": 20,\r\n        \"FontName\": \"\",\r\n        \"FontColor\": \"#000000\",\r\n        \"CharScale\": 1.0,\r\n        \"POILayout\": 0,\r\n        \"UIType\": 2,\r\n        \"IconAlphaEnabled\": true,\r\n        \"FontOutLine\": null,\r\n        \"FontEdgeColor\": null,\r\n        \"AlphaTestRef\": null,\r\n        \"Location\": 768,\r\n        \"LocationOffset\": null,\r\n        \"BackFrameBorderSize\": null,    \r\n        \"BackBorderColor\": null,\r\n        \"BackFillColor\": null,\r\n        \"LabelMargin\": null,\r\n        \"IconLabelMargin\": null,\r\n        \"SpecialTransparent\": true,\r\n        \"AlwaysOnScreen\": false,\r\n        \"POIS\": [\r\n            {\r\n                \"Name\": \"POI1\",\r\n                \"FontColor\": \"#ff0000\",\r\n                \"Text\": \"TESTPOI1\",\r\n                \"Icon\": \"Texture/dx_dz_16.png\",\r\n                \"IconSize\": [48,48],\r\n                \"Position\": [0,0,0]\r\n            },\r\n            {\r\n                \"Name\": \"POI2\",\r\n                \"FontColor\": \"#ff00ff\",\r\n                \"Text\": \"TESTPOI2\",\r\n                \"Icon\": \"Texture/dx_dz_16.png\",\r\n                \"IconSize\": [48,48],\r\n                \"Position\": [0,20,0]\r\n            },\r\n            {\r\n                        \"Name\": \"Group/POI3\",\r\n                        \"FontColor\": \"#ff00ff\",\r\n                        \"Text\": \"TESTPOI3\",\r\n                        \"Icon\": \"Texture/dx_dz_16.png\",\r\n                        \"IconSize\": [48,48],\r\n                        \"Position\": [0,20,0]\r\n                    }\r\n                ]\r\n            }\r\n            \r\n            1            2POI\"Group/POI3\"GroupPOI\r\n            3POI\r\n    */\r\n        addPOIByJson: function (pois) {\r\n        \tmapObj._map3d.addPOIByJson(pois);\r\n            return this;\r\n    \t},\r\n        \r\n        // @method addContainerByJson(ctnName: String, jsonStr: String): NodeContainer\r\n        // JSON\r\n        /*JSON\r\n         {\r\n        \"Name\": \"myContainer\", //\r\n        \"Type\": 0,\t\t//Alpha: 0,Color: 1,Visible: 2,Material: 3\r\n        \"TargetValue\": \"0.2\",\t//TypeAlpha:0.2,Color:\"#000000\",Visible:\"true/false\",Material:\"Material/xy_xy_cao_580.mtr\"\r\n        \"NODES\": [\"XHQ/node_1\",\"XHQ/node_2\"]\r\n        }\r\n        */\r\n        addContainerByJson: function (ctnName, jsonStr) {\r\n            mapObj._map3d.addContainerByJson(jsonStr);\r\n            return Q3D.nodeContainer(ctnName);\r\n        },        \r\n        \r\n        // @method saveImageAsBase64(isJpg: Boolean): String\r\n        // UIBase64pngjpg\r\n        saveImageAsBase64: function (isJpg) {\r\n            var imgTypeStr = isJpg ? \"jpg\" : \"png\";\r\n            var strImg = \"data:image/\" + imgTypeStr + \";base64,\" + mapObj._map3d.saveImageEx(imgTypeStr);\r\n            return strImg.replace(/\\r\\n/g,'');\r\n        },\r\n        \r\n        // @method saveImageAsFile(fileName: String): String\r\n        // UIpngjpg'/'\r\n        saveImageAsFile: function (fileName) {\r\n            return mapObj._map3d.saveImage(fileName);\r\n        },\r\n        \r\n        // @method saveFrameAsBase64(isJpg: Boolean): String\r\n        // Base64pngjpg\r\n        saveFrameAsBase64: function (isJpg) {\r\n            var imgTypeStr = isJpg ? \"jpg\" : \"png\";\r\n            var strImg = \"data:image/\" + imgTypeStr + \";base64,\" + mapObj._map3d.saveCurrentFrameAsBase64(imgTypeStr);\r\n            return strImg.replace(/\\r\\n/g,'');\r\n        },\r\n        \r\n        // @method saveFrameAsFile(fileName: String): String\r\n        // pngjpg'/'\r\n        saveFrameAsFile: function (fileName) {\r\n            return mapObj._map3d.saveCurrentFrameAsFile(fileName);\r\n        },\r\n\r\n        // @method queryByRay(stPt: Vector3d, edPt: Vector3d): Number\r\n        // \r\n        // 0-11\r\n        // root\r\n        // `<Physics enabled=\"true\" mainEnabled=\"true\" acsEnabled=\"false\">`\r\n        //      `<PhyWorld meshAutoSetup=\"true\" fPRoamType=\"0\" id=\"0\" />`\r\n        // `</Physics>`\r\n        queryByRay: function (stPt, edPt) {\r\n            var _dirPacked3d = edPt.clone().subtract(stPt);\r\n            var _totalLen = _dirPacked3d.distanceTo(Q3D.vector3d(0, 0, 0));\r\n            _dirPacked3d.divide(Q3D.vector3d(_totalLen, _totalLen, _totalLen));\r\n            var _dir = Q3D.vector3(_dirPacked3d.x, _dirPacked3d.y, _dirPacked3d.z);\r\n            var _cross = Q3D.vector3d(0, 0, 0).get();\r\n            _cross = mapObj._map3d.getWorldManager().pickNearestSceneNodeByRayEx(0, stPt.get(), _dir.get(), -1);\r\n            if (!_cross) return 0; //\r\n            \r\n            var _crossPacked3d = Q3D.vector3d(_cross.x, _cross.y, _cross.z);\r\n            if (_crossPacked3d.x != 0 || _crossPacked3d.y != 0 || _crossPacked3d.z != 0) {\r\n                //var _crossPacked3d = Q3D.vector3d(_cross.x, _cross.y, _cross.z);\r\n                //\r\n                if (edPt.equals(_crossPacked3d, 0.1) || stPt.equals(_crossPacked3d, 0.1)) {\r\n                    return -1; //\r\n                } else { //\r\n                    var _crossLen = _crossPacked3d.subtract(stPt).distanceTo(Q3D.vector3d(0, 0, 0));\r\n                    if (_crossLen < _totalLen)\r\n                        return 1; //\r\n                }\r\n            }\r\n            return false;\r\n        },\r\n        \r\n        // @method enableTooltip(waitTime: Number, fn: Function): this\r\n        //  TooltipwaitTimefnQSceneNode\r\n        enableTooltip: function (waitTime, fn) {\r\n            var wt = waitTime || 500;\r\n            if (fn) {\r\n                mapObj._map3d.setTooltipListener(wt);\r\n                mapObj.on('onSceneNodeTooltip', fn);\r\n            }\r\n            return this;\r\n        },\r\n        // @method disableTooltip(): this\r\n        // Tooltip\r\n        disableTooltip: function () {\r\n            mapObj._map3d.removeTooltipListener();\r\n\t\t\tmapObj.off('onSceneNodeTooltip');     \r\n            return this;\r\n        },\r\n    });\r\n\r\n// @section\r\n\r\n// @factory Q3D.map(id: String, options: Map Init Options)\r\n//   `<div>`   DOM ID \r\n//\r\n// @alternative\r\n// @factory Q3D.map(el: HTMLElement, options: Map Init Options)\r\n//   `<div>`  HTML \r\nQ3D.map = function (id, options) {\r\n    window.mapObj = new Q3D.Map(id, options);\r\n    return window.mapObj; //\r\n};","/* @class Vector2\r\n * @aka Q3D.Vector2\r\n *\r\n * \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var v2 = Q3D.vector2(50.5, 30.2);\r\n * ```\r\n *\r\n * \r\n *\r\n * ```\r\n * var v2 = Q3D.vector2([50.5, 30.2]);\r\n * v2 = Q3D.vector2({x:50.5, y:30.2})\r\n * ```\r\n */\r\n\r\nQ3D.Vector2 = function (x, y) {\r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }\r\n\tif (isNaN(x) || isNaN(y)) {\r\n\t\tthrow new Error('QVector2: (' + x + ', ' + y + ')');\r\n\t}    \r\n    \r\n    // @property x: Number\r\n\t//  x\r\n\tthis.x = +x;\r\n    // @property y: Number\r\n\t//  y\r\n\tthis.y = +y;\r\n\r\n};\r\n\r\nQ3D.Vector2.prototype = {\r\n\t        \r\n    // @method get(): QVector2\r\n    //  QVector2 \r\n    get: function() {\r\n        this.update();\r\n        return this._qVector2 ;\r\n    },\r\n    // @method equals(otherVector2: Vector2, maxMargin?: Number): Boolean\r\n\t//  `Vector2` \r\n\tequals: function (obj, maxMargin) {\r\n\t\tif (!obj) { return false; }\r\n\r\n\t\tvar margin = Math.max(\r\n\t\t        Math.abs(this.x - obj.x),\r\n\t\t        Math.abs(this.y - obj.y));\r\n\r\n\t\treturn margin <= (maxMargin === undefined ? 1.0E-9 : maxMargin);\r\n\t},\r\n\r\n\t// @method toString(): String\r\n\t// \r\n\ttoString: function (precision) {\r\n\t\treturn 'QVector2(' +\r\n\t\t        Q3D.Util.formatNum(this.x, precision) + ', ' +\r\n\t\t        Q3D.Util.formatNum(this.y, precision) + ')';\r\n\t},\r\n\r\n\t// @method distanceTo(otherVector2: Vector2): Number\r\n\t//  `Vector2` \r\n\tdistanceTo: function (other) {\r\n        if (other)\r\n        {\r\n            var dx = other.x - this.x,\r\n\t\t    dy = other.y - this.y;\r\n\r\n            return Math.sqrt(dx * dx + dy * dy);\r\n        }\r\n        return null;\r\n\t},\r\n    \r\n    // @method add(otherVector2: Vector2): this\r\n    //  `Vector2` \r\n    add: function (other) {\r\n        if (other)\r\n        {\r\n            this.x += other.x; \r\n            this.y += other.y; \r\n        }\r\n        return this;\r\n\t},\r\n\r\n    // @method subtract(otherVector2: Vector2): this\r\n    //  `Vector2` \r\n    subtract: function (other) {\r\n        if (other)\r\n        {\r\n            this.x -= other.x;\r\n            this.y -= other.y;         \r\n        }\r\n        return this;\r\n\t},\r\n    // @method multiply(otherVector2: Vector2): this\r\n    //  `Vector2` \r\n    multiply: function (other) {\r\n        if (other)\r\n        {\r\n            this.x *= other.x; \r\n            this.y *= other.y;          \r\n        }\r\n        return this;\r\n\t},\r\n    // @method divide(otherVector2: Vector2): this\r\n    //  `Vector2` \r\n    divide: function (other) {\r\n        if (other)\r\n        {\r\n            if (other.x == 0 || other.y == 0)\r\n                throw new Error('0');\r\n\r\n            this.x /= other.x; \r\n            this.y /= other.y;       \r\n\r\n        }\r\n        return this;\r\n\t},\r\n   \r\n   // @method clone(): Vector2\r\n    //  `Vector2` \r\n\tclone: function () {\r\n\t\treturn new Q3D.Vector2(this.x, this.y);\r\n\t},\r\n    \r\n    // @method update(): this\r\n    //  QVector2 \r\n\tupdate: function () {        \r\n        if (this._qVector2 == null)\r\n\t\t\tthis._qVector2 = mapObj._map3d.createObject(\"QMap3DCtl.QVector2\");\r\n        this._qVector2.x = this.x;\r\n        this._qVector2.y = this.y;\r\n        return this;\r\n\t}\r\n};\r\n\r\n\r\n\r\n// @factory Q3D.vector2(a: Number, b: Number): Vector2\r\n// \r\n\r\n// @alternative\r\n// @factory Q3D.vector2(coords: Array): Vector2\r\n//  `[Number, Number]` \r\n\r\n// @alternative\r\n// @factory Q3D.vector2(coords: Object): Vector2\r\n//  `{x: Number, y: Number}`\r\n//   QVector2 \r\n\r\n// @alternative\r\n// @factory Q3D.vector2(): Vector2\r\n// 0\r\n\r\nQ3D.vector2 = function (a, b) {\r\n\r\n\tif (a instanceof Q3D.Vector2) {\r\n\t\treturn a; //\r\n\t}\r\n    \r\n\tif (Q3D.Util.isArray(a) && typeof a[0] !== 'object') {\t\t\r\n\t\tif (a.length === 2) {\r\n\t\t\treturn new Q3D.Vector2(a[0], a[1]);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tif (typeof a === 'object' && 'x' in a && 'y' in a) {\r\n\t\treturn new Q3D.Vector2(a.x, a.y);\r\n\t}    \r\n   \r\n    if  (arguments.length == 2 && typeof a === 'number' && typeof  b === 'number') {\r\n\t\treturn new Q3D.Vector2(a, b);\r\n\t}       \r\n\r\n    return new Q3D.Vector2(0, 0);\r\n};\r\n\r\n// @method toVector2(): Vector2\r\n// \r\n// ```js\r\n// var v2 = \"50.5, 30.2\".toVector2();\r\n// ``` \r\nString.prototype.toVector2 = function () {\r\n    try {\r\n        return Q3D.vector2(parseFloat(this.split(\",\")[0]), parseFloat(this.split(\",\")[1]));\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n}\r\n","/* @class Vector2I\r\n * @aka Q3D.Vector2I\r\n *\r\n * \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var v2I = Q3D.vector2I(50, 30);\r\n * ```\r\n *\r\n * \r\n *\r\n * ```\r\n * var v2I = Q3D.vector2I([50, 30]);\r\n * v2I = Q3D.vector2I({x:50, y:30})\r\n * ```\r\n */\r\n\r\nQ3D.Vector2I = function (x, y) {\r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }\r\n\tif (!Q3D.Util.isInteger(x) || !Q3D.Util.isInteger(y)) {\r\n\t\tthrow new Error('QVector2I: (' + x + ', ' + y + ')');\r\n\t}    \r\n    // @property x: Number\r\n\t//  x\r\n\tthis.x = +x;\r\n    // @property y: Number\r\n\t//  y\r\n\tthis.y = +y;\r\n\r\n};\r\n\r\nQ3D.Vector2I.prototype = {\r\n\t\r\n    \r\n     // @method get(): QVector2I\r\n    //  QVector2I \r\n     get: function() {\r\n         this.update();\r\n        return this._qVector2I ;\r\n    },\r\n\r\n    // @method equals(otherVector2I: Vector2I, maxMargin?: Number): Boolean\r\n    //  `Vector2I` \r\n\tequals: function (obj, maxMargin) {\r\n\t\tif (!obj) { return false; }\r\n\r\n\t\tvar margin = Math.max(\r\n\t\t        Math.abs(this.x - obj.x),\r\n\t\t        Math.abs(this.y - obj.y));\r\n\r\n\t\treturn margin <= (maxMargin === undefined ? 1.0E-9 : maxMargin);\r\n\t},\r\n\r\n\t// @method toString(): String\r\n              // \r\n\ttoString: function (precision) {\r\n\t\treturn 'QVector2I(' +\r\n\t\t        Q3D.Util.formatNum(this.x, precision) + ', ' +\r\n\t\t        Q3D.Util.formatNum(this.y, precision) + ')';\r\n\t},\r\n\r\n\t// @method distanceTo(otherVector2I: Vector2I): Number\r\n            //  `Vector2I` \r\n    distanceTo: function (other) {\r\n        if (other)\r\n        {\r\n            var dx = other.x - this.x,\r\n\t\t    dy = other.y - this.y;\r\n\r\n            return Math.sqrt(dx * dx + dy * dy);\r\n        }\r\n        return null;\r\n\t},\r\n    \r\n     // @method add(otherVector2I: Vector2I): this\r\n     //  `Vector2I` \r\n    add: function (other) {\r\n        if (other)\r\n        {\r\n            this.x += other.x;\r\n            this.y += other.y;            \r\n        }\r\n        return this;\r\n\t},\r\n\r\n     // @method subtract(otherVector2I: Vector2I): this\r\n     //  `Vector2I` \r\n    subtract: function (other) {\r\n        if (other)\r\n        {\r\n            this.x -= other.x;\r\n            this.y -= other.y;            \r\n        }\r\n        return this;\r\n\t},\r\n     // @method multiply(otherVector2I: Vector2I): this\r\n     //  `Vector2I`    \r\n    multiply: function (other) {\r\n        if (other)\r\n        {\r\n            this.x *= other.x;\r\n            this.y *= other.y;            \r\n        }\r\n        return this;\r\n\t},    \r\n    // @method divide(otherVector2I: Vector2I): this\r\n    //  `Vector2I` \r\n    divide: function (other) {\r\n        if (other)\r\n        {\r\n            if (other.x == 0 || other.y == 0)\r\n                throw new Error('0');\r\n\r\n            this.x /= other.x;\r\n            this.y /= other.y;         \r\n\r\n        }\r\n        return this;\r\n\t},\r\n   \r\n   // @method clone(): Vector2I\r\n    //  `Vector2I` \r\n\tclone: function () {\r\n\t\treturn new Q3D.Vector2I(this.x, this.y);\r\n\t},\r\n    \r\n    // @method update(): this\r\n    //  QVector2I \r\n\tupdate: function () {        \r\n    \tif (this._qVector2I == null)\r\n\t\t\tthis._qVector2I = mapObj._map3d.createObject(\"QMap3DCtl.QVector2I\");\r\n        this._qVector2I.x = this.x;\r\n        this._qVector2I.y = this.y;\r\n        return this;\r\n\t}\r\n};\r\n\r\n\r\n\r\n// @factory Q3D.vector2I(a: Number, b: Number): Vector2I\r\n// \r\n\r\n// @alternative\r\n// @factory Q3D.vector2I(coords: Array): Vector2I\r\n//  `[Number, Number]` \r\n\r\n// @alternative\r\n// @factory Q3D.vector2I(coords: Object): Vector2I\r\n//  `{x: Number, y: Number}`\r\n//   QVector2I \r\n\r\n// @alternative\r\n// @factory Q3D.vector2I(): Vector2I\r\n// 0\r\n\r\nQ3D.vector2I = function (a, b) {\r\n\r\n\tif (a instanceof Q3D.Vector2I) {\r\n\t\treturn a;\r\n\t}\r\n    \r\n\tif (Q3D.Util.isArray(a) && typeof a[0] !== 'object') {\t\t\r\n\t\tif (a.length === 2) {\r\n\t\t\treturn new Q3D.Vector2I(a[0], a[1]);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tif (typeof a === 'object' && 'x' in a && 'y' in a) {\r\n\t\treturn new Q3D.Vector2I(a.x, a.y);\r\n\t}\r\n\t\r\n    if  (arguments.length == 2 && typeof a === 'number' && typeof  b === 'number') {\r\n\t\treturn new Q3D.Vector2I(a, b);\r\n\t} \r\n    \r\n\treturn new Q3D.Vector2I(0, 0);\r\n};\r\n// @method toVector2I(): Vector2I\r\n// \r\n// ```js\r\n// var v2I = \"50, 30\".toVector2I();\r\n// ```\r\nString.prototype.toVector2I = function () {\r\n    try {\r\n        return Q3D.vector2I(parseInt(this.split(\",\")[0]), parseInt(this.split(\",\")[1]));\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n}\r\n","/* @class Vector3\r\n * @aka Q3D.Vector3\r\n *\r\n *  y \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var v3 = Q3D.vector3(50.3, 5.0, 30.5);\r\n * ```\r\n *\r\n * \r\n *\r\n * ```\r\n * var v3 = Q3D.vector3([50.3, 5.0, 30.5]);\r\n * v3 = Q3D.vector3({x:50.3, y:5.0, z:30.5})\r\n * ```\r\n */\r\n\r\nQ3D.Vector3 = function (x, y, z) {\r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }\r\n\tif (isNaN(x) || isNaN(y) || isNaN(z)) {\r\n\t\tthrow new Error('QVector3: (' + x + ', ' + y +  ', ' + z + ')');\r\n\t}\r\n\r\n    // @property x: Number\r\n\t//  x\r\n\tthis.x = +x;\r\n    // @property y: Number\r\n\t//  y\r\n\tthis.y = +y;\r\n    // @property z: Number\r\n\t//  z\r\n    this.z = +z;\r\n\r\n};\r\n\r\nQ3D.Vector3.prototype = {\t\r\n    \r\n     // @method get(): QVector3\r\n    //  QVector3     \r\n     get: function() {\r\n        this.update();//\r\n        return this._qVector3 ;\r\n    },\r\n    // @method equals(otherVector3: Vector3, maxMargin?: Number): Boolean\r\n    //  `Vector3` \r\n\tequals: function (obj, maxMargin) {\r\n\t\tif (!obj) { return false; }\r\n\r\n\t\t//obj = Q3D.vector3(obj);\r\n\r\n\t\tvar margin = Math.max(\r\n\t\t        Math.abs(this.x - obj.x),\r\n\t\t        Math.abs(this.y - obj.y),\r\n                Math.abs(this.z - obj.z));\r\n\r\n\t\treturn margin <= (maxMargin === undefined ? 1.0E-9 : maxMargin);\r\n\t},\r\n\r\n    // @method toString(): String\r\n    // \r\n\ttoString: function (precision) {\r\n\t\treturn 'QVector3(' +\r\n\t\t        Q3D.Util.formatNum(this.x, precision) + ', ' +\r\n                Q3D.Util.formatNum(this.y, precision) + ', ' +\r\n\t\t        Q3D.Util.formatNum(this.z, precision) + ')';\r\n\t},\r\n\r\n    // @method distanceTo(otherVector3: Vector3): Number\r\n    //  `Vector3` \r\n\tdistanceTo: function (other) {\r\n        if (other)\r\n        {\r\n            var dx = other.x - this.x,\r\n\t\t    dy = other.y - this.y,\r\n            dz = other.z - this.z;\r\n\r\n            return Math.sqrt(dx * dx + dy * dy + dz * dz);\r\n        }\r\n        return null;\r\n\t},\r\n    \r\n    // @method add(otherVector3: Vector3): this\r\n    //  `Vector3` \r\n    add: function (other) {\r\n        if (other)\r\n        {\r\n            this.x += other.x;\r\n            this.y += other.y;    \r\n            this.z += other.z;                \r\n        }\r\n        return this;\r\n\t},\r\n\r\n    // @method subtract(otherVector3: Vector3): this\r\n    //  `Vector3` \r\n    subtract: function (other) {\r\n        if (other)\r\n        {\r\n            this.x -= other.x;\r\n            this.y -= other.y;  \r\n            this.z -= other.z;             \r\n        }\r\n        return this;\r\n\t},\r\n    \r\n    // @method multiply(otherVector3: Vector3): this\r\n    //  `Vector3` \r\n    multiply: function (other) {\r\n        if (other)\r\n        {\r\n            this.x *= other.x;\r\n            this.y *= other.y;            \r\n            this.z *= other.z;    \r\n        }\r\n        return this;\r\n\t},\r\n    \r\n    // @method divide(otherVector3: Vector3): this\r\n    //  `Vector3` \r\n    divide: function (other) {\r\n        if (other)\r\n        {\r\n            if (other.x == 0 || other.y == 0 || other.z == 0)\r\n                throw new Error('0');\r\n\r\n            this.x /= other.x;\r\n            this.y /= other.y;   \r\n            this.z /= other.z;   \r\n\r\n        }\r\n        return this;\r\n\t},\r\n   \r\n    // @method clone(): Vector3\r\n    //  `Vector3` \r\n\tclone: function () {\r\n\t\treturn new Q3D.Vector3(this.x, this.y, this.z);\r\n\t},\r\n    \r\n    // @method toGlobalPos(areaName: String): QVector3d\r\n    // QVector3d \r\n\ttoGlobalPos: function (areaName) {\r\n        var area = mapObj._map3d.getWorldManager().getArea(areaName);\r\n        if (area) {\r\n            return area.toGlobalPos(this.get());\r\n        } \r\n        return null;        \r\n\t},   \r\n    // @method toGlobalVec3d(areaName: String): QGlobalVec3d\r\n    // QGlobalVec3d \r\n\ttoGlobalVec3d: function (areaName) {\r\n        var area = mapObj._map3d.getWorldManager().getArea(areaName);\r\n        if (area) {\r\n            var  v3d = area.toGlobalPos(this.get());\r\n            var math = mapObj._map3d.getMath();\r\n            return math.vec3DToGlobalVec3D(v3d);\r\n        } \r\n        return null;        \r\n\t},       \r\n    \r\n    // @method update(): this\r\n    //  QVector3 \r\n\tupdate: function () {    \r\n        if (this._qVector3 == null)\r\n\t\t\tthis._qVector3 = mapObj._map3d.createObject(\"QMap3DCtl.QVector3\");    \r\n        this._qVector3.x = this.x;\r\n        this._qVector3.y = this.y;\r\n        this._qVector3.z = this.z;\r\n        return this;\r\n\t}\r\n};\r\n\r\n\r\n\r\n// @factory Q3D.vector3(a: Number, b: Number, c: Number): Vector3\r\n// \r\n\r\n// @alternative\r\n// @factory Q3D.vector3(coords: Array): Vector3\r\n//  `[Number, Number, Number]` \r\n\r\n// @alternative\r\n// @factory Q3D.vector3(coords: Object): Vector3\r\n//  `{x: Number, y: Number, z: Number}`\r\n//   QVector3 \r\n\r\n// @alternative\r\n// @factory Q3D.vector3(): Vector3\r\n// 0\r\n\r\nQ3D.vector3 = function (a, b, c) {\r\n\r\n\tif (a instanceof Q3D.Vector3) {\r\n\t\treturn a;\r\n\t}\r\n    \r\n\tif (Q3D.Util.isArray(a) && typeof a[0] !== 'object') {\t\t\r\n\t\tif (a.length === 3) {\r\n\t\t\treturn new Q3D.Vector3(a[0], a[1], a[2]);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tif (typeof a === 'object' && 'x' in a && 'y' in a && 'z' in a) {\r\n\t\treturn new Q3D.Vector3(a.x, a.y, a.z);\r\n\t}\r\n\t\r\n    if  (arguments.length == 3 && typeof a === 'number' && typeof  b === 'number' && typeof c === 'number') {\r\n\t\treturn new Q3D.Vector3(a, b, c);\r\n\t} \r\n    \r\n    return new Q3D.Vector3(0, 0, 0);\r\n};\r\n\r\n// @method toVector3(): Vector3\r\n// \r\n// ```js\r\n// var v3 = \"50.3, 5.0, 30.5\".toVector3();\r\n// ``` \r\nString.prototype.toVector3 = function () {\r\n    try {\r\n        return Q3D.vector3(parseFloat(this.split(\",\")[0]), parseFloat(this.split(\",\")[1]), parseFloat(this.split(\",\")[2]));\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n}\r\n\r\n","/* @class Vector3d\r\n * @aka Q3D.Vector3d\r\n *\r\n *  y \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var v3 = Q3D.vector3d(50.34343, 5.02342, 30.52324);\r\n * ```\r\n *\r\n * \r\n *\r\n * ```\r\n * var v3 = Q3D.vector3d([50.34343, 5.02342, 30.52324]);\r\n * v3 = Q3D.vector3d({x:50.34343, y:5.02342, z:30.52324})\r\n * ```\r\n */\r\n\r\nQ3D.Vector3d = function (x, y, z) {\r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }\r\n\tif (isNaN(x) || isNaN(y) || isNaN(z)) {\r\n\t\tthrow new Error('QVector3d: (' + x + ', ' + y +  ', ' + z + ')');\r\n\t}    \r\n    // @property x: Number\r\n\t//  x\r\n\tthis.x = +x;\r\n    // @property y: Number\r\n\t//  y\r\n\tthis.y = +y;\r\n    // @property z: Number\r\n\t//  z\r\n    this.z = +z;\r\n\r\n};\r\n\r\nQ3D.Vector3d.prototype = {\r\n\r\n    // @method get(): QVector3d\r\n    //  QVector3d     \r\n    get: function() {\r\n        this.update();\r\n        return this._qVector3d ;\r\n    },\r\n    // @method equals(otherVector3d: Vector3d, maxMargin?: Number): Boolean\r\n    //  `Vector3d` \r\n\tequals: function (obj, maxMargin) {\r\n\t\tif (!obj) { return false; }\r\n\r\n\t\tvar margin = Math.max(\r\n\t\t        Math.abs(this.x - obj.x),\r\n\t\t        Math.abs(this.y - obj.y),\r\n                Math.abs(this.z - obj.z));\r\n\r\n\t\treturn margin <= (maxMargin === undefined ? 1.0E-9 : maxMargin);\r\n\t},\r\n\r\n    // @method toString(): String\r\n    // \r\n\ttoString: function (precision) {\r\n\t\treturn 'QVector3d(' +\r\n\t\t        Q3D.Util.formatNum(this.x, precision) + ', ' +\r\n                Q3D.Util.formatNum(this.y, precision) + ', ' +\r\n\t\t        Q3D.Util.formatNum(this.z, precision) + ')';\r\n\t},\r\n\r\n    // @method distanceTo(otherVector3d: Vector3d): Number\r\n    //  `Vector3d` \r\n\tdistanceTo: function (other) {\r\n        if (other)\r\n        {\r\n            var dx = other.x - this.x,\r\n\t\t    dy = other.y - this.y,\r\n            dz = other.z - this.z;\r\n\r\n            return Math.sqrt(dx * dx + dy * dy + dz * dz);\r\n        }\r\n        return null;\r\n\t},\r\n    \r\n    // @method add(otherVector3d: Vector3d): this\r\n    //  `Vector3d` \r\n    add: function (other) {\r\n        if (other)\r\n        {\r\n            this.x += other.x;\r\n            this.y += other.y;    \r\n            this.z += other.z;                \r\n        }\r\n        return this;\r\n\t},\r\n\r\n    // @method subtract(otherVector3d: Vector3d): this\r\n    //  `Vector3d` \r\n    subtract: function (other) {\r\n        if (other)\r\n        {\r\n            this.x -= other.x;\r\n            this.y -= other.y;  \r\n            this.z -= other.z;             \r\n        }\r\n        return this;\r\n\t},\r\n    \r\n    // @method multiply(otherVector3d: Vector3d): this\r\n    //  `Vector3d` \r\n    multiply: function (other) {\r\n        if (other)\r\n        {\r\n            this.x *= other.x;\r\n            this.y *= other.y;            \r\n            this.z *= other.z;    \r\n        }\r\n        return this;\r\n\t},\r\n    \r\n    // @method divide(otherVector3d: Vector3d): this\r\n    //  `Vector3d` \r\n    divide: function (other) {\r\n        if (other)\r\n        {\r\n            if (other.x == 0 || other.y == 0 || other.z == 0)\r\n                throw new Error('0');\r\n\r\n            this.x /= other.x;\r\n            this.y /= other.y;   \r\n            this.z /= other.z;   \r\n        }\r\n        return this;\r\n\t},\r\n   \r\n    // @method clone(): Vector3d\r\n    //  `Vector3d` \r\n\tclone: function () {\r\n\t\treturn new Q3D.Vector3d(this.x, this.y, this.z);\r\n\t},    \r\n    // @method toLocalPos(areaName: String): QVector3\r\n    // QVector3 \r\n\ttoLocalPos: function (areaName) {\r\n        var area = mapObj._map3d.getWorldManager().getArea(areaName);\r\n        if (area) {\r\n            return area.toLocalPos(this.get());\r\n        } \r\n        return null;        \r\n\t},      \r\n    // @method toGlobalVec3D(): QGlobalVec3d\r\n    // QGlobalVec3d \r\n\ttoGlobalVec3d: function () {\r\n        var math = mapObj._map3d.getMath();\r\n        return math.vec3DToGlobalVec3D(this.get());        \r\n\t},      \r\n\r\n    // @method update(): this\r\n    //  QVector3d \r\n\tupdate: function () {      \r\n\t\tif (this._qVector3d == null)\r\n\t\t\tthis._qVector3d = mapObj._map3d.createObject(\"QMap3DCtl.QVector3d\");  \r\n        this._qVector3d.x = this.x;\r\n        this._qVector3d.y = this.y;\r\n        this._qVector3d.z = this.z;\r\n        return this;\r\n\t}\r\n};\r\n\r\n\r\n\r\n// @factory Q3D.vector3d(a: Number, b: Number, c: Number): Vector3d\r\n// \r\n\r\n// @alternative\r\n// @factory Q3D.vector3d(coords: Array): Vector3d\r\n//  `[Number, Number, Number]` \r\n\r\n// @alternative\r\n// @factory Q3D.vector3d(coords: Object): Vector3d\r\n//  `{x: Number, y: Number, z: Number}`\r\n//   QVector3d \r\n\r\n// @alternative\r\n// @factory Q3D.vector3d(): Vector3d\r\n// 0\r\n\r\nQ3D.vector3d = function (a, b, c) {\r\n\r\n\tif (a instanceof Q3D.Vector3d) {\r\n\t\treturn a;\r\n\t}\r\n    \r\n\tif (Q3D.Util.isArray(a) && typeof a[0] !== 'object') {\t\t\r\n\t\tif (a.length === 3) {\r\n\t\t\treturn new Q3D.Vector3d(a[0], a[1], a[2]);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tif (typeof a === 'object' && 'x' in a && 'y' in a && 'z' in a) {\r\n\t\treturn new Q3D.Vector3d(a.x, a.y, a.z);\r\n\t}\r\n    \r\n    if  (arguments.length == 3 && typeof a === 'number' && typeof  b === 'number' && typeof c === 'number') {\r\n\t\treturn new Q3D.Vector3d(a, b, c);\r\n\t} \r\n    \r\n    return new Q3D.Vector3d(0, 0, 0);\r\n};\r\n// @method toVector3d(): Vector3d\r\n// \r\n// ```js\r\n// var v3d = \"50.34343, 5.02342, 30.52324\".toVector3d();\r\n// ``` \r\nString.prototype.toVector3d = function () {\r\n    try {\r\n        return Q3D.vector3d(parseFloat(this.split(\",\")[0]), parseFloat(this.split(\",\")[1]), parseFloat(this.split(\",\")[2]));\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n}","/* @class GlobalVec3d\r\n * @aka Q3D.GlobalVec3d\r\n *\r\n * \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var v3 = Q3D.globalVec3d(121.343345, 31.023422, 10);\r\n * ```\r\n *\r\n * \r\n *\r\n * ```\r\n * var v3 = Q3D.globalVec3d([121.343345, 31.023422, 10]);\r\n * v3 = Q3D.globalVec3d({longitude:121.343345, latitude:31.023422, height:10})\r\n * ```\r\n */\r\n\r\nQ3D.GlobalVec3d = function (_lon, _lat, _height) {\r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }\r\n\tif (isNaN(_lon) || isNaN(_lat) || isNaN(_height)) {\r\n\t\tthrow new Error('QGlobalVec3d: (' + _lon + ', ' + _lat +  ', ' + _height + ')');\r\n\t}\r\n    \r\n    // @property longitude: Number\r\n\t//  longitude\r\n\tthis.longitude = +_lon;\r\n    // @property latitude: Number\r\n\t//  latitude\r\n\tthis.latitude = +_lat;\r\n    // @property height: Number\r\n\t//  height\r\n    this.height = +_height;\r\n\r\n};\r\n\r\nQ3D.GlobalVec3d.prototype = {\r\n\t\r\n   \r\n    // @method get(): QGlobalVec3d\r\n    //  QGlobalVec3d     \r\n    get: function() {\r\n        this.update();\r\n        return this._qGlobalVec3d ;\r\n    },\r\n    // @method equals(otherGlobalVec3d: GlobalVec3d, maxMargin?: Number): Boolean\r\n    //  `GlobalVec3d` \r\n\tequals: function (obj, maxMargin) {\r\n\t\tif (!obj) { return false; }\r\n\r\n\t\tvar margin = Math.max(\r\n\t\t        Math.abs(this.longitude - obj.longitude),\r\n\t\t        Math.abs(this.latitude - obj.latitude),\r\n                Math.abs(this.height - obj.height));\r\n\r\n\t\treturn margin <= (maxMargin === undefined ? 1.0E-9 : maxMargin);\r\n\t},\r\n\r\n    // @method toString(): String\r\n    // \r\n\ttoString: function (precision) {\r\n\t\treturn 'QGlobalVec3d(' +\r\n\t\t        Q3D.Util.formatNum(this.longitude, precision) + ', ' +\r\n                Q3D.Util.formatNum(this.latitude, precision) + ', ' +\r\n\t\t        Q3D.Util.formatNum(this.height, precision) + ')';\r\n\t},   \r\n    \r\n    // @method toGlobalPos(): QVector3d\r\n    // QVector3d \r\n\ttoGlobalPos: function () {\r\n        var math = mapObj._map3d.getMath();\r\n        return math.globalVec3DtoVec3D(this.get());\r\n\t},       \r\n    // @method toLocalPos(areaName: String): QVector3\r\n    // QVector3 \r\n\ttoLocalPos: function (areaName) {\r\n        var math = mapObj._map3d.getMath();       \r\n        var v3d = math.globalVec3DtoVec3D(this.get());\r\n        var area = mapObj._map3d.getWorldManager().getArea(areaName);\r\n        if (area) {\r\n            return area.toLocalPos(v3d);\r\n        } \r\n        return null;        \r\n\t},       \r\n   \r\n   // @method clone(): GlobalVec3d\r\n    //  `GlobalVec3d` \r\n\tclone: function () {\r\n\t\treturn new Q3D.GlobalVec3d(this.longitude, this.latitude, this.height);\r\n\t},\r\n    \r\n    // @method update(): this\r\n    //  QGlobalVec3d \r\n\tupdate: function () {        \r\n    \tif (this._qGlobalVec3d == null)\r\n\t\t\tthis._qGlobalVec3d = mapObj._map3d.createObject(\"QMap3DCtl.QGlobalVec3d\");\r\n        this._qGlobalVec3d.longitude = this.longitude;\r\n\t    this._qGlobalVec3d.latitude = this.latitude;\r\n        this._qGlobalVec3d.height = this.height;\r\n        return this;\r\n\t}\r\n};\r\n\r\n\r\n\r\n// @factory Q3D.globalVec3d(a: Number, b: Number, c: Number): GlobalVec3d\r\n// \r\n\r\n// @alternative\r\n// @factory Q3D.globalVec3d(coords: Array): GlobalVec3d\r\n//  `[Number, Number, Number]` \r\n\r\n// @alternative\r\n// @factory Q3D.globalVec3d(coords: Object): GlobalVec3d\r\n//  `{longitude: Number, latitude: Number, height: Number}`\r\n//   QGlobalVec3d \r\nQ3D.globalVec3d = function (a, b, c) {\r\n\r\n\tif (a instanceof Q3D.GlobalVec3d) {\r\n\t\treturn a;\r\n\t}\r\n    \r\n\tif (Q3D.Util.isArray(a) && typeof a[0] !== 'object') {\t\t\r\n\t\tif (a.length === 3) {\r\n\t\t\treturn new Q3D.GlobalVec3d(a[0], a[1], a[2]);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tif (typeof a === 'object' && 'longitude' in a && 'latitude' in a && 'height' in a) {\r\n\t\treturn new Q3D.GlobalVec3d(a.longitude, a.latitude, a.height);\r\n\t}   \r\n    \r\n    if  (arguments.length == 3 && typeof a === 'number' && typeof  b === 'number' && typeof c === 'number') {\r\n\t\treturn new Q3D.GlobalVec3d(a, b, c);\r\n\t} \r\n    \r\n    return new Q3D.GlobalVec3d(0, 0, 0);\r\n};\r\n// @method toGlobalVec3d(): GlobalVec3d\r\n// \r\n// ```js\r\n// var gv3d = \"121.343345, 31.023422, 10\".toGlobalVec3d();\r\n// ``` \r\nString.prototype.toGlobalVec3d = function () {\r\n    try {\r\n        return Q3D.globalVec3d(parseFloat(this.split(\",\")[0]), parseFloat(this.split(\",\")[1]), parseFloat(this.split(\",\")[2]));\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n}\r\n","/* @class ColourValue\r\n * @aka Q3D.ColourValue\r\n *\r\n *  rgba\r\n *\r\n * @example\r\n *\r\n * ```\r\n * var clr = Q3D.colourValue(1,0,1,1);\r\n * ```\r\n *\r\n * \r\n *\r\n * ```\r\n * var clr = Q3D.colourValue([1,0,1,1]);\r\n * clr = Q3D.colourValue({r:1, g:0, b:1, a:1});\r\n * clr = Q3D.colourValue('#ffff00',0.5);\r\n * ```\r\n */\r\n\r\nQ3D.ColourValue = function (r, g, b, a) {\r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }\r\n\tif (isNaN(r) || isNaN(g) || isNaN(b) || isNaN(a)) {\r\n\t\tthrow new Error('QColourValue: (' + r + ', ' + g +  ', ' + b + ', ' + a + ')');\r\n\t}\r\n    \r\n    // @property r: Number\r\n\t// r [0~1]\r\n\tthis.r = +r;\r\n    // @property g: Number\r\n\t// g [0~1]\r\n\tthis.g = +g;\r\n    // @property b: Number\r\n\t// b [0~1]\r\n    this.b = +b;\r\n    // @property a: Number\r\n\t// a [0~1]\r\n    this.a = +a;\r\n\r\n};\r\n\r\nQ3D.ColourValue.prototype = {\t\r\n    //16\r\n    _toHex: function(num){\r\n        return num<16?\"0\"+num.toString(16).toUpperCase() : num.toString(16).toUpperCase();\r\n    },\r\n    \r\n     // @method get(): QColourValue\r\n    //  QColourValue     \r\n     get: function() {\r\n        this.update();\r\n        return this._qColurValue ;\r\n    },\r\n    \r\n    // @method toString(): String\r\n    // \r\n\ttoString: function (precision) {\r\n\t\treturn 'QColourValue(' +\r\n\t\t        Q3D.Util.formatNum(this.r, precision) + ', ' +\r\n                Q3D.Util.formatNum(this.g, precision) + ', ' +\r\n                Q3D.Util.formatNum(this.b, precision) + ', ' +\r\n\t\t        Q3D.Util.formatNum(this.a, precision) + ')';\r\n\t},\r\n    \r\n    \r\n    // @method toWebColor(): String\r\n    // 16\r\n    toWebColor: function () {\r\n        return \"#\" + this._toHex(parseInt(this.r * 255)) + this._toHex(parseInt(this.g * 255)) + this._toHex(parseInt(this.b * 255));\r\n    },\r\n   \r\n   // @method clone(): ColurValue\r\n    //  `ColurValue` \r\n\tclone: function () {\r\n\t\treturn new Q3D.ColourValue(this.r, this.g, this.b, this.a);\r\n\t},\r\n    \r\n    // @method revise(): this\r\n    //  `ColurValue`  \r\n\trevise: function () {\r\n\t\tthis.r = Math.pow(this.r, 1/2.2);\r\n        this.g = Math.pow(this.g, 1/2.2);\r\n        this.b = Math.pow(this.b, 1/2.2);\r\n        return this;\r\n\t},\r\n    \r\n    // @method update(): this\r\n    //  QColourValue \r\n\tupdate: function () {   \r\n\t\tif (this._qColurValue == null)\r\n\t\t\tthis._qColurValue = mapObj._map3d.createObject(\"QMap3DCtl.QColourValue\");\r\n        this._qColurValue.r = this.r;\r\n        this._qColurValue.g = this.g;\r\n        this._qColurValue.b = this.b;\r\n        this._qColurValue.a = this.a;\r\n        return this;\r\n\t}\r\n};\r\n\r\n\r\n\r\n// @factory Q3D.colourValue(a: Number, b: Number, c: Number, d: Number): ColourValue\r\n// rgba\r\n\r\n// @alternative\r\n// @factory Q3D.colourValue(rgba: Array): ColourValue\r\n//  `[Number, Number, Number, Number]` \r\n\r\n// @alternative\r\n// @factory Q3D.colourValue(rgba: Object): ColourValue\r\n//  `{r: Number, g: Number, b: Number, a: Number}`\r\n//   QColourValue \r\n\r\n// @alternative\r\n// @factory Q3D.colourValue(rgb: String, a: Number): ColourValue\r\n//  \r\nQ3D.colourValue = function (a, b, c, d) {\r\n\r\n\tif (a instanceof Q3D.ColourValue) {\r\n\t\treturn a;\r\n\t}\r\n    \r\n\tif (Q3D.Util.isArray(a) && typeof a[0] !== 'object') {\t\t\r\n\t\tif (a.length === 4) {\r\n\t\t\treturn new Q3D.ColourValue(a[0], a[1], a[2], a[3]);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tif (typeof a === 'object' && 'r' in a && 'g' in a && 'b' in a && 'a' in a) {\r\n\t\treturn new Q3D.ColourValue(a.r, a.g, a.b, a.a);\r\n\t}\r\n\t\r\n    if (arguments.length == 2 && typeof (arguments[0]) === \"string\" && !isNaN (arguments[1]) ) //ab\r\n    {\r\n        var clrStr = a.indexOf(\"#\") != -1 ? a.replace(/#/g, \"\") : a;\r\n        var rVal = parseInt(clrStr.substr(0, 2), 16) / 255;\r\n        var gVal = parseInt(clrStr.substr(2, 2), 16) / 255;\r\n        var bVal = parseInt(clrStr.substr(4, 2), 16) / 255;\r\n        return new Q3D.ColourValue(rVal, gVal, bVal, b);\r\n    }\r\n    \r\n    if  (arguments.length == 4 && typeof a === 'number' && typeof  b === 'number' && typeof c === 'number' && typeof d === 'number') {\r\n\t\treturn new Q3D.ColourValue(a, b, c, d);\r\n\t} \r\n    \r\n    return new Q3D.ColourValue(0, 0, 0, 1);\r\n};\r\n// @method toColourValue(): ColourValue\r\n// \r\n// ```js\r\n// var clr = \"1,0,1\".toColourValue();\r\n// ``` \r\nString.prototype.toColourValue = function () {\r\n    try {\r\n        return Q3D.colourValue(this.toString(), 1);\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n}\r\n","/* @class ArcVertex\r\n * @aka Q3D.ArcVertex\r\n *\r\n *   \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var av = Q3D.arcVertex(50.5, 30.2, 100.5, 1.2, 10);\r\n * ```\r\n *\r\n * \r\n *\r\n * ```\r\n * var av = Q3D.arcVertex([50.5, 30.2, 100.5, 1.2, 10]);\r\n * av = Q3D.arcVertex({x:50.5, y:30.2, z:100.5, r:1.2, d:10});\r\n * ```\r\n */\r\n\r\nQ3D.ArcVertex = function (x, y, z, r, d) {\r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }\r\n\tif (isNaN(x) || isNaN(y) || isNaN(z) || isNaN(r) || isNaN(d)) {\r\n\t\tthrow new Error('QArcVertex: (' + x + ', ' + y  + ', ' + z  + ', ' + r  + ', ' + d+ ')');\r\n\t}\r\n    if (+r < 1.0 || +d < 0) {\r\n\t\tthrow new Error('QArcVertex: (' + x + ', ' + y  + ', ' + z  + ', ' + r  + ', ' + d+ ')');\r\n\t}  \r\n    \r\n    \r\n    // @property x: Number\r\n\t//  x\r\n    this.x = x;\r\n    // @property y: Number\r\n\t//  y\r\n\tthis.y = y;\r\n    // @property z: Number\r\n\t//  z\r\n\tthis.z = z;\r\n    // @property r: Number\r\n\t//  r=1.0>=1.0\r\n\tthis.r = r;\r\n    // @property d: Number\r\n\t// d=10\r\n\tthis.d = d;\r\n\r\n};\r\n\r\nQ3D.ArcVertex.prototype = {\r\n\t        \r\n    // @method get(): QArcVertex\r\n    //  QArcVertex \r\n    get: function() {\r\n        this.update();\r\n        return this._qArcVertex ;\r\n    },\r\n    \r\n    // @method getRadius(): Number\r\n    // \r\n    getRadius: function() {\r\n        return this.r ;\r\n    },\r\n    \r\n    // @method getdAngle(): Number\r\n    // \r\n    getdAngle: function() {\r\n        return this.d ;\r\n    },\r\n    \r\n    // @method getPos(): QVector3\r\n    // \r\n    getPos: function() {\r\n        return  Q3D.vector3(this.x, this.y, this.z).get() ;\r\n    },\r\n    \r\n    // @method equals(otherArcVertex: ArcVertex, maxMargin?: Number): Boolean\r\n\t//  `ArcVertex` \r\n\tequals: function (obj, maxMargin) {\r\n\t\tif (!obj) { return false; }\r\n\r\n\t\tvar margin = Math.max(\r\n\t\t        Math.abs(this.x - obj.x),\r\n\t\t        Math.abs(this.y - obj.y),\r\n                Math.abs(this.z - obj.z),\r\n                Math.abs(this.r - obj.r),\r\n                Math.abs(this.d - obj.d));\r\n\r\n\t\treturn margin <= (maxMargin === undefined ? 1.0E-9 : maxMargin);\r\n\t},\r\n\r\n\t// @method toString(): String\r\n\t// \r\n\ttoString: function (precision) {\r\n\t\treturn 'QArcVertex(' +\r\n\t\t        Q3D.Util.formatNum(this.x, precision) + ', ' +\r\n                Q3D.Util.formatNum(this.y, precision) + ', ' +\r\n                Q3D.Util.formatNum(this.z, precision) + ', ' +\r\n                Q3D.Util.formatNum(this.r, precision) + ', ' +\r\n\t\t        Q3D.Util.formatNum(this.d, precision) + ')';\r\n\t},\t\r\n    \r\n    // @method add(otherArcVertex: ArcVertex): this\r\n    //  `ArcVertex` \r\n    add: function (other) {\r\n        if (other)\r\n        {\r\n            this.x += other.x;\r\n            this.y += other.y;    \r\n            this.z += other.z;        \r\n        }\r\n        return this;\r\n\t},\r\n\r\n    // @method subtract(otherArcVertex: ArcVertex): this\r\n    //  `ArcVertex` \r\n    subtract: function (other) {\r\n        if (other)\r\n        {\r\n            this.x -= other.x;\r\n            this.y -= other.y;    \r\n            this.z -= other.z;               \r\n        }\r\n        return this;\r\n\t},\r\n    \r\n    // @method multiply(otherArcVertex: ArcVertex): this\r\n    //  `ArcVertex` \r\n    multiply: function (other) {\r\n        if (other)\r\n        {\r\n            this.x *= other.x;\r\n            this.y *= other.y;    \r\n            this.z *= other.z;        \r\n        }\r\n        return this;\r\n\t},\r\n    \r\n    // @method divide(otherArcVertex: ArcVertex): this\r\n    //  `ArcVertex` \r\n    divide: function (other) {\r\n        if (other)\r\n        {\r\n            if (other.x == 0 || other.y == 0 || other.z == 0)\r\n                throw new Error('0');\r\n\r\n            this.x /= other.x;\r\n            this.y /= other.y;    \r\n            this.z /= other.z;       \r\n\r\n        }\r\n        return this;\r\n\t},\r\n   \r\n    // @method clone(): ArcVertex\r\n    //  `ArcVertex` \r\n\tclone: function () {\r\n\t\treturn new Q3D.arcVertex(this.x, this.y, this.z, this.r, this.d);\r\n\t},   \r\n    \r\n    // @method update(): this\r\n    //  QArcVertex \r\n\tupdate: function () {     \r\n\t\tif (this._qArcVertex == null)\r\n\t\t\tthis._qArcVertex = mapObj._map3d.createObject(\"QMap3DCtl.QArcVertex\");\r\n    \tthis._qArcVertex.setPos(Q3D.vector3(this.x, this.y, this.z).get());\r\n    \tthis._qArcVertex.setRadius(this.r);\r\n    \tthis._qArcVertex.setdAngle(this.d);    \r\n\r\n        return this;\r\n\t}\r\n};\r\n\r\n\r\n\r\n// @factory Q3D.arcVertex(a: Number, b: Number, c: Number, d: Number, e: Number): ArcVertex\r\n// \r\n\r\n// @alternative\r\n// @factory Q3D.arcVertex(coords: Array): ArcVertex\r\n//  `[Number, Number, Number, Number, Number]` \r\n\r\n// @alternative\r\n// @factory Q3D.arcVertex(coords: Object): ArcVertex\r\n//  `{x: Number, y: Number, z: Number, r: Number, d: Number}`\r\n\r\nQ3D.arcVertex = function (a, b, c, d, e) {\r\n\r\n\tif (a instanceof Q3D.ArcVertex) {\r\n\t\treturn a; //\r\n\t}\r\n    \r\n\tif (Q3D.Util.isArray(a) && typeof a[0] !== 'object') {\t\t\r\n\t\tif (a.length === 5) {\r\n\t\t\treturn new Q3D.ArcVertex(a[0], a[1], a[2], a[3], a[4]);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tif (typeof a === 'object' && 'x' in a && 'y' in a && 'z' in a && 'r' in a && 'd' in a) {\r\n\t\treturn new Q3D.ArcVertex(a.x, a.y, a.z, a.r, a.d);\r\n\t}\r\n    \r\n\tif (arguments.length < 5) {\r\n        //throw new Error(' QVector2 ' );\r\n\t\treturn null;\r\n\t}\r\n\treturn new Q3D.ArcVertex(a, b, c, d, e);\r\n};\r\n\r\n// @method toArcVertex(): ArcVertex\r\n// \r\n// ```js\r\n// var av= \"50.5, 30.2, 100.5, 1.2, 10\".toArcVertex();\r\n// ``` \r\nString.prototype.toArcVertex = function () {\r\n    try {\r\n        return Q3D.arcVertex(parseFloat(this.split(\",\")[0]), parseFloat(this.split(\",\")[1]), parseFloat(this.split(\",\")[2]), parseFloat(this.split(\",\")[3]), parseFloat(this.split(\",\")[4]));\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n}\r\n","  /* @class GlobalCamera\r\n * @aka Q3D.GlobalCamera\r\n *\r\n * \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var gc = Q3D.globalCamera();\r\n * ``` \r\n */\r\nQ3D.GlobalCamera = function () {    \r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }\r\n    this._gc = mapObj._map3d.getWorldManager().getMainCamera(0);\r\n};\r\n\r\nQ3D.GlobalCamera.prototype = {\r\n    \r\n    //aabb,\r\n    _addBox: function(areaName, boxName, aabbMin, aabbMax)  {\r\n        if (mapObj.getSceneNode(areaName, boxName) != null)\r\n            mapObj.destroySceneNode(areaName, boxName);\r\n       \r\n       var lineArray = [];\r\n        lineArray.push(Q3D.vector3(aabbMin.x, aabbMin.y, aabbMin.z));\r\n        lineArray.push(Q3D.vector3(aabbMax.x, aabbMin.y, aabbMin.z));\r\n        lineArray.push(Q3D.vector3(aabbMax.x, aabbMin.y, aabbMax.z));\r\n        lineArray.push(Q3D.vector3(aabbMin.x, aabbMin.y, aabbMax.z));\r\n        return mapObj.createPrism(areaName + \"/\" + boxName, {\r\n            Points: lineArray,\r\n            WallAlpha: 0,\r\n            CeilAlpha: 0,\r\n            Height: aabbMax.y - aabbMin.y ,\r\n        });              \r\n    },\t\r\n    \r\n    // @method get(): QGlobalCamera\r\n    //  QGlobalCamera     \r\n    get:function() {\r\n        return this._gc;\r\n    },\r\n    \r\n    // @method getAbsPos(): QVector3d\r\n    // QVector3d \r\n    getAbsPos: function() {\r\n        return this._gc.getAbsPos(); \r\n    },\r\n    \r\n    // @method getOrientation(): QVector3   \r\n    // QVector3 \r\n    getOrientation: function() {\r\n        return this._gc.getOrientation(Q3D.Enums.orientationType.World); \r\n    },    \r\n    \r\n    // @method setFOVy(fovVal: Number): this   \r\n    //45\r\n    setFOVy: function(fovVal) {\r\n        this._gc.setFOVy(fovVal);\r\n        return this;\r\n    },    \r\n    \r\n    // @method setClipDistance(nearDist: Number, farDist: Number): this   \r\n    //\r\n    setClipDistance: function(nearDist, farDist) {\r\n        this._gc.setNearClipDistance(nearDist);\r\n        this._gc.setFarClipDistance(farDist);\r\n        return this;\r\n    },\r\n    \r\n    // @method getCameraInfo(): Array   \r\n    //\r\n    getCameraInfo: function() {\r\n        var fovy = parseInt(this._gc.getFOVy());\r\n        var nearDist = this._gc.getNearClipDistance();\r\n        var farDist = this._gc.getFarClipDistance();\r\n        return [fovy,nearDist, farDist]; \r\n    },\r\n        \r\n    // @method flyTo(v3d: Vector3d, v3?: Vector3, flyTime?: Number, fn?: Function): this   \r\n    // \r\n    flyTo: function(v3d, v3, flyTime, fn) {\r\n        mapObj.off(\"onCameraFlyToEnd\");\r\n        if (fn && Q3D.Util.isFunction(fn)) {\r\n            mapObj._map3d.setFlyToListener(this._gc);            \r\n            mapObj.on(\"onCameraFlyToEnd\", fn);\r\n        }\r\n        v3 = v3 || Q3D.vector3(this.getOrientation());\r\n        flyTime = Q3D.Util.isNumber(flyTime) ? flyTime : 0;\r\n        \r\n        this._gc.flyTo(v3d.get(), v3.get(), flyTime);\r\n        return this;\r\n    },\r\n    \r\n    // @method flyToByDistance(targetPosV3d: Vector3d, distToTargetPos?: Number, viewDirV3?: Vector3, flyTime?: Number, fn?: Function): this\r\n    // \r\n\tflyToByDistance: function(targetPosV3d, distToTargetPos, viewDirV3, flyTime, fn) {\r\n\t\tviewDirV3 = viewDirV3 || Q3D.vector3(this.getOrientation());\r\n        distToTargetPos = Q3D.Util.isNumber(distToTargetPos) ? distToTargetPos : 20;\r\n\t\tvar v3 = mapObj._map3d.getMath().eulerToDirection(viewDirV3.get());\r\n\t\tvar eyePosV3d = Q3D.vector3d(v3.x * distToTargetPos + targetPosV3d.x, v3.y * distToTargetPos + targetPosV3d.y, v3.z * distToTargetPos + targetPosV3d.z);\r\n\t\tthis.flyTo(eyePosV3d, viewDirV3, flyTime, fn);\t\t\r\n\t},\t\r\n    \r\n    // @method flyToByClick(domName: String, clickPosV3d: Vector3d, flyTime?: Number, fn?: Function): this\r\n    // \r\n\tflyToByClick: function(domName, clickPosV3d, flyTime, fn) {\r\n        var w = document.getElementById(domName).clientWidth;\r\n        var h = document.getElementById(domName).clientHeight;\r\n        var v2_enter = Q3D.vector2I(w / 2, h / 2);//\r\n        var v3d_oc = Q3D.vector3d(this._gc.getCrossCoord(v2_enter.get(),-1));//\r\n        var v3 = Q3D.vector3(this.getOrientation()); //\r\n        var v3d_cam = Q3D.vector3d(this.getAbsPos());//\r\n        var v3d_diff = v3d_cam.clone().subtract(v3d_oc);\r\n        var v3d_eyepos = clickPosV3d.clone().add(v3d_diff);\r\n        this.flyTo(v3d_eyepos, v3, flyTime, fn);\t     \r\n\t},\t\r\n    \r\n    // @method flyToPos(lng: Number, lat: Number, hgt?: Number, pitch?: Number, yaw?: Number, flyTime?: Number, fn?: Function): this   \r\n    // \r\n    //  [0,-90][0,90]0\r\n    flyToPos: function(lng, lat, hgt, pitch, yaw, flyTime, fn) {\r\n        mapObj.off(\"onCameraFlyToEnd\");\r\n        if (fn && Q3D.Util.isFunction(fn)) {\r\n            mapObj._map3d.setFlyToListener(this._gc);            \r\n            mapObj.on(\"onCameraFlyToEnd\", fn);\r\n        }\r\n\r\n        hgt = Q3D.Util.isNumber(hgt) ? hgt : 50;\r\n        pitch = Q3D.Util.isNumber(pitch) ? pitch : -45;\r\n        yaw = Q3D.Util.isNumber(yaw) ? yaw : 0;\r\n        flyTime = Q3D.Util.isNumber(flyTime) ? flyTime : 0;\r\n                \r\n        var v3d = Q3D.globalVec3d(lng, lat, hgt).toGlobalPos();\r\n        var v3 = this._gc.makeRotByYawPitch(pitch, yaw);        \r\n        this._gc.flyTo(v3d, v3, flyTime);\r\n        \r\n        return this;\r\n    },\r\n    \r\n    // @method flyToNode(node: QSceneNode, v3?: Vector3, flyTime?: Number, fn?: Function): this    \r\n    //\r\n    //\r\n    flyToNode: function(node, v3, flyTime, fn) {\r\n        mapObj.off(\"onCameraFlyToEnd\");\r\n        if (fn && Q3D.Util.isFunction(fn)) {\r\n            mapObj._map3d.setFlyToListener(this._gc);            \r\n            mapObj.on(\"onCameraFlyToEnd\", fn);\r\n        }\r\n        v3 = v3 || Q3D.vector3(this.getOrientation());\r\n        flyTime = Q3D.Util.isNumber(flyTime) ? flyTime : 0;\r\n        this._gc.flyToNode(node, v3.get(), flyTime);\r\n        return this;\r\n    },\r\n    \r\n    // @method flyToAxisView(node: QSceneNode, diff?: Number, flyTime?: Number, fn?: Function): this    \r\n    //\r\n    flyToAxisView: function(node, diff, flyTime, fn) {\r\n        mapObj.off(\"onCameraFlyToEnd\");\r\n        if (fn && Q3D.Util.isFunction(fn)) {\r\n            mapObj._map3d.setFlyToListener(this._gc);            \r\n            mapObj.on(\"onCameraFlyToEnd\", fn);\r\n        }\r\n        \r\n        diff = Q3D.Util.isNumber(diff) ? diff : 10;\r\n        flyTime = Q3D.Util.isNumber(flyTime) ? flyTime : 0;\r\n  \r\n        var targetPos = Q3D.vector3d(node.getAbsPos());\r\n        var eyePos = targetPos.clone().add(Q3D.vector3d(diff,diff,diff));\r\n        this._gc.flyToViaLookAt(eyePos.get(), targetPos.get(), Q3D.vector3(0,1,0).get(), flyTime);\r\n                \r\n        return this;\r\n    },\r\n    \r\n    // @method flyToCamView(areaName: String, aabbMin: Vector3, aabbMax: Vector3, camViewType?: Q3D.Enums.camViewType, flyTime?: Number, fn?: Function): this   \r\n    //    \r\n    flyToCamView: function(areaName, aabbMin, aabbMax, camViewType, flyTime, fn) {\r\n        mapObj.off(\"onCameraFlyToEnd\");\r\n        if (fn && Q3D.Util.isFunction(fn)) {\r\n            mapObj._map3d.setFlyToListener(this._gc);            \r\n            mapObj.on(\"onCameraFlyToEnd\", fn);\r\n        }\r\n        \r\n        camViewType = camViewType || Q3D.Enums.camViewType.Front; \r\n        flyTime = Q3D.Util.isNumber(flyTime) ? flyTime : 0;\r\n        \r\n        //\r\n        this._addBox(areaName, \"#Box\", aabbMin, aabbMax);\r\n        var _wm = mapObj._map3d.getWorldManager();\r\n        var _am = _wm.getArea(areaName);\r\n        var nodeList = _wm.createEmptySceneNodeList();\r\n        nodeList.addNode(mapObj.getSceneNode(areaName, \"#Box\"));     \r\n        //\r\n        var campos = null, direciton = null;\r\n        switch(camViewType) {\r\n            case Q3D.Enums.camViewType.Front:\r\n            \tdireciton = Q3D.vector3(0,0,0).get();\r\n                campos = this._gc.calcFullVisiblePos(nodeList,direciton,0);\r\n                this._gc.flyTo(campos, direciton, flyTime); \r\n                break;\r\n            case Q3D.Enums.camViewType.Top:\r\n\t\t\t\tdireciton = Q3D.vector3(-90,0,0).get();\r\n                campos = this._gc.calcFullVisiblePos(nodeList,direciton,0);\r\n                this._gc.flyTo(campos, direciton, flyTime);    \r\n                break;\r\n            case Q3D.Enums.camViewType.Side:\r\n\t\t\t\tdireciton = Q3D.vector3(0,90,0).get();\r\n                campos = this._gc.calcFullVisiblePos(nodeList,direciton,0);\r\n                this._gc.flyTo(campos, direciton, flyTime);   \r\n                break;\r\n            case Q3D.Enums.camViewType.Axis:\r\n                var q3d = _am.toGlobalPos(aabbMin.get());\r\n                var minPt = Q3D.vector3d(q3d);\r\n                q3d = _am.toGlobalPos(aabbMax.get());\r\n                var maxPt = Q3D.vector3d(q3d);\r\n                var sub = maxPt.subtract(minPt);\r\n                var diffVec = Q3D.vector3d(sub.x, sub.y, sub.z).multiply(Q3D.vector3d(1.2,1.2,1.2));\r\n                var eyePos = minPt.clone().add(diffVec);\r\n                this._gc.flyToViaLookAt(eyePos.get(), minPt.get(), Q3D.vector3(0,1,0).get(), flyTime);\r\n                break;                \r\n        }                 \r\n        nodeList.release();\r\n        mapObj.destroySceneNode(areaName, \"#Box\");\r\n        return this;\r\n    },    \r\n    \r\n    // @method flyToCamViewEx(targetPos: Vector3d, camViewType?: Q3D.Enums.camViewType, diff?: Number, flyTime?: Number, fn?: Function): this   \r\n    //\r\n    flyToCamViewEx: function(targetPos, camViewType, diff, flyTime, fn) {\r\n        mapObj.off(\"onCameraFlyToEnd\");\r\n        if (fn && Q3D.Util.isFunction(fn)) {\r\n            mapObj._map3d.setFlyToListener(this._gc);            \r\n            mapObj.on(\"onCameraFlyToEnd\", fn);\r\n        }\r\n        camViewType = camViewType || Q3D.Enums.camViewType.Front; \r\n        diff = Q3D.Util.isNumber(diff) ? diff : 10;\r\n\t\tflyTime = Q3D.Util.isNumber(flyTime) ? flyTime : 0;\r\n        \r\n        //\r\n        var spotPos = targetPos.clone();\r\n        var eyePos = null;\r\n        switch(camViewType) {\r\n            case Q3D.Enums.camViewType.Front:\r\n                eyePos = spotPos.clone().add(Q3D.vector3d(0,0,diff));\r\n                this._gc.flyToViaLookAt(eyePos.get(), spotPos.get(), Q3D.vector3(0,1,0).get(), flyTime);\r\n                break;\r\n            case Q3D.Enums.camViewType.Top:\r\n                eyePos = spotPos.clone().add(Q3D.vector3d(0,diff,0));\r\n                this._gc.flyToViaLookAt(eyePos.get(), spotPos.get(), Q3D.vector3(0,0,1).get(), flyTime);\r\n                break;\r\n            case Q3D.Enums.camViewType.Side:\r\n                eyePos = spotPos.clone().add(Q3D.vector3d(diff,0,0));\r\n                this._gc.flyToViaLookAt(eyePos.get(), spotPos.get(), Q3D.vector3(0,1,0).get(), flyTime);  \r\n                break;\r\n            case Q3D.Enums.camViewType.Axis:\r\n                eyePos = spotPos.clone().add(Q3D.vector3d(diff/Math.sqrt(2),diff/Math.sqrt(2),diff/Math.sqrt(2)));\r\n                this._gc.flyToViaLookAt(eyePos.get(), spotPos.get(), Q3D.vector3(0,1,0).get(), flyTime);  \r\n                break;                \r\n        }\r\n                \r\n        return this;\r\n    },    \r\n    \r\n    // @method flyToBy3Steps(v3d: Vector3d, v3: Vector3, flyTime: Number Or Array, flyHeight: Number, fn?: Function): this   \r\n    // : step 1:  Step 2:  Step 3: \r\n\t// flyTimenumber,  flyTimeArray\r\n    flyToBy3Steps: function(v3d, v3, flyTime, flyHeight, fn) {\r\n\t\tvar startPosV3d = Q3D.vector3d(this.getAbsPos());\r\n\t\t\r\n\t\tmapObj._flyToByStepData = mapObj._flyToByStepData || {};\r\n\t\tvar flyHeight = Q3D.Util.isNumber(flyHeight) ? flyHeight : 1000;\r\n\t\t\r\n\t\tif(Q3D.Util.isArray(flyTime)) {\r\n\t\t\tif(flyTime.length !== 3) {\r\n\t\t\t\tconsole.log(\"\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tmapObj._flyToByStepData._times = flyTime;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar distanceForStep1 = Math.abs(startPosV3d.y - flyHeight),\r\n\t\t\tdistanceForStep2 = Math.sqrt((v3d.x - startPosV3d.x) * (v3d.x - startPosV3d.x) + (v3d.z - startPosV3d.z) * (v3d.z - startPosV3d.z)),\r\n\t\t\tdistanceForStep3 = Math.abs(v3d.y - flyHeight),\r\n\t\t\ttotalDist = distanceForStep1 + distanceForStep2 + distanceForStep3;\r\n\t\t\t\r\n\t\t\tif(totalDist < 1.0E-9 || flyTime < 0.001) {\r\n\t\t\t\tthis.flyTo(v3d, v3, flyTime, fn);\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\tmapObj._flyToByStepData._times = [Math.max(distanceForStep1/totalDist * flyTime, 0.5), Math.max(distanceForStep2/totalDist * flyTime, 0.5), Math.max(distanceForStep3/totalDist * flyTime, 0.5)];\r\n\t\t}\r\n\t\t\t\r\n\t\tmapObj._flyToByStepData._targetPosV3d = v3d;\r\n\t\tmapObj._flyToByStepData._targetOri = v3;\r\n\t\tmapObj._flyToByStepData._fn = fn;\r\n\t\t\r\n\t\tstartPosV3d.y = flyHeight;\r\n\t\tvar yaw = this.get().fetchRotYaw();\r\n\t\tvar oriForStep1 = Q3D.vector3(this.get().makeRotByYawPitch(-30, yaw));\r\n\t\tthis.flyTo(startPosV3d, oriForStep1, mapObj._flyToByStepData._times[0], function(){\r\n            setTimeout(function(){\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tvar mainCamera = Q3D.globalCamera(),\r\n\t\t\t\t\tcurrPosV3d = mainCamera.getAbsPos(),\r\n\t\t\t\t\ttargetPosV3d = mapObj._flyToByStepData._targetPosV3d,\t\t\t\t\t\r\n\t\t\t\t\ttargetPosV3dForStep2 = Q3D.vector3d(targetPosV3d.x, currPosV3d.y, targetPosV3d.z);\r\n\t\t\t\t\t\r\n\t\t\t\tmainCamera.flyTo(targetPosV3dForStep2, Q3D.vector3(mainCamera.getOrientation()), mapObj._flyToByStepData._times[1], function(){\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\tvar mainCamera = Q3D.globalCamera(),\r\n\t\t\t\t\t\t\ttargetPosV3d = mapObj._flyToByStepData._targetPosV3d,\r\n\t\t\t\t\t\t\ttargetOri = mapObj._flyToByStepData._targetOri;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tmainCamera.flyTo(targetPosV3d, targetOri, mapObj._flyToByStepData._times[2], function(){\r\n\t\t\t\t\t\t\tvar fn = mapObj._flyToByStepData._fn;\r\n\t\t\t\t\t\t\tif (fn && Q3D.Util.isFunction(fn)) {\r\n\t\t\t\t\t\t\t\tfn();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tmapObj.off(\"onCameraFlyToEnd\");\r\n\t\t\t\t\t\t\tdelete mapObj._flyToByStepData;\r\n\t\t\t\t\t\t});\t\t\t\t\t\r\n\t\t\t\t\t}, 100);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t});\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t}, 100);\r\n\t\t});\t\t\t\r\n        return this;\r\n    },\r\n        \r\n\t// @method flyToBy4Steps(v3d: Vector3d, v3: Vector3, flyTime: Number Or Array, flyHeight: Number, fn?: Function): this   \r\n    // : step 1:  Step 2:  Step 3:  Step 4: \r\n\t// flyTimenumber,  flyTimeArray\r\n    flyToBy4Steps: function(v3d, v3, flyTime, flyHeight, fn) {\r\n\t\tvar startPosV3d = Q3D.vector3d(this.getAbsPos());\r\n\t\t\r\n\t\tmapObj._flyToByStepData = mapObj._flyToByStepData || {};\r\n\t\tvar flyHeight = Q3D.Util.isNumber(flyHeight) ? flyHeight : 1000;\r\n\t\t\r\n\t\tif(Q3D.Util.isArray(flyTime)) {\r\n\t\t\tif(flyTime.length !== 4) {\r\n\t\t\t\tconsole.log(\"\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tmapObj._flyToByStepData._times = flyTime;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar distanceForStep1 = Math.abs(startPosV3d.y - flyHeight),\r\n\t\t\t\tdistanceForStep2 = Math.sqrt((v3d.x - startPosV3d.x) * (v3d.x - startPosV3d.x) + (v3d.z - startPosV3d.z) * (v3d.z - startPosV3d.z)),\r\n\t\t\t\tdistanceForStep3 = Math.abs(v3d.y - flyHeight),\r\n\t\t\t\tminDist = Math.min(distanceForStep1, distanceForStep2, distanceForStep3),\r\n\t\t\t\ttotalDist = distanceForStep1 + distanceForStep2 + distanceForStep3 + minDist; //step4 \r\n\t\t\t\r\n\t\t\tif(totalDist < 1.0E-9 || flyTime < 0.001) {\r\n\t\t\t\tthis.flyTo(v3d, v3, flyTime, fn);\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\tmapObj._flyToByStepData._times = [Math.max(distanceForStep1/totalDist * flyTime, 0.5), Math.max(distanceForStep2/totalDist * flyTime, 0.5), Math.max(distanceForStep3/totalDist * flyTime, 0.5), Math.max(minDist/totalDist * flyTime, 0.5)];\t\r\n\t\t}\r\n\t\t\t\t\r\n\t\tmapObj._flyToByStepData._targetPosV3d = v3d;\r\n\t\tmapObj._flyToByStepData._targetOri = v3;\r\n\t\tmapObj._flyToByStepData._fn = fn;\r\n\t\t\r\n\t\tstartPosV3d.y = flyHeight;\r\n\t\tvar yaw = this.get().fetchRotYaw();\r\n\t\tvar oriForStep1 = Q3D.vector3(this.get().makeRotByYawPitch(-30, yaw));\r\n\t\tthis.flyTo(startPosV3d, oriForStep1, mapObj._flyToByStepData._times[0], function(){\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tvar mainCamera = Q3D.globalCamera(),\r\n\t\t\t\t\tcurrPosV3d = mainCamera.getAbsPos(),\r\n\t\t\t\t\ttargetPosV3d = mapObj._flyToByStepData._targetPosV3d,\t\t\t\t\t\r\n\t\t\t\t\ttargetPosV3dForStep2 = Q3D.vector3d(targetPosV3d.x, currPosV3d.y, targetPosV3d.z);\r\n\t\t\t\tmainCamera.flyTo(targetPosV3dForStep2, Q3D.vector3(mainCamera.getOrientation()), mapObj._flyToByStepData._times[1], function(){\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\tvar mainCamera = Q3D.globalCamera(),\r\n\t\t\t\t\t\t\ttargetPosV3d = mapObj._flyToByStepData._targetPosV3d;\t\t\t\t\t\r\n\t\t\t\t\t\tmainCamera.flyTo(targetPosV3d, Q3D.vector3(mainCamera.getOrientation()), mapObj._flyToByStepData._times[2], function(){\t\r\n\t\t\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t\t\tvar mainCamera = Q3D.globalCamera(),\r\n\t\t\t\t\t\t\t\t\ttargetPosV3d = mapObj._flyToByStepData._targetPosV3d,\r\n\t\t\t\t\t\t\t\t\ttargetOri = mapObj._flyToByStepData._targetOri;\r\n\r\n\t\t\t\t\t\t\t\t\tmainCamera.flyTo(targetPosV3d, targetOri, mapObj._flyToByStepData._times[3], function(){\r\n\t\t\t\t\t\t\t\t\t\tvar fn = mapObj._flyToByStepData._fn;\r\n\t\t\t\t\t\t\t\t\t\tif (fn && Q3D.Util.isFunction(fn)) {\r\n\t\t\t\t\t\t\t\t\t\t\tfn();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tmapObj.off(\"onCameraFlyToEnd\");\r\n\t\t\t\t\t\t\t\t\t\tdelete mapObj._flyToByStepData;\r\n\t\t\t\t\t\t\t\t\t});\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}, 100);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, 100);\r\n\t\t\t\t});\r\n\t\t\t}, 100);\r\n\t\t});\r\n\t\t\t\r\n        return this;\r\n    },\t\r\n    \r\n    // @method flyToMakeSureVisible(sceneNodeNameArray: Array, viewDirV3?: Vector3, offsetLen?:Number, flyTime: Number, fn?: Function): this   \r\n\t// sceneNodeNameArray\r\n\t// viewDirV3null\r\n\tflyToMakeSureVisible: function(sceneNodeArray, viewDirV3, offsetLen, flyTime, fn) {\r\n\t\t\r\n        var sNodeList = mapObj._map3d.getWorldManager().createEmptySceneNodeList();\r\n\t\tfor(var i = 0; i < sceneNodeArray.length; ++i) {\r\n\t\t\tsNodeList.addNode(mapObj.getSceneNode(sceneNodeArray[i]));\r\n\t\t}\r\n\t\t\r\n\t\tvar gCamera = this._gc;\r\n        offsetLen = Q3D.Util.isNumber(offsetLen) ? offsetLen : 0;\t\t\r\n\t\t\r\n        //\r\n\t\tvar  currViewDirV3 =  !viewDirV3 ? Q3D.vector3(-90,0,0): viewDirV3;\t//\r\n        //offsetLen\r\n\t\tvar  currEyePosV3d = gCamera.calcFullVisiblePos(sNodeList, currViewDirV3.get(), offsetLen);\r\n\t\tthis.flyTo(Q3D.vector3d(currEyePosV3d), currViewDirV3, flyTime, fn);\r\n\t    sNodeList.release();\r\n\t\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n    // @method startCircleFly(eyePos: Vector3d, targetPos: Vector3d, timePerCircle?: Number, rounds?:Number, isLoop?:Boolean, fn?: Function): this   \r\n    // rounds\r\n    startCircleFly: function(eyePos, targetPos, timePerCircle, rounds, isLoop, fn) {\r\n        mapObj.off(\"onCameraCircleAniEnd\");\r\n        if (fn && Q3D.Util.isFunction(fn)) {\r\n            mapObj._map3d.setFlyToListener(this._gc);            \r\n            mapObj.on(\"onCameraCircleAniEnd\", fn);\r\n        }\r\n        timePerCircle = Q3D.Util.isNumber(timePerCircle) ? timePerCircle : 1.0;\r\n        rounds = Q3D.Util.isNumber(rounds) ? rounds : 1;\r\n        isLoop = isLoop ? 1 : 0;      \r\n        this._gc.playCircleAni(eyePos.get(), targetPos.get(), timePerCircle * Math.abs(rounds), rounds, isLoop);\r\n        return this;\r\n    },\r\n    // @method stopCircleFly(): this   \r\n    // \r\n    stopCircleFly: function() {\r\n        this._gc.stopCircleAni();\r\n        return this;\r\n    },\r\n    \r\n    // @method startCircleFlyEx(eyePos: Vector3d, targetPos: Vector3d, timePerCircle?: Number, rounds?:Number, isLoop?:Boolean): MovieClipInstance   \r\n    // rounds\r\n    startCircleFlyEx: function(eyePos, targetPos, timePerCircle, rounds, isLoop) {\r\n        \r\n        timePerCircle = Q3D.Util.isNumber(timePerCircle) ? timePerCircle : 1.0;\r\n        rounds = Q3D.Util.isNumber(rounds) ? rounds : 1;\r\n        isLoop = isLoop ? 1 : 0;      \r\n        var aniName = \"circlefly_\" + this._gc.getFullName() + \"_movieclip\";\r\n        var instName = \"circlefly_\" + this._gc.getFullName() + \"_movieclip_inst\";       \r\n        \r\n        var _mc = Q3D.movieClip(aniName,50);\r\n        var _mcInst = Q3D.movieClipInstance(instName,_mc);\r\n        \r\n        var mc = _mc.get();\r\n        var actor = mc.addIActor(\"circlefly\");\r\n        var track = actor.addITrack( Q3D.Enums.actorTrackType.TransformMoveAbs, Q3D.Enums.actorKeyType.VecCircle ).asVecCircleTrack();\r\n        track.setCircleCenter( targetPos.get() );\r\n        track.setStartPos( eyePos.get() );\r\n        track.lockOrientation( 1 );\r\n        track.setBeginFrame( 0 );\r\n        track.setFrames( timePerCircle * Math.abs(rounds) * 50 );\r\n        track.setRounds( rounds );\r\n        \r\n        _mcInst.get().setPlayer( \"circlefly\", Q3D.Enums.playerType.Node, this._gc.getFullName()); \r\n        _mcInst.get().setLoop(isLoop);\r\n        return _mcInst;\r\n    },\r\n    \r\n    // @method stopCircleFlyEx(): this   \r\n    // \r\n    stopCircleFlyEx: function() {\r\n        var _wm = mapObj._map3d.getWorldManager();\r\n        var _mcInst = _wm.getMovieClipInstance(\"circlefly_\" + this._gc.getFullName() + \"_movieclip_inst\");\r\n        if (_mcInst) {\r\n            _mcInst.stop();\r\n            _mcInst.gotoFrame(0);\r\n            var _mcName = _mcInst.getMovieClipCName();\r\n            _wm.destroyMovieClipInstance(_mcInst.getCName());            \r\n            _wm.destroyMovieClip(_mcName);       \r\n        }        \r\n        return this;\r\n    },\r\n      \r\n    // @method onCameraUpdate(enabled: Boolean, fn?: Function, interval?: Number): this   \r\n    // interval\r\n    onCameraUpdate: function(enabled, fn, interval) {\r\n        if (fn && !Q3D.Util.isFunction(fn)) {\r\n            throw new Error('');\r\n        }\r\n        if (enabled) {\r\n            mapObj._map3d.setCameraListener(this._gc);         \r\n            if(!mapObj._lastCameraUpdateTime) {\r\n                mapObj._lastCameraUpdateTime = 0;\r\n                mapObj._cbFn = fn;\r\n                mapObj._interval = interval;\r\n               }   \r\n            mapObj.on(\"onCameraUpdate\", function() {  \r\n\t\t\t\tvar now = new Date().getTime();\r\n        \t\tif(now - mapObj._lastCameraUpdateTime <= mapObj._interval) {\r\n          \t\t\treturn;\r\n        \t\t}\r\n        \t\tmapObj._lastCameraUpdateTime = now;\r\n        \t\tif (Q3D.Util.isDefined(mapObj._cbFn)) mapObj._cbFn();  \r\n            });            \r\n            \r\n        } else {\r\n            mapObj._map3d.removeCameraListener(this._gc);             \r\n            mapObj.off(\"onCameraUpdate\",fn);\r\n            delete mapObj._lastCameraUpdateTime;\r\n            delete mapObj._cbFn;\r\n            delete mapObj._interval;\r\n        }   \r\n        return this;\r\n    },  \r\n    \r\n    // @method calRelativePos(nodePath: String): QVector3   \r\n    // \r\n\tcalRelativePos: function(nodePath) {\r\n\t\tvar relativePos = mapObj.getSceneNode(nodePath).toLocalPos(this.getAbsPos());\r\n\t\tconsole.log(\": \" + relativePos.x + \",\" + relativePos.y + \",\" + relativePos.z);\r\n\t\treturn relativePos;\r\n\t},\r\n};\r\n// @factory Q3D.globalCamera(): GlobalCamera\r\n// \r\nQ3D.globalCamera = function () {\r\n    return new Q3D.GlobalCamera();\r\n};\r\n","\r\n/* @class InputManager\r\n * @aka Q3D.InputManager\r\n *\r\n * \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var im = Q3D.inputManager();\r\n * ```\r\n */\r\nQ3D.InputManager = function () {\r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }\r\n    this._im = mapObj._map3d.getInputManager();\r\n};\r\n\r\nQ3D.InputManager.prototype = {\r\n\r\n    // @method get(): QInputManager\r\n    //  QInputManager \r\n    get: function () {\r\n        return this._im;\r\n    },\r\n\r\n    // @method setLocator(enabled: Boolean): this\r\n    // \r\n    setLocator: function (enabled) {\r\n        if (enabled) {\r\n            this._im.showLocator();\r\n        } else {\r\n            this._im.hideLocator();\r\n        }\r\n        return this;\r\n    },\r\n    \r\n    // @method setInertia(enabled: Boolean, duration: Number): this\r\n    // (1s)\r\n    setInertia: function (enabled, duration) {\r\n        if (enabled) {\r\n            this._im.enableInertia();\r\n            this._im.setInertiaDuration(isNaN(duration) ? 1 : duration);\r\n        } else {\r\n            this._im.disableInertia();\r\n        }\r\n        return this;\r\n    },\r\n    \r\n    // @method setPitch(enabled: Boolean, range: Array): this\r\n    // ([-90,+90])\r\n    setPitch: function (enabled, range) {\r\n        if (enabled) {\r\n            var oldpitch = Q3D.globalCamera().get().fetchRotPitch();\r\n            this._im.enablePitch();\r\n            if (Q3D.Util.isArray(range) && range.length === 2) {\r\n                range.sort(function(a,b){return a>b?1:-1});//\r\n                range[0] = Math.max(range[0] , -90);\r\n                range[1] = Math.min(range[1] , +90);\r\n                var newpitch = oldpitch;\r\n                if(parseInt(range[0]) == parseInt(range[1])) {\r\n                    newpitch = range[0];\r\n                } else {\r\n                    if (oldpitch < range[0])\r\n                        newpitch = range[0];\r\n                    else  {\r\n                        if (oldpitch > range[1])\r\n                            newpitch = range[1];\r\n                    }     \r\n                }             \r\n                var yaw = Q3D.globalCamera().get().fetchRotYaw();\r\n                var ori = Q3D.globalCamera().get().makeRotByYawPitch(newpitch, yaw);\r\n                var campos = Q3D.globalCamera().getAbsPos();\r\n                Q3D.globalCamera().get().flyTo(campos, ori, 0.5); \r\n                this._im.setPitchRange(range[0], range[1]);\r\n            } else {\r\n                this._im.setPitchRange(-90, +90);\r\n            }\r\n\r\n        } else {\r\n            this._im.disablePitch();\r\n        }\r\n        return this;\r\n    },\r\n    \r\n    // @method setDefaultPlaneHeight(height: Number): this\r\n    // (0m)\r\n    setDefaultPlaneHeight: function (height) {\r\n        this._im.setActionBaseplaneHeight(isNaN(height) ? 0 : height);\r\n        return this;\r\n    },\r\n    \r\n    // @method setDynamicSpeed(scaleSpd: Number, rambleSpd: Number): this\r\n    // =0.2=1.0\r\n    setDynamicSpeed: function (scaleSpd, rambleSpd) {\r\n        this._im.sendActionMsg(Q3D.Enums.actionType.SCALED_SCREEN, Q3D.Enums.actionMsg.SET_SCALE_DYNAMICSPEED, 0, isNaN(scaleSpd) ? 0.2 : scaleSpd);\r\n        this._im.sendActionMsg(Q3D.Enums.actionType.RAMBLE_KEEPORI, Q3D.Enums.actionMsg.SET_RAMBLE_TRANSLATESPEED, 0, isNaN(rambleSpd) ? 1.0 : rambleSpd);\r\n        return this;\r\n    },\r\n\r\n    // @method setKeyboardMoveSpeed(moveSpd: Number): this\r\n    // \r\n    setKeyboardMoveSpeed: function (moveSpd) {\r\n        this._im.setSpeed(moveSpd);\r\n        return this;\r\n    },\r\n    \r\n     // @method setCommonSpeed(actType: Number, paramType: Number, value: Number): this\r\n    // \r\n    setCommonSpeed: function (actType, paramType, value) {\r\n        this._im.sendActionMsg(actType, paramType, 0, isNaN(value) ? 0.1 : value);\r\n        return this;\r\n    },\r\n\r\n    // @method setLimitBox(enabled: Boolean, boxId: Number): this\r\n    // \r\n    setLimitBox: function (enabled, boxId) {\r\n        var rm = mapObj._map3d.getInputActionRestrictionManager();\r\n        if (enabled) {\r\n            rm.setCurRestriction(boxId);\r\n        } else {\r\n            rm.setCurRestriction(-1);\r\n        }\r\n        rm = null;\r\n        return this;\r\n    },\r\n    \r\n    // @method setFixedPointRotate(enabled: Boolean, fixPnt: Vector3d): this\r\n    //\r\n    setFixedPointRotate: function (enabled, fixPnt) {\r\n        if (enabled) {\r\n            this._im.sendActionMsg(Q3D.Enums.actionType.ROTATET_FIXPNT, Q3D.Enums.actionMsg.SET_FIXPNT, 0, fixPnt.get());\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.RBUTTON, Q3D.Enums.actionType.ROTATET_FIXPNT);\r\n        } else {\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.RBUTTON, Q3D.Enums.actionType.ROTATET_SCREEN);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    // @method setFirstPersonRotate(enabled: Boolean): this\r\n    // \r\n    setFirstPersonRotate: function (enabled) {\r\n        if (enabled) {\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.RBUTTON, Q3D.Enums.actionType.ROTATET_CAMERA);\r\n        } else {\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.RBUTTON, Q3D.Enums.actionType.ROTATET_SCREEN);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    // @method setThirdPersonOperation(enabled: Boolean,meshName: String, aniName: String): this\r\n    // \r\n    // \r\n    //  ASDW \r\n    //    \r\n    setThirdPersonOperation: function (enabled, meshName, aniName) {\r\n        if (enabled) {\r\n            if (meshName === undefined) {\r\n                mapObj.showNotice(\"\", \"!\");\r\n                return this;\r\n            }\r\n            aniName = aniName || \"\";\r\n            this._im.setInputType(1, meshName, aniName);\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.THIRD_CAMERAROTATE);\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.MBUTTON, Q3D.Enums.actionType.THIRD_MOVETO);\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.RBUTTON, Q3D.Enums.actionType.THIRD_ROTATE);\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.WHEEL, Q3D.Enums.actionType.THIRD_WHEEL);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.A.ctrlId, Q3D.Enums.actionType.THIRD_MOVELEFT);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.D.ctrlId, Q3D.Enums.actionType.THIRD_MOVERIGHT);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.W.ctrlId, Q3D.Enums.actionType.THIRD_MOVEFORTH);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.S.ctrlId, Q3D.Enums.actionType.THIRD_MOVEBACK);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.Q.ctrlId, Q3D.Enums.actionType.THIRD_MOVEDOWN);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.E.ctrlId, Q3D.Enums.actionType.THIRD_MOVEUP);\r\n\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.LEFT.ctrlId, Q3D.Enums.actionType.THIRD_TURNLEFT);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.RIGHT.ctrlId, Q3D.Enums.actionType.THIRD_TURNRIGHT);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.DOWN.ctrlId, Q3D.Enums.actionType.THIRD_LOOKDOWN);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.UP.ctrlId, Q3D.Enums.actionType.THIRD_LOOKUP);\r\n\r\n        } else {\r\n            \r\n            this._im.setInputType(0, \"\", \"\");\r\n            //\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.A.ctrlId, Q3D.Enums.actionType.TRANS_LEFTX);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.D.ctrlId, Q3D.Enums.actionType.TRANS_RIGHT);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.W.ctrlId, Q3D.Enums.actionType.TRANS_FORTH);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.S.ctrlId, Q3D.Enums.actionType.TRANS_BACKX);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.Q.ctrlId, Q3D.Enums.actionType.TRANS_DOWNX);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.E.ctrlId, Q3D.Enums.actionType.TRANS_UPXXX);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.LEFT.ctrlId, Q3D.Enums.actionType.TRANS_LEFTX);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.RIGHT.ctrlId, Q3D.Enums.actionType.TRANS_RIGHT);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.UP.ctrlId, Q3D.Enums.actionType.TRANS_FORTH);\r\n            this._im.bindControlAction(Q3D.Enums.device.KEYBOARD, Q3D.Enums.keyboard.DOWN.ctrlId, Q3D.Enums.actionType.TRANS_BACKX);\r\n\r\n            //\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.TRANS_SCENE);\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.MBUTTON, Q3D.Enums.actionType.RAMBLE_KEEPORI);\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.RBUTTON, Q3D.Enums.actionType.ROTATET_SCREEN);\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.WHEEL, Q3D.Enums.actionType.SCALED_SCREEN);\r\n        }\r\n        return this;\r\n    },\r\n    \r\n    // @method setThirdPersonBind(enabled: Boolean,nodePath: String): this\r\n    // \r\n    // \r\n    //  ASDW \r\n    //    \r\n    setThirdPersonBind: function (enabled, nodePath) {\r\n        var node = mapObj.getSceneNode(nodePath);\r\n        if (!node)\r\n            return this;\r\n        \r\n        if (enabled) {            \r\n            this._im.bindNode(node);\r\n            //\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.THIRD_CAMERAROTATE);\r\n            //this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.MBUTTON, Q3D.Enums.actionType.THIRD_MOVETO);\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.RBUTTON, Q3D.Enums.actionType.THIRD_ROTATE);\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.WHEEL, Q3D.Enums.actionType.THIRD_WHEEL);\r\n\r\n        } else {\r\n            this._im.unbindNode();\r\n            //\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.TRANS_SCENE);\r\n            //this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.MBUTTON, Q3D.Enums.actionType.RAMBLE_KEEPORI);\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.RBUTTON, Q3D.Enums.actionType.ROTATET_SCREEN);\r\n            this._im.bindControlAction(Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.WHEEL, Q3D.Enums.actionType.SCALED_SCREEN);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    // @method enableAllActions(enabled: Boolean, actArray: Array): this\r\n    // \r\n    enableAllActions: function (enabled, actArray) {\r\n        actArray = actArray || [];\r\n        var defaultActionArray = [\r\n            Q3D.Enums.actionType.TRANS_LEFTX,\r\n            Q3D.Enums.actionType.TRANS_RIGHT,\r\n            Q3D.Enums.actionType.TRANS_FORTH,\t\r\n            Q3D.Enums.actionType.TRANS_BACKX,\r\n            Q3D.Enums.actionType.TRANS_DOWNX,\r\n            Q3D.Enums.actionType.TRANS_UPXXX,\r\n            Q3D.Enums.actionType.CAMERA_CLOSETO,\r\n            Q3D.Enums.actionType.TRANS_SCENE,\r\n            Q3D.Enums.actionType.RAMBLE_KEEPORI,\r\n            Q3D.Enums.actionType.ROTATES_SCREEN,\r\n            Q3D.Enums.actionType.SCALED_SCREEN,\r\n            Q3D.Enums.actionType.YPSS_SCREEN\r\n        ];\r\n        \r\n        //\r\n        var _concat = function (arr1, arr2) {\r\n            //var arr = arr1arrarr1\r\n            var arr = arr1.concat();\r\n            //slice()var arr = arr1.slice(0)\r\n            for (var i = 0; i < arr2.length; i++) {\r\n                arr.indexOf(arr2[i]) === -1 ? arr.push(arr2[i]) : 0;\r\n            }\r\n            return arr;\r\n        }\r\n        \r\n        var combinedActions = _concat(defaultActionArray,actArray)\r\n        \r\n        for(var i = 0, len = combinedActions.length; i < len; ++i) {\r\n            this._im.enableAction(combinedActions[i], enabled);\r\n        }\r\n        return this;\r\n    },\r\n\r\n};\r\n\r\n// @factory Q3D.inputManager(): InputManager\r\n// \r\nQ3D.inputManager = function () {\r\n    return new Q3D.InputManager();\r\n};","\r\n  /* @class LayerGroup\r\n * @aka Q3D.LayerGroup\r\n *\r\n * \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var lg = Q3D.layerGroup();\r\n * ``` \r\n */\r\nQ3D.LayerGroup = function () {    \r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }   \r\n};\r\n\r\nQ3D.LayerGroup.prototype = {\r\n   \r\n    // @method getLayer(layerName: String): QLayer  \r\n    //  QLayer \r\n    getLayer: function(layerName) {  \r\n        return mapObj._map3d.getWorldManager().getLayer(layerName);        \r\n    },\r\n    \r\n    // @method setLayerAttributes(layerName: String, options: LayerAttr options): this  \r\n    // \r\n    setLayerAttributes: function(layerName, options) {        \r\n        var defaultOptions = {            \r\n            ShowOrder: 0, // 0\r\n            IsHeightHideCtrl: false,//\r\n            MinHeight: -5000,//\r\n            MaxHeight: 5000, //\r\n            IsForbidSelect: false,//\r\n            IsForbidOperation: false, //\r\n        }\r\n        Q3D.extend(defaultOptions,options);\r\n        \r\n        var _dstLayer = this.getLayer(layerName);\r\n        if (!_dstLayer) {  //       \r\n            return false;\r\n        }              \r\n        _dstLayer.setOrder(defaultOptions.ShowOrder);\r\n        if (defaultOptions.IsHeightHideCtrl) {\r\n            _dstLayer.enableHideHeight(1);\r\n            _dstLayer.setHideHeight(defaultOptions.MinHeight, defaultOptions.MaxHeight);\r\n        } else {\r\n            _dstLayer.enableHideHeight(0);\r\n        }\r\n        _dstLayer.setForbidSelect(defaultOptions.IsForbidSelect ? 1 : 0);\r\n        _dstLayer.setForbidOperation(defaultOptions.IsForbidOperation ? 1 : 0);        \r\n        \r\n        return true;\r\n    },\r\n    \r\n    // @method getAllLayerNames(): Array  \r\n    // \r\n    getAllLayerNames: function() {\r\n        var _layerNames = [];\r\n        var _ll = mapObj._map3d.getWorldManager().getAllLayers();\r\n        var _layer = _ll.firstLayer();\r\n        if (_layer) {\r\n            _layerNames.push(_layer.getLayerName());\r\n            while (true) {\r\n                _layer = _ll.nextLayer();\r\n                if (!_layer) \r\n                    break;\r\n                _layerNames.push(_layer.getLayerName());\r\n            }\r\n        }\r\n        _ll.release();\r\n        return _layerNames;\r\n    },    \r\n    \r\n    // @method getLayerAllNodeNames(layerName: String): Array  \r\n    // \r\n    getLayerAllNodeNames: function(layerName) {\r\n        var _nodeNames = [];\r\n        var _ll = this.getLayer(layerName);\r\n        if (!_ll) {  //          \r\n            return _nodeNames;\r\n        }    \r\n        var  _nodes = _ll.getLayerAllNodes();\r\n        var _node = _nodes.firstNode();\r\n        if (_node) {\r\n            _nodeNames.push(_node.getFullName());\r\n            while (true) {\r\n                _node = _nodes.nextNode();\r\n                if (!_node) \r\n                    break;\r\n                _nodeNames.push(_node.getFullName());\r\n            }\r\n        }\r\n        _nodes.release();\r\n        return _nodeNames;\r\n    },\r\n    \r\n    // @method createLayers(layers: Array): Boolean  \r\n    // \r\n    createLayers: function(layers) {\r\n        if (!Q3D.Util.isArray(layers) || typeof layers[0] !== 'string') \r\n            return false;\r\n        \r\n        var _wm = mapObj._map3d.getWorldManager();        \r\n        //\r\n        var _cnt = layers.length;\r\n        layers.forEach( function(l) {   \r\n            if (_wm.getLayer(l)) //\r\n                _cnt--;\r\n        } ) ;\r\n        if (_cnt < layers.length )\r\n            return false;\r\n        \r\n        layers.forEach( function(l) {   \r\n            _wm.createLayer(l);\r\n        } ) ;\r\n  \r\n        return true;\r\n    },\r\n    \r\n    // @method toggleLayers(layers: Array): this  \r\n    // \r\n    toggleLayers: function(layers) {\r\n        if (Q3D.Util.isArray(layers) && typeof layers[0] === 'string') {        \r\n            var _wm = mapObj._map3d.getWorldManager();     \r\n            layers.forEach( function(l) {   \r\n                var _layer = _wm.getLayer(l);\r\n                if (_layer) {\r\n                    _layer.setVisible(_layer.isVisible() == 1 ? 0 : 1)\r\n                }            \r\n            } ) ;\r\n        }\r\n        return this;\r\n    },\r\n    \r\n    // @method setLayersVisible(layers: Array, isVisible: Boolean): this  \r\n    // \r\n    setLayersVisible: function(layers, isVisible) {\r\n        if (Q3D.Util.isArray(layers) && typeof layers[0] === 'string') {        \r\n            var _wm = mapObj._map3d.getWorldManager();     \r\n            layers.forEach( function(l) {   \r\n                var _layer = _wm.getLayer(l);\r\n                if (_layer) {\r\n                    _layer.setVisible(isVisible ? 1 : 0);\r\n                }            \r\n            } ) ;\r\n        }\r\n        return this;\r\n    },\r\n    \r\n    // @method addSceneNodesToLayer(layerName: String, nodeNames: Array): this  \r\n    // nodeNameAreaName\r\n    // \r\n    addSceneNodesToLayer: function(layerName, nodeNames) {\r\n        var _dstLayer = this.getLayer(layerName);\r\n        if (!_dstLayer) {  //          \r\n            this.createLayers([layerName]);\r\n            _dstLayer = this.getLayer(layerName);\r\n        }        \r\n        \r\n        if (Q3D.Util.isArray(nodeNames) && typeof nodeNames[0] === 'string') {           \r\n            nodeNames.forEach( function(nodeName) {  \r\n\t\t\t\tvar _node = mapObj._map3d.getWorldManager().getSceneNode(nodeName) ;\r\n                if (_node && _node.getLayerName() == \"\")\r\n            \t\t_dstLayer.addSceneNodebyName(nodeName);                          \r\n            } ) ;\r\n        }\r\n        \r\n        return this;\r\n    },\r\n    \r\n    // @method removeSceneNodesFromLayer(layerName: String, nodeNames?: Array): this  \r\n    // nodeNameAreaName\r\n    removeSceneNodesFromLayer: function(layerName, nodeNames) {\r\n        var _dstLayer = this.getLayer(layerName);\r\n        if (!_dstLayer) {  //          \r\n            return false;\r\n        }      \r\n        \r\n        if (typeof  nodeNames === \"undefined\")\r\n            _dstLayer.removeAllNodes();\r\n        else {        \r\n        \tif (Q3D.Util.isArray(nodeNames) && typeof nodeNames[0] === 'string') {           \r\n            \tnodeNames.forEach( function(nodeName) {  \r\n\t\t\t\t\tvar _node = mapObj._map3d.getWorldManager().getSceneNode(nodeName) ;\r\n                \tif  (_node)\r\n                \t\t_dstLayer.removeNode(_node);                 \r\n            \t} ) ;\r\n        \t}\r\n        }        \r\n        return true;\r\n    },\r\n    \r\n    // @method moveSceneNodesBetweenLayers(srcLayerName: String, dstLayerName: String): Boolean \r\n    // \r\n    moveSceneNodesBetweenLayers: function(srcLayerName, dstLayerName) {\r\n        var _srcLayer = this.getLayer(srcLayerName);\r\n        var _dstLayer = this.getLayer(dstLayerName);\r\n        if (!_srcLayer || !_dstLayer) \r\n            return false;\r\n        \r\n        var nodes = _srcLayer.getLayerAllNodes();\r\n        return this.moveSceneNodesToLayer(nodes, dstLayerName);\r\n    },\r\n    \r\n    // moveSceneNodesToLayer(nodes: QSceneNodeList, layerName: String): Boolean  \r\n    // \r\n    moveSceneNodesToLayer: function(nodes, layerName) {\r\n        var _dstLayer = this.getLayer(layerName);\r\n        if (!_dstLayer) {\r\n            this.createLayers([layerName]);\r\n            _dstLayer = this.getLayer(layerName);\r\n        }        \r\n        var _node = nodes.firstNode();\r\n        if (_node) {\r\n            _dstLayer.moveSceneNode(_node);            \r\n            while (true) {\r\n                _node = nodes.nextNode();\r\n                if (!_node)\r\n                    break;\r\n                _dstLayer.moveSceneNode(_node);                \r\n            }\r\n        }\r\n        nodes.release();\r\n        return true;\r\n    },\r\n    \r\n};\r\n\r\n// @factory Q3D.layerGroup(): LayerGroup\r\n// \r\n\r\nQ3D.layerGroup = function () {\r\n    return new Q3D.LayerGroup();\r\n};\r\n","\r\n/* @class MovieClip\r\n * @aka Q3D.MovieClip\r\n *\r\n * \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var mc = Q3D.movieClip(\"movie_clip\",50);\r\n * mc.addActorTranslateAnimation(\"carA1\", [{Key:\"0\",Pos:q3},{Key:\"200\",Pos:q3}]);\r\n * mc.addActorTrackControlPoint(\"carA1\", 0, q3, true);\r\n * mc.addActorRotateAnimation(\"carA1\", [{Key:\"0\",Rotate:q3},{Key:\"200\",Rotate:q3}]);\r\n * mc.addActorScaleAnimation(\"carA1\", [{Key:\"0\",Scale:q3},{Key:\"200\",Scale:q3}]);\r\n * ```\r\n *\r\n */\r\nQ3D.MovieClip = function (mcName, fps) {    \r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }            \r\n    \r\n    this._mcName = mcName;//\r\n    var _wm = mapObj._map3d.getWorldManager();\r\n    this._mc = _wm.getMovieClip(mcName);\r\n    if (!this._mc) {\r\n        this._mc = _wm.createMovieClip(mcName);//\r\n    } \r\n    this._mc.setFPS(fps);   \r\n    //this._mc.removeAllActors();    \r\n};\r\n\r\nQ3D.MovieClip.prototype = {\r\n    \r\n    // @method get(): QMovieClip\r\n    //  QMovieClip     \r\n    get: function() {\r\n        return this._mc ;\r\n    },\r\n    \r\n    // @method getTotalFrameLength(): Number  \r\n    // \r\n    getTotalFrameLength: function() {\r\n        return this._mc.getTimeLength() * this._mc.getFPS();\r\n    },\r\n    \r\n    // @method getFPS(): Number  \r\n    // \r\n    getFPS: function() {\r\n        return this._mc.getFPS();\r\n    },\r\n    \r\n    // @method getFrameFromTime(secs: Number): Number  \r\n    //  -1\r\n    getFrameFromTime: function(secs) {\r\n        var totalTime = this._mc.getTimeLength();\r\n        if (secs > totalTime || secs < 0) \r\n            return -1;\r\n        return secs * this._mc.getFPS() ;\r\n    },\r\n    \r\n    // @method getTimeFromFrame(frames: Number): Number  \r\n    //  -1\r\n    getTimeFromFrame: function(frames) {\r\n        var totalFrames = this.getTotalFrameLength();\r\n        if (frames > totalFrames || frames < 0) \r\n            return -1;\r\n        return frames / this._mc.getFPS();\r\n    },\r\n   \r\n    // @method removeActor(acName: String): this  \r\n    // \r\n    removeActor: function(acName) {\r\n        this._mc.removeActor(acName);\r\n        return this;       \r\n    },\r\n    \r\n    // @method removeAllActors(): this  \r\n    // \r\n    removeAllActors: function() {\r\n        this._mc.removeAllActors();\r\n        return this;\r\n    },\r\n    \r\n    // @method hasActor(acName: String): Boolean  \r\n    //\r\n    hasActor: function(acName) {\r\n        return this._mc.getIActor(acName) != null;\r\n    },\r\n    \r\n    // @method addActorTranslateAnimation(acName:String, transInfo: Array): this  \r\n    // JSONVector3\r\n    addActorTranslateAnimation: function(acName, transInfo) {\r\n        //\r\n        var _cnt = transInfo.length;\r\n        if (_cnt < 2) return null;\r\n        \r\n        var _actor = this._mc.getIActor(acName);//        \r\n        if (!_actor) {\r\n            _actor = this._mc.addIActor(acName);//\r\n        }\r\n\r\n        var _trackMove = _actor.addITrack( Q3D.Enums.actorTrackType.TransformMove, Q3D.Enums.actorKeyType.KeyAuto ).asKeyTrack();\r\n        for (var i = 0; i < transInfo.length; i++) {  \r\n            var key = _trackMove.addIKey(transInfo[i].Key);\r\n            if (!key) {\r\n                key = _trackMove.addIKey(transInfo[i].Key + 1); //1\r\n            }\r\n            key.setKeyIPointAsQVector3(transInfo[i].Pos.get());\r\n            if (i == 0)  { //                \r\n                key.setRightTimeCtrlType( Q3D.Enums.timeCtrlType.EaseIn );\r\n            } else if (i == _cnt - 1) { //\r\n                key.setLeftTimeCtrlType( Q3D.Enums.timeCtrlType.EaseOut );\r\n            } else {\r\n                //\r\n                key.setLeftCurveCtrlType( Q3D.Enums.curveCtrlType.Linear ); \r\n                key.setRightCurveCtrlType( Q3D.Enums.curveCtrlType.Linear );\r\n            }\r\n        } \r\n        return this;\r\n    },\r\n    \r\n    _addActorTranslateGravityAnimation: function(acName, transInfo) {\r\n        //\r\n        var _cnt = transInfo.length;\r\n        if (_cnt < 2) return null;\r\n        \r\n        var _actor = this._mc.getIActor(acName);//        \r\n        if (!_actor) {\r\n            _actor = this._mc.addIActor(acName);//\r\n        }\r\n\r\n        var _trackMove = _actor.addITrack( Q3D.Enums.actorTrackType.TransformMove, Q3D.Enums.actorKeyType.KeyAuto ).asKeyTrack();\r\n        for (var i = 0; i < transInfo.length; i++) {  \r\n            var key = _trackMove.addIKey(transInfo[i].Key);\r\n            if (!key) {\r\n                key = _trackMove.addIKey(transInfo[i].Key + 1); //1\r\n            }\r\n            key.setKeyIPointAsQVector3(transInfo[i].Pos.get());\r\n            if (i % 2 == 0)  { //               \r\n                key.setRightTimeCtrlType( Q3D.Enums.timeCtrlType.EaseIn );\r\n                if(i > 0)\r\n                    key.setLeftTimeCtrlType( Q3D.Enums.timeCtrlType.EaseOut );\r\n            } \r\n        } \r\n        return this;\r\n    },\r\n    \r\n    // @method addActorTrackControlPoint(acName:String, keyIndex: Number, ctlPnt: Vector3, isRight: Boolean): this  \r\n    //     \r\n    addActorTrackControlPoint: function(acName, keyIndex, ctlPnt, isRight) {\r\n         var _actor = this._mc.getIActor(acName);\r\n         if (!_actor) return null;\r\n         var _track = _actor.getITrack(Q3D.Enums.actorTrackType.TransformMove);\r\n         if (!_track) return null;\r\n         var _trackMove = _track.asKeyTrack();\r\n         var _key = _trackMove.getIKey(keyIndex);\r\n         if (!_key) return null;\r\n         if (isRight) {\r\n             _key.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Bessel);\r\n             _key.setRightCtrlIPointAsQVector3(ctlPnt.get());\r\n         } else {\r\n             _key.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Bessel);\r\n             _key.setLeftCtrlIPointAsQVector3(ctlPnt.get());\r\n         }\r\n         return this;\r\n    },\r\n    \r\n    // @method addActorRotateAnimation(acName:String, rotatesInfo: Array): this  \r\n    // JSON\r\n    addActorRotateAnimation: function(acName, rotatesInfo) {\r\n        var _cnt = rotatesInfo.length;\r\n        if (_cnt < 2) return null;\r\n        \r\n        var _actor = this._mc.getIActor(acName);\r\n        if (!_actor) {\r\n            _actor = this._mc.addIActor(acName);//\r\n        }\r\n\r\n        var _trackRot = _actor.addITrack( Q3D.Enums.actorTrackType.TransformRotate, Q3D.Enums.actorKeyType.KeyAuto ).asKeyTrack();\r\n        for(var i=0;i<rotatesInfo.length;i++){\r\n            var key = _trackRot.addIKey(rotatesInfo[i].Key);\r\n            if (!key) {\r\n                key = _trackRot.addIKey(rotatesInfo[i].Key + 1); //1\r\n            }\r\n            key.setKeyIPointAsQVector3(rotatesInfo[i].Rotate.get());\r\n            if (i == 0)  { //\r\n                var currRot = rotatesInfo[i].Rotate.clone();\r\n                var nextRot = rotatesInfo[i+1].Rotate.clone();\r\n                if (currRot.equals(nextRot))\r\n                    key.setRightCurveCtrlType( Q3D.Enums.curveCtrlType.Point );\r\n                else\r\n                    key.setRightCurveCtrlType( Q3D.Enums.curveCtrlType.Linear );\r\n            } else if (i == _cnt - 1) { //\r\n                var currRot = rotatesInfo[i].Rotate.clone();\r\n                var prevRot = rotatesInfo[i-1].Rotate.clone();\r\n                if (currRot.equals(prevRot))\r\n                    key.setLeftCurveCtrlType( Q3D.Enums.curveCtrlType.Point );\r\n                else\r\n                    key.setLeftCurveCtrlType( Q3D.Enums.curveCtrlType.Linear );\r\n            } else { //\r\n                var currRot = rotatesInfo[i].Rotate.clone();\r\n                var nextRot = rotatesInfo[i+1].Rotate.clone();\r\n                var prevRot = rotatesInfo[i-1].Rotate.clone();\r\n                if (currRot.equals(prevRot))\r\n                    key.setLeftCurveCtrlType( Q3D.Enums.curveCtrlType.Point );\r\n                else\r\n                    key.setLeftCurveCtrlType( Q3D.Enums.curveCtrlType.Linear );\r\n                \r\n                if (currRot.equals(nextRot))\r\n                    key.setRightCurveCtrlType( Q3D.Enums.curveCtrlType.Point );\r\n                else\r\n                    key.setRightCurveCtrlType( Q3D.Enums.curveCtrlType.Linear );                \r\n            }\r\n        }\r\n        \r\n        return this;        \r\n    },\r\n    \r\n    // @method addActorScaleAnimation(acName:String, scalesInfo: Array): this  \r\n    // JSON\r\n    addActorScaleAnimation: function(acName, scalesInfo) {\r\n        var _cnt = scalesInfo.length;\r\n        if (_cnt < 2) return null;\r\n        \r\n        var _actor = this._mc.getIActor(acName);\r\n        if (!_actor) {\r\n            _actor = this._mc.addIActor(acName);\r\n        }\r\n        \r\n        var _trackScale = _actor.addITrack( Q3D.Enums.actorTrackType.TransformScale, Q3D.Enums.actorKeyType.KeyAuto ).asKeyTrack();\r\n        for(var i=0;i<scalesInfo.length;i++){\r\n            var key = _trackScale.addIKey(scalesInfo[i].Key);\r\n            if (!key) {\r\n                key = _trackScale.addIKey(scalesInfo[i].Key + 1); //1\r\n            }\r\n            key.setKeyIPointAsQVector3(scalesInfo[i].Scale.get());\r\n            if (i == 0)  { //\r\n                var currScale = scalesInfo[i].Scale.clone();\r\n                var nextScale = scalesInfo[i+1].Scale.clone();\r\n                if (currScale.equals(nextScale))\r\n                    key.setRightCurveCtrlType( Q3D.Enums.curveCtrlType.Point );\r\n                else\r\n                    key.setRightCurveCtrlType( Q3D.Enums.curveCtrlType.Linear );\r\n            } else if (i == _cnt - 1) { //\r\n                var currScale = scalesInfo[i].Scale.clone();\r\n                var prevScale = scalesInfo[i-1].Scale.clone();\r\n                if (currScale.equals(prevScale))\r\n                    key.setLeftCurveCtrlType( Q3D.Enums.curveCtrlType.Point );\r\n                else\r\n                    key.setLeftCurveCtrlType( Q3D.Enums.curveCtrlType.Linear );\r\n            } else { //\r\n                var currScale = scalesInfo[i].Scale.clone();\r\n                var nextScale = scalesInfo[i+1].Scale.clone();\r\n                var prevScale = scalesInfo[i-1].Scale.clone();\r\n                if (currScale.equals(prevScale))\r\n                    key.setLeftCurveCtrlType( Q3D.Enums.curveCtrlType.Point );\r\n                else\r\n                    key.setLeftCurveCtrlType( Q3D.Enums.curveCtrlType.Linear );\r\n                \r\n                if (currScale.equals(nextScale))\r\n                    key.setRightCurveCtrlType( Q3D.Enums.curveCtrlType.Point );\r\n                else\r\n                    key.setRightCurveCtrlType( Q3D.Enums.curveCtrlType.Linear );                \r\n            }\r\n        }\r\n        \r\n        return this;                \r\n    },\r\n    \r\n    //  _addFadeInAnimation(acName:String, actTime: Number, alphaEnd: Number): this  \r\n    // `\r\n    _addFadeInAnimation: function(acName, actTime, alphaEnd) {\r\n        var _actor = this._mc.getIActor(acName);\r\n        if (!_actor) {\r\n            _actor = this._mc.addIActor(acName);\r\n        } else {\r\n            _actor.destroyTrack(Q3D.Enums.actorTrackType.ColorAlpha);\r\n        }        \r\n        var _trackFadeIn = _actor.addITrack( Q3D.Enums.actorTrackType.ColorAlpha, Q3D.Enums.actorKeyType.KeyAuto ).asKeyTrack();\r\n        var key = _trackFadeIn.addIKey( 0 );\r\n        key.setKeyIPointAsFloat( 0.0 );\r\n        key = _trackFadeIn.addIKey( actTime * this._mc.getFPS() );\r\n        key.setKeyIPointAsFloat( alphaEnd || 1.0 );\r\n        key.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.EaseOut );        \r\n        return this;\r\n    },\r\n    \r\n    //  addFadeOutAnimation(acName:String, actTime: Number, alphaStart: Number): this  \r\n    // \r\n    _addFadeOutAnimation: function(acName, actTime, alphaStart) {\r\n        var _actor = this._mc.getIActor(acName);\r\n        if (!_actor) {\r\n            _actor = this._mc.addIActor(acName);\r\n        } else {\r\n            _actor.destroyTrack(Q3D.Enums.actorTrackType.ColorAlpha);\r\n        }\r\n\r\n        var _trackFadeIn = _actor.addITrack( Q3D.Enums.actorTrackType.ColorAlpha, Q3D.Enums.actorKeyType.KeyAuto ).asKeyTrack();\r\n        var key = _trackFadeIn.addIKey( 0 );\r\n        key.setKeyIPointAsFloat( alphaStart || 1.0 );\r\n        key.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.EaseIn);  \r\n        key = _trackFadeIn.addIKey( actTime * this._mc.getFPS() );\r\n        key.setKeyIPointAsFloat( 0.0 );\r\n          \r\n        return this;\r\n    },\r\n    \r\n    //  _addTransparentFlashAnimation(acName:String, initAlpha: Number, actTime: Number, flashTimes: Number): this  \r\n    // \r\n    _addTransparentFlashAnimation: function(acName, initAlpha, actTime, flashTimes) {\r\n        var _actor = this._mc.getIActor(acName);\r\n        if (!_actor) {\r\n            _actor = this._mc.addIActor(acName);\r\n        } else {\r\n            _actor.destroyTrack(Q3D.Enums.actorTrackType.ColorAlpha);\r\n        }\r\n\r\n        //var fps = this._mc.getFPS(); //\r\n        var _trackTransFlash = _actor.addITrack( Q3D.Enums.actorTrackType.ColorAlpha, Q3D.Enums.actorKeyType.KeyAuto ).asKeyTrack();\r\n        var currKeyStart = 0;\r\n        key = _trackTransFlash.addIKey( currKeyStart );\r\n        key.setKeyIPointAsFloat( initAlpha );\r\n        for (var i = 0; i < flashTimes; i++) {\r\n            key = _trackTransFlash.addIKey( currKeyStart + actTime * this._mc.getFPS()  );\r\n            key.setKeyIPointAsFloat( 0.0 );\r\n            key = _trackTransFlash.addIKey( currKeyStart + actTime * 2 * this._mc.getFPS()  );\r\n            key.setKeyIPointAsFloat( initAlpha );\r\n            currKeyStart += actTime * 2 * this._mc.getFPS() ;\r\n        }\r\n       \r\n        return this;\r\n    },\r\n    \r\n    //    \r\n    _addColorFlashAnimation: function(acName, initColor, targetColor, actTime, flashTimes,  isEmissiveColor) {\r\n        var _actor = this._mc.getIActor(acName);\r\n\t\tvar colorType = isEmissiveColor? Q3D.Enums.actorTrackType.ColorEmissive : Q3D.Enums.actorTrackType.ColorDiffuse;\r\n        if (!_actor) {\r\n            _actor = this._mc.addIActor(acName);\r\n        } else {\r\n            _actor.destroyTrack(colorType);\r\n        }\r\n\r\n        //var fps = this._mc.getFPS(); //\r\n        var _trackColorFlash = _actor.addITrack( colorType, Q3D.Enums.actorKeyType.KeyAuto ).asKeyTrack();\r\n        var currKeyStart = 0;\r\n        var key = _trackColorFlash.addIKey( currKeyStart );\r\n        key.setKeyIPointAsQColourValue( initColor );\r\n        for (var i = 0; i < flashTimes; i++) {           \r\n            key = _trackColorFlash.addIKey( currKeyStart + actTime * this._mc.getFPS() );\r\n            key.setKeyIPointAsQColourValue( targetColor );\r\n            key = _trackColorFlash.addIKey( currKeyStart + actTime * 2 * this._mc.getFPS() );\r\n            key.setKeyIPointAsQColourValue( initColor );\r\n            currKeyStart += actTime * 2 * this._mc.getFPS();\r\n        }\r\n        \r\n        return this;\r\n    },   \r\n       \r\n};\r\n\r\n// @factory Q3D.movieClip(mcName: String, fps: Number): QMovieClip\r\n// \r\nQ3D.movieClip = function (mcName, fps) {\t\r\n    return new Q3D.MovieClip(mcName,fps);\r\n};\r\n\r\n","\r\n/* @class MovieClipInstance\r\n * @aka Q3D.MovieClipInstance\r\n *\r\n * \r\n * \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var mc = Q3D.movieClip(\"movie_clip\",50);\r\n * var mcInst = Q3D.movieClipInstance(\"movie_clip_inst\",mc);\r\n * ```\r\n *\r\n */\r\nQ3D.MovieClipInstance = function (mcInstName, mcObj) {    \r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }            \r\n    \r\n    var _wm = mapObj._map3d.getWorldManager();\r\n    this._mcInst = _wm.getMovieClipInstance(mcInstName);\r\n    if (!this._mcInst) {\r\n        this._mcInst = _wm.createMovieClipInstance( mcInstName ); //\r\n        this._mcInst.setMovieClip( mcObj.get().getCName() );  \r\n        mapObj._map3d.setMovieClipInstanceEventListener(this._mcInst);//\r\n    } else {\r\n        this._mcInst.setMovieClip( mcObj.get().getCName() );  \r\n        this._mcInst.gotoFrame(0);\r\n        this._mcInst.clearAllPlayers();\r\n    }     \r\n    this._mc = mcObj;//mc\r\n    this._nodespos = {};//\r\n    this._nodesmat = [];//\r\n};\r\n\r\nQ3D.MovieClipInstance.prototype = {\r\n    // @method get(): QMovieClipInstance\r\n    //  QMovieClipInstance     \r\n    get: function() {\r\n        return this._mcInst ;\r\n    },\r\n    \r\n    // @method getMovieClip(): MovieClip\r\n    // MovieClip     \r\n    getMovieClip: function() {\r\n        return this._mc ;\r\n    },\r\n    \r\n    // @method getCName(): String\r\n    //  QMovieClipInstance     \r\n    getCName: function() {\r\n        return this._mcInst.getCName() ;\r\n    },\r\n    \r\n    // @method getMovieClipCName(): String\r\n    //  QMovieClipInstance  QMovieClip    \r\n    getMovieClipCName: function() {\r\n        return this._mcInst.getMovieClipCName() ;\r\n    },\r\n    \r\n    // @method init(): Null\r\n    //     \r\n    init: function() {\r\n        this._mcInst.clearAllPlayers();\r\n        this._mcInst.setLoop( 0 );\r\n        this._mcInst.gotoFrame( 0 );  \r\n        this._nodespos = {};\r\n        this._nodesmat = [];        \r\n    },\r\n    \r\n    // @method setTransformPlayer(acName: String, node: QSceneNode): Boolean\r\n    // ()\r\n    // acName\r\n    setTransformPlayer: function(acName, node) {\r\n        var nodeName = node.getFullName();//getArea().getName() + \"/\" + node.getName();\r\n        for (var name in this._nodespos) {\r\n            if (name == nodeName) //\r\n                return false;\r\n        }       \r\n\r\n        this._mcInst.setPlayer( acName, Q3D.Enums.playerType.Node, nodeName );//\r\n        this._nodespos[nodeName] = node.getPosition();   //\r\n        return true;\r\n    },\r\n    \r\n    // @method setMaterialFadePlayer(node: QSceneNode, fadeType: Number, actTime: Number, flashTimes?: Number): Boolean\r\n    // (Actor)\r\n    // \r\n    // \r\n    setMaterialFadePlayer: function(node, fadeType, actTime, flashTimes) {\r\n        var nodeType = node.getNodeType();\r\n        if (nodeType != Q3D.Enums.sceneNodeType.SNODE_Model && nodeType != Q3D.Enums.sceneNodeType.SNODE_VecModel)\r\n            return false;\r\n        \r\n        var realNode = null;\r\n        if (nodeType == Q3D.Enums.sceneNodeType.SNODE_Model)\r\n            realNode = node.asModel();\r\n        else\r\n            realNode = node.asVecModel();        \r\n       \r\n        //realNode.makeAloneMaterials();\r\n        realNode.makeAloneMaterialsEx(2);\r\n        for (var i = 0; i <= realNode.getMaterialCount() - 1; i++)\r\n        {\r\n            var mat = realNode.getMaterial(i);    \r\n            if(mat == null) continue;\r\n            var initAlpha = mat.getAlpha();\r\n            mat.setAlphaBlendEnable( 1 );\r\n            if (fadeType == Q3D.Enums.fadeType.fadeIn)\r\n                this._mc._addFadeInAnimation( mat.getName(), actTime, initAlpha ); //Actor\r\n            else if (fadeType == Q3D.Enums.fadeType.fadeOut)\r\n                this._mc._addFadeOutAnimation( mat.getName(), actTime, initAlpha ); //Actor\r\n            else                 \r\n                this._mc._addTransparentFlashAnimation( mat.getName(), initAlpha, actTime, flashTimes ); //Actor\r\n            this._mcInst.setPlayer( mat.getName(), Q3D.Enums.playerType.Material, mat.getName() );\r\n        }\r\n        var nodeName = node.getFullName();//getArea().getName() + \"/\" + node.getName();\r\n        if( this._nodesmat.indexOf(nodeName) == -1)\r\n            this._nodesmat.push(nodeName);     //\r\n        \r\n        return true;\r\n    },\r\n    \r\n    // @method setMaterialColorFlashPlayer(node: QSceneNode, targetColor: ColourValue,actTime: Number, flashTimes: Number, isEmissiveColor?: Boolean): Boolean\r\n    // (Actor)\r\n    // \r\n    //     \r\n    setMaterialColorFlashPlayer: function(node, targetColor, actTime, flashTimes, isEmissiveColor) {\r\n        var nodeType = node.getNodeType();\r\n        if (nodeType != Q3D.Enums.sceneNodeType.SNODE_Model && nodeType != Q3D.Enums.sceneNodeType.SNODE_VecModel)\r\n            return false;\r\n        \r\n        var realNode = null;\r\n        if (nodeType == Q3D.Enums.sceneNodeType.SNODE_Model)\r\n            realNode = node.asModel();\r\n        else\r\n            realNode = node.asVecModel();        \r\n       \r\n        //realNode.makeAloneMaterials();\r\n        realNode.makeAloneMaterialsEx(2);\r\n        for (var i = 0; i <= realNode.getMaterialCount() - 1; i++)\r\n        {\r\n            var mat = realNode.getMaterial(i);    \r\n            if(mat == null) continue;\r\n            mat.setAlphaBlendEnable( 1 );\r\n\t\t\t\r\n            var initColor = isEmissiveColor?  mat.getEmissiveColor() : mat.getDiffuseColor();\r\n            this._mc._addColorFlashAnimation( mat.getName(), initColor, targetColor.get(), actTime, flashTimes, isEmissiveColor ); //Actor\r\n            this._mcInst.setPlayer( mat.getName(), Q3D.Enums.playerType.Material, mat.getName() );\r\n        }\r\n        var nodeName = node.getFullName();//getArea().getName() + \"/\" + node.getName();\r\n        if( this._nodesmat.indexOf(nodeName) == -1)\r\n            this._nodesmat.push(nodeName);     \r\n        \r\n        return true;\r\n    },    \r\n    \r\n    // @method setPlayOptions(startFrame?: Number, isLoop?: Boolean): this\r\n    // =0=false\r\n    setPlayOptions: function(startFrame, isLoop) {\r\n        this._mcInst.stop();\r\n        this._mcInst.setLoop( isLoop ? 1 : 0 );\r\n        this._mcInst.gotoFrame( startFrame ? startFrame : 0 );           \r\n        return this;\r\n    },\r\n    \r\n    // @method play(): this\r\n    // \r\n    play: function() {\r\n        this._mcInst.play();   \r\n        return this;\r\n    },\r\n    \r\n    // @method pause(): this\r\n    // \r\n    pause: function() {\r\n        this._mcInst.pause();   \r\n        return this;\r\n    },\r\n    \r\n    // @method replay(): this\r\n    // \r\n    replay: function() {\r\n        this._mcInst.replay();   \r\n        return this;\r\n    },\r\n    \r\n    // @method stop(): this\r\n    // \r\n    stop: function() {\r\n        this._mcInst.stop();   \r\n        return this;\r\n    },\r\n    \r\n     // @method currFrame(): Number\r\n    // \r\n    currFrame: function() {\r\n        return this._mcInst.getCurrFrameNo();\r\n    },\r\n     \r\n    // @method currTime(): Number\r\n    // \r\n    currTime: function() {\r\n        return this._mcInst.getCurrTickTime()\r\n    },\r\n    \r\n    // @method nextFrame(frames?: Number): this\r\n    // =1\r\n    nextFrame: function(frames) {\r\n        var currFrame = this._mcInst.getCurrFrameNo();\r\n        this._mcInst.gotoFrame(currFrame+(frames?frames:1));\r\n        return this;\r\n    },\r\n    \r\n    // @method nextTime(secs?: Number): this\r\n    // =1\r\n    nextTime: function(secs) {\r\n        var currTime = this._mcInst.getCurrTickTime();\r\n        this._mcInst.gotoTime(currTime+(secs?secs:1));\r\n        return this;\r\n    },\r\n    \r\n    // @method prevFrame(frames?: Number): this\r\n    // =1\r\n    prevFrame: function(frames) {\r\n        var currFrame = this._mcInst.getCurrFrameNo();\r\n        this._mcInst.gotoFrame(currFrame-(frames?frames:1));\r\n        return this;\r\n    },  \r\n    \r\n    // @method prevTime(secs?: Number): this\r\n    // =1\r\n    prevTime: function(secs) {\r\n        var currTime = this._mcInst.getCurrTickTime();\r\n        this._mcInst.gotoTime(currTime-(secs?secs:1));\r\n        return this;\r\n    },\r\n    \r\n    // @method getFPS(): Number\r\n    // \r\n    getFPS: function( ) {\r\n        return this._mc.getFPS();\r\n    },\r\n    \r\n    // @method changePlaySpeed(fps: Number): this\r\n    // \r\n\tchangePlaySpeed: function(fps) {\r\n\t\tvar currFrame = this._mcInst.getCurrFrameNo();\r\n\t\tthis._mc.get().setFPS(fps);\r\n\t\tthis._mcInst.gotoFrame(currFrame);\r\n\t\treturn this;\r\n\t},\r\n       \r\n    // @method onMovieClipInstancePassFrame(keyIndex: Number, fn: Function): this\r\n    // \r\n    onMovieClipInstancePassFrame: function(keyIndex, fn) {\r\n        if (fn && Q3D.Util.isFunction(fn)) {        \r\n            mapObj.attachUIEvent(\"onMovieClipInstancePassFrame\", this._mcInst.getCName()+\"/\"+keyIndex, fn);\r\n            this._mcInst.registerFrameEvent(keyIndex);//\r\n        }        \r\n        return this;\r\n    },\r\n    \r\n    // @method clearMovieClipInstancePassFrame(keyIndex: Number): this\r\n    // \r\n    clearMovieClipInstancePassFrame: function(keyIndex) {\r\n        var mciName = this.getCName();\r\n        if (mapObj._widgetEvents != undefined) {\r\n            var typeListeners = mapObj._widgetEvents[\"onMovieClipInstancePassFrame\"];\r\n            if (typeListeners) {\r\n                for (var i = 0, len = typeListeners.length; i < len; i++) {\r\n                    var keyArr = typeListeners[i].key.split(\"/\");\r\n                    if (keyArr[0] == mciName && keyArr[keyArr.length-1] == keyIndex) {\r\n                        \tthis._mcInst.unregisterFrameEvent(keyIndex);\r\n                        \tmapObj.detachUIEvent(\"onMovieClipInstancePassFrame\", typeListeners[i].key);\r\n                        \tbreak;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    },\r\n    \r\n    // \r\n    _clearMovieClipInstanceOnLastFrame: function(endKey, endFn) {\r\n        this.onMovieClipInstancePassFrame(endKey, function(mci,key){ \r\n            if (endFn && Q3D.Util.isFunction(endFn)) \r\n                endFn(mci, key);\r\n            var mciName = mci.getCName();\r\n            setTimeout(function() {\r\n                mapObj.clearMovieClip(mciName, endKey, false);\r\n            }, 100);\r\n        });\r\n    },\r\n    \r\n    // @method restoreAllNodes(): this\r\n    // \r\n    restoreAllNodes: function() {\r\n        this._mcInst.stop();\r\n        this._mcInst.gotoFrame( 0 );\r\n        this._mcInst.clearAllPlayers();\r\n        //\r\n        var _wm = mapObj._map3d.getWorldManager();\r\n        for (var name in this._nodespos) {\r\n            _wm.getSceneNode(name).setPosition(this._nodespos[name]);\r\n        }\r\n        this._nodespos = {};\r\n        //\r\n        this._nodesmat.forEach( function(name) {   \r\n            var node = _wm.getSceneNode(name);\r\n            if (node.getNodeType() == Q3D.Enums.sceneNodeType.SNODE_Model)\r\n                node.asModel().restoreAloneMaterials();\r\n            else\r\n                node.asVecModel().restoreAloneMaterials();\r\n        } ) ;\r\n        this._nodesmat = [];\r\n        return this;\r\n    },\r\n    \r\n};\r\n\r\n// @factory Q3D.movieClipInstance(mcInstName: String, mcObj: MovieClip): MovieClipInstance\r\n// \r\nQ3D.movieClipInstance = function (mcInstName, mcObj) {\t  \r\n    return new Q3D.MovieClipInstance(mcInstName, mcObj);\r\n};","/* @class NodeContainer\r\n * @aka Q3D.NodeContainer\r\n *\r\n * \r\n *\r\n * @example\r\n *\r\n * ```\r\n * var ncAlpha = Q3D.nodeContainer(\"nc_alpha\");\r\n * ```\r\n *\r\n */\r\nQ3D.NodeContainer = function (ncName) {    \r\n    if (!mapObj) {\r\n        throw new Error('');\r\n    }          \r\n\r\n    var _wm = mapObj._map3d.getWorldManager();\r\n    this._nc = _wm.getContainer(ncName);\r\n    if (this._nc == null) {\r\n        this._nc = _wm.createContainer(ncName);// \r\n        //this._ncName = ncName;//\r\n    }             \r\n    this._targetVal = null;\r\n    this._ncType = null;//\r\n};\r\n\r\nQ3D.NodeContainer.prototype = {\r\n    \r\n    // @method get(): QSceneContentContainer \r\n    //  QSceneContentContainer     \r\n    get: function() {\r\n        return this._nc ;\r\n    },\r\n    \r\n    //\r\n    _doAction: function(setFlag, matType) {\r\n        if (matType != undefined)\r\n            this._nc.setMaterialModifyMode (matType);\r\n        if (this._ncType == Q3D.Enums.nodeContainerType.Alpha){\r\n            if (setFlag) this._nc.setMaterialAlpha(this._targetVal);\r\n            else this._nc.restoreAllMaterials();\r\n        }\r\n        else if (this._ncType == Q3D.Enums.nodeContainerType.Color) {\r\n            if (setFlag) this._nc.setMaterialColor(this._targetVal.get());\r\n            else this._nc.restoreAllMaterials();\r\n        }\r\n        else if (this._ncType == Q3D.Enums.nodeContainerType.Visible) {\r\n            if (setFlag) this._nc.setNodeVisible(this._targetVal); \r\n            else this._nc.restoreAllNodeProperties();\r\n        } else if (this._ncType == Q3D.Enums.nodeContainerType.Material) {\r\n            if (setFlag) this._nc.setNodeReplaceMaterial(this._targetVal); \r\n            else this._nc.restoreAllNodeProperties();\r\n        } else {\r\n \r\n        }         \r\n    },\r\n    \r\n    // @method setTargetVal(ncType: Number, val: Number, matMode?: Number): this  \r\n    // 0~1.00-;1-ColourValue\r\n    setTargetVal: function(ncType, val, matMode) {\r\n        this._ncType = ncType;\r\n        this._targetVal = val;\r\n        this._doAction(true, matMode);\r\n        return this;\r\n    },\r\n    // @method addSceneNode(nodePath: String): this  \r\n    //  setTargetVal\r\n    addSceneNode: function(nodePath) {\r\n        this._nc.addSceneNode(nodePath);\r\n        return this;\r\n    },\r\n \r\n\t// @method addSceneNodeFromLayer(layerName: String): this  \r\n    //  setTargetVal\r\n    addSceneNodeFromLayer: function(layerName) {\r\n        this._nc.addSceneNodeFromLayer(layerName);\r\n        return this;\r\n    },\r\n\t\r\n    // @method addSceneNodeFromArea(areaName: String): this  \r\n    //  setTargetVal\r\n    addSceneNodeFromArea: function(areaName) {\r\n        this._nc.addSceneNodeFromArea(areaName);\r\n        return this;\r\n    },\r\n    \r\n    // @method loadFromFile(condFile: String, asyn: boolean): this  \r\n    //  setTargetVal\r\n    loadFromFile: function(condFile, asyn) {\r\n        this._nc.loadFromFile(condFile, asyc ? 1 : 0);\r\n        return this;\r\n    },\r\n    \r\n    // @method removeSceneNode(nodePath: String): this  \r\n    // \r\n    removeSceneNode: function(nodePath) {\r\n        this._nc.removeSceneNode(nodePath);\r\n        return this;\r\n    },\r\n    \r\n    // @method clear(): this  \r\n    // \r\n    clear: function() {\r\n        this._nc.clear();//setTargetVal\r\n        return this;\r\n    },\r\n    // @method restore(): this  \r\n    //         \r\n    restore: function() {\r\n        //this._doAction(false);//setTargetVal\r\n        this._nc.restoreAllMaterials();\r\n\t\tthis._nc.restoreAllNodeProperties();\r\n        return this;\r\n    },       \r\n};\r\n\r\n// @factory Q3D.nodeContainer(ncName: String): NodeContainer\r\n// \r\nQ3D.nodeContainer = function (ncName) {\r\n    return new Q3D.NodeContainer(ncName);\r\n};\r\n","// @namespace Map\r\n// @section \r\nQ3D.Map.include({\r\n    // @method cameraRoamByFile(areaName: String, aniFile: String, startPosition: Vector3, startOrientation: Vector3): QLocalCamera \r\n    //   QLocalCamera \r\n    cameraRoamByFile: function(areaName, aniFile, startPosition, startOrientation) {\r\n        var _lcName = \"TestLocalCamera_\" + mapObj.guid();\r\n        var _nodeCreated = this.createCommonNode(areaName+\"/\"+_lcName, Q3D.Enums.sceneNodeType.SNODE_LocalCamera);\r\n        \r\n        startPosition = startPosition || Q3D.vector3d(Q3D.globalCamera().getAbsPos());\r\n        startOrientation = startOrientation || Q3D.vector3(Q3D.globalCamera().getOrientation());\r\n        _nodeCreated.setPosition(startPosition.get());\r\n\t\t_nodeCreated.setOrientation(startOrientation.get(), Q3D.Enums.nodeOrientationType.World);\r\n        \r\n        if (_nodeCreated != null) {\r\n            //\r\n            var _gc = Q3D.globalCamera();\r\n            mapObj._gcAbsPos = Q3D.vector3d(_gc.getAbsPos());\r\n            mapObj._gcOrientation = Q3D.vector3(_gc.getOrientation());\r\n            mapObj._localCamera = _nodeCreated.asCamera().asLocalCamera();\r\n            mapObj._localCamera.setNodeAnimationName(aniFile);\r\n            mapObj._localCamera.enableBind(1);\r\n            \r\n            var _aniState = _nodeCreated.getNodeAnimationState();\r\n            if (_aniState == null) return;            \r\n            _aniState.setLoop(0);\r\n            _aniState.setAutoPlay(1);\r\n            mapObj._map3d.setOnAnimationEndListener(_aniState);\r\n            mapObj.off(\"onCameraFlyToEnd\");\r\n            mapObj.on(\"onAnimationEnd\", function(aniState) { \r\n                mapObj._localCamera.enableBind(0);\r\n                Q3D.globalCamera().flyTo(mapObj._gcAbsPos, mapObj._gcOrientation, 0.5);   \r\n                setTimeout(function() {\r\n\t\t\t\t\tmapObj._localCamera.getArea().destroySceneNode(mapObj._localCamera.getName());\r\n\t\t\t\t\tmapObj._localCamera = null;\t\t\t\t\t\t\r\n\t\t\t\t\tmapObj.off(\"onAnimationEnd\");\t\t\t\t\t\t\r\n\t\t\t\t}, 100);\t\t\t\r\n            });\r\n            _aniState.play();   \r\n            return  mapObj._localCamera;\r\n        }       \r\n    },\r\n    \r\n    // @method stopCameraRoam(): this \r\n    // \r\n    stopCameraRoam: function() {\r\n        if (mapObj._localCamera) {\r\n            mapObj._localCamera.getNodeAnimationState().stop();\r\n            mapObj._localCamera.enableBind(0);\r\n            Q3D.globalCamera().flyTo(mapObj._gcAbsPos, mapObj._gcOrientation, 0.5);\r\n            mapObj.off(\"onAnimationEnd\");\r\n\t\t\tmapObj._localCamera.getArea().destroySceneNode(mapObj._localCamera.getName());\r\n\t\t\tmapObj._localCamera\t= null;\t\t\r\n        }\r\n        return this;\r\n    },\r\n    \r\n     // @method cameraRoamByMovieClipFile(areaName: String, mcFile: String, actorName: String): MovieClipInstance \r\n    //   MovieClipInstance \r\n    cameraRoamByMovieClipFile: function(areaName, mcFile, actorName) {\r\n                \r\n        var fps = 50,\r\n\t\t\t\tmcName = actorName + \"_mc\",\r\n\t\t\t\tmcInstName = actorName + \"_mci\";\r\n\t\tthis.clearMovieClip(mcInstName);\r\n        \r\n        var _wm = mapDiv.getOcx().getWorldManager();\r\n        _wm.loadMovieClip(mcFile,0);\r\n        var _mc = Q3D.movieClip(mcName,fps);\r\n        var _mcInst = Q3D.movieClipInstance(mcInstName, _mc);\r\n        \r\n        var _actor = _mc.get().getIActor(actorName);\r\n        var startPos = _actor.getITrack(\"0\").asKeyTrack().getIKey(0).getKeyIPointAsQVector3();\r\n        var startOri = _actor.getITrack(\"1\").asKeyTrack().getIKey(0).getKeyIPointAsQVector3();       \r\n        \r\n         //         \r\n        var _lcName = \"_LocalCamera_RoamByCamera_\";\r\n        var _nodeCreated  = mapDiv.getSceneNode(areaName+\"/\"+_lcName);\r\n        if (!_nodeCreated) {\r\n            _nodeCreated = mapDiv.createCommonNode(areaName+\"/\"+_lcName, Q3D.Enums.sceneNodeType.SNODE_LocalCamera);      \r\n            //\r\n            var _gc = Q3D.globalCamera();\r\n            mapObj._gcAbsPos = Q3D.vector3d(_gc.getAbsPos());\r\n            mapObj._gcOrientation = Q3D.vector3(_gc.getOrientation());\r\n            mapObj._localCamera = _nodeCreated.asCamera().asLocalCamera();\r\n        }            \r\n        _nodeCreated.setPosition(startPos);\r\n        _nodeCreated.setOrientation(startOri, Q3D.Enums.nodeOrientationType.World);\r\n        _mcInst.setTransformPlayer(actorName, _nodeCreated);      \r\n        _nodeCreated.asCamera().asLocalCamera().enableBind(1);\r\n        \r\n        _mcInst._clearMovieClipInstanceOnLastFrame(_mc.getTotalFrameLength(),function(){\r\n            mapObj._localCamera.enableBind(0);\r\n            Q3D.globalCamera().flyTo(mapObj._gcAbsPos, mapObj._gcOrientation, 0.5);   \r\n            setTimeout(function() {\r\n\t\t\t\tmapObj._localCamera.getArea().destroySceneNode(mapObj._localCamera.getName());\r\n\t\t\t\tmapObj._localCamera = null;\t\t\t\t\t\t\t\t\t\r\n\t\t\t}, 100);\t\t\t\r\n        }); \t\r\n        _mcInst.setPlayOptions(0, false);        \r\n\r\n        return _mcInst;\r\n    },\r\n    \r\n    // @method roamByPolyline(nodePath: String, options: Roam options): MovieClipInstance \r\n    // \r\n    roamByPolyline: function(nodePath, options) {\r\n        var defaultOptions = {            \r\n            CenterLine: [], //Vector3\r\n            OffsetDist: [],//\r\n            TotalTime: 5,//\r\n            DelayTime: 0, //\r\n            //startFrame: 0,//\r\n            IsLoop: false,//\r\n            IsAutoPlay: false, //\r\n            IsEndDestroy: true, //\r\n\t\t\tPitchAllowed: true, //\r\n\t\t\tOnAnimationEndFn: null, //\r\n        }\r\n        Q3D.extend(defaultOptions,options);\r\n        try {                  \r\n            //\r\n            if (defaultOptions.CenterLine.length < 2 || (defaultOptions.CenterLine.length >= 3 && defaultOptions.CenterLine.length != defaultOptions.OffsetDist.length)) \r\n                return null;\t\t\t\r\n            var node = this.getSceneNode(nodePath);            \r\n            if (node == null) \r\n                return null; \r\n\r\n\t\t\t//\r\n\t\t\tvar _cl = [defaultOptions.CenterLine[0]],\r\n\t\t\t\t_od = [defaultOptions.OffsetDist[0]];\r\n\t\t\tfor(var i = 1; i < defaultOptions.CenterLine.length; ++i) {                \r\n                if (defaultOptions.CenterLine[i].equals(defaultOptions.CenterLine[i - 1]))\r\n                    continue;\r\n\t\t\t\t\r\n\t\t\t\t_cl.push(defaultOptions.CenterLine[i]);\r\n\t\t\t\t_od.push(defaultOptions.OffsetDist[i]);\t\t\r\n\t\t\t}\r\n\r\n\t\t\t//_clForRot\r\n\t\t\tif(!defaultOptions.PitchAllowed) {\r\n\t\t\t\tvar _clForRot = [];\r\n\t\t\t\tfor(var i = 0; i < _cl.length; ++i) {\r\n\t\t\t\t\t_clForRot[i] = Q3D.vector3(_cl[i].x, 0, _cl[i].z);  //_clForRot_cl\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar _clForRot = _cl;  //_clForRot_cl\r\n\t\t\t}\r\n            \r\n            var path = nodePath.split(\"/\"),\r\n                nodeName = path[path.length - 1],\r\n                areaName = path[0];\r\n                \r\n            var fps = 50,\r\n\t\t\t\ttimeForDirAdjustion = 0.5, //\r\n\t\t\t\tmcName = areaName + \"_\" + nodeName + \"_MovieClip_RoamByPolyline\",\r\n\t\t\t\tmcInstName = areaName + \"_\" + nodeName + \"_MovieClipInst_RoamByPolyline\",\r\n\t\t\t\tactorName = areaName + \"_\" + nodeName + \"_Actor_RoamByPolyline\";\r\n\r\n\t\t\tthis.clearMovieClip(mcInstName);\t\t\t\t\r\n\t\t\tvar\t_mc = Q3D.movieClip(mcName, fps), \r\n\t\t\t\t_tt = defaultOptions.TotalTime;\t\r\n\t\t\t\t\r\n            //0.5s0.5s         \r\n            var startFrameBase = parseInt(defaultOptions.DelayTime * fps),\r\n\t\t\t\tstartKey = parseInt(startFrameBase + timeForDirAdjustion * fps),\r\n\t\t\t\tendKey = parseInt((defaultOptions.DelayTime + defaultOptions.TotalTime + timeForDirAdjustion*2 ) * fps);\r\n\t\t\t            \r\n            if (_cl.length == 2) {//                \r\n                var startPt = _cl[0],\r\n\t\t\t\t\tendPt = _cl[1],\r\n\t\t\t\t\tstartPtForRot = _clForRot[0],\r\n\t\t\t\t\tendPtForRot = _clForRot[1];\r\n\t\t\t    var endRot = mapObj._map3d.getMath().directionToEuler(endPtForRot.clone().subtract(startPtForRot).get());\t\r\n                //\r\n                _mc.addActorRotateAnimation(actorName, [\r\n\t\t\t\t\t{Key:startFrameBase, Rotate:Q3D.vector3(node.getOrientation( Q3D.Enums.orientationType.World ))},\r\n                    {Key:startKey, Rotate:Q3D.vector3(endRot)},\r\n                    {Key:endKey, Rotate:Q3D.vector3(endRot)}\r\n\t\t\t\t]);               \r\n                 //                 \r\n                _mc.addActorTranslateAnimation(actorName, [\r\n                    {Key:startFrameBase, Pos:Q3D.vector3(node.getPosition())},\r\n                    {Key:startKey, Pos:startPt},\r\n                    {Key:endKey - fps * timeForDirAdjustion, Pos:endPt},\r\n                    {Key:endKey, Pos:endPt}\r\n                ]);                        \r\n            } \r\n\t\t\telse { //3                \r\n                //\r\n                var sum = 0;\r\n                for (var j = 0; j < _cl.length - 1; j++) {\r\n                    sum +=  _cl[j+1].distanceTo(_cl[j]);\r\n                }\r\n                //KeyPos\r\n                var keyPosTra = [], keyPosRot = [], keyPosCtl = [];\r\n                var currDist = 0, endRot, currKeyIndex;\r\n\t\t\t\tvar startPt, endPt,startPtForRot, endPtForRot; \r\n\t\t\t\tvar prevPt, currPt, nextPt, prevPtForRot, currPtForRot, nextPtForRot, distToPrev, distToNext;\r\n\t\t\t\tvar endRotPrev, endRotNext;\r\n\t\t\t\tvar coeff = Q3D.vector3(1/2, 1/2, 1/2);\r\n                keyPosTra.push({Key:startFrameBase, Pos:Q3D.vector3(node.getPosition())});\r\n                keyPosRot.push({Key:startFrameBase, Rotate:Q3D.vector3(node.getOrientation( Q3D.Enums.orientationType.World ))});\r\n\t\t\t\t//\r\n\t\t\t\tkeyPosTra.push({Key:startKey, Pos:_cl[0]});\t\t\t\t\t\t\r\n\t\t\t\tstartPtForRot = _clForRot[0];\r\n\t\t\t\tendPtForRot = _clForRot[1];\r\n\t\t\t\tendRot = mapObj._map3d.getMath().directionToEuler(endPtForRot.clone().subtract(startPtForRot).get());//startPtendPt\r\n\t\t\t\tkeyPosRot.push({Key:startKey, Rotate:Q3D.vector3(endRot)}); \r\n\t\t\t\t//\r\n                for (var i = 1; i < _cl.length - 1; i++) {                  \r\n\t\t\t\t\tprevPt = _cl[i-1];\r\n\t\t\t\t\tcurrPt = _cl[i];\r\n\t\t\t\t\tnextPt = _cl[i+1];\t\t\t\r\n\t\t\t\t\tprevPtForRot = _clForRot[i-1];\r\n\t\t\t\t\tcurrPtForRot = _clForRot[i];\r\n\t\t\t\t\tnextPtForRot = _clForRot[i+1];\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tdistToPrev = currPt.distanceTo(prevPt); \r\n\t\t\t\t\tdistToNext = nextPt.distanceTo(currPt);\r\n\t\t\t\t\tcurrDist += distToPrev;           \r\n\t\t\t\t\t\r\n\t\t\t\t\tendRotPrev = mapObj._map3d.getMath().directionToEuler(currPtForRot.clone().subtract(prevPtForRot).get());\r\n\t\t\t\t\tendRotNext = mapObj._map3d.getMath().directionToEuler(nextPtForRot.clone().subtract(currPtForRot).get());\r\n\t\t\t\t\tif (_od [i] > 0) { //\r\n\t\t\t\t\t\tvar offsetLen = 3 * _od [i] < distToPrev ?  _od [i] : distToPrev / 3;                        \r\n\t\t\t\t\t\tvar diffVec = prevPt.clone().subtract(currPt).multiply(Q3D.vector3(offsetLen/distToPrev,offsetLen/distToPrev,offsetLen/distToPrev));\r\n\t\t\t\t\t\tvar derivedLeftPt = currPt.clone().add(diffVec);\r\n\t\t\t\t\t\tcurrKeyIndex = parseInt(startKey + (currDist - offsetLen) / sum * fps * _tt);\r\n\t\t\t\t\t\tkeyPosTra.push({Key:currKeyIndex, Pos:derivedLeftPt});                        \r\n\t\t\t\t\t\tkeyPosRot.push({Key:currKeyIndex, Rotate:Q3D.vector3(endRotPrev)});\r\n\t\t\t\t\t\tkeyPosCtl.push({Key:currKeyIndex, Pos:derivedLeftPt.clone().add(currPt).multiply(coeff)});\r\n\t\t\t\t\t\toffsetLen = 3 * _od [i] < distToNext ?  _od [i] : distToNext / 3;\r\n\r\n\t\t\t\t\t\tdiffVec = nextPt.clone().subtract(currPt).multiply(Q3D.vector3(offsetLen/distToNext,offsetLen/distToNext,offsetLen/distToNext));\r\n\t\t\t\t\t\tvar derivedRightPt = currPt.clone().add(diffVec);\r\n\t\t\t\t\t\tcurrKeyIndex = parseInt(startKey + (currDist + offsetLen) / sum * fps * _tt);\r\n\t\t\t\t\t\tkeyPosTra.push({Key:currKeyIndex, Pos:derivedRightPt});\r\n\t\t\t\t\t\tkeyPosRot.push({Key:currKeyIndex, Rotate:Q3D.vector3(endRotNext)});\r\n\t\t\t\t\t\tkeyPosCtl.push({Key:currKeyIndex, Pos:derivedRightPt.clone().add(currPt).multiply(coeff)});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tcurrKeyIndex = parseInt(startKey + currDist / sum * fps * _tt);\r\n\t\t\t\t\t\tkeyPosTra.push({Key:currKeyIndex, Pos:currPt});\r\n\t\t\t\t\t\tkeyPosRot.push({Key:currKeyIndex, Rotate:Q3D.vector3(endRotNext)});\r\n\t\t\t\t\t}\r\n                }   \r\n\t\t\t\t//\r\n\t\t\t\tcurrKeyIndex = parseInt(startKey + fps * _tt);\r\n\t\t\t\tkeyPosTra.push({Key:currKeyIndex, Pos:_cl[i]});\r\n\t\t\t\tkeyPosTra.push({Key:endKey, Pos:_cl[i]});\t\t\t\t\t\t\r\n\t\t\t\tstartPtForRot = _clForRot[i-1];\r\n\t\t\t\tendPtForRot = _clForRot[i];\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \r\n\t\t\t\tendRot = mapObj._map3d.getMath().directionToEuler(endPtForRot.clone().subtract(startPtForRot).get());     \t\t\t\t\t\t\r\n\t\t\t\tkeyPosRot.push({Key:currKeyIndex, Rotate:Q3D.vector3(endRot)}); \r\n\t\t\t\tkeyPosRot.push({Key:endKey, Rotate:Q3D.vector3(endRot)}); \t\t\t\t\r\n                //                 \r\n                _mc.addActorTranslateAnimation(actorName, keyPosTra);   \r\n                \r\n                //\r\n                for (var k = 0; k < keyPosCtl.length; ) {\r\n                    _mc.addActorTrackControlPoint(actorName, keyPosCtl[k].Key, keyPosCtl[k].Pos, true);//\r\n                    _mc.addActorTrackControlPoint(actorName, keyPosCtl[k+1].Key, keyPosCtl[k+1].Pos, false);   \r\n                    k += 2;\r\n                }\r\n                //\r\n                _mc.addActorRotateAnimation(actorName, keyPosRot);                      \r\n            }          \r\n            var _mcInst = Q3D.movieClipInstance(mcInstName, _mc);\r\n            _mcInst.setTransformPlayer(actorName, node);       \r\n            _mcInst.setPlayOptions(0, defaultOptions.IsLoop);  \r\n\t\t\r\n            if (defaultOptions.IsEndDestroy) { //\r\n\t\t\t\t_mcInst._clearMovieClipInstanceOnLastFrame(endKey,defaultOptions.OnAnimationEndFn); \t\t\r\n            }\r\n            \r\n            if (defaultOptions.IsAutoPlay)\r\n                _mcInst.play();\r\n            \r\n            return _mcInst;\r\n\r\n        } catch (e) {\r\n            this.showNotice(\"\", \"roamByPolyline: \" + e.message);\r\n            return null;\r\n        }\r\n        return null;\r\n    },  \r\n    \r\n\t// @method roamByGPSTrack(nodePath: String, options: Track options): MovieClipInstance \r\n    // GPS\r\n    roamByGPSTrack: function(nodePath, options) {\r\n        var defaultOptions = {            \r\n            CenterLine: [], //GlobalVec3dVector3\r\n            SecsFromStart: [], //\r\n            Heading: null,//\r\n            TotalTime: 5,//\r\n            IsLoop: false,//\r\n            IsAutoPlay: false, //\r\n            IsEndDestroy: true, //\r\n\t\t\tPitchAllowed: true, //\r\n            BaseGlobalPos: null, //, GlobalVec3d, GlobalVec3d\r\n\t\t\tOnAnimationEndFn: null, //\r\n        }\r\n        Q3D.extend(defaultOptions,options);\r\n        try {          \r\n            var _cltemp = defaultOptions.CenterLine,\r\n                _ss = defaultOptions.SecsFromStart,\r\n                _hd = defaultOptions.Heading,\r\n\t\t\t    _tt = defaultOptions.TotalTime;\t\t\t        \r\n            //\r\n            if (_cltemp.length < 2 || (_cltemp.length >= 3 && _cltemp.length != _ss.length) || (_hd != null && _hd.length != _cltemp.length)) \r\n                return null;\t\t\r\n            \r\n            var node = this.getSceneNode(nodePath);            \r\n            if (node == null) \r\n                return null;          \r\n            \r\n            var path = nodePath.split(\"/\"),\r\n                nodeName = path[path.length - 1],\r\n                areaName = path[0];\r\n            \r\n\t\t\tif(Q3D.Util.isQMapObj(_cltemp[0].get(),Q3D.Enums.ValueTypeCLSID.QGlobalVec3d)) {\r\n\t\t\t\t//\r\n\t\t\t\tvar basePosV3 = Q3D.vector3(0, 0, 0);\r\n\t\t\t\tif(defaultOptions.BaseGlobalPos) {\r\n\t\t\t\t   basePosV3 = Q3D.vector3(BaseGlobalPos.toLocalPos(areaName));\r\n\t\t\t\t}            \r\n\t\t\t\t\r\n\t\t\t\t//QGlobalVec3dQVector3\r\n\t\t\t\tvar _cl = [];\r\n\t\t\t\tfor(var i = 0; i < _cltemp.length; ++i) {\r\n\t\t\t\t\tvar v3 = Q3D.vector3(_cltemp[i].toLocalPos(areaName));\t\t\t\t\t\r\n\t\t\t\t\t_cl.push(v3.subtract(basePosV3));\r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\t\t\telse {\t//QVector3\r\n\t\t\t\tvar _cl = _cltemp;\r\n\t\t\t}\t\t\r\n            \r\n\t\t\t//_clForRot\r\n\t\t\tif(!defaultOptions.PitchAllowed) {\r\n\t\t\t\tvar _clForRot = [];\r\n\t\t\t\tfor(var i = 0; i < _cl.length; ++i) {\r\n\t\t\t\t\t_clForRot[i] = Q3D.vector3(_cl[i].x, 0, _cl[i].z);  //_clForRot_cl\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar _clForRot = _cl;  //_clForRot_cl\r\n\t\t\t}            \r\n            \r\n\t\t\t//\t\t\r\n            var fps = 50,\r\n\t\t\t\ttimeForDirAdjustion = 0.02,\t//\r\n                scale = _tt / _ss[_ss.length - 1], \r\n\t\t\t\tmcName = areaName + \"_\" + nodeName + \"_MovieClip_RoamByGPSTrack\",\r\n\t\t\t\tmcInstName = areaName + \"_\" + nodeName + \"_MovieClipInst_RoamByGPSTrack\",\r\n\t\t\t\tactorName = areaName + \"_\" + nodeName + \"_Actor_RoamByGPSTrack\";\r\n\t\t\t\t\r\n\t\t\tthis.clearMovieClip(mcInstName);\r\n\t\t\tvar\t_mc = Q3D.movieClip(mcName, fps);             \r\n            var keyPosTra = [], keyPosRot = [];\r\n            var  startPtForRot, endPtForRot, endRot;\r\n            if (_hd == null) {\r\n                //\r\n                for (var i = 0; i < _cl.length - 1; i++) {\r\n                    //\r\n                    keyPosTra.push({Key:parseInt(_ss[i] * fps * scale), Pos:_cl[i]});  \r\n                    keyPosTra.push({Key:parseInt((_ss[i] + timeForDirAdjustion) * fps * scale), Pos:_cl[i]});\r\n                    //\r\n                    keyPosRot.push({Key:parseInt(_ss[i] * fps * scale), Rotate: keyPosRot.length == 0 ? Q3D.vector3(node.getOrientation( Q3D.Enums.orientationType.World )) : keyPosRot[keyPosRot.length-1].Rotate});\r\n                    startPtForRot = _clForRot[i];\r\n                    endPtForRot = _clForRot[i+1];\r\n\t\t\t\t\t//startPtendPt\r\n\t\t\t\t\tvar dirV3 = endPtForRot.clone().subtract(startPtForRot);\r\n                    endRot = (Math.abs(dirV3.x) < 1.0E-9 && Math.abs(dirV3.y) < 1.0E-9 && Math.abs(dirV3.z) < 1.0E-9)? keyPosRot[keyPosRot.length-1].Rotate : Q3D.vector3(mapObj._map3d.getMath().directionToEuler(dirV3.get()));//startPtendPt\t\t\t\t\t\r\n                    keyPosRot.push({Key:parseInt((_ss[i] + timeForDirAdjustion) * fps * scale), Rotate:endRot}); \r\n                }\r\n                //\r\n                keyPosTra.push({Key:parseInt(_tt * fps), Pos:_cl[_cl.length - 1]});  \r\n                keyPosRot.push({Key:parseInt(_tt * fps), Rotate:endRot}); \r\n            } else {\r\n                //\r\n                node.setOrientation(Q3D.vector3(0,_hd[0],0).get(),Q3D.Enums.orientationType.World);\r\n                keyPosTra.push({Key:parseInt(_ss[0] * fps * scale), Pos:_cl[0]});\r\n                keyPosRot.push({Key:parseInt(_ss[0] * fps * scale), Rotate:Q3D.vector3(0,_hd[0],0)});\r\n                //\r\n                for (var i = 1; i < _cl.length; i++) {\r\n                    //\r\n                    keyPosTra.push({Key:parseInt((_ss[i] - timeForDirAdjustion) * fps * scale) , Pos:_cl[i]});\r\n                    keyPosTra.push({Key:parseInt(_ss[i] * fps * scale), Pos:_cl[i]});                      \r\n                    //\r\n                    keyPosRot.push({Key:parseInt((_ss[i] - timeForDirAdjustion) * fps * scale), Rotate:keyPosRot[keyPosRot.length-1].Rotate});\r\n                    keyPosRot.push({Key:parseInt(_ss[i] * fps * scale), Rotate:Q3D.vector3(0,_hd[i],0)}); \r\n                }\r\n            }\r\n            \r\n            //                 \r\n            _mc.addActorTranslateAnimation(actorName, keyPosTra);\r\n            //\r\n            _mc.addActorRotateAnimation(actorName, keyPosRot);\r\n            \r\n            var _mcInst = Q3D.movieClipInstance(mcInstName, _mc);\r\n            _mcInst.setTransformPlayer(actorName, node);       \r\n            _mcInst.setPlayOptions(0, defaultOptions.IsLoop);  \r\n\t\t\r\n            if (defaultOptions.IsEndDestroy) { //\r\n\t\t\t\t_mcInst._clearMovieClipInstanceOnLastFrame(parseInt(_tt * fps),defaultOptions.OnAnimationEndFn); \t\t\r\n            }\r\n            if (defaultOptions.IsAutoPlay)\r\n                _mcInst.play();\r\n            return _mcInst;           \r\n        } catch (e) {\r\n            this.showNotice(\"\", \"roamByGPSTrack: \" + e.message);\r\n            return null;\r\n        }\r\n        return null;\r\n    },\r\n    \r\n    // @method clearMovieClip(mciName: String, keyToStop?: Number, saveMC?: Boolean): this\r\n    // \r\n    clearMovieClip: function(mciName, keyToStop, saveMC) {\r\n        var _mci = mapObj._map3d.getWorldManager().getMovieClipInstance(mciName);\r\n        if (_mci == null) return null;\r\n        \r\n        _mci.stop();\r\n        _mci.gotoFrame(keyToStop || 0);\r\n\t\t        \r\n        if (this._widgetEvents != undefined) {\r\n            var typeListeners = mapObj._widgetEvents[\"onMovieClipInstancePassFrame\"];\r\n            if (typeListeners) {\r\n                for (var i = 0, len = typeListeners.length; i < len; ) {\r\n                    var keyArr = typeListeners[i].key.split(\"/\");\r\n                    if (keyArr[0] == mciName) {\r\n                        _mci.unregisterFrameEvent(keyArr[keyArr.length-1]);\r\n                        mapObj.detachUIEvent(\"onMovieClipInstancePassFrame\", typeListeners[i].key);\r\n                        len = len - 1;\r\n                        continue;\r\n                    }\r\n                    ++i;\r\n                }\r\n            }\r\n        }\r\n        \r\n        var saveMC = saveMC || false;\r\n        if (!saveMC) {\r\n        \tvar _mcName = _mci.getMovieClipCName();\r\n        \tmapObj._map3d.getWorldManager().destroyMovieClip(_mcName);\r\n        }\r\n        mapObj._map3d.getWorldManager().destroyMovieClipInstance(mciName);\r\n        return this;\r\n        \r\n    },\r\n\t\r\n\t// @method createRoamRoute(nodePath: String, options: RoamRoute options): QLineNode\r\n    //  QLineNode \r\n\tcreateRoamRoute: function(nodePath, options) {\t\r\n\t\tvar defaultCreateOption = {            \r\n            Material: null,\r\n            SpecialTransparent: true, //\r\n            LinePoints: [], //,Vector3\r\n\t\t\tOffsetDist: [],//\r\n            LineOptions: {\r\n                Subdivision: 20, //\r\n                LineWidth: 2,\r\n                WrapLen: 2,\r\n                //\r\n                Color: Q3D.colourValue(\"#0000FF\", 1), //\r\n                Alpha: 1, //\r\n            },\r\n            OnLineCreated: null\r\n        };\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\t\t\t\r\n\t\t        \r\n        //\r\n        if (defaultCreateOption.LinePoints.length < 2 || (defaultCreateOption.LinePoints.length >= 3 && defaultCreateOption.LinePoints.length != defaultCreateOption.OffsetDist.length)) {\r\n            return null;\t\r\n\t\t}\t\t\t\t\r\n\t\t//\r\n\t\tvar _lp = [defaultCreateOption.LinePoints[0]],\r\n\t\t\t_od = [defaultCreateOption.OffsetDist[0]];\r\n\t\tfor(var i = 1; i < defaultCreateOption.LinePoints.length; ++i) {\r\n            if (defaultCreateOption.LinePoints[i].equals(defaultCreateOption.LinePoints[i - 1]))\r\n                    continue;\r\n\t\t\t\r\n\t\t\t_lp.push(defaultCreateOption.LinePoints[i]);\r\n\t\t\t_od.push(defaultCreateOption.OffsetDist[i]);\t\t\r\n\t\t}\r\n\t\t\r\n\t\tvar prevPt, nextPt, currPt, derivedLeftPt, derivedRightPt, diffVec;\r\n\t\tvar distToPrev, distToNext, offsetLen;\r\n\t\tvar besselPoints = [];\r\n\t\tvar coeff = Q3D.vector3(1/2, 1/2, 1/2);\r\n\t\t//\r\n\t\t//for\r\n\t\tbesselPoints.push(_lp[0].clone());\r\n\t\tbesselPoints.push(Q3D.vector3(_lp[0].x * 2/3, _lp[0].y * 2/3, _lp[0].z * 2/3));\r\n\t\tbesselPoints.push(Q3D.vector3(_lp[0].x * 1/3, _lp[0].y * 1/3, _lp[0].z * 1/3));\r\n\t\tfor(var i = 1, len = _lp.length; i < len - 1; ++i) {\r\n\t\t\tif(_od[i] > 0) {\r\n\t\t\t\tprevPt = _lp[i-1];//Q3D.vector3(_lp[i-1].x, _lp[i-1].y, _lp[i-1].z);\r\n\t\t\t\tcurrPt = _lp[i];//Q3D.vector3(_lp[i].x, _lp[i].y, _lp[i].z);\r\n\t\t\t\tnextPt = _lp[i+1];//Q3D.vector3(_lp[i+1].x, _lp[i+1].y, _lp[i+1].z);\t\r\n\t\t\t\tdistToPrev = currPt.distanceTo(prevPt); \t\t\t\t\t\t\r\n\t\t\t\toffsetLen = 3 * _od[i] < distToPrev ?  _od[i] : distToPrev / 3;                        \r\n\t\t\t\tdiffVec = prevPt.clone().subtract(currPt).multiply(Q3D.vector3(offsetLen/distToPrev,offsetLen/distToPrev,offsetLen/distToPrev));\r\n\t\t\t\tderivedLeftPt = currPt.clone().add(diffVec);\t\t\t\t\r\n\t\t\t\tdistToNext = nextPt.distanceTo(currPt);\r\n\t\t\t\toffsetLen = 3 * _od[i] < distToNext ?  _od[i] : distToNext / 3;\r\n\t\t\t\tdiffVec = nextPt.clone().subtract(currPt).multiply(Q3D.vector3(offsetLen/distToNext,offsetLen/distToNext,offsetLen/distToNext));\t\t\t\r\n\t\t\t\tderivedRightPt = currPt.clone().add(diffVec);\t\r\n\t\t\t\t\r\n\t\t\t\tvar num = besselPoints.length;\r\n\t\t\t\tbesselPoints[num - 2].add(Q3D.vector3(derivedLeftPt.x * 1/3, derivedLeftPt.y * 1/3, derivedLeftPt.z * 1/3).get());\r\n\t\t\t\tbesselPoints[num - 1].add(Q3D.vector3(derivedLeftPt.x * 2/3, derivedLeftPt.y * 2/3, derivedLeftPt.z * 2/3).get());\t\t\t\t\r\n\t\t\t\tbesselPoints.push(derivedLeftPt);\r\n\t\t\t\tbesselPoints.push(derivedLeftPt.clone().add(currPt).multiply(coeff));\r\n\t\t\t\tbesselPoints.push(derivedRightPt.clone().add(currPt).multiply(coeff));\r\n\t\t\t\tbesselPoints.push(derivedRightPt);\r\n\t\t\t\tbesselPoints.push(Q3D.vector3(derivedRightPt.x * 2/3, derivedRightPt.y * 2/3, derivedRightPt.z * 2/3));\r\n\t\t\t\tbesselPoints.push(Q3D.vector3(derivedRightPt.x * 1/3, derivedRightPt.y * 1/3, derivedRightPt.z * 1/3));\t\t\t\t\t\t\t\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar num = besselPoints.length;\r\n\t\t\t\tbesselPoints[num - 2].add(Q3D.vector3(_lp[i].x * 1/3, _lp[i].y * 1/3, _lp[i].z * 1/3));\r\n\t\t\t\tbesselPoints[num - 1].add(Q3D.vector3(_lp[i].x * 2/3, _lp[i].y * 2/3, _lp[i].z * 2/3));\r\n\t\t\t\tbesselPoints.push(_lp[i].clone());\r\n\t\t\t\tbesselPoints.push(Q3D.vector3(_lp[i].x * 2/3, _lp[i].y * 2/3, _lp[i].z * 2/3));\r\n\t\t\t\tbesselPoints.push(Q3D.vector3(_lp[i].x * 1/3, _lp[i].y * 1/3, _lp[i].z * 1/3));\t\t\t\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar num = besselPoints.length,\r\n\t\t\ti = len - 1;\r\n\t\tbesselPoints[num - 2].add(Q3D.vector3(_lp[i].x * 1/3, _lp[i].y * 1/3, _lp[i].z * 1/3));\r\n\t\tbesselPoints[num - 1].add(Q3D.vector3(_lp[i].x * 2/3, _lp[i].y * 2/3, _lp[i].z * 2/3));\r\n\t\tbesselPoints.push(_lp[i].clone());\t\r\n\t\t//\t\t\r\n\t\tvar createOptions = {            \r\n            Material: defaultCreateOption.Material,\r\n            SpecialTransparent: defaultCreateOption.SpecialTransparent, //\r\n            LinePoints: [besselPoints],\r\n            LineOptions: {\r\n                LineType: Q3D.Enums.lineType.Bessel,\r\n                BesselDim: 3, //\r\n                Subdivision: defaultCreateOption.LineOptions.Subdivision, //\r\n                LineWidth: defaultCreateOption.LineOptions.LineWidth,\r\n                WrapLen: defaultCreateOption.LineOptions.WrapLen,\r\n                //\r\n                Color: defaultCreateOption.LineOptions.Color, //\r\n                Alpha: defaultCreateOption.LineOptions.Alpha, //\r\n            },\r\n            OnLineCreated: defaultCreateOption.OnLineCreated\r\n        }\t\t\t\t\r\n    \r\n\t\treturn this.createPolyLine(nodePath, createOptions);\t\t\r\n    },\r\n\t\r\n\t// @method firstPersonView(nodePath: String, cameraName: String, options: FirstPerson options): QLocalCamera\r\n    // ,  QLocalCamera \r\n\tfirstPersonView: function(nodePath, cameraName, options) {\t\r\n\t\tvar defaultOptions = {\r\n\t\t\tPostion: Q3D.vector3(0, 0, 0),\r\n\t\t\tOrientation: Q3D.vector3(0, 180, 0),\r\n\t\t\tOrientationType: Q3D.Enums.nodeOrientationType.Self,\r\n\t\t};\r\n\t\tQ3D.Util.jQueryExtend(true, defaultOptions, options);\r\n\t\t\r\n\t\tvar node = mapObj.getSceneNode(nodePath);\r\n\t\tif(!node) return null;\r\n        \r\n        var path = nodePath.split(\"/\"),\r\n           nodeName = path[path.length - 1],\r\n           areaName = path[0];        \r\n\t\t\r\n\t\tvar camFullName = areaName + \"/\" + nodeName + \"/\" + cameraName,\r\n\t\t\tlocalCamNode = mapObj.getSceneNode(areaName, cameraName);\r\n\t\tif(!localCamNode) {\r\n\t\t\tlocalCamNode = mapObj.createCommonNode(camFullName, Q3D.Enums.sceneNodeType.SNODE_LocalCamera);\r\n\t\t}\r\n\t\tvar localCam = localCamNode.asCamera().asLocalCamera();\r\n\t\tlocalCam.setPosition(defaultOptions.Postion.get());\r\n\t\tlocalCam.setOrientation(defaultOptions.Orientation.get(), defaultOptions.OrientationType);\r\n\t\t\r\n\t\tvar mainCamera = mapObj.getOcx().getWorldManager().getMainCamera(0);\r\n\t\tlocalCam.bindCamera(mainCamera);\r\n\t\tlocalCam.enableBind(1);\t\r\n\t\treturn localCamNode;\r\n\t},\r\n\t\r\n\t// @method thirdPersonView(areaName: String, cameraName: String): this\r\n    // \r\n\tthirdPersonView: function(areaName, cameraName) {\t\r\n\t\tvar localCamNode = mapObj.getSceneNode(areaName, cameraName);\r\n\t\tif(localCamNode != null) {\r\n\t\t\tlocalCamNode.asCamera().asLocalCamera().unbindCamera();\r\n\t\t\tmapObj.getArea(areaName).destroySceneNode(cameraName);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n    \r\n    // @method startRealTimeTrack(nodePath: String, options: RealTimeTrack options): this\r\n    // \r\n    startRealTimeTrack: function(nodePath, options) {\r\n        var defaultOptions = {            \r\n            TimeDiff: null, //S\r\n            Location: null, //Vector3GlobalVector3d\r\n            Heading: null,//[-180,180]0\r\n            PitchAllowed: true, //            \r\n        }\r\n        Q3D.extend(defaultOptions,options);       \r\n\t\t\r\n        //\r\n        var node = this.getSceneNode(nodePath);\r\n        if (node == null || node.getNodeType() != Q3D.Enums.sceneNodeType.SNODE_Model)\r\n            return null;\r\n        \r\n        var path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];        \r\n\t\t\r\n\t\tvar mcName = areaName + \"_\" + nodeName + \"_MovieClip_RealTimeGPSTrack\",\r\n\t\t\tmcInstName = areaName + \"_\" + nodeName + \"_MovieClipInst_RealTimeGPSTrack\",\r\n\t\t\tactorName = areaName + \"_\" + nodeName + \"_Actor_RealTimeGPSTrack\",\r\n\t\t\tfps = 50,\r\n\t\t\ttimeForDirAdjustion = 0.1,\t//\r\n\t\t\twm = mapObj._map3d.getWorldManager();\t\t\r\n\t\t \r\n\t\t//MovieClip\r\n\t\tvar mc = wm.getMovieClip(mcName);\t\t\r\n\t\tif (!mc) {\r\n\t\t\tmc = wm.createMovieClip(mcName);\r\n\t\t\tmc.setFPS(fps);\r\n\t\t} \r\n\t\t//MovieClipInstance\r\n\t\tvar mcInst = wm.getMovieClipInstance(mcInstName);\r\n\t\tif(!mcInst) {\r\n\t\t\tmcInst = wm.createMovieClipInstance(mcInstName);\r\n\t\t\tmcInst.setMovieClip(mcName);\r\n\t\t\tmapObj._map3d.setMovieClipInstanceEventListener(mcInst);\t//\r\n\t\t}\r\n        \r\n        \r\n        var transKeyTrack = null, \r\n\t\t\trotKeyTrack = null;\r\n\t\t\t\r\n\t\tvar currPos = Q3D.Util.isQMapObj(defaultOptions.Location.get(),Q3D.Enums.ValueTypeCLSID.QVector3) ? defaultOptions.Location : Q3D.vector3(defaultOptions.Location.toLocalPos(areaName));\t\r\n\t\t\r\n        //Actor\t\r\n\t\tvar actor = mc.getIActor(actorName);\r\n        if (actor == null) { //\r\n            mapObj._gTrackInfo = mapObj._gTrackInfo || {};\r\n\t\t\tmapObj._prevDirection = mapObj._prevDirection || {};\t//\r\n            actor = mc.addIActor(actorName);\r\n\t\t\tif(!actor) {\r\n\t\t\t\tthrow new Error(\"Actor\");\r\n\t\t\t}\r\n\t\t\ttransKeyTrack = actor.addITrack(Q3D.Enums.actorTrackType.TransformMove, Q3D.Enums.actorKeyType.KeyAuto).asKeyTrack();\r\n\t\t\trotKeyTrack = actor.addITrack(Q3D.Enums.actorTrackType.TransformRotate, Q3D.Enums.actorKeyType.KeyAuto).asKeyTrack(); \t\r\n            \r\n\t\t\t//key\r\n            var key = transKeyTrack.addIKey(0);\r\n            key.setKeyIPointAsQVector3(currPos.get());                 \r\n            key.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.EaseOut);\r\n            \r\n           \t//key\r\n\t\t\tvar currRot = Q3D.vector3(node.getOrientation(0));\r\n\t\t\tif(defaultOptions.Heading != null) {\r\n\t\t\t\tcurrRot.y = defaultOptions.Heading;\r\n\t\t\t}\r\n            key = rotKeyTrack.addIKey(0);\t\t\t\r\n            key.setKeyIPointAsQVector3(currRot.get());\r\n            key.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Point);    \r\n            //\r\n            mapObj._gTrackInfo[mcName] = [0];\r\n\t\t\t//\r\n\t\t\tmapObj._prevDirection[mcName] = currRot;\r\n\t\t\t//player\r\n\t\t\tmcInst.setPlayer(actorName, Q3D.Enums.playerType.Node, areaName + \"/\" + nodeName);\r\n            mcInst.setLoop(0); \r\n            mcInst.play();               \r\n        } \r\n\t\telse {\r\n            // trackkey\r\n            transKeyTrack = actor.getITrack(Q3D.Enums.actorTrackType.TransformMove).asKeyTrack();\r\n            rotKeyTrack = actor.getITrack(Q3D.Enums.actorTrackType.TransformRotate).asKeyTrack();          \r\n            //key\r\n            var len = mapObj._gTrackInfo[mcName].length;\r\n            var startKeyIndex = mapObj._gTrackInfo[mcName][len - 1],            \r\n\t\t\t\tstartTransKey = transKeyTrack.getIKey(startKeyIndex),            \r\n\t\t\t\tstartPt = startTransKey.getKeyIPointAsQVector3();\r\n\r\n\t\t\tvar\tstartPtForRot = Q3D.vector3(startPt),          \r\n\t\t\t\tendPtForRot = currPos.clone();\t\t\r\n\t\t\t\t\r\n\t\t\tif(!defaultOptions.PitchAllowed) {\r\n\t\t\t\tstartPtForRot.y = 0;\r\n\t\t\t\tendPtForRot.y = 0;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar dirV3 = endPtForRot.clone().subtract(startPtForRot);\r\n\t\t\tvar endRot = (Math.abs(dirV3.x) < 1.0E-9 && Math.abs(dirV3.y) < 1.0E-9 && Math.abs(dirV3.z) < 1.0E-9)? mapObj._prevDirection[mcName] : Q3D.vector3(mapObj._map3d.getMath().directionToEuler(dirV3.get()));//startPtendPt\t\r\n            //      \r\n            if (defaultOptions.TimeDiff * fps > startKeyIndex + timeForDirAdjustion * fps) {                \r\n                var key = null,\r\n\t\t\t\t\tkeyIndex = 0;\r\n\t\t\t\t//key\r\n                if (defaultOptions.Heading == null) {\r\n\t\t\t\t\tkeyIndex = Math.round(startKeyIndex + timeForDirAdjustion * fps);\r\n\t\t\t\t\t//\r\n                    key = transKeyTrack.addIKey(keyIndex);   \r\n                    key.setKeyIPointAsQVector3(startPt);//\t\t\t\t\t\r\n\t\t\t\t\tkey.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\tkey.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\t//\r\n                    key = rotKeyTrack.addIKey(keyIndex);  \r\n                    key.setKeyIPointAsQVector3(endRot.get());\r\n                    key.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear); \r\n                    key.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\t//\r\n\t\t\t\t\tmapObj._gTrackInfo[mcName].push(keyIndex);\r\n                } else {\r\n\t\t\t\t\tkeyIndex = Math.round(defaultOptions.TimeDiff * fps - timeForDirAdjustion * fps);\r\n\t\t\t\t\t//\r\n                    key = transKeyTrack.addIKey(keyIndex);\r\n                    key.setKeyIPointAsQVector3(currPos.get());//\r\n\t\t\t\t\tkey.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\tkey.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\t\t\t\t\t\r\n\t\t\t\t\t//\r\n                    key = rotKeyTrack.addIKey(keyIndex);\r\n\t\t\t\t\tkey.setKeyIPointAsQVector3(mapObj._prevDirection[mcName].get()); \t\t\t\t\t\r\n                    key.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear); \r\n                    key.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\t\t\t\t\t\r\n\t\t\t\t\t//\r\n\t\t\t\t\tmapObj._gTrackInfo[mcName].push(keyIndex);\r\n                }                \r\n\r\n                // key\r\n\t\t\t\t//\r\n\t\t\t\tkeyIndex = Math.round(defaultOptions.TimeDiff * fps);\r\n                key = transKeyTrack.addIKey(keyIndex);\r\n                key.setKeyIPointAsQVector3(currPos.get());\r\n                key.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n                key.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\t\r\n                //\r\n                if (defaultOptions.Heading == null) {\r\n                    key = rotKeyTrack.addIKey(keyIndex);\r\n                    key.setKeyIPointAsQVector3(endRot.get());\r\n                    key.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n                    key.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\t\r\n                } else {\r\n                    key = rotKeyTrack.addIKey(keyIndex);\r\n\t\t\t\t\tendRot = mapObj._prevDirection[mcName];\r\n                    endRot.y = defaultOptions.Heading;\r\n                    key.setKeyIPointAsQVector3(endRot.get());\r\n                    key.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n                    key.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\t\r\n                }\r\n\t\t\t\t//\r\n\t\t\t\tmapObj._gTrackInfo[mcName].push(keyIndex);\r\n\t\t\t\t//\r\n\t\t\t\tmapObj._prevDirection[mcName] = endRot;\t\t\t\t\r\n            }\r\n            \r\n\t\t\t//\r\n\t\t\tvar currFrameNo = mcInst.getCurrFrameNo();\r\n\t\t\tfor(var index = 0, len = mapObj._gTrackInfo[mcName].length; index < len; ++index) {\r\n\t\t\t\tif(mapObj._gTrackInfo[mcName][index]  > currFrameNo) {\r\n\t\t\t\t\tif(index === 0) break;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tfor(var j = 0; j < index - 1; ++j) {\r\n\t\t\t\t\t\tvar keyIndex = mapObj._gTrackInfo[mcName][j];\r\n\t\t\t\t\t\ttransKeyTrack.removeKey(keyIndex);\r\n\t\t\t\t\t\trotKeyTrack.removeKey(keyIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmapObj._gTrackInfo[mcName].splice(0, index - 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}            \r\n            mcInst.play();      \r\n        }\r\n        return this;\r\n    },\r\n    \r\n    // @method startRealTimeTrackEx(nodePath: String, options: RealTimeTrack options): this\r\n    // ,\r\n    startRealTimeTrackEx: function(nodePath, options) {\r\n        var defaultOptions = {            \r\n            TimeDiff: null, //S\r\n            LocationArr: null, //Vector3GlobalVector3d\r\n            Heading: null,//LocationArr[-180,180]0\r\n            PitchAllowed: true, //            \r\n        }\r\n        Q3D.extend(defaultOptions,options);       \r\n\t\t\r\n\t\tif(defaultOptions.Heading != null && defaultOptions.Heading.length != defaultOptions.LocationArr.length) return null;\t\r\n\t\t\r\n        //\r\n        var node = this.getSceneNode(nodePath);\r\n        if (node == null || node.getNodeType() != Q3D.Enums.sceneNodeType.SNODE_Model)\r\n            return null;\r\n        \r\n        var path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];        \r\n\t\t\r\n\t\tvar mcName = areaName + \"_\" + nodeName + \"_MovieClip_RealTimeGPSTrack\",\r\n\t\t\tmcInstName = areaName + \"_\" + nodeName + \"_MovieClipInst_RealTimeGPSTrack\",\r\n\t\t\tactorName = areaName + \"_\" + nodeName + \"_Actor_RealTimeGPSTrack\",\r\n\t\t\tfps = 50,\r\n\t\t\ttimeForDirAdjustion = 0.04,\t//\r\n\t\t\twm = mapObj._map3d.getWorldManager();\t\t\r\n\t\t \r\n\t\t//MovieClip\r\n\t\tvar mc = wm.getMovieClip(mcName);\t\t\r\n\t\tif (!mc) {\r\n\t\t\tmc = wm.createMovieClip(mcName);\r\n\t\t\tmc.setFPS(fps);\r\n\t\t} \r\n\t\t//MovieClipInstance\r\n\t\tvar mcInst = wm.getMovieClipInstance(mcInstName);\r\n\t\tif(!mcInst) {\r\n\t\t\tmcInst = wm.createMovieClipInstance(mcInstName);\r\n\t\t\tmcInst.setMovieClip(mcName);\r\n\t\t\tmapObj._map3d.setMovieClipInstanceEventListener(mcInst);\t//\r\n\t\t}   \r\n        \r\n        var transKeyTrack = null, \r\n\t\t\trotKeyTrack = null;\r\n\r\n        //Actor\t\r\n\t\tvar actor = mc.getIActor(actorName);\r\n        if (actor == null) { //\r\n            mapObj._gTrackInfo = mapObj._gTrackInfo || {};\r\n\t\t\tmapObj._prevDirection = mapObj._prevDirection || {};\t//\r\n            actor = mc.addIActor(actorName);\r\n\t\t\tif(!actor) {\r\n\t\t\t\tthrow new Error(\"Actor\");\r\n\t\t\t}\r\n\t\t\ttransKeyTrack = actor.addITrack(Q3D.Enums.actorTrackType.TransformMove, Q3D.Enums.actorKeyType.KeyAuto).asKeyTrack();\r\n\t\t\trotKeyTrack = actor.addITrack(Q3D.Enums.actorTrackType.TransformRotate, Q3D.Enums.actorKeyType.KeyAuto).asKeyTrack(); \t\r\n\t\t\t\r\n\t\t\tvar currPos = Q3D.Util.isQMapObj(defaultOptions.LocationArr[0].get(),Q3D.Enums.ValueTypeCLSID.QVector3) ? defaultOptions.LocationArr[0] : Q3D.vector3(defaultOptions.LocationArr[0].toLocalPos(areaName));\t\r\n\t\t\t//key\r\n            var key = transKeyTrack.addIKey(0);\r\n            key.setKeyIPointAsQVector3(currPos.get());                 \r\n            key.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.EaseOut);\r\n            \r\n           \t//key\r\n\t\t\tvar currRot = Q3D.vector3(node.getOrientation(0));\r\n\t\t\tif(defaultOptions.Heading != null) {\r\n\t\t\t\tcurrRot.y = defaultOptions.Heading[0];\r\n\t\t\t}\r\n            key = rotKeyTrack.addIKey(0);\t\t\t\r\n            key.setKeyIPointAsQVector3(currRot.get());\r\n            key.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Point);    \r\n            //\r\n            mapObj._gTrackInfo[mcName] = [0];\r\n\t\t\t//\r\n\t\t\tmapObj._prevDirection[mcName] = currRot;\r\n\t\t\t//player\r\n\t\t\tmcInst.setPlayer(actorName, Q3D.Enums.playerType.Node, areaName + \"/\" + nodeName);\r\n            mcInst.setLoop(0); \r\n            mcInst.play();               \r\n        } \r\n\t\telse {\r\n            // trackkey\r\n            transKeyTrack = actor.getITrack(Q3D.Enums.actorTrackType.TransformMove).asKeyTrack();\r\n            rotKeyTrack = actor.getITrack(Q3D.Enums.actorTrackType.TransformRotate).asKeyTrack();          \r\n            //key\r\n            var len = mapObj._gTrackInfo[mcName].length;\r\n            var prevKeyIndex = mapObj._gTrackInfo[mcName][len - 1],            \r\n\t\t\t\tprevTransKey = transKeyTrack.getIKey(prevKeyIndex),            \r\n\t\t\t\tprevPt = prevTransKey.getKeyIPointAsQVector3(),\r\n\t\t\t\tprevPtForRot = Q3D.vector3(prevPt),\r\n\t\t\t\tendKeyIndex = defaultOptions.TimeDiff * fps,\r\n\t\t\t\tdeltaKeyIndex = endKeyIndex - prevKeyIndex;\r\n\t\t\t\t\r\n\t\t\tvar locArr = defaultOptions.LocationArr,\r\n\t\t\t\tlocArrLen = locArr.length;\r\n\t\t\r\n\t\t\t//\r\n\t\t\tvar dists = [locArr[0].distanceTo(prevPt)];\t\r\n\t\t\tvar sum = dists[0];\r\n\t\t\tfor(var i = 0; i < locArrLen - 1; ++i) {\r\n\t\t\t\tdists.push(locArr[i+1].distanceTo(locArr[i]));\r\n\t\t\t\tsum += dists[i+1];\r\n\t\t\t}\r\n\t\r\n\t\t\tfor(var i = 0; i < locArrLen; ++i) {\r\n\t\t\t\tvar currPt = Q3D.Util.isQMapObj(locArr[i].get(),Q3D.Enums.ValueTypeCLSID.QVector3) ? locArr[i] : Q3D.vector3(locArr[i].toLocalPos(areaName));\r\n\t\t\t\tvar currKeyIndex = prevKeyIndex + parseInt(dists[i] / sum * deltaKeyIndex);\r\n\t\t\t\t\r\n\t\t\t\tvar currPtForRot = currPt.clone();\r\n\t\t\t\tif(!defaultOptions.PitchAllowed) {\r\n\t\t\t\t\tprevPtForRot.y = 0;\r\n\t\t\t\t\tcurrPtForRot.y = 0;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar dirV3 = currPtForRot.clone().subtract(prevPtForRot);\r\n\t\t\t\tvar currRot = (Math.abs(dirV3.x) < 1.0E-9 && Math.abs(dirV3.y) < 1.0E-9 && Math.abs(dirV3.z) < 1.0E-9)? mapObj._prevDirection[mcName] : Q3D.vector3(mapObj._map3d.getMath().directionToEuler(dirV3.get()));//startPtendPt\t\r\n\t\t\t\t\r\n\t\t\t\tif (currKeyIndex > prevKeyIndex + timeForDirAdjustion * fps) {                \r\n\t\t\t\t\tvar key = null,\r\n\t\t\t\t\t\tkeyIndex = 0;\r\n\t\t\t\t\t//key\r\n\t\t\t\t\tif (defaultOptions.Heading == null) {\r\n\t\t\t\t\t\tkeyIndex = Math.round(prevKeyIndex + timeForDirAdjustion * fps);\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\tkey = transKeyTrack.addIKey(keyIndex);   \r\n\t\t\t\t\t\tkey.setKeyIPointAsQVector3(prevPt);//\t\t\t\t\t\r\n\t\t\t\t\t\tkey.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\tkey = rotKeyTrack.addIKey(keyIndex);  \r\n\t\t\t\t\t\tkey.setKeyIPointAsQVector3(currRot.get());\r\n\t\t\t\t\t\tkey.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear); \r\n\t\t\t\t\t\tkey.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\tmapObj._gTrackInfo[mcName].push(keyIndex);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tkeyIndex = Math.round(currKeyIndex - timeForDirAdjustion * fps);\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\tkey = transKeyTrack.addIKey(keyIndex);\r\n\t\t\t\t\t\tkey.setKeyIPointAsQVector3(currPt.get());//\r\n\t\t\t\t\t\tkey.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\t\t\t\t\t\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\tkey = rotKeyTrack.addIKey(keyIndex);\r\n\t\t\t\t\t\tkey.setKeyIPointAsQVector3(mapObj._prevDirection[mcName].get()); \t\t\t\t\t\r\n\t\t\t\t\t\tkey.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear); \r\n\t\t\t\t\t\tkey.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\t\t\t\t\t\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\tmapObj._gTrackInfo[mcName].push(keyIndex);\r\n\t\t\t\t\t}                \r\n\r\n\t\t\t\t\t// key\r\n\t\t\t\t\t//\r\n\t\t\t\t\tkey = transKeyTrack.addIKey(currKeyIndex);\r\n\t\t\t\t\tkey.setKeyIPointAsQVector3(currPt.get());\r\n\t\t\t\t\tkey.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\tkey.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\t\r\n\t\t\t\t\t//\r\n\t\t\t\t\tif (defaultOptions.Heading == null) {\r\n\t\t\t\t\t\tkey = rotKeyTrack.addIKey(currKeyIndex);\r\n\t\t\t\t\t\tkey.setKeyIPointAsQVector3(currRot.get());\r\n\t\t\t\t\t\tkey.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tkey = rotKeyTrack.addIKey(currKeyIndex);\r\n\t\t\t\t\t\tcurrRot = mapObj._prevDirection[mcName];\r\n\t\t\t\t\t\tcurrRot.y = defaultOptions.Heading[i];\r\n\t\t\t\t\t\tkey.setKeyIPointAsQVector3(currRot.get());\r\n\t\t\t\t\t\tkey.setLeftTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setRightTimeCtrlType(Q3D.Enums.timeCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setLeftCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\r\n\t\t\t\t\t\tkey.setRightCurveCtrlType(Q3D.Enums.curveCtrlType.Linear);\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//\r\n\t\t\t\t\tmapObj._gTrackInfo[mcName].push(currKeyIndex);\r\n\t\t\t\t\t//\r\n\t\t\t\t\tmapObj._prevDirection[mcName] = currRot;\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\tprevKeyIndex = currKeyIndex;\r\n\t\t\t\tprevPtForRot = currPtForRot;\r\n\t\t\t\tprevPt = currPt.get();\t\t\r\n\t\t\t}\r\n\t\t\t\t\t\t\r\n            //\r\n\t\t\tvar currFrameNo = mcInst.getCurrFrameNo();\r\n\t\t\tfor(var index = 0, len = mapObj._gTrackInfo[mcName].length; index < len; ++index) {\r\n\t\t\t\tif(mapObj._gTrackInfo[mcName][index]  > currFrameNo) {\t\t\t\t\t\r\n\t\t\t\t\tif(index === 0) break;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tfor(var j = 0; j < index - 1; ++j) {\r\n\t\t\t\t\t\tvar keyIndex = mapObj._gTrackInfo[mcName][j];\r\n\t\t\t\t\t\ttransKeyTrack.removeKey(keyIndex);\r\n\t\t\t\t\t\trotKeyTrack.removeKey(keyIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmapObj._gTrackInfo[mcName].splice(0, index - 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\t\t          \r\n            mcInst.play();      \r\n        }\r\n        return this;\r\n    },\r\n    \r\n    // @method stopRealTimeTrack(nodePath: String): this\r\n    // \r\n    stopRealTimeTrack: function(nodePath) {\r\n        var path = nodePath.split(\"/\"),\r\n           nodeName = path[path.length - 1],\r\n           areaName = path[0];\r\n           \r\n        var mcName = areaName + \"_\" + nodeName + \"_MovieClip_RealTimeGPSTrack\",\r\n\t\t\tmcInstName = areaName + \"_\" + nodeName + \"_MovieClipInst_RealTimeGPSTrack\";\r\n\t\t\r\n\t\tif(this.clearMovieClip(mcInstName)) {\r\n\t\t\tdelete mapObj._gTrackInfo[mcName];\r\n\t\t\tdelete mapObj._prevDirection[mcName];\r\n\t\t}        \r\n        return this;\r\n    },\r\n\t\r\n    // @method drawTrackLine(nodePath: String, options?: TrackLine options): this\r\n    // \t\r\n\tdrawTrackLine: function(nodePath, options) {\r\n\t\tvar defaultOptions = {\r\n\t\t\tMaterial: null, //polyline\t\t\r\n\t\t\tColor: Q3D.colourValue(\"#FF0000\", 1), //\r\n\t\t\tAlpha: 1, //\r\n\t\t\tLineWidth: 2, //\r\n\t\t\tWrapLen: 2,\r\n\t\t\tSpecialTransparent: true, //\r\n\t\t\tTimeInterval: 300,\t//\r\n\t\t};\r\n        Q3D.Util.jQueryExtend(true, defaultOptions, options);\r\n\t\t\r\n\t\tvar sNode = mapObj.getSceneNode(nodePath);\r\n\t\tif(!sNode) {\r\n\t\t\treturn null;\r\n\t\t}\r\n        \r\n        var path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];\r\n\t\t\r\n\t\tvar lineNodeName = \"TrackLineOf_\" + areaName + \"_\" + nodeName,\r\n\t\t\tlineNodePath = areaName +\"/\" + lineNodeName;\r\n\t\t\t\r\n\t\t//\r\n\t\tthis.stopAndRemoveTrackLine(nodePath);\r\n\t\t//\r\n\t\tvar lineNodeCreated = this.createCommonNode(lineNodePath, Q3D.Enums.sceneNodeType.SNODE_Line);\r\n\t\tif(!lineNodeCreated) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar lineAppend = lineNodeCreated.asLine();\r\n\t\t//\r\n\t\tif (defaultOptions.Material != null) {\r\n\t\t\tlineAppend.setMaterial(defaultOptions.Material);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar tempMatName = \"defaultMaterialForLine-\" + this.guid(), //\r\n\t\t\t\tmaterial = this._map3d.getResourceManager().getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n\t\t\t\t\r\n\t\t\tif (material == null) {\r\n\t\t\t\tmaterial = this.createSimpleMaterial(tempMatName, {\r\n\t\t\t\t\tAlpha: defaultOptions.Alpha,\r\n\t\t\t\t\tEmissiveColor: defaultOptions.Color,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tmaterial = material.asMaterial();\r\n\t\t\t\tmaterial.setAlpha(defaultOptions.Alpha);\r\n\t\t\t\tmaterial.setEmissiveColor(defaultOptions.Color.get());\r\n\t\t\t}                 \r\n\t\t\tlineAppend.setMaterial(tempMatName);\r\n\t\t}\r\n\t\tvar posV3d = sNode.getAbsPos();\r\n\t\tlineAppend.setAbsPos(posV3d);\r\n\t\t\r\n\t\tvar line = lineAppend.addLine();\r\n\t\tline.setLineType(0);\r\n\t\tline.setLineWidth(defaultOptions.LineWidth);\r\n\t\tline.setWrapLen(defaultOptions.WrapLen);\r\n\t\tline.addPoint(Q3D.vector3(0, 0, 0).get());\r\n\t\t\r\n\t\tthis._timeOutIdForTrackLine = this._timeOutIdForTrackLine || {};\r\n\t\tthis._timeOutIdForTrackLine[lineNodeName] = setTimeout(function(){\r\n\t\t\tif(sNode.getName() === \"\") {\r\n\t\t\t\tclearTimeout(mapObj._timeOutIdForTrackLine[lineNodeName]);\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\tvar currPosV3d = sNode.getAbsPos();\r\n\t\t\tcurrPosV3d.subtract(posV3d);\r\n\t\t\tvar currPosV3 = Q3D.vector3(currPosV3d.x, currPosV3d.y, currPosV3d.z).get();\r\n\t\t\t//\r\n\t\t\tvar count = line.getPointCount();\r\n\t\t\tvar tempV3 = line.getPoint(count - 1);\r\n\t\t\tvar margin = Math.max(Math.abs(currPosV3.x - tempV3.x), Math.abs(currPosV3.y - tempV3.y), Math.abs(currPosV3.z - tempV3.z));\r\n\t\t\tif(margin > 1.0E-9) {\r\n\t\t\t\tline.addPoint(currPosV3);\r\n\t\t\t}\t\r\n\t\t\t\r\n\t\t\tmapObj._timeOutIdForTrackLine[lineNodeName] = setTimeout(arguments.callee, defaultOptions.TimeInterval);\r\n\t\t}, defaultOptions.TimeInterval);\t\r\n\t\t\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method stopDrawingTrackLine(nodePath: String): this\r\n    // \r\n\tstopDrawingTrackLine: function(nodePath) {\r\n        var path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];    \r\n\t\tvar lineNodeName = \"TrackLineOf_\" + areaName + \"_\" + nodeName;\t\t\r\n\t\tif(this._timeOutIdForTrackLine != undefined && this._timeOutIdForTrackLine[lineNodeName] != undefined) {\r\n\t\t\tclearTimeout(this._timeOutIdForTrackLine[lineNodeName]);\r\n\t\t}\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t//@method stopAndRemoveTrackLine(nodePath: String): this\r\n\t//\r\n\tstopAndRemoveTrackLine: function(nodePath) {\r\n        var path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];            \r\n\t\tvar lineNodeName = \"TrackLineOf_\" + areaName + \"_\" + nodeName;\r\n\t\tif(this._timeOutIdForTrackLine != undefined && this._timeOutIdForTrackLine[lineNodeName] != undefined) {\r\n\t\t\tclearTimeout(this._timeOutIdForTrackLine[lineNodeName]);\r\n\t\t\tdelete this._timeOutIdForTrackLine[lineNodeName];\r\n\t\t}\t\t\t\t\r\n\t\tthis.destroySceneNode(areaName, lineNodeName);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// @method drawTrackLineByPipe(nodePath: String, options: TrackPipeLine options): this\r\n    // ()\t\r\n\tdrawTrackLineByPipe: function(nodePath, options) {\r\n\t\tvar defaultOptions = {\r\n\t\t\tMaterial: null, \t//\t\t\r\n\t\t\tColor: Q3D.colourValue(\"#FF0000\", 1),\t//\r\n\t\t\tAlpha: 1, \t\t\t//\r\n\t\t\tOuterRadius: 0.5, \t//\r\n\t\t\tInnerRadius: 0.4,\t//\r\n\t\t\tRadius: 1,\t\t\t//\r\n\t\t\tAngle: 20,\t\t\t//\r\n\t\t\tHeightOffset: 0, \t//\r\n\t\t\tTimeInterval: 500,\t//\r\n\t\t};\r\n        Q3D.Util.jQueryExtend(true, defaultOptions, options);\r\n\t\t\r\n\t\tvar sNode = mapObj.getSceneNode(nodePath);\r\n\t\tif(!sNode) {\r\n\t\t\treturn null;\r\n\t\t}\r\n        var path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];            \r\n\t\t\r\n\t\tvar pipeNodeName = \"TrackLineByPipe_\" + areaName + \"_\" + nodeName,\r\n\t\t\tpipeNodePath = areaName +\"/\" + pipeNodeName;\r\n\t\t\t\r\n\t\t//\r\n\t\tthis.stopAndRemoveTrackLineByPipe(nodePath);\r\n\t\t//\r\n\t\tvar vecNodeCreated = this.createCommonNode(pipeNodePath, Q3D.Enums.sceneNodeType.SNODE_VecModel);\r\n\t\tif(!vecNodeCreated) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar vecNodeAppend = vecNodeCreated.asVecModel(),\r\n\t\t\tvecPipe = vecNodeAppend.createVecModel(Q3D.Enums.vecModelType.QPipe).asPipe();\r\n\t\t\t\r\n\t\t//\t\t\r\n\t\tif (defaultOptions.Material != null) {\r\n\t\t\tif (Q3D.Util.isArray(defaultOptions.Material)) {\r\n\t\t\t\tfor (var i = 0; i <= defaultOptions.Material.length; i++) {\r\n\t\t\t\t\tvecNodeAppend.setMaterial(i, defaultOptions.Material[i]);\r\n\t\t\t\t\tif ( i == 3) break;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvecNodeAppend.setMaterial(0, defaultOptions.Material);\r\n\t\t\t\tvecNodeAppend.setMaterial(1, defaultOptions.Material);\r\n\t\t\t\tvecNodeAppend.setMaterial(2, defaultOptions.Material);\r\n\t\t\t\tvecNodeAppend.setMaterial(3, defaultOptions.Material);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar tempMatName = \"defaultMaterialForPipe-\" + this.guid(); //\r\n\t\t\tvar _res = this._map3d.getResourceManager().getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n\t\t\tif (_res == null) {\r\n\t\t\t\tvar material = this.createSimpleMaterial(tempMatName, {\r\n\t\t\t\t\t\tAlpha: defaultOptions.Alpha,\r\n\t\t\t\t\t\tDiffuseColor: defaultOptions.Color,\r\n\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tvar material = _res.asMaterial();\r\n\t\t\t\tmaterial.setAlpha(defaultOptions.Alpha);\r\n\t\t\t\tmaterial.setEmissiveColor(defaultOptions.Color.get());\r\n\t\t\t}                 \r\n\t\t\tvecNodeAppend.setMaterial(0, tempMatName);\r\n\t\t\tvecNodeAppend.setMaterial(1, tempMatName);\r\n\t\t\tvecNodeAppend.setMaterial(2, tempMatName);\r\n\t\t\tvecNodeAppend.setMaterial(3, tempMatName);\r\n\t\t}\t\t\r\n\t\tvar posV3d = sNode.getAbsPos();\r\n\t\tvecNodeAppend.setAbsPos(posV3d);\r\n\t\t\r\n\t\tvecPipe.setRadiusInner(defaultOptions.InnerRadius);\r\n        vecPipe.setRadiusOuter(defaultOptions.OuterRadius);\r\n\t\tvecPipe.setCrossPieces(24);\t\t//\r\n\t\tvecPipe.addPoint(Q3D.arcVertex(0, 0 + defaultOptions.HeightOffset, 0, defaultOptions.Radius, defaultOptions.Angle).get());\r\n\r\n\t\tthis._timeOutIdForTrackLineByPipe = this._timeOutIdForTrackLineByPipe || {};\r\n\t\tthis._timeOutIdForTrackLineByPipe[pipeNodeName] = setTimeout(function(){\r\n\t\t\tif(sNode.getName() === \"\") {\r\n\t\t\t\tclearTimeout(mapObj._timeOutIdForTrackLineByPipe[pipeNodeName]);\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\tvar currPosV3d = sNode.getAbsPos();\r\n\t\t\tcurrPosV3d.subtract(posV3d);\r\n\t\t\tvar currArcVer = Q3D.arcVertex(currPosV3d.x, currPosV3d.y + defaultOptions.HeightOffset, currPosV3d.z, defaultOptions.Radius, defaultOptions.Angle).get();\r\n\t\t\t//\r\n\t\t\tvar count = vecPipe.getCount(),\r\n\t\t\t\tcurrV3 = currArcVer.getPos(),\r\n\t\t\t\ttempV3 = vecPipe.getPoint(count - 1).getPos();\r\n\t\t\tvar margin = Math.max(Math.abs(currV3.x - tempV3.x), Math.abs(currV3.y - tempV3.y), Math.abs(currV3.z - tempV3.z));\r\n\t\t\tif(margin > 1.0E-9) {\r\n\t\t\t\tvecPipe.addPoint(currArcVer);\r\n\t\t\t}\t\r\n\t\t\t\r\n\t\t\tmapObj._timeOutIdForTrackLineByPipe[pipeNodeName] = setTimeout(arguments.callee, defaultOptions.TimeInterval);\r\n\t\t}, defaultOptions.TimeInterval);\t\r\n\r\n\t\treturn this;\r\n\t},\r\n    \r\n    // @method stopDrawingTrackLineByPipe(nodePath: String): this\r\n    // ()\t\r\n\tstopDrawingTrackLineByPipe: function(nodePath) {\r\n        var path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];        \r\n\t\tvar pipeNodeName = \"TrackLineByPipe_\" + areaName + \"_\" + nodeName;\t\t\r\n\t\tif(this._timeOutIdForTrackLineByPipe != undefined && this._timeOutIdForTrackLineByPipe[pipeNodeName] != undefined) {\r\n\t\t\tclearTimeout(this._timeOutIdForTrackLineByPipe[pipeNodeName]);\r\n\t\t}\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t//@method stopAndRemoveTrackLineByPipe(nodePath: String): this\r\n\t//()\t.\r\n\tstopAndRemoveTrackLineByPipe: function(nodePath) {\r\n        var path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];            \r\n\t\tvar pipeNodeName = \"TrackLineByPipe_\" + areaName + \"_\" + nodeName;\r\n\t\tif(this._timeOutIdForTrackLineByPipe != undefined && this._timeOutIdForTrackLineByPipe[pipeNodeName] != undefined) {\r\n\t\t\tclearTimeout(this._timeOutIdForTrackLineByPipe[pipeNodeName]);\r\n\t\t\tdelete this._timeOutIdForTrackLineByPipe[pipeNodeName];\r\n\t\t}\t\t\t\t\r\n\t\tthis.destroySceneNode(areaName, pipeNodeName);\r\n\t\treturn this;\r\n\t},\r\n    \r\n    // @method drawTrackLineByWall(nodePath: String, options?: TrackWall options): this\r\n    // ()\t\r\n\tdrawTrackLineByWall: function(nodePath, options) {\r\n\t\tvar defaultOptions = {\r\n\t\t\tMaterial: null, \t//50  1  2  3  4 addMaterial \t\t\r\n\t\t\tColor: Q3D.colourValue(\"#FF0000\", 1),\t//\r\n\t\t\tAlpha: 1, \t\t\t//\r\n            IgnoreFloor: true,\r\n            IgnoreCeil: false,\r\n\t\t\tHeight: 0.01,\t\t\t//\r\n            Width: 0.5,\t\t\t//\r\n\t\t\tHeightOffset: 0, \t//\r\n\t\t\tTimeInterval: 500,\t//\r\n\t\t};\r\n        Q3D.Util.jQueryExtend(true, defaultOptions, options);\r\n\t\t\r\n\t\tvar sNode = mapObj.getSceneNode(nodePath);\r\n\t\tif(!sNode) {\r\n\t\t\treturn null;\r\n\t\t}\r\n        \r\n        var path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];  \r\n\t\t\r\n\t\tvar wallNodeName = \"TrackLineByWall_\" + areaName + \"_\" + nodeName,\r\n\t\t\twallNodePath = areaName +\"/\" + wallNodeName;\r\n\t\t\t\r\n\t\t//\r\n\t\tthis.stopAndRemoveTrackLineByWall(nodePath);\r\n\t\t//\r\n\t\tvar vecNodeCreated = this.createCommonNode(wallNodePath, Q3D.Enums.sceneNodeType.SNODE_VecModel);\r\n\t\tif(!vecNodeCreated) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar vecNodeAppend = vecNodeCreated.asVecModel(),\r\n\t\t\tvecWall = vecNodeAppend.createVecModel(Q3D.Enums.vecModelType.QWalls).asWalls();\r\n\t\t\t\r\n\t\t//\t\t\r\n\t\tif (defaultOptions.Material != null) {\r\n\t\t\tif (Q3D.Util.isArray(defaultOptions.Material)) {\r\n\t\t\t\tfor(var i = 0; i <= defaultOptions.Material.length; i++) {\r\n\t\t\t\t\tif (i <= 4) {\r\n\t\t\t\t\t\tvecNodeAppend.setMaterial(i, defaultOptions.Material[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvecNodeAppend.addMaterial(defaultOptions.Material[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\t\t\t\t\r\n\t\t\t\tfor(var i = 0; i < 5; ++i) {\r\n\t\t\t\t\tvecNodeAppend.setMaterial(i, defaultOptions.Material);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar tempMatName = \"defaultMaterialForWalls-\" + this.guid(); //\r\n\t\t\tvar _res = this._map3d.getResourceManager().getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n\t\t\tif (_res == null) {\r\n\t\t\t\tvar material = this.createSimpleMaterial(tempMatName, {\r\n\t\t\t\t\t\tAlpha: defaultOptions.Alpha,\r\n\t\t\t\t\t\tDiffuseColor: defaultOptions.Color,\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar material = _res.asMaterial();\r\n\t\t\t\tmaterial.setAlpha(defaultOptions.Alpha);\r\n\t\t\t\tmaterial.setEmissiveColor(defaultOptions.Color.get());\r\n\t\t\t}  \r\n\r\n\t\t\tfor(var i = 0; i < 5; ++i) {\r\n\t\t\t\tvecNodeAppend.setMaterial(i, tempMatName);\r\n\t\t\t}\t\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tvecWall.setDefaultSize(defaultOptions.Width, defaultOptions.Height);\r\n\t\tif (defaultOptions.IgnoreCeil) {\r\n\t\t\tvecWall.ignoreCeil(1);\r\n\t\t}\r\n\t\tif (defaultOptions.IgnoreFloor) {\r\n\t\t\tvecWall.ignoreFloor(1);\r\n\t\t}\r\n\t\t\r\n\t\tvar posV3d = sNode.getAbsPos();\r\n\t\tvecNodeAppend.setAbsPos(posV3d);\r\n\t\tvecWall.addCorner(0, Q3D.vector3(0, defaultOptions.HeightOffset, 0).get());\r\n\r\n\t\tthis._timeOutIdForTrackLineByWall = this._timeOutIdForTrackLineByWall || {};\r\n\t\tthis._timeOutIdForTrackLineByWall[wallNodeName] = setTimeout(function(){\r\n\t\t\tif(sNode.getName() === \"\") {\r\n\t\t\t\tclearTimeout(mapObj._timeOutIdForTrackLineByWall[wallNodeName]);\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\tvar currPosV3d = sNode.getAbsPos();\r\n\t\t\tcurrPosV3d.subtract(posV3d);\r\n\t\t\tvar currPosV3 = Q3D.vector3(currPosV3d.x, currPosV3d.y + defaultOptions.HeightOffset, currPosV3d.z).get();\r\n\t\t\t//\r\n\t\t\tvar count = vecWall.getCornerCount(),\r\n\t\t\t\tprevCornerID = vecWall.getCornerID(count - 1),\r\n\t\t\t\ttempV3 = vecWall.getCornerPos(prevCornerID);\r\n\t\t\tvar margin = Math.max(Math.abs(currPosV3.x - tempV3.x), Math.abs(currPosV3.y - tempV3.y), Math.abs(currPosV3.z - tempV3.z));\r\n\t\t\tif(margin > 1.0E-9) {\r\n\t\t\t\tvecWall.addCorner(prevCornerID + 1, currPosV3);\r\n\t\t\t\tvecWall.constructWall(count - 1, prevCornerID, prevCornerID + 1);\r\n\t\t\t}\t\r\n\t\t\t\r\n\t\t\tmapObj._timeOutIdForTrackLineByWall[wallNodeName] = setTimeout(arguments.callee, defaultOptions.TimeInterval);\r\n\t\t}, defaultOptions.TimeInterval);\t\r\n\r\n\t\treturn this;\r\n\t},\r\n    \r\n    // @method stopDrawingTrackLineByWall(nodePath: String): this\r\n    // \t\r\n\tstopDrawingTrackLineByWall: function(nodePath) {\r\n\t\tvar path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];     \r\n        var wallNodeName = \"TrackLineByWall_\" + areaName + \"_\" + nodeName;\t\t\r\n\t\tif(this._timeOutIdForTrackLineByWall != undefined && this._timeOutIdForTrackLineByWall[wallNodeName] != undefined) {\r\n\t\t\tclearTimeout(this._timeOutIdForTrackLineByWall[wallNodeName]);\r\n\t\t}\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t//@method stopAndRemoveTrackLineByWall(nodePath: String): this\r\n\t//.\r\n\tstopAndRemoveTrackLineByWall: function(nodePath) {\r\n\t\tvar path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];  \r\n        var wallNodeName = \"TrackLineByWall_\" + areaName + \"_\" + nodeName;\r\n\t\tif(this._timeOutIdForTrackLineByWall != undefined && this._timeOutIdForTrackLineByWall[wallNodeName] != undefined) {\r\n\t\t\tclearTimeout(this._timeOutIdForTrackLineByWall[wallNodeName]);\r\n\t\t\tdelete this._timeOutIdForTrackLineByWall[wallNodeName];\r\n\t\t}\t\t\t\t\r\n\t\tthis.destroySceneNode(areaName, wallNodeName);\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t\t\r\n\t\r\n\t\r\n    // _getRandomNum(min: Number, max: Number): Number\r\n\t//minmax\r\n\t_getRandomNum: function(min, max) {\r\n\t\tvar range = max - min,  \r\n\t\t\trandom = Math.random();     \r\n\t\treturn (min + random * range);\r\n\t},\r\n    \r\n    // _addVehicle(nodePath: String, options: Vehicle options): this\r\n    // this\r\n\t_addVehicle: function(nodePath, options) {\r\n\t\tvar defaultCreateOption = {\r\n            Position: null,   //Vector3\r\n            Orientation: null,   //Vector3\r\n\t\t\tOrientationType: Q3D.Enums.nodeOrientationType.Self,\r\n\t\t\tMesh: null,\r\n\t\t\tRoutePtsV3Array: [],   //Vector3\r\n\t\t\tVelocity: 400/36,   ///\r\n\t\t\tStartTime: 0,   //\r\n\t\t};\r\n\t\tQ3D.Util.jQueryExtend(true, defaultCreateOption, options);\t\t\r\n\t\tvar sNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_Model);\r\n\t\tif(sNodeCreated != null) {\r\n\t\t\tvar modelNode = sNodeCreated.asModel();\r\n\t\t\tif(defaultCreateOption.Position != null) {\t\t\t\r\n\t\t\t\tmodelNode.setPosition(defaultCreateOption.Position.get());\r\n\t\t\t}\r\n\t\t\tif(defaultCreateOption.Orientation != null) {\r\n\t\t\t\tmodelNode.setOrientation(defaultCreateOption.Orientation.get(), defaultCreateOption.OrientationType);\r\n\t\t\t}\r\n\t\t\tif(defaultCreateOption.Mesh  != null) {\r\n\t\t\t\tmodelNode.setMesh(defaultCreateOption.Mesh);\r\n\t\t\t}\r\n\t\t\tvar activeCtrlObj = modelNode.getActiveCtrlObj(),\r\n\t\t\t\tvelMeterPerSec = defaultCreateOption.Velocity;\r\n\t\t\t\t\r\n\t\t\t//var areaName = nodePath.split(\"/\")[0];\r\n\t\t\t\r\n\t\t\tactiveCtrlObj.beginAddKey();\r\n\t\t\tfor(var i = 0; i < defaultCreateOption.RoutePtsV3Array.length; ++i) {\r\n\t\t\t\tif(i == 0) {\t\t\t\t\t\r\n\t\t\t\t\tactiveCtrlObj.addKey(defaultCreateOption.StartTime, defaultCreateOption.RoutePtsV3Array[i].get());\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tactiveCtrlObj.addKeyByVel(velMeterPerSec, defaultCreateOption.RoutePtsV3Array[i].get());\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t\tactiveCtrlObj.endAddKey();\r\n\t\t\tactiveCtrlObj.setLoop(1);\r\n\t\t\tmapObj._map3d.setActiveCtrlObjListener(activeCtrlObj);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this;\r\n\t},  \r\n\t\r\n\t// _getTotalRoadLength(routePtsArray: Array): Number\r\n\t//,Vector3\r\n\t_getTotalRoadLength: function(routePtsArray) {\r\n\t\tvar totalLength = 0;\r\n\t\tfor(var i = 1; i < routePtsArray.length; ++i) {\r\n\t\t\tvar dx = routePtsArray[i].x - routePtsArray[i - 1].x,\r\n\t\t\t\tdy = routePtsArray[i].y - routePtsArray[i - 1].y,\r\n\t\t\t\tdz = routePtsArray[i].z - routePtsArray[i - 1].z;\t\t\t\r\n\t\t\ttotalLength += Math.sqrt(dx * dx + dy * dy + dz * dz);\r\n\t\t}\r\n\t\treturn totalLength;\r\n\t},\r\n\t\r\n\t// @method createOneRoadwayTraffic(roadwayPath: String, options: Roadway options): Number\r\n\t//\r\n\tcreateOneRoadwayTraffic: function(roadwayPath, options) {\r\n\t\tvar defaultOptions = {\r\n\t\t\tVelocity: 40,            \t//,/\r\n\t\t\tRoutePtsGV3d: null,\t\t \t// GlobalVec3d (RoutePtsGV3dRoutePtsV3)\r\n\t\t\tRoutePtsV3: null,\t\t\t//Vector3,RoutePtsGV3d(RoutePtsGV3dRoutePtsV3)\r\n\t\t\tAverageDistance: 5,\t\t \t//\r\n\t\t\tMinDistance: 5,\t\t\t \t//,\r\n\t\t\tVehicleMeshArray: [],    \t//mesh\r\n\t\t\tBaseGlobalPos: null,\t\t//,  GlobalVec3d \r\n            IsLabeled: false, //POI\r\n\t\t};\r\n\t\t\r\n\t\tQ3D.Util.jQueryExtend(true, defaultOptions, options);\r\n\t\t//\r\n\t\tif((!defaultOptions.RoutePtsGV3d && !defaultOptions.RoutePtsV3) || !defaultOptions.VehicleMeshArray.length || !defaultOptions.MinDistance) return null;\r\n        \r\n        var path = roadwayPath.split(\"/\"),\r\n            roadwayName = path[path.length - 1],\r\n            areaName = path[0];        \r\n\t\t\r\n\t\tvar parentNodePath = areaName + \"/\" + roadwayName,\r\n\t\t\tparentNode = mapObj.createCommonNode(parentNodePath, Q3D.Enums.sceneNodeType.SNODE_Group);\t\r\n\t\tif(!parentNode) return null;\r\n\r\n\t\t//Vector3\r\n\t\tif(defaultOptions.RoutePtsV3 != null){\t\r\n\t\t\tvar ptV3Arr = defaultOptions.RoutePtsV3;\r\n\t\t}\t\r\n\t\telse if(defaultOptions.RoutePtsGV3d != null) {\t//\r\n\t\t\tvar basePosV3 = Q3D.vector3(0, 0, 0);\r\n\t\t\tif(!!defaultOptions.BaseGlobalPos) {\r\n\t\t\t\tif (typeof defaultOptions.BaseGlobalPos == \"string\") {\r\n\t\t\t\t\tbasePosV3 = Q3D.vector3(defaultOptions.BaseGlobalPos.toGlobalVec3d().toLocalPos(areaName));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbasePosV3 = Q3D.vector3(defaultOptions.BaseGlobalPos.toLocalPos(areaName));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//Vector3\r\n\t\t\tvar ptsStrArr = null, \r\n\t\t\t\tptV3Arr = [],\r\n\t\t\t\tptV3 = null;\r\n\t\t\tif (typeof defaultOptions.RoutePtsGV3d == \"string\") {\r\n\t\t\t\tptsStrArr = defaultOptions.RoutePtsGV3d.split(\";\");\r\n\t\t\t\tfor(var i = 0; i < ptsStrArr.length; ++i) {\r\n\t\t\t\t\tptV3 = Q3D.vector3(ptsStrArr[i].toGlobalVec3d().toLocalPos(areaName));\r\n\t\t\t\t\tptV3.subtract(basePosV3);\r\n\t\t\t\t\tptV3Arr.push(ptV3);\r\n\t\t\t\t}\t\r\n\t\t\t} else {\r\n\t\t\t\tfor(var i = 0; i < defaultOptions.RoutePtsGV3d.length; ++i) {\r\n\t\t\t\t\tptV3 = Q3D.vector3(defaultOptions.RoutePtsGV3d[i].toLocalPos(areaName));\r\n\t\t\t\t\tptV3.subtract(basePosV3);\r\n\t\t\t\t\tptV3Arr.push(ptV3);\r\n\t\t\t\t}\t\r\n\t\t\t}        \t\t\r\n\t\t}\r\n\t\t\t\t\r\n\t\t//\r\n\t\tvar totalRoadLen = this._getTotalRoadLength(ptV3Arr);\t\r\n\t\tvar averageDistance = defaultOptions.AverageDistance < defaultOptions.MinDistance ? defaultOptions.MinDistance : defaultOptions.AverageDistance;\r\n\t\tvar velocity = defaultOptions.Velocity * 1000 / 3600,\t            \t////\r\n\t\t\tminTimeInterval = defaultOptions.MinDistance / velocity,         \t//\r\n\t\t\taverageTimeInterval = averageDistance / velocity,\t\t\t\t\t//\r\n\t\t\ttotalTime = totalRoadLen / velocity,\t                        \t//,\r\n\t\t\tcurrTime = -minTimeInterval,\r\n\t\t\tminRandom = minTimeInterval,\r\n\t\t\tmaxRandom = averageTimeInterval * 2 - minTimeInterval,\r\n\t\t\tid = 0;\r\n\t\t\r\n\t\twhile(currTime < (totalTime - minRandom)) {\r\n            //if(currTime < (totalTime - minRandom)) {\r\n\t\t\tvar nodePath = parentNodePath + \"/\" + roadwayName + \"Vehicle\" + id;\t\r\n\t\t\tif(currTime > totalTime - minRandom - maxRandom) {\r\n\t\t\t\tcurrTime = totalTime - minRandom;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcurrTime = currTime + this._getRandomNum(minRandom, maxRandom);\r\n\t\t\t}\t\t\t\r\n\t\t\tvar options = {\r\n\t\t\t\tPosition: Q3D.vector3(Q3D.globalVec3d(0, 0, 0).toLocalPos(areaName)),  //\r\n\t\t\t\tOrientation: Q3D.vector3(0, 0, 0),\r\n\t\t\t\tOrientationType: Q3D.Enums.nodeOrientationType.Self,\r\n\t\t\t\tMesh: defaultOptions.VehicleMeshArray[Math.floor(Math.random() * defaultOptions.VehicleMeshArray.length)],\r\n\t\t\t\tRoutePtsV3Array: ptV3Arr,   //QVector3\r\n\t\t\t\tVelocity: velocity,    \t\t///\r\n\t\t\t\tStartTime: currTime, \r\n\t\t\t};\t\t\t\t\t\t\t\r\n\t\t\tthis._addVehicle(nodePath, options);\r\n            if(defaultOptions.IsLabeled) {\r\n                var poiOptions = {\r\n                    POIOptions: {\r\n                        FontName: \"Arial\",\r\n                        FontSize: 16,\r\n                        FontColor: Q3D.colourValue(\"#ff0000\", 1),\r\n                        POILayout: Q3D.Enums.poiLayOut.Left,\r\n                        CharScale: 1,\r\n                        Text: \"Vehicle\" + id,\r\n                        FontOutLine: 1, //\r\n                        FontEdgeColor: Q3D.colourValue(1, 1, 0.5, 1), //\r\n                    }\r\n                };\t\r\n                this.createPOI(areaName + \"/\" + roadwayName + \"Vehicle\" + id + \"/POI_\" + roadwayName + \"_Vehicle_\" + id, poiOptions);\r\n            }\r\n\t\t\t++id;\r\n\t\t}\r\n\t\treturn totalTime;\r\n\t},\r\n\t\r\n\t// @method clearOneRoadwayTraffic(roadwayPath: String): this\r\n\t//\r\n\tclearOneRoadwayTraffic: function(roadwayPath) {\r\n\t\treturn mapObj.destroySceneNode(roadwayPath);\r\n\t},\t\r\n  \r\n\t// @method addVehicleByGPSInfo(nodePath: String, options: Vehicle options): QActiveCtrlObj\r\n    // GPS\r\n\taddVehicleByGPSInfo: function(nodePath, options) {\r\n\t\tvar defaultOptions = {\r\n            Position: null,      //Vector3\r\n            Orientation: null,   //Vector3\r\n\t\t\tOrientationType: Q3D.Enums.nodeOrientationType.Self,\r\n\t\t\tMesh: null,\r\n            MeshType: 1,\t\t// 1: .mesh 2: .lodg\r\n\t\t\tRoutePtsV3Array: [],   //Vector3\r\n\t\t\tSecsFromStart: [],\t  //\r\n\t\t\tOnActCtrlObjAniEnd: null,\t//\t\r\n\t\t};\r\n\t\tQ3D.Util.jQueryExtend(true, defaultOptions, options);\r\n\t\t//\r\n\t\tif(!defaultOptions.RoutePtsV3Array || !defaultOptions.SecsFromStart || defaultOptions.RoutePtsV3Array.length != defaultOptions.SecsFromStart.length) {\t\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\r\n\t\tvar path = nodePath.split(\"/\"),\r\n\t\t\tareaName = path[0],\r\n\t\t\tnodeName = path[path.length - 1],\r\n\t\t\tnodeExist = true;\r\n\t\t\t\r\n\t\tvar sNode = this.getSceneNode(areaName, nodeName);\r\n\t\tif(!sNode) {\t\t\t\r\n\t\t\tsNode = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_Model);\r\n\t\t\tvar modelNode = sNode.asModel();\r\n\t\t\tif(defaultOptions.Position != null) {\t\t\t\r\n\t\t\t\tmodelNode.setPosition(defaultOptions.Position.get());\r\n\t\t\t}\r\n\t\t\tif(defaultOptions.Orientation != null) {\r\n\t\t\t\tmodelNode.setOrientation(defaultOptions.Orientation.get(), defaultOptions.OrientationType);\r\n\t\t\t}\r\n            if(defaultOptions.Mesh != null) {\r\n\t\t\t\tswitch(defaultOptions.MeshType) {\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tmodelNode.setMesh(defaultOptions.Mesh);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tmodelNode.setLodGroup(defaultOptions.Mesh);\r\n\t\t\t\t\t\tmodelNode.loadAllResource();\r\n\t\t\t\t\t\t//modelNode.setCombineType(4);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tnodeExist = false;\r\n\t\t}\r\n\r\n\t\tvar activeCtrlObj = sNode.getActiveCtrlObj();\t\t\t\r\n\t\tactiveCtrlObj.beginAddKey();\r\n\t\tfor(var i = 0; i < defaultOptions.RoutePtsV3Array.length; ++i) {\r\n\t\t\tactiveCtrlObj.addKey(defaultOptions.SecsFromStart[i], defaultOptions.RoutePtsV3Array[i].get());\t\t\t\t\r\n\t\t}\r\n\t\tactiveCtrlObj.endAddKey();\r\n\t\tif(!nodeExist) {\r\n\t\t\tactiveCtrlObj.setMaxKeyframeBufferSize(0);\r\n\t\t\tmapObj._map3d.setActiveCtrlObjListener(activeCtrlObj);\r\n\t\t\tif(defaultOptions.OnActCtrlObjAniEnd && Q3D.Util.isFunction(defaultOptions.OnActCtrlObjAniEnd)) {\r\n\t\t\t\tmapObj.attachUIEvent(\"onActCtrlObjAniEnd\", nodeName, defaultOptions.OnActCtrlObjAniEnd);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn activeCtrlObj;\r\n\t},\r\n\r\n\t\r\n\t// @method addVehicleByGPSInfoEx(nodePath: String, options: VehicleEx options): QActiveCtrlObj\r\n    // GPS\r\n\taddVehicleByGPSInfoEx: function(nodePath, options) {\r\n\t\tvar defaultOptions = {\r\n            Position: null,      //Vector3\r\n            Orientation: null,   //Vector3\r\n\t\t\tOrientationType: Q3D.Enums.nodeOrientationType.Self,\r\n\t\t\tMesh: null,\r\n            MeshType: 1,\t\t// 1: .mesh 2: .lodg\r\n\t\t\tLocInfos: null,   //,[[\"28808\",117.384888,34.138813],[\"28809\",117.384743,34.138821]]\r\n\t\t\tOnActCtrlObjAniEnd: null,\t//\t\r\n\t\t};\r\n\t\tQ3D.Util.jQueryExtend(true, defaultOptions, options);\r\n\t\t//\r\n\t\tif(!defaultOptions.LocInfos || defaultOptions.LocInfos.length == 0) {\t\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\r\n\t\tvar path = nodePath.split(\"/\"),\r\n\t\t\tareaName = path[0],\r\n\t\t\tnodeName = path[path.length - 1],\r\n\t\t\tnodeExist = true;\r\n\t\t\t\r\n\t\tvar sNode = this.getSceneNode(areaName, nodeName);\r\n\t\tif(!sNode) {\t\t\t\r\n\t\t\tsNode = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_Model);\r\n\t\t\tvar modelNode = sNode.asModel();\r\n\t\t\tif(defaultOptions.Position != null) {\t\t\t\r\n\t\t\t\tmodelNode.setPosition(defaultOptions.Position.get());\r\n\t\t\t}\r\n\t\t\tif(defaultOptions.Orientation != null) {\r\n\t\t\t\tmodelNode.setOrientation(defaultOptions.Orientation.get(), defaultOptions.OrientationType);\r\n\t\t\t}\r\n\t\t\tif(defaultOptions.Mesh != null) {\r\n\t\t\t\tswitch(defaultOptions.MeshType) {\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tmodelNode.setMesh(defaultOptions.Mesh);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tmodelNode.setLodGroup(defaultOptions.Mesh);\r\n\t\t\t\t\t\tmodelNode.loadAllResource();\r\n\t\t\t\t\t\t//modelNode.setCombineType(4);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tnodeExist = false;\r\n\t\t}\r\n\r\n\t\tvar activeCtrlObj = sNode.getActiveCtrlObj();\t\t\t\r\n\t\tactiveCtrlObj.beginAddKey();\r\n\t\tfor(var i = 0; i < defaultOptions.LocInfos.length; ++i) {\r\n\t\t\tvar currLocInfo = defaultOptions.LocInfos[i];\r\n\t\t\tvar v3 = Q3D.vector3(currLocInfo[1], 0, currLocInfo[2]).get();\r\n\t\t\tactiveCtrlObj.addKey(parseFloat(currLocInfo[0]), v3);\t\t\t\t\r\n\t\t}\r\n\t\tactiveCtrlObj.endAddKey();\r\n\t\tif(!nodeExist) {\r\n\t\t\tactiveCtrlObj.setMaxKeyframeBufferSize(0);\r\n\t\t\tmapObj._map3d.setActiveCtrlObjListener(activeCtrlObj);\r\n\t\t\tif(defaultOptions.OnActCtrlObjAniEnd && Q3D.Util.isFunction(defaultOptions.OnActCtrlObjAniEnd)) {\r\n\t\t\t\tmapObj.attachUIEvent(\"onActCtrlObjAniEnd\", nodeName, defaultOptions.OnActCtrlObjAniEnd);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn activeCtrlObj;\r\n\t},\t\r\n\t\r\n\t// @method removeVehicle(nodePath: String): this\r\n    //  setTimeoutthis\r\n\tremoveVehicle: function(nodePath) {\r\n\t\tvar path = nodePath.split(\"/\"),\r\n\t\t\tareaName = path[0],\r\n\t\t\tnodeName = path[path.length - 1];\r\n\t\t\t\r\n\t\tvar sNode = this.getSceneNode(areaName, nodeName);\r\n\t\tif(!sNode)\treturn;\r\n\t\tvar activeCtrlObj = sNode.getActiveCtrlObj();\r\n\t\tmapObj._map3d.removeActiveCtrlObjListener(activeCtrlObj);\r\n\t\tmapObj.detachUIEvent(\"onActCtrlObjAniEnd\", nodeName);   //\r\n\t\tmapObj.destroySceneNode(areaName, nodeName);\t\t\r\n\t},\r\n});\r\n","// @namespace Map\r\n// @section UI\r\n\r\nQ3D.Map.include({ \r\n\r\n\t//widgetwidget, offspringArray\r\n\tgetWidgetOffspring: function(widget, offspringArray) {\r\n\t\tvar childWidgetList = widget.getChildren();\r\n\r\n\t\tif (childWidgetList !== null) {\r\n\t\t\tfor(var i = childWidgetList.getItemSize() ; i > 0; --i) {\r\n\t\t\t\tvar currentChild = childWidgetList.getItem(i - 1);\r\n\t\t\t\toffspringArray.push(currentChild);\r\n\t\t\t\tthis.getWidgetOffspring(currentChild, offspringArray);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t//Layoutwidget\r\n\tgetLayoutAllWidgets: function(nameOfLayout) {\r\n\t\tvar uiSystem = mapObj._map3d.getUISystem(),\r\n\t\t\tlayout = uiSystem.getLayout(nameOfLayout),\r\n\t\t\trootWidgetList = null,\r\n\t\t\trootWidget = null,\r\n\t\t\tallWidgetsArray = [];\r\n\t\t\r\n\t\tif(layout !== null) {\r\n\t\t\trootWidgetList = layout.getRootWidgets();\r\n\t\t\tfor(var i = rootWidgetList.getItemSize(); i > 0; --i) {\r\n\t\t\t\trootWidget = rootWidgetList.getItem(i - 1);\r\n                allWidgetsArray.push(rootWidget);\r\n\t\t\t\tthis.getWidgetOffspring(rootWidget, allWidgetsArray);\r\n\t\t\t}\t\t\t\r\n\t\t}\t\t\r\n\t\treturn allWidgetsArray;\r\n\t},\r\n\t\r\n    // @method setLayoutVisible(nameOfLayout: String, isVisible: Boolean): this\r\n\t// layout\r\n\tsetLayoutVisible: function(nameOfLayout, isVisible) {\r\n\t\tvar uiSystem = mapObj._map3d.getUISystem(),\r\n\t\t\tlayout = uiSystem.getLayout(nameOfLayout),\r\n\t\t\trootWidgetList = null,\r\n\t\t\trootWidget = null;\r\n\t\t\r\n\t\tif(layout === null) {\r\n\t\t\treturn ;\r\n\t\t}\r\n\t\t\r\n\t\trootWidgetList = layout.getRootWidgets();\r\n\t\tfor (var i = rootWidgetList.getItemSize() ; i > 0; --i) {\r\n\t\t\trootWidget = rootWidgetList.getItem(i - 1).setVisible(isVisible? 1:0);\r\n\t\t}\r\n        return this;\r\n\t},\r\n\t\r\n    // @method loadLayout(nameOfLayout: String, isVisible: Boolean, layoutfileName: String, left: Number, top: Number, width: Number, height: Number): QUILayout\r\n\t// layoutlayoutbutton QUILayout \r\n\tloadLayout: function(nameOfLayout, isVisible, layoutfileName, left, top, width, height) {\r\n\t\tvar uiSystem = mapObj._map3d.getUISystem(),\r\n\t\t\tlayout = uiSystem.getLayout(nameOfLayout);\t\t\t\r\n\r\n\t\tif (layout === null) {\r\n\t\t\tvar allWidgetsArray = [];\r\n\r\n\t\t\tlayout = uiSystem.loadRootLayout(nameOfLayout, layoutfileName);\t\t\t\t\t\r\n\t\t\tallWidgetsArray = this.getLayoutAllWidgets(nameOfLayout);\r\n\t\t\t//widgetbutton widget\r\n\t\t\tallWidgetsArray.forEach(function(widget){\r\n\t\t\t\tvar widgetButton = widget.asButton();\r\n\t\t\t\tif (widgetButton !== null && !!widgetButton.getName()){\r\n\t\t\t\t\tmapObj._map3d.setUIMouseButtonClickEventListener(widgetButton);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif(typeof(left) == \"number\" && typeof(top) == \"number\") {\r\n\t\t\tlayout.getMainWidget().setPosition(left, top);\r\n\t\t}\r\n\t\t\r\n\t\tif(typeof(width) == \"number\" && typeof(height) == \"number\") {\r\n\t\t\tlayout.getMainWidget().setSize(width, height);\r\n\t\t}\r\n\t\t\r\n\t\tthis.setLayoutVisible(nameOfLayout, isVisible);\r\n\t\treturn layout;\r\n\t},\r\n\t\r\n\t// @method unloadLayout(nameOfLayout: String, time?: Number): this \r\n\t// layoutbuttonWidget,timefadeout   \r\n\tunloadLayout: function(nameOfLayout, time) {\r\n\t\tvar uiSystem = mapObj._map3d.getUISystem(),\r\n\t\t\tlayout = uiSystem.getLayout(nameOfLayout);\t\t\t\r\n\r\n\t\tif (layout === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar allWidgetsArray = [];\t\t\t\t\r\n\t\t\tallWidgetsArray = this.getLayoutAllWidgets(nameOfLayout);\r\n\t\t\t//widgetbutton widget\r\n\t\t\tallWidgetsArray.forEach(function(widget){\r\n\t\t\t\tvar widgetButton = widget.asButton();\r\n\t\t\t\tif(widgetButton !== null && !!widgetButton.getName()) {\r\n\t\t\t\t\tmapObj.detachUIEvent(\"onNotifyMouseButtonClick\", widgetButton.getName());\r\n\t\t\t\t\tmapObj._map3d.removeUIMouseButtonClickEventListener(widgetButton);\r\n\t\t\t\t}\t\t\t\r\n\t\t\t});\t\r\n\t\t\tif(typeof time == \"undefined\") {\r\n\t\t\t\tuiSystem.unloadLayout(nameOfLayout);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tuiSystem.fadeout(nameOfLayout, time);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\t\t\r\n\t\t\r\n    // @method alertDialog(message: String, dialogTitle: String, dialogWidth?: Number, dialogHeight?: Number): this\r\n    //  Alert   \r\n\talertDialog: function(message, dialogTitle, dialogWidth, dialogHeight) {\r\n\t\t//alertLayoutwidth = 380,height = 140 (layout\r\n\t\tdialogWidth = dialogWidth || 380;\r\n        dialogHeight = dialogHeight || 140;\r\n\t\tvar windowWidth = document.documentElement.clientWidth,\r\n\t\t\twindowHeight = document.documentElement.clientHeight;\r\n        var defaultOptions = {\r\n\t\t\tleft: (windowWidth > dialogWidth) ? Math.floor((windowWidth - dialogWidth)/2) : 0,\r\n\t\t\ttop: (windowHeight > dialogHeight) ? Math.floor((windowHeight - dialogHeight)/2) : 0,\r\n\t\t\tmessage: \"This is a message\",\r\n\t\t\tdialogTitle: \"Alert Dialog\"\r\n\t\t};\t\t\r\n\t\tvar layout = this.loadLayout(\"_alertDialog\", 1, \"_alertDialog.layout\", defaultOptions.left, defaultOptions.top),\r\n\t\t\t//maskLayout = this.loadLayout(\"_mask\", 1, \"_mask.layout\"),\r\n\t\t\tmessageBox = layout.getWidget(\"_editBoxMessageADialog\").asTextBox(),\r\n\t\t\twindowTitle = layout.getWidget(\"_windowADialog\").asTextBox();\r\n\t\t\r\n\t\tmessage = (typeof message === \"undefined\")? defaultOptions.message : message;\r\n\t\tdialogTitle = (typeof dialogTitle === \"undefined\")? defaultOptions.dialogTitle : dialogTitle;\t\t\t\t\t\r\n\t\tmessageBox.setCaption(message);\r\n\t\twindowTitle.setCaption(dialogTitle);\t\r\n\t\t\r\n\t\tthis.attachUIEvent(\"onNotifyMouseButtonClick\", \"_buttonOKADialog\", function(widget){\r\n\t\t\tmapObj.unloadLayout(\"_mask\");\r\n\t\t\tmapObj.unloadLayout(\"_alertDialog\");\t\r\n\t\t});\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n    // @method confirmDialog(message: String, dialogTitle: String, okFn: Function, cancelFn: Function, dialogWidth?: Number, dialogHeight?: Number): this\r\n    //  Confirm   \r\n\tconfirmDialog: function(message, dialogTitle, okFn, cancelFn, dialogWidth, dialogHeight) {\r\n\t\t//confirmLayoutwidth = 380,height = 140 (layout\r\n        dialogWidth = dialogWidth || 380;\r\n        dialogHeight = dialogHeight || 140;\r\n\t\tvar windowWidth = document.documentElement.clientWidth,\r\n\t\t\twindowHeight = document.documentElement.clientHeight;\r\n\t\tvar defaultOptions = {\r\n\t\t\tleft: (windowWidth > dialogWidth) ? Math.floor((windowWidth - dialogWidth)/2) : 0,\r\n\t\t\ttop: (windowHeight > dialogHeight) ? Math.floor((windowHeight - dialogHeight)/2) : 0,\r\n\t\t\tmessage: \"This is a message\",\r\n\t\t\tdialogTitle: \"Confirm Dialog\"\r\n\t\t};\t\r\n\t\tvar\tlayout = this.loadLayout(\"_confirmDialog\", 1, \"_confirmDialog.layout\", defaultOptions.left, defaultOptions.top),\r\n\t\t\t//maskLayout = this.loadLayout(\"_mask\", 1, \"_mask.layout\"),\r\n\t\t\tmessageBox = layout.getWidget(\"_editBoxMessageCDialog\").asTextBox(),\r\n\t\t\twindowTitle = layout.getWidget(\"_windowCDialog\").asTextBox();\r\n\t\t\r\n\t\tmessage = (typeof message === \"undefined\")? defaultOptions.message : message;\r\n\t\tdialogTitle = (typeof dialogTitle === \"undefined\")? defaultOptions.dialogTitle : dialogTitle;\t\t\r\n\t\tmessageBox.setCaption(message);\r\n\t\twindowTitle.setCaption(dialogTitle);\t\r\n\r\n\t\tthis.attachUIEvent(\"onNotifyMouseButtonClick\", \"_buttonCancelCDialog\", function(widget){\t\t\t\r\n\t\t\tmapObj.unloadLayout(\"_confirmDialog\");\r\n\t\t\tmapObj.unloadLayout(\"_mask\");\r\n\t\t\tif (cancelFn() && Q3D.Util.isFunction(cancelFn())) {\r\n\t\t\t\tcancelFn();\r\n\t\t\t}\t\r\n\t\t});\t\t\r\n\r\n\t\tthis.attachUIEvent(\"onNotifyMouseButtonClick\", \"_buttonOKCDialog\", function(widget){\r\n\t\t\tmapObj.unloadLayout(\"_confirmDialog\");\r\n\t\t\tmapObj.unloadLayout(\"_mask\");\r\n\t\t\tif (okFn && Q3D.Util.isFunction(okFn)) {\r\n\t\t\t\tokFn();\r\n\t\t\t}\t\r\n\t\t});\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n    // @method promptDialog(inputTitle: String, dialogTitle: String, callback: Function, dialogWidth?: Number, dialogHeight?: Number): this\r\n    //  Prompt  callback \r\n\tpromptDialog: function(inputTitle, dialogTitle, callback, dialogWidth, dialogHeight) { \r\n\t\t//promptLayoutwidth = 380,height = 140 (layout\r\n        dialogWidth = dialogWidth || 380;\r\n        dialogHeight = dialogHeight || 140;\r\n\t\tvar windowWidth = document.documentElement.clientWidth,\r\n\t\t\twindowHeight = document.documentElement.clientHeight;\r\n\t\tvar defaultOptions = {\r\n\t\t\tleft: (windowWidth > dialogWidth) ? Math.floor((windowWidth - dialogWidth)/2) : 0,\r\n\t\t\ttop: (windowHeight > dialogHeight) ? Math.floor((windowHeight - dialogHeight)/2) : 0\r\n\t\t};\t\r\n\t\tvar\tlayout = this.loadLayout(\"_promptDialog\", 1, \"_promptDialog.layout\", defaultOptions.left, defaultOptions.top),\r\n\t\t\t//maskLayout = this.loadLayout(\"_mask\", 1, \"_mask.layout\"),\r\n\t\t\tinputTitleBox = layout.getWidget(\"_textBoxInputTitlePDialog\").asTextBox(),\r\n\t\t\twindowTitle = layout.getWidget(\"_windowPDialog\").asTextBox();\t\r\n\t\t\t\r\n\t\tinputTitleBox.setCaption(inputTitle);\r\n\t\twindowTitle.setCaption(dialogTitle);\r\n\t\r\n\t\tthis.attachUIEvent(\"onNotifyMouseButtonClick\", \"_buttonOKPDialog\", function(widget){\r\n\t\t\tvar uiSystem = mapObj._map3d.getUISystem(),\r\n\t\t\t\tinputValue = uiSystem.getLayout(\"_promptDialog\").getWidget(\"_editBoxInputPDialog\").asTextBox().getCaption();\r\n\t\t\t\r\n\t\t\tmapObj.unloadLayout(\"_promptDialog\");\r\n\t\t\tmapObj.unloadLayout(\"_mask\");\r\n\t\t\tif (callback && Q3D.Util.isFunction(callback)) {\r\n\t\t\t\tcallback(inputValue);\r\n\t\t\t}\t\t\t\t\t\t\t\r\n\t\t});\t\r\n\t\t\r\n\t\tthis.attachUIEvent(\"onNotifyMouseButtonClick\", \"_buttonCancelPDialog\", function(widget){\t\t\r\n\t\t\tmapObj.unloadLayout(\"_promptDialog\");\r\n\t\t\tmapObj.unloadLayout(\"_mask\");\t\t\t\r\n\t\t});\t\r\n\t\treturn this;\r\n\t},\t\r\n    \r\n    // @method videoDialog(videoCtrlName: String, options: Video options): this\r\n    // \r\n\tvideoDialog: function(videoCtrlName, options) {\r\n\t\tvar defaultOptions = {\r\n\t\t\tVideoPath: null,\r\n            VideoType: Q3D.Enums.videoSourceType.VIDSRC_NETSTREAM,          //VIDSRC_NETSTREAM - VIDSRC_LOCAL - \r\n\t\t\tTitle: {                               \t\t\t\t\t\t\t//\r\n\t\t\t\tText: \"\",\r\n\t\t\t\tColor: Q3D.colourValue(\"#000000\", 1),\r\n\t\t\t\tHeight: 20,\r\n\t\t\t},\r\n\t\t\tLeft: document.documentElement.clientWidth - 200,\t\t\t\t\t\t// - \r\n\t\t\tTop: 0,\t\t\t\t\t\t                                    // - \r\n\t\t\tWidth: 200,\t\t\t\t\t\t\t  \t\t\t\t\t\t\t//\r\n\t\t\tHeight: 200,\t\t\t\t\t\t\t \t\t\t\t\t\t//\r\n\t\t\tTargetNode: null,\t\t\t\t\t  \t\t\t\t\t\t\t//(QSceneNode)\r\n\t\t\tTargetPosition: null,\t\t\t\t  \t\t\t\t\t\t\t//(QVector3d\r\n\t\t\tAttachNode: null,\t\t\t\t\t  \t\t\t\t\t\t\t//,,\r\n\t\t\tIsIndicatrixVisible: true,\t\t\t\t\t\t\t\t\t\t//\r\n\t\t\tIndicatrixWidth: 2,\t\t\t\t\t  \t\t\t\t\t\t\t//\r\n\t\t\tIndicatrixMatrial: \"\",\t\t\t  \t\t\t\t\t\t\t    //\r\n\t\t\tIndicatrixLocation: 1,\t\t\t  \t\t\t\t\t\t\t    //0 - center; 1 - nearest corner\r\n            OnVideoCtrlClose: null,     \t\t\t\t\t\t\t\t\t//\r\n        };\t\t\r\n\t\tQ3D.Util.jQueryExtend(true, defaultOptions, options);\r\n\t\tvar uiSystem = mapObj._map3d.getUISystem(),\r\n\t\t\tvideoCtrl = uiSystem.createVideoCtrlWithName(videoCtrlName, defaultOptions.VideoPath, defaultOptions.VideoType);\r\n\r\n\t\t//videoCtrl\r\n\t\tif(!videoCtrl)\treturn;\t\t\r\n\t\tvideoCtrl.setTitle(defaultOptions.Title.Text, defaultOptions.Title.Color.get(), defaultOptions.Title.Height);\r\n\t\tvideoCtrl.setLeftTop(defaultOptions.Left, defaultOptions.Top);\r\n\t\tvideoCtrl.setSize(defaultOptions.Width, defaultOptions.Height);\r\n\t\tvar hasSpecifiedNodeOrPos = false;      //\r\n\t\tif(defaultOptions.TargetNode != null) {\r\n\t\t\tvideoCtrl.targetNode(defaultOptions.TargetNode);\r\n\t\t\thasSpecifiedNodeOrPos = true;\r\n\t\t}\r\n\t\tif(defaultOptions.TargetPosition != null) {\r\n\t\t\tvideoCtrl.targetPosition(defaultOptions.TargetPosition);\r\n\t\t\thasSpecifiedNodeOrPos = true;\r\n\t\t}\r\n\t\tif(defaultOptions.AttachNode != null) {\r\n\t\t\tvideoCtrl.attachNode(defaultOptions.AttachNode);\r\n\t\t\thasSpecifiedNodeOrPos = true;\r\n\t\t}\r\n\t\t\r\n\t\tif(defaultOptions.IsIndicatrixVisible && hasSpecifiedNodeOrPos) {\t//\r\n\t\t\tvideoCtrl.setIndicatrixVisible(1);\r\n\t\t\tvideoCtrl.setIndicatrixWidth(defaultOptions.IndicatrixWidth);\r\n\t\t\tif(defaultOptions.IndicatrixMatrial != null) {\r\n\t\t\t\tvideoCtrl.setIndicatrixMatrial(defaultOptions.IndicatrixMatrial);\t\t\r\n\t\t\t}\r\n\t\t\tvideoCtrl.setIndicatrixLocation(defaultOptions.IndicatrixLocation);  \r\n\t\t}\r\n\t\telse {\r\n\t\t\tvideoCtrl.setIndicatrixVisible(0);\r\n\t\t}\r\n        \r\n        if(defaultOptions.OnVideoCtrlClose !=null) {\r\n            mapObj._map3d.setUIVideoCtrlListener(videoCtrl);\r\n            mapObj.attachUIEvent(\"onVideoCtrlClose\", videoCtrlName, defaultOptions.OnVideoCtrlClose);\r\n        }\r\n\r\n        return this;\r\n\t},\r\n    \r\n    // @method removeVideo(videoCtrlName: String): this\r\n    // \r\n\tremoveVideo: function(videoCtrlName) {\r\n\t\tvar uiSystem = mapObj._map3d.getUISystem(),\r\n\t\t\tvideoCtrl = uiSystem.getVideoCtrl(videoCtrlName);\r\n\t\t\r\n\t\tif(!videoCtrl) return;\r\n        mapObj._map3d.removeUIVideoCtrlListener(videoCtrl);\r\n        mapObj.detachUIEvent(\"onVideoCtrlClose\", videoCtrlName);\r\n\t\tuiSystem.removeVideoCtrl(videoCtrlName);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t// @method getVideoCtrl(videoCtrlName: String): QVideoCtrl\r\n    // QVideoCtrl\r\n\tgetVideoCtrl: function(videoCtrlName) {\r\n\t\tvar uiSystem = mapObj._map3d.getUISystem();\r\n\t\treturn uiSystem.getVideoCtrl(videoCtrlName);\r\n\t},\r\n\t\t\r\n\t// @method setUIBtnState(layoutName: String, widgetName: String, isSelected: Boolean): this\r\n    // buttonWidget\r\n\tsetUIBtnState: function(layoutName, widgetName, isSelected) {\r\n\t\tvar uiSys = mapObj._map3d.getUISystem(),\r\n\t\t\tlayout = uiSys.getLayout(layoutName);\r\n\r\n\t\tif (layout != null) {\r\n\t\t\tvar btnWidget = layout.getWidget(widgetName).asButton();\r\n\t\t\tbtnWidget.setStateSelected(isSelected? 1:0);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n    // @method createHtmlWidget(nodePath: String, options: HtmlWidget options): QHtmlWidget\r\n    //html QHtmlWidget \r\n    //\r\n    createHtmlWidget: function (nodePath, options) {\r\n        var defaultOptions = {\r\n            Name: null,\r\n            BackImageUrl: \"\",\r\n            TitleImageUrl: \"\",\r\n            HtmlUrl: null,\r\n            Layout: 0, //(0),(1),(2),(3),\r\n            Position: null, //Vector2\r\n            Size: null,//Vector2\r\n            ClientRectPosition: null,//Vector2\r\n            ClientRectSize: null,//Vector2\r\n            TitlePosition: null,//Vector2\r\n            TitleSize: null,//Vector2\r\n            CloseRectPosition: null,//Vector2\r\n            CloseRectSize: null,//Vector2\r\n            Alpha: 1,\r\n            FadeIn: 0.5,\r\n            ZOrder: null,\r\n            TooltipOptions: {\r\n                TriFillColor: Q3D.colourValue(\"#000000\", 1),\r\n                TriAlpha: 0.5,\r\n                EdgeColor: null,\r\n                EdgeWidth: 0,             \r\n            },\r\n            OnHtmlWidgetClosed: null,\r\n            OnUserNotify: null,\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultOptions, options);\r\n        try {\r\n            var extUI = mapObj._map3d.getExternUIWidgetSys();\r\n            if(extUI == null) return null;\r\n            \r\n            //htmlWidget\r\n            var htmlWidgetCreated = extUI.createHtmlWidget(defaultOptions.Name, defaultOptions.BackImageUrl, defaultOptions.TitleImageUrl);\r\n            if (htmlWidgetCreated != null) {\r\n                htmlWidgetCreated.setLayout(defaultOptions.Layout);\r\n                if (defaultOptions.Position != null ) {\r\n                    htmlWidgetCreated.setPos(defaultOptions.Position.x, defaultOptions.Position.y);\r\n                }\r\n                if (defaultOptions.Size != null ) {\r\n                    htmlWidgetCreated.setSize(defaultOptions.Size.x, defaultOptions.Size.y);\r\n                }\r\n                if (defaultOptions.ClientRectPosition != null ) {\r\n                    htmlWidgetCreated.setClientPos(defaultOptions.ClientRectPosition.x, defaultOptions.ClientRectPosition.y);\r\n                }\r\n                if (defaultOptions.ClientRectSize != null ) {\r\n                    htmlWidgetCreated.setClientSize(defaultOptions.ClientRectSize.x, defaultOptions.ClientRectSize.y);\r\n                }\r\n                if (defaultOptions.TitlePosition != null ) {\r\n                    htmlWidgetCreated.setTitlePos(defaultOptions.TitlePosition.x, defaultOptions.TitlePosition.y);\r\n                }\r\n                if (defaultOptions.TitleSize != null ) {\r\n                    htmlWidgetCreated.setTitleSize(defaultOptions.TitleSize.x, defaultOptions.TitleSize.y);\r\n                }\r\n                if (defaultOptions.Alpha != null && typeof(defaultOptions.Alpha) == \"number\") {\r\n                    htmlWidgetCreated.setAlpha(defaultOptions.Alpha);\r\n                }\r\n                if (defaultOptions.FadeIn != null && typeof(defaultOptions.FadeIn) == \"number\") {\r\n                    htmlWidgetCreated.fadeIn(defaultOptions.FadeIn);\r\n                }\r\n                if (defaultOptions.ZOrder != null && typeof(defaultOptions.ZOrder) == \"number\") {\r\n                    htmlWidgetCreated.setZOrder(defaultOptions.ZOrder);\r\n                }\r\n                if (defaultOptions.CloseRectPosition != null && defaultOptions.CloseRectSize != null ) {\r\n                    htmlWidgetCreated.setCloseRect(defaultOptions.CloseRectPosition.x, defaultOptions.CloseRectPosition.y, defaultOptions.CloseRectSize.x, defaultOptions.CloseRectSize.y);\r\n                }\r\n                if (defaultOptions.HtmlUrl != null && typeof(defaultOptions.HtmlUrl) == \"string\") {\r\n                    htmlWidgetCreated.setHtml(defaultOptions.HtmlUrl);\r\n                }\r\n                htmlWidgetCreated.setAutoUpdate(1);\r\n                htmlWidgetCreated.setReceiveInput(1);\r\n                \r\n                var node = this.getSceneNode(nodePath);\r\n                if (node != null) {\r\n                    var tooltipWidget = htmlWidgetCreated.asTooltipWidget();\r\n                    tooltipWidget.setTriFillColor(defaultOptions.TooltipOptions.TriFillColor.get());\r\n                    tooltipWidget.setTriAlpha(defaultOptions.TooltipOptions.TriAlpha);                    \r\n                    tooltipWidget.setEdgeWidth(defaultOptions.TooltipOptions.EdgeWidth);\r\n                    if (defaultOptions.TooltipOptions.EdgeWidth > 0 && defaultOptions.TooltipOptions.EdgeColor != null) {\r\n                        tooltipWidget.setEdgeColor(defaultOptions.TooltipOptions.EdgeColor.get());\r\n                    }\r\n                    tooltipWidget.createRectLinks(0, 0, defaultOptions.Size.x, defaultOptions.Size.y);\r\n                    tooltipWidget.setAutoObserveObj(node);\r\n                }\r\n\r\n                setTimeout(function () {\r\n                    if (Q3D.Util.isFunction(defaultOptions.OnHtmlWidgetClosed)) {\r\n                        mapObj.attachUIEvent(\"onWidgetClose\", defaultOptions.Name, defaultOptions.OnHtmlWidgetClosed);\r\n                    }\r\n                    if (Q3D.Util.isFunction(defaultOptions.OnUserNotify)) {\r\n                        mapObj.attachUIEvent(\"onUserNotifyEX\", defaultOptions.Name, defaultOptions.OnUserNotify);\r\n                    }\r\n                }, 100);                \r\n            }\r\n            return htmlWidgetCreated;\r\n        } catch (e) {\r\n            return null;\r\n        }\r\n    }, \r\n    \r\n    // @method createImageWidget(imgWidgetName: String, options: ImageWidget options): QHtmlWidget\r\n    //Image QImageWidget \r\n    createImageWidget: function (imgWidgetName, options) {\r\n        var defaultOptions = {\r\n            ImageUrl: \"\", //\r\n            LeftTop: Q3D.vector2(0, 0),            \r\n            Size: Q3D.vector2(300, 200),\r\n            Alpha: 1,\r\n            ZOrder: 1,\r\n            FadeIn: 0.5,\r\n            Visible: true,\r\n            LoadingOptions: {\r\n                ImageUrl: \"\",\r\n                FrameClip: Q3D.vector2(2, 2), \r\n                Interval: 0.2   \r\n            },\r\n            VideoOptions: {\r\n                VideoPath: \"\",\r\n                VideoType: Q3D.Enums.videoSourceType.VIDSRC_NETSTREAM,   \r\n                IsLoop: true\r\n            },\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultOptions, options);\r\n        try {\r\n            var uiSys = this._map3d.getWorldManager().getUIWindowSys(0);\r\n            var widget = uiSys.getWidget(imgWidgetName);\r\n            if(!widget) {\r\n                widget = uiSys.createImageWidget(imgWidgetName);\r\n\t\t\t}             \r\n            var imgWidget = widget.asImageWidget();\r\n            \r\n            if (defaultOptions.ImageUrl != \"\") {\r\n                imgWidget.setImage(defaultOptions.ImageUrl);\r\n            }\r\n            imgWidget.setMarginLeft(defaultOptions.LeftTop.x);\r\n            imgWidget.setMarginTop(defaultOptions.LeftTop.y);\r\n            imgWidget.setLayoutWidth(defaultOptions.Size.x);\r\n            imgWidget.setLayoutHeight(defaultOptions.Size.y);\r\n            imgWidget.setAlpha(defaultOptions.Alpha);\r\n            imgWidget.setVisible(defaultOptions.Visible ? 1 : 0);\r\n            imgWidget.setZOrder(defaultOptions.ZOrder);\t\r\n            imgWidget.fadeIn(defaultOptions.FadeIn);\t\r\n           \r\n\t\t\tif (defaultOptions.VideoOptions.VideoPath != \"\") {                \r\n                 if (defaultOptions.LoadingOptions.ImageUrl != \"\") { //\r\n                    imgWidget.setImage(defaultOptions.LoadingOptions.ImageUrl);               \r\n                    var mat = imgWidget.getMaterial();\r\n                    var textureUnit = mat.getTextureUnit(Q3D.Enums.textureUnit.DIFFUSE);\r\n                    textureUnit.setFrameXClip(defaultOptions.LoadingOptions.FrameClip.x);\r\n                    textureUnit.setFrameYClip(defaultOptions.LoadingOptions.FrameClip.y);\r\n                    textureUnit.setFrameInterval(defaultOptions.LoadingOptions.Interval);\r\n                }      \r\n                //\r\n                var videoName = imgWidgetName+\"_videoSrc\";\r\n                var _rm = this._map3d.getResourceManager();\r\n                var _qVideo = _rm.getResource(Q3D.Enums.resourceType.VIDEO, videoName);\r\n                if (_qVideo == null) {//                \r\n                    _qVideo = _rm.registerResource(Q3D.Enums.resourceType.VIDEO, videoName).asVideo();\r\n                    _qVideo.createEmpty();\r\n                } else {\r\n                    _qVideo = _qVideo.asVideo();          \r\n                    _qVideo.stop();\r\n                }          \r\n\t\t\t\t_qVideo.setVideoSource(defaultOptions.VideoOptions.VideoPath, defaultOptions.VideoOptions.VideoType);\r\n                _qVideo.setWidth(defaultOptions.Size.x);\r\n                _qVideo.setHeight(defaultOptions.Size.y);\r\n                _qVideo.setAutoPlay(1);\r\n                _qVideo.setLoop(defaultOptions.VideoOptions.IsLoop ? 1 : 0);                \r\n                _qVideo.play();   \r\n                \r\n                var mat = imgWidget.getMaterial();\r\n                var textureUnit = mat.getTextureUnit(Q3D.Enums.textureUnit.DIFFUSE);\r\n                textureUnit.setVideo(videoName, 1);\r\n            }              \r\n            return imgWidget;\r\n        } catch (e) {\r\n            return null;\r\n        }\r\n    }, \r\n    \r\n    // @method createTooltipWidget(nodePath: String, options: TooltipWidget options): QHtmlWidget\r\n    //Tooltip QTooltipWidget \r\n    createTooltipWidget: function (nodePath, options) {\r\n        var defaultOptions = {\r\n            Name: null,\r\n            Layout: 0, //(0),(1),(2),(3)\r\n            Position: null, //Vector2\r\n            Size: Q3D.vector2(1,1),//Vector2            \r\n            Alpha: 1,\r\n            FadeIn: 0.5,\r\n            ZOrder: null,\r\n            TooltipOptions: {\r\n                TriFillColor: Q3D.colourValue(\"#000000\", 1),\r\n                TriAlpha: 0.5,\r\n                EdgeColor: null,\r\n                EdgeWidth: 0,             \r\n            },\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultOptions, options);\r\n        try {\r\n            var uiSys = mapObj._map3d.getWorldManager().getUIWindowSys(0);\r\n            if(uiSys == null) return null;\r\n            \r\n            //htmlWidget\r\n            var tooltipWidget = uiSys.createTooltipWidget(defaultOptions.Name);\r\n            if (tooltipWidget != null) {\r\n                if (defaultOptions.Position != null ) {\r\n                    switch(defaultOptions.Layout) {\r\n                        case 0://\r\n                            tooltipWidget.setMarginLeft(defaultOptions.Position.x);\r\n                            tooltipWidget.setMarginTop(defaultOptions.Position.y);\r\n                            break;\r\n                        case 1://\r\n                            tooltipWidget.setMarginRight(defaultOptions.Position.x);\r\n                            tooltipWidget.setMarginTop(defaultOptions.Position.y);\r\n                            break;\r\n                        case 2://\r\n                            tooltipWidget.setMarginLeft(defaultOptions.Position.x);\r\n                            tooltipWidget.setMarginBottom(defaultOptions.Position.y);\r\n                            break;\r\n                        case 3://\r\n                            tooltipWidget.setMarginRight(defaultOptions.Position.x);\r\n                            tooltipWidget.setMarginBottom(defaultOptions.Position.y);\r\n                            break;\r\n                    }\r\n                }\r\n                if (defaultOptions.Size != null ) {\r\n                \ttooltipWidget.setLayoutWidth(defaultOptions.Size.x);\r\n                \ttooltipWidget.setLayoutHeight(defaultOptions.Size.y);\r\n                }                \r\n                if (defaultOptions.Alpha != null && typeof(defaultOptions.Alpha) == \"number\") {\r\n                \ttooltipWidget.setAlpha(defaultOptions.Alpha)\r\n                }\r\n\t\t\t\tif (defaultOptions.FadeIn != null && typeof(defaultOptions.FadeIn) == \"number\") {\r\n                    tooltipWidget.fadeIn(defaultOptions.FadeIn);\r\n                }\r\n                if (defaultOptions.ZOrder != null && typeof(defaultOptions.ZOrder) == \"number\") {\r\n                    tooltipWidget.setZOrder(defaultOptions.ZOrder);\r\n                }                \r\n                tooltipWidget.setVisible(1);\r\n                \r\n                var node = this.getSceneNode(nodePath);\r\n                if (node != null) {\r\n                    tooltipWidget.setTriFillColor(defaultOptions.TooltipOptions.TriFillColor.get());\r\n                    tooltipWidget.setTriAlpha(defaultOptions.TooltipOptions.TriAlpha);                    \r\n                    tooltipWidget.setEdgeWidth(defaultOptions.TooltipOptions.EdgeWidth);\r\n                    if (defaultOptions.TooltipOptions.EdgeWidth > 0 && defaultOptions.TooltipOptions.EdgeColor != null) {\r\n                        tooltipWidget.setEdgeColor(defaultOptions.TooltipOptions.EdgeColor.get());\r\n                    }\r\n                    tooltipWidget.createRectLinks(0, 0, defaultOptions.Size.x, defaultOptions.Size.y);\r\n                    tooltipWidget.setAutoObserveObj(node);\r\n                }                       \r\n            }\r\n            return tooltipWidget;\r\n        } catch (e) {\r\n            return null;\r\n        }\r\n    }, \r\n    \r\n    // @method removeHtmlWidget(widgetName: String): this\r\n    // html\r\n\tremoveHtmlWidget: function(widgetName) {\r\n        var extUI = mapObj._map3d.getExternUIWidgetSys();\r\n        if(extUI != null)\r\n\t\t\textUI.destroyWidget(widgetName);\r\n\t\treturn this;\r\n\t},\r\n    \r\n    // @method removeTooltipWidget(widgetName: String): this\r\n    // Tooltip\r\n\tremoveTooltipWidget: function(widgetName) {\r\n\t\tvar uiSys = mapObj._map3d.getWorldManager().getUIWindowSys(0);\r\n\t\tuiSys.destroyTooltipWidget(widgetName);\r\n\t\treturn this;\r\n\t},   \r\n    \r\n    // @method removeImageWidget(widgetName: String): this\r\n    // Image\r\n\tremoveImageWidget: function(widgetName) {\r\n\t\tvar uiSys = mapObj._map3d.getWorldManager().getUIWindowSys(0);\r\n\t\tuiSys.destroyWidget(widgetName);\r\n\t\treturn this;\r\n\t},    \r\n    \r\n    // @method createHtmlWidgetToTexture(options: HtmlWidgetTexture options): QHtmlWidget\r\n    //html QHtmlWidget \r\n    // \r\n    createHtmlWidgetToTexture: function (options) {\r\n        var defaultOptions = {\r\n            Name: null, //htmlWidget            \r\n            HtmlUrl: null,//url\r\n            Size: null, //, Vector2  \r\n            Material: null,//,\r\n        }\r\n        Q3D.extend(defaultOptions, options);\r\n        try {\r\n                        \r\n            var extUI = this._map3d.getExternUIWidgetSys();     \r\n\t\t\tif(extUI == null) return  null;    \r\n            \r\n            //\r\n            //\r\n            var _rm = this._map3d.getResourceManager();\r\n            var _mat = _rm.getResource(Q3D.Enums.resourceType.MATERIAL, defaultOptions.Material);\r\n            if (_mat == null) {//                \r\n                _mat = _rm.registerResource(Q3D.Enums.resourceType.MATERIAL, defaultOptions.Material).asMaterial();\r\n                _mat.createEmpty();\r\n            } else {\r\n                _mat = _mat.asMaterial();                \r\n            }\r\n            var _clr = Q3D.colourValue(1,1,1,1);\r\n            _mat.setDiffuseColor(_clr.get());\r\n            var _texUnit = _mat.getTextureUnit(Q3D.Enums.textureUnit.DIFFUSE);\r\n\r\n            //htmlWidget\r\n            var htmlWidgetCreated = extUI.createHtmlTextureWidget(defaultOptions.Name, _texUnit, defaultOptions.Size.x, defaultOptions.Size.y);\r\n            if (htmlWidgetCreated != null) {                \r\n                htmlWidgetCreated.setAutoUpdate(1);\r\n                htmlWidgetCreated.setHtml(defaultOptions.HtmlUrl);     \r\n                htmlWidgetCreated.setReceiveInput(0);                                      \r\n            }\r\n            return htmlWidgetCreated;\r\n        } catch (e) {\r\n            return null;\r\n        }\r\n    },\r\n    \r\n    // @method createUILayoutToTexture(options: UITexture options): QUILayout\r\n    // RTTUI QUILayout \r\n    //  \r\n    createUILayoutToTexture: function (options) {\r\n        var defaultOptions = {\r\n            Name: null, //layout   \r\n            FileName: null, //layout   \r\n            RTTName: null, //RTTxml            \r\n            Material: null,//,\r\n            UIOptions: {\r\n                AlphaBlend: true,//\r\n                Alpha: 1, //\r\n                DepthCheck: true, //\r\n                BackCull: false,//                \r\n            },\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultOptions, options);\r\n        try {\r\n            //layout\r\n            var _layoutRTT = this.loadLayout(defaultOptions.Name, true, defaultOptions.FileName, 0, 0);\r\n            if (_layoutRTT == null)\r\n                return null;\r\n            \r\n            //\r\n            var _rm = this._map3d.getResourceManager();\r\n            var _mat = _rm.getResource(Q3D.Enums.resourceType.MATERIAL, defaultOptions.Material);\r\n            if (_mat == null) {//                \r\n                _mat = _rm.registerResource(Q3D.Enums.resourceType.MATERIAL, defaultOptions.Material).asMaterial();\r\n                _mat.createEmpty();\r\n            } else {\r\n                _mat = _mat.asMaterial();                \r\n            }\r\n            var _clr = Q3D.colourValue(1,1,1,1);\r\n            _mat.setDiffuseColor(_clr.get());\r\n            var _texUnit = _mat.getTextureUnit(Q3D.Enums.textureUnit.DIFFUSE);\r\n            \r\n            //RTTUI\r\n            _texUnit.setTexture(defaultOptions.RTTName, 0);            \r\n\t\t\t_mat.setAlphaBlendEnable(defaultOptions.UIOptions.AlphaBlend?1:0); \r\n            if (defaultOptions.UIOptions.AlphaBlend)\r\n            \t_mat.setAlpha(defaultOptions.UIOptions.Alpha);\r\n        \t_mat.setDepthCheck(defaultOptions.UIOptions.DepthCheck?1:0); //\r\n            _mat.setCullMode(defaultOptions.UIOptions.BackCull?2:1); //\r\n\t\t\t\r\n            return _layoutRTT;\r\n        } catch (e) {\r\n            return null;\r\n        }\r\n    },\r\n    \r\n    // @method createIRHeatmap(name: String, options: Heatmap options): QHeatMapIrregular\r\n    //  QHeatMapIrregular \r\n    createIRHeatmap: function (name, options) {\r\n        var defaultOptions = {\r\n            GridSize: Q3D.vector2(80,80), //\r\n            HeatPoints: [], //GlobalVec3D\r\n            Range: 10, //\r\n            ColorBandKey: [], //number1, number2,...\r\n            ColorBandValue: [], //ColourValue\r\n            BaseHeight: 0, //\r\n            IsContinuousColor: true, //\r\n            IsPlane: true, //\r\n            AlgType: Q3D.Enums.heatMapCalcType.SquaredWeighted, //\r\n            BorderPoints: [], //Vector3           \r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultOptions, options);\r\n        try {\r\n            var heatMapManager = mapObj._map3d.getHeatMapManager();\r\n            var heatMap = heatMapManager.getHeatMapByID(name);\r\n            if(heatMap != null) {\r\n\t\t\t\theatMapManager.destoryHeatMapByID(name); \r\n\t\t\t}\r\n            //heatmap\r\n            heatMap = heatMapManager.createHeatMap(name, 3).asHeatMapIrregular();\r\n            //\r\n            heatMap.setNxNz(defaultOptions.GridSize.x,defaultOptions.GridSize.y);    \r\n            /*\r\n            if (defaultOptions.TopLeft != null) {\r\n                heatMap.setTopLeftPoint(defaultOptions.TopLeft);\r\n            }\r\n            if (defaultOptions.RightBottom != null) {\r\n                heatMap.SetBottomRightPoint(defaultOptions.RightBottom);\r\n            }*/\r\n            var i;\r\n            for (i = 0; i < defaultOptions.HeatPoints.length; i++) {\r\n                var ptName = name + \"_pi_\" + i;\r\n                heatMap.addPoint(defaultOptions.HeatPoints[i].get(),defaultOptions.Range,ptName);\r\n            }\r\n            for (i = 0; i < defaultOptions.ColorBandKey.length; i++) {\r\n                heatMap.addColorBand(defaultOptions.ColorBandKey[i], defaultOptions.ColorBandValue[i].get());\r\n            }\r\n            heatMap.setUseContinuousColor(defaultOptions.IsContinuousColor ? 1 : 0);\r\n            //\r\n\t\t\theatMap.setHeight(defaultOptions.BaseHeight);\r\n            //\r\n\t\t\theatMap.setScapple(defaultOptions.IsPlane ? 1 : 0);\r\n            \r\n            // \r\n\t\t\theatMap.setAlgType(defaultOptions.AlgType);\r\n\t\t\theatMap.build();      \r\n            \r\n            //\r\n            var v3list = mapObj._map3d.getWorldManager().createEmptyQVector3List();\r\n            for (i = 0; i < defaultOptions.BorderPoints.length; i++) {\r\n                v3list.add(defaultOptions.BorderPoints[i].get());\r\n            }\r\n            if (defaultOptions.BorderPoints.length > 0) {\r\n                //\r\n\t\t\t\theatMap.setBorderPoints(v3list);\r\n\t \t\t\t//\r\n\t\t\t\theatMap.render();      \r\n            }\r\n            return heatMap;\r\n        } catch (e) {\r\n            return null;\r\n        }\r\n    },   \r\n    \r\n});","// @namespace Map\r\n// @section Mesh\r\nQ3D.Map.include({\r\n    \r\n    _restoreModelMaterial: function(nodePath) {\r\n        var _node = this.getSceneNode(nodePath);\r\n        if (_node == null)\r\n            return null;   \r\n        \r\n        var _nodeType = _node.getNodeType();\r\n        if (_nodeType != Q3D.Enums.sceneNodeType.SNODE_Model && _nodeType != Q3D.Enums.sceneNodeType.SNODE_VecModel)\r\n            return null;\r\n        \r\n        var _realNode = null;\r\n        if (_nodeType == Q3D.Enums.sceneNodeType.SNODE_Model)\r\n            _realNode = _node.asModel();\r\n        else\r\n            _realNode = _node.asVecModel();        \r\n        \r\n        //\r\n        _realNode.restoreAloneMaterials();\r\n        \r\n        return this;\r\n    },\r\n    \r\n    // @method createSimpleMaterial(resourceName: String, options: Colour material options): QMaterial\r\n    //  QMaterial \r\n    createSimpleMaterial: function (resourceName, options) {\r\n        var DefaultCreateOption = {\r\n            DiffuseColor: null,//ColourValue\r\n            EmissiveColor: null,\r\n            SpecularColor: null,\r\n            Alpha: null,\r\n        }\r\n        Q3D.extend(DefaultCreateOption, options);\r\n        //\r\n        var _rm = this._map3d.getResourceManager();\r\n        var _mat = _rm.getResource(Q3D.Enums.resourceType.MATERIAL, resourceName);\r\n        if (_mat != null) //\r\n            return _mat;\r\n        _mat = _rm.registerResource(Q3D.Enums.resourceType.MATERIAL, resourceName).asMaterial();\r\n        _mat.createEmpty();\r\n       \r\n       _mat.setShadowFactor(1);//\r\n       _mat.setLightEnable(1);//\r\n        if (DefaultCreateOption.DiffuseColor)\r\n            _mat.setDiffuseColor(DefaultCreateOption.DiffuseColor.get());\r\n        if (DefaultCreateOption.SpecularColor)\r\n            _mat.setSpecularColor(DefaultCreateOption.SpecularColor.get());        \r\n        if (DefaultCreateOption.EmissiveColor) {\r\n            _mat.setEmissiveColor(DefaultCreateOption.EmissiveColor.get());\r\n            _mat.setDiffuseColor(Q3D.colourValue(\"#000000\", 1).get());\r\n            _mat.setLightEnable(0);//\r\n        }\r\n        if (DefaultCreateOption.Alpha && DefaultCreateOption.Alpha < 1.0) {\r\n            _mat.setAlphaBlendEnable(1);\r\n            _mat.setAlpha(DefaultCreateOption.Alpha);\r\n            _mat.setDepthWriteEnable(0);//\r\n            //_mat.setDepthCheck(1);\r\n        }\r\n        \r\n        return _mat;\r\n    },\r\n\r\n    // @method createModel(nodePath: String, meshName: String, options: Model create options): QModelNode\r\n    // Node\"/[]/\" QModelNode \r\n    //  Mesh \r\n    createModel: function (nodePath, meshName, options) {\r\n        var DefaultCreateOption = {\r\n            Position: null, //Vector3\r\n            Orientation: null,//Vector3\r\n            OrientationType: Q3D.Enums.nodeOrientationType.Self,\r\n            Scale: null,//Vector3\r\n            SkeletonAnimation: null, //\r\n            OnLoaded: null, //\r\n        }\r\n        Q3D.extend(DefaultCreateOption, options);\r\n        try {           \r\n            \r\n            var ModelNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_Model); \r\n            if (ModelNodeCreated != null) {\r\n                \r\n                if (DefaultCreateOption.OnLoaded) {\r\n                    mapObj._map3d.setSceneNodeListener(ModelNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(ModelNodeCreated), DefaultCreateOption.OnLoaded);\r\n                }                \r\n                ModelNodeCreated.trackAllResource();     \r\n\r\n                var ModelAppend = ModelNodeCreated.asModel();\r\n\r\n                ModelAppend.setMesh(meshName);\r\n                if (DefaultCreateOption.Position != null) {\r\n                    ModelAppend.setPosition(DefaultCreateOption.Position.get());\r\n                }\r\n                if (DefaultCreateOption.Orientation != null) {\r\n                    ModelAppend.setOrientation(DefaultCreateOption.Orientation.get(), DefaultCreateOption.OrientationType);\r\n                }\r\n                if (DefaultCreateOption.Scale != null) {\r\n                    ModelAppend.setScale(DefaultCreateOption.Scale.get());\r\n                }\r\n                \r\n                if (DefaultCreateOption.SkeletonAnimation != null)\r\n                    ModelAppend.setSkeletonAnimation(DefaultCreateOption.SkeletonAnimation);\r\n\r\n            \t\r\n\r\n                return ModelAppend;\r\n            } \r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createModel: \" + e.message);\r\n            return null;\r\n        }\r\n        return null;\r\n    },\r\n\r\n    // @method playModelSkeletonAnimation(nodePath: String, aniName?: String): this\r\n    // \r\n    playModelSkeletonAnimation: function (nodePath, aniName) {\r\n        var _node = this.getSceneNode(nodePath);\r\n        if (_node == null || _node.getNodeType() != Q3D.Enums.sceneNodeType.SNODE_Model)\r\n            return null;\r\n        \r\n        var _model = _node.asModel();\r\n        if (aniName !== undefined) {          \r\n            _model.setSkeletonAnimation(aniName);\r\n            _model.loadAllResource();\r\n        }\r\n        var _aniState = _model.getSkeletonAnimationState();\r\n        if (_aniState == null) \r\n            return null;\r\n        _aniState.setLoop(1);\r\n        _aniState.setAutoPlay(1);\r\n        _aniState.play();        \r\n        return this;\r\n    },\r\n\t\r\n    // @method stopModelSkeletonAnimation(nodePath: String): this\r\n    // \r\n    stopModelSkeletonAnimation: function (nodePath) {\r\n        var _node = this.getSceneNode(nodePath);\r\n        if (_node == null || _node.getNodeType() != Q3D.Enums.sceneNodeType.SNODE_Model)\r\n            return null;\r\n\r\n        var _model = _node.asModel();\r\n        var _aniState = _model.getSkeletonAnimationState();\r\n        if (_aniState == null)\r\n            return null;\r\n        _aniState.stop();\r\n        //_aniState.stopAndBack();\r\n        return this;\r\n    },\r\n\t\r\n    // @method setModelHighlight(nodePath: String, highLightEnable: Boolean): this\r\n    // \r\n    setModelHighlight: function (nodePath, highLightEnable) {        \r\n\r\n        var _node = this.getSceneNode(nodePath);\r\n        if (_node == null)\r\n            return null;\r\n\r\n        var _nodeType = _node.getNodeType();\r\n        if (_nodeType != Q3D.Enums.sceneNodeType.SNODE_Model && _nodeType != Q3D.Enums.sceneNodeType.SNODE_VecModel)\r\n            return null;\r\n\r\n        var _model = _nodeType == Q3D.Enums.sceneNodeType.SNODE_Model ? _node.asModel() : _node.asVecModel();  \r\n        //_model.makeAloneMaterials();\r\n        _model.makeAloneMaterialsEx(2);\r\n        for (var i = 0; i <= _model.getMaterialCount() - 1; i++) {\r\n            if (highLightEnable) {\r\n                _model.getMaterial(i).setEmissiveColor(Q3D.colourValue(1, 0, 1, 1).get());\r\n            } else {\r\n                _model.getMaterial(i).setEmissiveColor(Q3D.colourValue(0, 0, 0, 0).get());\r\n            }\r\n        }\r\n        if (!highLightEnable) {\r\n            _model.restoreAloneMaterials();\r\n        }\r\n        return this;\r\n    },\r\n\r\n    // @method setModelColor(nodePath: String, newColor: ColourValue, colorEnable: Boolean): this\r\n    //     \r\n    setModelColor: function (nodePath, newColor, colorEnable) {\r\n        var ctnName = \"model_color_\" + newColor.toWebColor()\r\n        var nc = Q3D.nodeContainer(ctnName);\r\n        nc.setTargetVal(Q3D.Enums.nodeContainerType.Color,newColor);\r\n        if (colorEnable) {\r\n            nc.addSceneNode(nodePath);\r\n        } else {\r\n            nc.removeSceneNode(nodePath);\r\n        }\r\n        return this;\r\n    },\r\n\t\r\n    // @method clearModelsColor(clrArr: Array): this\r\n    // \r\n    clearModelsColor: function (clrArr) {\r\n        if (!Q3D.Util.isArray(clrArr)) \r\n            return null;\r\n        clrArr.forEach( function(clr) {   \r\n        \tvar ctnName = \"model_color_\" + clr.toWebColor()\r\n        \tQ3D.nodeContainer(ctnName).clear();\r\n        \tmapObj._map3d.getWorldManager().destroyContainer(ctnName);\r\n        } ) ;        \r\n        return this;\r\n    },\r\n\t\r\n    // @method setBatchModelMaterial(nodeNames: Array, mtrName: String): this\r\n    // \r\n    setBatchModelMaterial: function(nodeNames, mtrName) {\r\n        \r\n        if (!Q3D.Util.isArray(nodeNames) || typeof nodeNames[0] !== 'string') \r\n            return null;       \r\n\r\n        var nc = Q3D.nodeContainer(\"model_with_\" + mtrName);\r\n        nc.setTargetVal(Q3D.Enums.nodeContainerType.Material,mtrName);\r\n        for (var j = 0 ; j < nodeNames.length; j++) {\r\n            nc.addSceneNode(nodeNames[j]);\r\n        }    \r\n        return this;\r\n    },\r\n\t\r\n    // @method clearBatchModelMaterial(mtrName: String): this\r\n    // \r\n    clearBatchModelMaterial: function(mtrName) {\r\n        Q3D.nodeContainer(\"model_with_\" + mtrName).clear();\r\n        mapObj._map3d.getWorldManager().destroyContainer(\"model_with_\" + mtrName);\r\n        return this;\r\n    },   \r\n    \r\n    // @method setBatchModelColorFlash(nodeNames: Array, newColor: ColourValue, isEmissiveColor: Boolean, speed: Number, flashTimes?: Number): this\r\n    //  clearModelColorFlash\r\n    setBatchModelColorFlash: function (nodeNames, newColor, isEmissiveColor, speed, flashTimes) {   \r\n\t\t\r\n        if (!Q3D.Util.isArray(nodeNames) || typeof nodeNames[0] !== 'string') \r\n            return null;    \r\n        \r\n        if(typeof this._clrFlashObj === \"undefined\")\r\n\t\t\tthis._clrFlashObj = []; \t\t\t\t\r\n\t\t\r\n\t\t//\r\n\t\tthis.clearBatchModelColorFlash(nodeNames);\t\r\n\r\n        var framesPerSec = 50;\r\n        for (var j = 0 ; j < nodeNames.length; j++) {\r\n            var nodeExist = this.getSceneNode(nodeNames[j]);\r\n            if (nodeExist == null) \r\n                continue;        \r\n\r\n\t\t\tthis._clrFlashObj.push(nodeNames[j]);   \r\n\t\t\t//MovieClip\r\n\t\t\tvar _mc = Q3D.movieClip(nodeNames[j].replace(\"/\",\"@^\") + \"_colorFlashMovieclip\", framesPerSec);\t\t\t\r\n            //\r\n\t\t\tvar _mcInst = Q3D.movieClipInstance(nodeNames[j].replace(\"/\",\"@^\") + \"_colorFlashInstance\", _mc);\r\n            if (flashTimes === undefined) {\r\n                _mcInst.setMaterialColorFlashPlayer(nodeExist, newColor, speed, 1, isEmissiveColor);\r\n                _mcInst.setPlayOptions(0,true);  \r\n                _mcInst.play();\r\n            } else {\r\n                _mcInst.setMaterialColorFlashPlayer(nodeExist, newColor, speed, flashTimes, isEmissiveColor);\r\n                _mcInst._clearMovieClipInstanceOnLastFrame(framesPerSec * speed * flashTimes * 2, function(mci, key) {\r\n\t\t\t\t\tvar mciName = mci.getCName(),\r\n\t\t\t\t\t\tnodePath = mciName.substring(0, mciName.length - 19).replace(\"@^\",\"/\");\r\n\r\n\t\t\t\t\tfor (var i = 0; i < mapObj._clrFlashObj.length; i++) {\r\n\t\t\t\t\t\tif(nodePath === mapObj._clrFlashObj[i]) {\r\n\t\t\t\t\t\t\tmapObj._restoreModelMaterial(mapObj._clrFlashObj[i]);\r\n\t\t\t\t\t\t\tmapObj._clrFlashObj.splice(i, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} \t\r\n\t\t\t\t});  \r\n\t\t\t\t_mcInst.setPlayOptions(0,false);              \r\n                _mcInst.play();\r\n            }\r\n        }\r\n\r\n        return this;\r\n    },\r\n\t\r\n    // @method clearBatchModelColorFlash(nodeNames?: Array): this\r\n    // \r\n    clearBatchModelColorFlash: function (nodeNames) {\r\n                \r\n\t\tif(typeof this._clrFlashObj === \"undefined\" || this._clrFlashObj.length == 0)\t\r\n            return null;\r\n\t\t\r\n\t\t//var _wm = this._map3d.getWorldManager();\t\t\r\n\t\tif(typeof nodeNames == \"undefined\")\t\r\n\t\t{\r\n\t\t\t//\r\n\t\t\tfor (var i = 0; i < this._clrFlashObj.length; i++) {\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tvar nodePath = this._clrFlashObj[i],\r\n\t\t\t\t\tinstName = nodePath.replace(\"/\",\"@^\") + \"_colorFlashInstance\";\r\n\t\t\t\tthis._restoreModelMaterial(nodePath);          \r\n\t\t\t\tthis.clearMovieClip(instName, 0, false);\r\n\t\t\t}\r\n\t\t\tdelete this._clrFlashObj;\r\n\t\t}\r\n\t\telse{\r\n            if (!Q3D.Util.isArray(nodeNames) || typeof nodeNames[0] !== 'string') \r\n            \treturn null;    \r\n\t\t\t//\r\n\t\t\tfor(var j = 0; j < nodeNames.length ; j++) {\r\n\t\t\t\tvar currNodePath = nodeNames[j];\r\n\t\t\t\t\r\n\t\t\t\tfor(var i = 0; i < this._clrFlashObj.length; i++) {\r\n\t\t\t\t\tif(currNodePath === this._clrFlashObj[i]) {\r\n\t\t\t\t\t\tthis._restoreModelMaterial(currNodePath);\r\n\t\t\t\t\t\tthis.clearMovieClip(currNodePath.replace(\"/\",\"@^\") + \"_colorFlashInstance\", 0, false);\r\n\t\t\t\t\t\tthis._clrFlashObj.splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\t\t\t\r\n        return this;\t\r\n    },\r\n   \r\n    // @method setBatchModelTransparentFlash(nodeNames: Array, speed: Number, flashTimes?: Number): this\r\n    //  clearModelTransparentFlash\r\n    setBatchModelTransparentFlash: function (nodeNames, speed, flashTimes) {\r\n\t\t\r\n        if (!Q3D.Util.isArray(nodeNames) || typeof nodeNames[0] !== 'string') \r\n            return null;    \r\n        \r\n        if(typeof this._transFlashObj === \"undefined\")\r\n\t\t\tthis._transFlashObj = [];  \t        \r\n\r\n\t\t//\t\r\n\t\tthis.clearBatchModelTransparentFlash(nodeNames);\r\n\t\t\r\n        var framesPerSec = 50;\r\n        for (var j = 0 ; j < nodeNames.length; j++) {\r\n            var nodeExist = this.getSceneNode(nodeNames[j]);\r\n            if (nodeExist == null )\r\n                continue;\r\n            this._transFlashObj.push(nodeNames[j]);\r\n\t\t\t//\r\n\t\t\tvar _mc = Q3D.movieClip(nodeNames[j].replace(\"/\",\"@^\") + \"_transparentFlashMovieclip\", framesPerSec);\r\n            //\r\n            var _mcInst = Q3D.movieClipInstance(nodeNames[j].replace(\"/\",\"@^\") + \"_transparentFlashInstance\", _mc);\r\n            if (flashTimes == undefined) {\r\n                _mcInst.setMaterialFadePlayer(nodeExist, Q3D.Enums.fadeType.fadeFlash, speed, 1);\r\n                _mcInst.setPlayOptions(0,true);  \r\n                _mcInst.play();\r\n            } else {\r\n                _mcInst.setMaterialFadePlayer(nodeExist, Q3D.Enums.fadeType.fadeFlash, speed, flashTimes);\r\n                _mcInst._clearMovieClipInstanceOnLastFrame(framesPerSec * speed * flashTimes * 2, function(mci, key) {\t\t\t\t\t\r\n\t\t\t\t\tvar mciName = mci.getCName(),\r\n\t\t\t\t\t\tnodePath = mciName.substring(0, mciName.length - 25).replace(\"@^\",\"/\");\r\n\r\n\t\t\t\t\tfor (var i = 0; i < mapObj._transFlashObj.length; i++) {\r\n\t\t\t\t\t\tif(nodePath === mapObj._transFlashObj[i]) {\r\n\t\t\t\t\t\t\tmapObj._restoreModelMaterial(mapObj._transFlashObj[i]);\r\n\t\t\t\t\t\t\tmapObj._transFlashObj.splice(i, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} \r\n\t\t\t\t});  \r\n                _mcInst.setPlayOptions(0, false);  \r\n                _mcInst.play();            \r\n            }\r\n        }\r\n        return this;\r\n    },\r\n    \r\n    // @method clearBatchModelTransparentFlash(nodePaths: Array): this\r\n    // \r\n    clearBatchModelTransparentFlash: function (nodePaths) {      \r\n\t\tif(typeof this._transFlashObj === \"undefined\" || this._transFlashObj.length == 0)\treturn null;\r\n\t\t\r\n\t\t//var _wm = this._map3d.getWorldManager();\r\n\t\t\r\n\t\tif(typeof nodePaths == \"undefined\")\t\r\n\t\t{\r\n\t\t\t//\r\n\t\t\tfor (var i = 0; i < this._transFlashObj.length; i++) {\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tvar nodePath = this._transFlashObj[i],\r\n\t\t\t\t\tinstName = nodePath + \"_transparentFlashInstance\";\r\n\t\t\t\tthis._restoreModelMaterial(nodePath);          \r\n\t\t\t\tthis.clearMovieClip(instName, 0, false);\r\n\t\t\t}\r\n\t\t\tdelete this._transFlashObj;\r\n\t\t}\r\n\t\telse{\r\n            if (!Q3D.Util.isArray(nodePaths) || typeof nodePaths[0] !== 'string') \r\n            \treturn null;    \r\n\t\t\t//\r\n\t\t\tfor(var j = 0; j < nodePaths.length ; j++) {\r\n\t\t\t\tvar currNodePath = nodePaths[j];\r\n\t\t\t\t\r\n\t\t\t\tfor(var i = 0; i < this._transFlashObj.length; i++) {\r\n\t\t\t\t\tif(currNodePath === this._transFlashObj[i]) {\r\n\t\t\t\t\t\tthis._restoreModelMaterial(currNodePath);\r\n\t\t\t\t\t\tthis.clearMovieClip(currNodePath.replace(\"/\",\"@^\") + \"_transparentFlashInstance\", 0, false);\r\n\t\t\t\t\t\tthis._transFlashObj.splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\t\t\t\r\n        return this;\r\n    },\r\n    \r\n    // @method setModelFadeIn(nodePath: String, speed: Number, restoreMaterial: Boolean): this\r\n    // \r\n    setModelFadeIn: function (nodePath, speed, restoreMaterial) {\r\n        var _node = this.getSceneNode(nodePath);\r\n        if (_node == null)\r\n            return null;     \r\n        \r\n        var _nodeType = _node.getNodeType();\r\n        if (_nodeType == Q3D.Enums.sceneNodeType.SNODE_Model)\r\n            _node.asModel().setCastShadow(1);\r\n        else \r\n            _node.asVecModel().setCastShadow(1);\r\n        \r\n        var _mc = Q3D.movieClip(nodePath.replace(\"/\",\"@^\")  + \"_fadeInMovieclip\", 50);\r\n\t\tvar _mcInst = Q3D.movieClipInstance(nodePath.replace(\"/\",\"@^\")  + \"_fadeInInstance\", _mc);\r\n\r\n        _mcInst.setMaterialFadePlayer(_node, Q3D.Enums.fadeType.fadeIn, speed, 1.0);\r\n        _mcInst.onMovieClipInstancePassFrame(50 * speed, function(mci, key) {\t\t\r\n\t\t\tvar mciName = mci.getCName();\t\t\t\r\n\t\t\tsetTimeout(function() {\r\n                mapObj.clearMovieClip(mciName, key, false);\r\n\t\t\t\tif(restoreMaterial) {\r\n\t\t\t\t\tvar nodePath = mciName.substring(0, mciName.length - 15);\r\n\t\t\t\t\tmapObj._restoreModelMaterial(nodePath.replace(\"@^\",\"/\"));\r\n\t\t\t\t}\t\t\t\t\r\n            }, 100);\r\n\t\t});\r\n        \r\n        _mcInst.setPlayOptions(0,false);  \r\n        _mcInst.play();\r\n        return this;\r\n    },\r\n    // @method setModelFadeOut(nodePath: String, speed: Number, restoreMaterial: Boolean): this\r\n    // \r\n    setModelFadeOut: function (nodePath, speed, restoreMaterial) {\r\n        var _node = this.getSceneNode(nodePath);\r\n        if (_node == null)\r\n            return null;\r\n        \r\n        var _nodeType = _node.getNodeType();\r\n        if (_nodeType == Q3D.Enums.sceneNodeType.SNODE_Model)\r\n            _node.asModel().setCastShadow(0);\r\n        else \r\n            _node.asVecModel().setCastShadow(0);\r\n        \r\n        var _mc = Q3D.movieClip(nodePath.replace(\"/\",\"@^\") + \"_fadeOutMovieclip\", 50);\r\n\t\tvar _mcInst = Q3D.movieClipInstance(nodePath.replace(\"/\",\"@^\")  + \"_fadeOutInstance\", _mc);\r\n\r\n        _mcInst.setMaterialFadePlayer(_node, Q3D.Enums.fadeType.fadeOut, speed, 1.0);\r\n        _mcInst.onMovieClipInstancePassFrame(50 * speed, function(mci, key) {\t\r\n\t\t\tvar mciName = mci.getCName();\r\n\t\t\t\r\n\t\t\tsetTimeout(function() {\r\n                mapObj.clearMovieClip(mciName, key, false);\r\n\t\t\t\tif(restoreMaterial) {\r\n\t\t\t\t\tvar nodePath = mciName.substring(0, mciName.length - 16);\r\n\t\t\t\t\tmapObj._restoreModelMaterial(nodePath.replace(\"@^\",\"/\"));\r\n\t\t\t\t}\t\t\t\t\r\n            }, 100);\r\n\t\t});\r\n\r\n        _mcInst.setPlayOptions(0,false);  \r\n        _mcInst.play();\r\n        return this;\r\n    },\r\n    \r\n    // @method proportionHeightStretching(nodePath: String, animationName: String, options: NodeAnimation options): QNodeAnimation\r\n    //  QNodeAnimation  \r\n    proportionHeightStretching: function (nodePath, animationName, options) {    \r\n        var DefaultNodeAnimationOptions = {\r\n            StartHeightScale: null, //\r\n            EndHeightScale: 1.0,//\r\n            Duration: 5,//\r\n            OnAnimationEnd: null //\r\n        }      \r\n\r\n        Q3D.Util.jQueryExtend(true, DefaultNodeAnimationOptions, options);\r\n        \r\n        var _node = this.getSceneNode(nodePath);\r\n        if (_node == null) return null;        \r\n        \r\n        //\r\n        var Current = {\r\n            Translate: _node.getPosition(),\r\n            Rotate: _node.getOrientation(1),\r\n            Scale: _node.getScale(1)\r\n        }\r\n        _node.setNodeAnimationName(\"\");           \r\n        \r\n        //\r\n        var _rm = this._map3d.getResourceManager();\r\n        var _ani = _rm.getResource(Q3D.Enums.resourceType.ANINODE, animationName);        \r\n        if (_ani == null) {\r\n            _ani = _rm.registerResource(Q3D.Enums.resourceType.ANINODE, animationName).asNodeAnimation();\r\n            _ani.createEmpty();\r\n        } else {\r\n            _ani = _ani.asNodeAnimation();\r\n            _ani.removeAllKeyframes();\r\n        }\r\n        \r\n        var startScale = Q3D.vector3(Current.Scale);\r\n        if (DefaultNodeAnimationOptions.StartHeightScale) { //\r\n            startScale = Q3D.vector3(1.0,DefaultNodeAnimationOptions.StartHeightScale,1.0);\r\n            _node.setScale(startScale.get());\r\n        }\r\n        //       \r\n        var targetScale = Q3D.vector3(startScale.x , startScale.y * DefaultNodeAnimationOptions.EndHeightScale, startScale.z );\r\n        _ani.addKeyframe(Current.Translate, Current.Rotate, startScale.get(), 0);\r\n        _ani.addKeyframe(Current.Translate, Current.Rotate, targetScale.get(), DefaultNodeAnimationOptions.Duration);\r\n        //_ani.updateKey();\r\n        _ani.setLineType(0,0,1);\r\n        \r\n        _node.setNodeAnimationName(animationName);\r\n        _node.setAlwaysHoldResource(1);\r\n        _node.loadAllResource();    \r\n        \r\n        var _aniState = _node.getNodeAnimationState();\r\n        _aniState.setAutoPlay(1);\r\n        _aniState.play();\r\n        \r\n        if (Q3D.Util.isFunction(DefaultNodeAnimationOptions.OnAnimationEnd)) {\r\n            mapObj._map3d.setOnAnimationEndListener(_aniState);\r\n            mapObj.on(\"onAnimationEnd\", DefaultNodeAnimationOptions.OnAnimationEnd);\r\n        }\r\n        \r\n        return _ani;        \r\n    },\r\n});","// @namespace Map\r\n// @section POI\r\nQ3D.Map.include({\r\n    // @method createPOI(nodePath: String, options?: POI options): QPOINode\r\n    // POINode\"/[]/POI\" QPOINode \r\n    createPOI: function (nodePath, options) {\r\n        var DefaultCreateOption = {\r\n            Position: null,//Vector3\r\n            Orientation: null,//Vector3\r\n            OrientationType: Q3D.Enums.nodeOrientationType.Self,\r\n            Scale: null,//Vector3\r\n            POIOptions: {\r\n                FontSize: 20,\r\n                FontName: \"\",\r\n                FontColor: Q3D.colourValue(\"#000000\", 1),//ColourValue\r\n                CharScale: 1.0,\r\n                Text: null,\r\n                Icon: null,\r\n                IconSize: null,//Vector2\r\n                POILayout: Q3D.Enums.poiLayOut.Left,\r\n                POILayoutCustom: null,\t//0LeftTop1.0LeftBottom0.5LeftPOILayoutLeftCustomTopCustomRightCustomBottomCustom\r\n                UIType: Q3D.Enums.poiUIType.CameraOrientedKeepSize,\r\n                IconAlphaEnabled: true,\r\n                FontOutLine: null, //\r\n                FontEdgeColor: null,//ColourValue\r\n                AlphaTestRef: null,\r\n                Location: Q3D.Enums.poiImagePositionType.POI_LOCATE_BOTTOM,\r\n                LocationOffset: null, //LocationPOI_LOCATE_CUSTOMVector2\r\n                BackFrameBorderSize: null, //\r\n                BackBorderColor: null,//ColourValue\r\n                BackFillColor: null,//ColourValue\r\n                LabelMargin: null,//Vector2\r\n                IconLabelMargin: null,//Vector2XY\r\n                SpecialTransparent: true,\r\n                AlwaysOnScreen: false,\r\n\t\t\t\tAbsPriority: null,\r\n\t\t\t\tRelPriority: null,\r\n            },\r\n            OnLoaded: null, //\r\n        }\r\n        Q3D.Util.jQueryExtend(true,DefaultCreateOption, options);\r\n        try {\r\n            \r\n            var ModelNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_POI);              \r\n            if (ModelNodeCreated != null) {\r\n                \r\n                 if (DefaultCreateOption.OnLoaded) {\r\n                    mapObj._map3d.setSceneNodeListener(ModelNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(ModelNodeCreated), DefaultCreateOption.OnLoaded);\r\n                }                \r\n                ModelNodeCreated.trackAllResource();     \r\n\r\n                var ModelAppend = ModelNodeCreated.asPOI();\r\n\r\n                if (DefaultCreateOption.Position != null) {\r\n                    ModelAppend.setPosition(DefaultCreateOption.Position.get());\r\n                }\r\n                \r\n                if (DefaultCreateOption.Orientation != null) {\r\n                    ModelAppend.setOrientation(DefaultCreateOption.Orientation.get(), DefaultCreateOption.OrientationType);\r\n                }\r\n                \r\n                if (DefaultCreateOption.Scale != null) {\r\n                    ModelAppend.setScale(DefaultCreateOption.Scale.get());\r\n                }\r\n\r\n                ModelAppend.setFontName(DefaultCreateOption.POIOptions.FontName);\r\n                ModelAppend.setFontSize(DefaultCreateOption.POIOptions.FontSize);\r\n                ModelAppend.setFontColor(DefaultCreateOption.POIOptions.FontColor.revise().get());\r\n                ModelAppend.setCharScale(DefaultCreateOption.POIOptions.CharScale);\r\n                \r\n                 if (DefaultCreateOption.POIOptions.FontOutLine != null) {\r\n                    ModelAppend.setFontOutLine(DefaultCreateOption.POIOptions.FontOutLine);\r\n                    if (DefaultCreateOption.POIOptions.FontEdgeColor != null)\r\n                        ModelAppend.setFontEdgeColor(DefaultCreateOption.POIOptions.FontEdgeColor.revise().get());\r\n                }\r\n                \r\n                if (DefaultCreateOption.POIOptions.Text != null) {\r\n                    ModelAppend.setText(DefaultCreateOption.POIOptions.Text);\r\n                } else {\r\n                    ModelAppend.setText(nodePath.split('/')[1]);\r\n                }\r\n                if (DefaultCreateOption.POIOptions.Icon != null) {\r\n                    ModelAppend.setIcon(DefaultCreateOption.POIOptions.Icon);\r\n                }\r\n                if (DefaultCreateOption.POIOptions.IconSize != null) {\r\n                    ModelAppend.setIconSize(DefaultCreateOption.POIOptions.IconSize.get());\r\n                }\r\n                ModelAppend.setPOILayout(DefaultCreateOption.POIOptions.POILayout);\r\n                if(DefaultCreateOption.POIOptions.POILayout >= Q3D.Enums.poiLayOut.LeftCustom &&  DefaultCreateOption.POIOptions.POILayout <= Q3D.Enums.poiLayOut.BottomCustom && DefaultCreateOption.POIOptions.POILayoutCustom != null)\r\n\t\t\t\t{\r\n\t\t\t\t\tModelAppend.setPOILayoutCustom(DefaultCreateOption.POIOptions.POILayoutCustom);\r\n\t\t\t\t}\r\n                ModelAppend.setUIType(DefaultCreateOption.POIOptions.UIType);\r\n                ModelAppend.setIconAlphaEnabled(DefaultCreateOption.POIOptions.IconAlphaEnabled);               \r\n               \r\n                if (DefaultCreateOption.POIOptions.AlphaTestRef != null) {\r\n                    ModelAppend.setAlphaTestRef(DefaultCreateOption.POIOptions.AlphaTestRef);\r\n                }\r\n                \r\n                if (DefaultCreateOption.POIOptions.Location == Q3D.Enums.poiImagePositionType.POI_LOCATE_CUSTOM && DefaultCreateOption.POIOptions.LocationOffset != null) {\r\n                    ModelAppend.setLocation(Q3D.Enums.poiImagePositionType.POI_LOCATE_CUSTOM);//[0,0]POI\r\n                    //var x = DefaultCreateOption.POIOptions.IconSize.x / 2 - DefaultCreateOption.POIOptions.LocationOffset.x;\r\n                    //var y = DefaultCreateOption.POIOptions.LocationOffset.y - DefaultCreateOption.POIOptions.IconSize.y / 2;\r\n                    ModelAppend.setLocationOffset(DefaultCreateOption.POIOptions.LocationOffset.get());//xy[20,20]POI\r\n                } else {\r\n                    ModelAppend.setLocation(DefaultCreateOption.POIOptions.Location);\r\n                }\r\n                \r\n                if (DefaultCreateOption.POIOptions.BackFrameBorderSize != null) {\r\n                    ModelAppend.showBackFrame(1);\r\n                    ModelAppend.setBackFrameBorderSize(DefaultCreateOption.POIOptions.BackFrameBorderSize);\r\n                    if (DefaultCreateOption.POIOptions.BackBorderColor != null)\r\n                        ModelAppend.setBackBorderColor(DefaultCreateOption.POIOptions.BackBorderColor.revise().get());\r\n                }\r\n                if (DefaultCreateOption.POIOptions.BackFillColor != null) {\r\n                    ModelAppend.setBackFillColor(DefaultCreateOption.POIOptions.BackFillColor.revise().get());\r\n                }\r\n                if (DefaultCreateOption.POIOptions.LabelMargin != null) {\r\n                    ModelAppend.setLabelMargin(DefaultCreateOption.POIOptions.LabelMargin.get());\r\n                }\r\n                //xy\r\n                if (DefaultCreateOption.POIOptions.IconLabelMargin != null) {\r\n                    ModelAppend.setIconLabelMargin(DefaultCreateOption.POIOptions.IconLabelMargin.get());\r\n                }                \r\n\r\n                if (DefaultCreateOption.POIOptions.SpecialTransparent) {\r\n                    ModelAppend.setSpecialTransparent(DefaultCreateOption.POIOptions.SpecialTransparent ? 1 : 0);\r\n                }\r\n                if (DefaultCreateOption.POIOptions.AlwaysOnScreen) {\r\n                    ModelAppend.setAlwaysOnScreen(DefaultCreateOption.POIOptions.AlwaysOnScreen ? 1 : 0);\r\n                }\r\n                if (Q3D.Util.isInteger(DefaultCreateOption.POIOptions.AbsPriority)) {\r\n                    ModelAppend.setAbsPriority(DefaultCreateOption.POIOptions.AbsPriority);\r\n                }\r\n\t\t\t\tif (Q3D.Util.isInteger(DefaultCreateOption.POIOptions.RelPriority)) {\r\n                    ModelAppend.setRelPriority(DefaultCreateOption.POIOptions.RelPriority);\r\n                }               \r\n                \r\n                return ModelAppend;\r\n            } \r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createPOI: \" + e.message);\r\n            return null;\r\n        }\r\n        return null;\r\n    },      \r\n     \r\n\r\n    // @method setBatchPOIJump(nodeNames: Array, height: Number, jumpTimes?: Number, circleTime?: Number): this\r\n    // POI clearPOIJump\r\n    setBatchPOIJump: function (nodeNames, height, jumpTimes, circleTime) {\r\n        \r\n        if(!!this._poiJumpObj) {\r\n\t\t\tthis.clearPOIJump();\r\n\t\t}\r\n\t\tthis._poiJumpObj = [];  \r\n        \r\n        var framesPerSec = 50;\r\n        circleTime = circleTime || 1.0;\r\n        var _mc = Q3D.movieClip(\"poi_jump_movieclip\", framesPerSec);\r\n        for (var j = 0 ; j < nodeNames.length; j++) {\r\n            var nodeExist = this.getSceneNode(nodeNames[j]);\r\n            if (nodeExist == null || nodeExist.getNodeType() != Q3D.Enums.sceneNodeType.SNODE_POI)\r\n                continue;\r\n            var poiExist = nodeExist.asPOI();\r\n            this._poiJumpObj.push(nodeNames[j]);  \r\n            \r\n            //\r\n            var _mcInst = Q3D.movieClipInstance(nodeNames[j].replace(\"/\",\"@^\") + \"_poiJumpInstance\", _mc);\r\n            //Actor\r\n            var p0 = Q3D.vector3(poiExist.getPosition());\r\n            var p1 = Q3D.vector3(p0.x, p0.y + height, p0.z);\r\n            var keyPairs = [{\r\n                    Key: 0,\r\n                    Pos: p0\r\n                }, {\r\n                    Key: circleTime * framesPerSec / 2,\r\n                    Pos: p1\r\n                }, {\r\n                    Key: circleTime * framesPerSec,\r\n                    Pos: p0\r\n                }\r\n            ];\r\n            if (jumpTimes != undefined) {\r\n                for (var i = 2; i < jumpTimes * 2; i++) {\r\n                    var tmp = {};\r\n                    tmp.Key = (i + 1) * circleTime * framesPerSec / 2;\r\n                    tmp.Pos = i % 2 == 0 ? p1 : p0;\r\n                    keyPairs.push(tmp);\r\n                }\r\n            }\r\n            _mc.addActorTranslateAnimation(\"poi_jump_ani_\" + j, keyPairs);\r\n            _mcInst.setTransformPlayer(\"poi_jump_ani_\" + j, poiExist);\r\n            \r\n            if (jumpTimes == undefined) {\r\n                _mcInst.setPlayOptions(0,true);  \r\n                _mcInst.play();\r\n            } else {                \r\n                //\r\n                var endKey = keyPairs[keyPairs.length-1].Key;\r\n                _mcInst._clearMovieClipInstanceOnLastFrame(endKey);      \r\n\t\t\t\t_mcInst.setPlayOptions(0,false);  \r\n                _mcInst.play();                \r\n            }\r\n        }      \r\n        return this;\r\n    },\r\n    \r\n    // @method setBatchPOIGravityJump(nodeNames: Array, height: Number): this\r\n    // POI\r\n    setBatchPOIGravityJump: function (nodeNames, height) {\r\n        \r\n        //\r\n        //_h1_h2,_h3,_h4\r\n        var _h1 = height, _h2 = _h1 / 7, _h3 = _h1 / 35, _h4 = _h1 / 105;        \r\n        //t = Math.sqrt(2 * h/a)t1 + 2*t2 + 2*t3 + 2*t4 = 1\r\n        var t1 = 1 / 2.28917;\r\n        //\r\n        var a = (2 * _h1) / (t1 * t1);\r\n        //t2,t3,t4\r\n        var t2 = Math.sqrt(2 * _h2 / a);\r\n        var t3 = Math.sqrt(2 * _h3 / a);\r\n        var t4 = Math.sqrt(2 * _h4 / a);\r\n            \r\n        var framesPerSec = 50;\r\n        var _mc = Q3D.movieClip(\"poi_gravity_jump_movieclip\", framesPerSec);\r\n        for (var j = 0 ; j < nodeNames.length; j++) {\r\n            var nodeExist = this.getSceneNode(nodeNames[j]);\r\n            if (nodeExist == null || nodeExist.getNodeType() != Q3D.Enums.sceneNodeType.SNODE_POI)\r\n                continue;\r\n            var poiExist = nodeExist.asPOI();\r\n            var suffixes = this.guid();\r\n            //\r\n            var _mcInst = Q3D.movieClipInstance(\"poi_gravity_jump_instance_\" + suffixes, _mc);          \r\n\r\n            //Actor\r\n            var p0 = Q3D.vector3(poiExist.getPosition());\r\n            var p1 = Q3D.vector3(p0.x, p0.y + _h1, p0.z);\r\n            var p2 = Q3D.vector3(p0.x, p0.y + _h2, p0.z);\r\n            var p3 = Q3D.vector3(p0.x, p0.y + _h3, p0.z);\r\n            var p4 = Q3D.vector3(p0.x, p0.y + _h4, p0.z);\r\n            \r\n            var keyPairs = [{\r\n                    Key: 0,\r\n                    Pos: p1\r\n                }, {\r\n                    Key: t1 * framesPerSec,\r\n                    Pos: p0\r\n                }, {\r\n                    Key: (t1 + t2) * framesPerSec,\r\n                    Pos: p2\r\n                }, {\r\n                    Key: (t1 + t2 * 2) * framesPerSec,\r\n                    Pos: p0\r\n                }, {\r\n                    Key: (t1 + t2 * 2 + t3) * framesPerSec,\r\n                    Pos: p3\r\n                }, {\r\n                    Key: (t1 + t2 * 2 + t3 * 2) * framesPerSec,\r\n                    Pos: p0\r\n                }, {\r\n                    Key: (t1 + t2 * 2 + t3 * 2 + t4) * framesPerSec,\r\n                    Pos: p4\r\n                }, {\r\n                    Key: framesPerSec,\r\n                    Pos: p0\r\n                }\r\n            ];\r\n            \r\n            _mc._addActorTranslateGravityAnimation(\"poi_gravity_ani_\" + suffixes, keyPairs);\r\n            _mcInst.setTransformPlayer(\"poi_gravity_ani_\" + suffixes, poiExist);     \r\n\r\n            //\r\n            _mcInst._clearMovieClipInstanceOnLastFrame(framesPerSec); \r\n\t\t\t_mcInst.setPlayOptions(0,false);  \r\n            _mcInst.play();    \r\n\r\n        }      \r\n        return this;\r\n    },   \r\n    \r\n    // @method clearPOIJump(): this\r\n    // POI\r\n    clearPOIJump: function () {\r\n        if(!this._poiJumpObj) return null;\r\n        var _wm = mapObj._map3d.getWorldManager();\r\n        for (var i = 0; i < this._poiJumpObj.length; i++) {\r\n            var nodePath = this._poiJumpObj[i],\r\n\t\t\t\tinstName = nodePath.replace(\"/\",\"@^\") + \"_poiJumpInstance\";\r\n            this.clearMovieClip(instName, 0, true);            \r\n        }\r\n        _wm.destroyMovieClip(\"poi_jump_movieclip\");       \r\n\t\tdelete this._poiJumpObj;   \r\n        return this;\t\t\r\n    },\r\n    \r\n    // @method setPOIColorAni(nodePath: String, fromClr: ColourValue, toClr: ColourValue, timeSec: Number, isLoop?: Boolean): this\r\n    // POIisLoop  true fromClr->toClr->fromClrfalse fromClr->toClr\r\n    setPOIColorAni: function(nodePath, fromClr, toClr, timeSec, isLoop) {\r\n        var nodeExist = this.getSceneNode(nodePath);\r\n        if (nodeExist == null || nodeExist.getNodeType() != Q3D.Enums.sceneNodeType.SNODE_POI) return null;\r\n        var poiExist = nodeExist.asPOI();\r\n\t\r\n    \tisLoop = isLoop || false;\r\n\t\tpoiExist.setAlwaysOnScreen(1);\r\n\t\tif(!!poiExist.getText()) {\r\n\t\t\tpoiExist.enableFontColorAni(1);\r\n\t\t\tpoiExist.setFontColorAni(timeSec, fromClr.get(), toClr.get(), isLoop ? 1 : 0);\r\n\t\t}\t\t\r\n\t\tif(!!poiExist.getIcon()) {\t\t\r\n\t\t\tpoiExist.enableIconColorAni(1);\r\n\t\t\tpoiExist.setIconColorAni(timeSec, fromClr.get(), toClr.get(), isLoop ? 1 : 0);\r\n\t\t}\r\n        return this;\r\n    },\r\n    \r\n    // @method clearPOIColorAni(nodePath: String): this\r\n    // POI\r\n    clearPOIColorAni: function (nodePath) {\r\n        var nodeExist = this.getSceneNode(nodePath);\r\n        if (nodeExist == null || nodeExist.getNodeType() != Q3D.Enums.sceneNodeType.SNODE_POI) return null;\r\n        var poiExist = nodeExist.asPOI();\r\n        \r\n\t\tpoiExist.setAlwaysOnScreen(0);\r\n        if(!!poiExist.getText()) {\r\n            poiExist.enableFontColorAni(0);\r\n        }\r\n        if(!!poiExist.getIcon()) {\t\r\n            poiExist.enableIconColorAni(0);\r\n        }\r\n        return this;\r\n    },\r\n\r\n});","// @namespace Map\r\n// @section \r\nQ3D.Map.include({\r\n\r\n    // @method enableCullPlane(areaName: String, options?: CullPlane options): this\r\n    // \r\n\tenableCullPlane: function (areaName, options) {  \r\n        var defaultEditModeOption = { \r\n            VMin: null, //AABBArea\r\n            VMax: null,\r\n            MeshHeight: 7.5,//, \r\n            HandlerMesh: \"Mesh/lxlan.mesh\",// 15           \r\n            MeshScale: Q3D.vector3(1,1,1),//          \r\n        }\r\n        Q3D.extend(defaultEditModeOption,options);\r\n        try {      \r\n            var area = this.getArea(areaName);\r\n            if (area == null) return null;\r\n            \r\n            if (defaultEditModeOption.VMin == null || defaultEditModeOption.VMax == null) {\r\n                var VMin = Q3D.vector3(0,0,0).get();\r\n                var VMax = Q3D.vector3(0,0,0).get();\r\n                area.getAABB(0, VMin, VMax);\r\n                defaultEditModeOption.VMin = Q3D.vector3(VMin);\r\n                defaultEditModeOption.VMax = Q3D.vector3(VMax);\r\n            }\r\n            \r\n            this._map3d.createCullPlanes(areaName, defaultEditModeOption.VMin.get(), defaultEditModeOption.VMax.get(), \r\n                defaultEditModeOption.MeshHeight, defaultEditModeOption.HandlerMesh, defaultEditModeOption.MeshScale.get());\r\n                \r\n                        \r\n            this._cullMode = false;\r\n            this.attachMouseEvent(\"OnLButtonDown\", \"_startCullPlanes\", (function (options) {\r\n                var im = this._map3d.getInputManager(); \r\n                if (options.NearestNode != null) {\r\n                    options.NearestNode.showAux(0, 0);\r\n                    if (options.NearestNode.getAlias() == \"Handler\") {\r\n                        this._cullMode = true;\r\n                        im.sendActionMsg( Q3D.Enums.actionType.OBJECTSELECT_MOVAUX, Q3D.Enums.actionMsg.SWITCH_USAGE, 0, 0 );\r\n                        im.bindControlAction( Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.OBJECTSELECT_MOVAUX );\t//\r\n                    }\r\n                }\r\n            }).bind(this));\r\n            this.attachMouseEvent(\"OnLButtonUp\", \"_endCullPlanes\", (function (options) {\r\n                if (this._cullMode) {\r\n                    this._map3d.updateCullPlanes();\r\n                }\r\n                this._cullMode = false;\r\n                var im = this._map3d.getInputManager(); \r\n                im.bindControlAction( Q3D.Enums.device.MOUSE, Q3D.Enums.mouse.LBUTTON, Q3D.Enums.actionType.TRANS_SCENE  );\t\r\n                im.sendActionMsg( Q3D.Enums.actionType.OBJECTSELECT_MOVAUX, Q3D.Enums.actionMsg.SWITCH_USAGE, 1, 0 );\r\n                \r\n            }).bind(this));\r\n            this.attachMouseEvent(\"OnMouseMove\", \"_updateCullPlanes\", (function (options) {\r\n                if (this._cullMode) {\r\n                    this._map3d.updateCullPlanes();\r\n                }                                \r\n            }).bind(this));                 \r\n        \r\n        } catch (e) {\r\n            this.showNotice(\"\", \"enableCullPlane: \" + e.message);\r\n            return null;\r\n        }\r\n        return  this;\r\n\t},\r\n    // @method disableCullPlane(): this\r\n    // \r\n    disableCullPlane: function() {\r\n        this._map3d.destroyCullPlanes();\r\n        this.detachMouseEvent(\"OnLButtonDown\", \"_startCullPlanes\"); \r\n        this.detachMouseEvent(\"OnLButtonUp\", \"_endCullPlanes\"); \r\n        this.detachMouseEvent(\"OnMouseMove\", \"_updateCullPlanes\"); \r\n        return this;\r\n    },\r\n    \r\n    // @method enableLaserDistance(lineColor: ColourValue): this\r\n    // : root\r\n    //  `<Physics enabled=\"true\" mainEnabled=\"true\" acsEnabled=\"false\">`\r\n    //   ` <PhyWorld meshAutoSetup=\"true\" fPRoamType=\"0\" id=\"0\" />`\r\n    //  `</Physics>`\r\n    enableLaserDistance: function(lineColor) {\r\n        if (!lineColor) {\r\n            lineColor = Q3D.colourValue('#ff0000', 1);\r\n        }\r\n        this._rulerColor = lineColor;\r\n        this.attachMouseEvent(\"OnLButtonDown\", \"_laserDist\", (function (options) {\r\n            var v2 = Q3D.vector2I(options.logX, options.logY).get();\r\n            this._map3d.getLaserDist(v2, this._rulerColor.get());\r\n        }).bind(this));\r\n        return this;\r\n    },\r\n    // @method enableRulerDistance(lineColor: ColourValue): this\r\n    // \r\n    enableRulerDistance: function(lineColor) {\r\n        if (!lineColor) {\r\n            lineColor = Q3D.colourValue('#ff0000', 1);\r\n        }\r\n        this._rulerColor = lineColor;\r\n        this._rulerStatus = 1;\r\n        this.attachMouseEvent(\"OnLButtonDown\", \"_rulerDist\", (function (options) {\r\n            var v2 = Q3D.vector2I(options.logX, options.logY).get();\r\n            if (this._rulerStatus == 1) {\r\n                this._map3d.setRulerDistStart(v2, this._rulerColor.get(), -1);\r\n                this._rulerStatus = 2;\r\n            } else if (this._rulerStatus == 2) {\r\n                this._map3d.rulerDist(v2, -1);\r\n                this._rulerStatus = 1;\r\n            }\r\n        }).bind(this));\r\n        this.attachMouseEvent(\"OnMouseMove\", \"_rulerDist\", (function (options) {\r\n        var v2 = Q3D.vector2I(options.logX, options.logY).get();\r\n            if (this._rulerStatus == 2) {\r\n                this._map3d.rulerDist(v2, -1);\r\n            }                           \r\n        }).bind(this)); \r\n        return this;\r\n    },\r\n\t\r\n\t// @method drawPolyline(areaName: String, options?: Draw options): this\r\n    // :   Ctrl+\r\n\tdrawPolyline: function(areaName, options) {\r\n\t\tvar defaultOptions = {\r\n\t\t\tMaterial: null, //polyline\t\t\r\n\t\t\tColor: Q3D.colourValue(\"#FF0000\", 1), //\r\n\t\t\tAlpha: 1, //\r\n\t\t\tLineWidth: 2, //\r\n\t\t\tPOIOptions: {\r\n\t\t\t\tIcon: null,\r\n\t\t\t\tIconSize: null,\r\n\t\t\t\tFontSize: 16, //\r\n\t\t\t\tFontName: \"\", //\r\n\t\t\t\tFontColor: Q3D.colourValue(\"#FFFFFF\", 1), //\r\n\t\t\t\tFontEdgeColor: Q3D.colourValue(\"#000000\", 1), //\r\n\t\t\t\tFontOutLine: 1, //\r\n\t\t\t},\r\n\t\t\tShowDistance: true,  //\r\n\t\t};\r\n\t\tQ3D.Util.jQueryExtend(true, defaultOptions, options);\r\n\t\t//POI\r\n\t\tvar parentNodeName = \"_rulerPolylinesAndPOI\",\r\n\t\t\tparentNodePath = areaName + \"/\" + parentNodeName,\r\n\t\t\tparentNode = this.getSceneNode(areaName, parentNodeName);\t\t\r\n\t\tif(!parentNode) {\r\n\t\t\tparentNode = this.getArea(areaName).createTopNode(Q3D.Enums.sceneNodeType.SNODE_Group, parentNodeName);\r\n\t\t}\r\n\t\t//QLineNode\r\n\t\tvar lineNodeName = \"_rulerPolyline\" + this.guid(),\r\n\t\t\tlineNodePath = parentNodePath + \"/\" + lineNodeName,\r\n\t\t\tlineNodeCreated = this.createCommonNode(lineNodePath, Q3D.Enums.sceneNodeType.SNODE_Line);\r\n\t\t\t\r\n\t\tif(!lineNodeCreated) {\r\n\t\t\treturn null;\r\n\t\t}\t\r\n\t\tvar polylineAppend = lineNodeCreated.asLine();\t\t\r\n\t\t//\r\n\t\tif (defaultOptions.Material != null) {\r\n\t\t\tpolylineAppend.setMaterial(defaultOptions.Material);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar tempMatName = \"defaultMaterialForLine-\" + this.guid(), //\r\n\t\t\t\tmaterial = this._map3d.getResourceManager().getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n\t\t\t\t\r\n\t\t\tif (material == null) {\r\n\t\t\t\tmaterial = this.createSimpleMaterial(tempMatName, {\r\n\t\t\t\t\tAlpha: defaultOptions.Alpha,\r\n\t\t\t\t\tEmissiveColor: defaultOptions.Color,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tmaterial = material.asMaterial();\r\n\t\t\t\tmaterial.setAlpha(defaultOptions.Alpha);\r\n\t\t\t\tmaterial.setEmissiveColor(defaultOptions.Color.get());\r\n\t\t\t}                 \r\n\t\t\tpolylineAppend.setMaterial(tempMatName);\r\n\t\t}\t\t\t\t\t\t\r\n\r\n\t\t//\r\n\t\tthis.detachMouseEvent(\"OnLButtonDown\", \"_drawRulerPolyline\");\r\n\t\tthis.detachMouseEvent(\"OnMouseMove\", \"_drawRulerPolyline\");\r\n\t\tthis.detachMouseEvent(\"OnRButtonDblClk\", \"_drawRulerPolyline\");\r\n\t\tthis.detachMouseEvent(\"OnRButtonDown\", \"_drawRulerPolyline\");\t\r\n\t\tthis._drawPolyLineStatus = 0;\r\n\t\t//\r\n\t\tthis.attachMouseEvent(\"OnLButtonDown\", \"_drawRulerPolyline\", function(options){\r\n\t\t\tif(options.GroundCoord != null) {\t\t\t\t\r\n\t\t\t\tvar area = mapObj.getArea(areaName),\r\n\t\t\t\t\tcurrPosV3 = area.toLocalPos(options.GroundCoord);\t\r\n\t\t\t\t//POI\r\n\t\t\t\tvar poiOptions = {\r\n\t\t\t\t\tPosition: null,       \r\n\t\t\t\t\tPOIOptions: {\r\n\t\t\t\t\t\tIcon: defaultOptions.POIOptions.Icon,\r\n\t\t\t\t\t\tIconSize: defaultOptions.POIOptions.IconSize,\r\n\t\t\t\t\t\tText: \"\",\r\n\t\t\t\t\t\tFontSize: defaultOptions.POIOptions.FontSize,\r\n\t\t\t\t\t\tFontName: defaultOptions.POIOptions.FontName,\r\n\t\t\t\t\t\tFontColor: defaultOptions.POIOptions.FontColor,\r\n\t\t\t\t\t\tUIType: Q3D.Enums.poiUIType.CameraOrientedKeepSize,\r\n\t\t\t\t\t\tPOILayout: Q3D.Enums.poiLayOut.Left,\r\n\t\t\t\t\t\tLocation: Q3D.Enums.poiImagePositionType.POI_LOCATE_VCENTER,\r\n\t\t\t\t\t\tFontOutLine: defaultOptions.POIOptions.FontOutLine,\r\n\t\t\t\t\t\tFontEdgeColor: defaultOptions.POIOptions.FontEdgeColor, \r\n\t\t\t\t\t\tAlwaysOnScreen: true,\r\n\t\t\t\t\t}\t\r\n\t\t\t\t};\r\n\t\t\t\t//_drawPolyLineStatus: 0 -  1 -  2 - \r\n\t\t\t\tswitch(mapObj._drawPolyLineStatus) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t//QLineNode\r\n\t\t\t\t\t\tpolylineAppend.setPosition(currPosV3);\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\tmapObj._currentLine = null;\t\t\r\n                        //\r\n\t\t\t\t\t\t//mapObj._drawPolyLineStatus = 1;\r\n                        //break;\r\n\t\t\t\t\tcase 1: \r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\tmapObj._currentLine = polylineAppend.addLine();\r\n\t\t\t\t\t\tvar line = mapObj._currentLine;\r\n\t\t\t\t\t\tline.setLineType(0);\r\n\t\t\t\t\t\tline.setLineWidth(defaultOptions.LineWidth);\t\t\t\t\t\r\n\t\t\t\t\t\t//QLineNode\t\t\r\n\t\t\t\t\t\tvar tempPosV3 = Q3D.vector3(currPosV3),\r\n\t\t\t\t\t\t\tnodePos = Q3D.vector3(polylineAppend.getPosition());\r\n\t\t\t\t\t\ttempPosV3.subtract(nodePos);\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tline.addPoint(tempPosV3.get());\r\n\t\t\t\t\t\tline.addPoint(tempPosV3.get());\r\n\t\t\t\t\t\t//PolylinePOI\r\n\t\t\t\t\t\tmapObj._poiParentName = \"_rulerPOIParent\" + mapObj.guid();\r\n\t\t\t\t\t\tmapObj.createCommonNode(parentNodePath + \"/\" + mapObj._poiParentName, Q3D.Enums.sceneNodeType.SNODE_Group);\t\t\t\t\t\r\n\t\t\t\t\t\t//\"\"POI\r\n\t\t\t\t\t\tpoiOptions.Position = Q3D.vector3(currPosV3);\r\n\t\t\t\t\t\tif(defaultOptions.ShowDistance) {\r\n\t\t\t\t\t\t\tpoiOptions.POIOptions.Text = \"\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tpoiOptions.POIOptions.AlwaysOnScreen = true;\r\n\t\t\t\t\t\tmapObj.createPOI(areaName + \"/\" + mapObj._poiParentName + \"/_rulerPOI\" + mapObj.guid(), poiOptions);\r\n\t\t\t\t\t\t//\"\"POI\r\n\t\t\t\t\t\tpoiOptions.Position = Q3D.vector3(currPosV3);\r\n\t\t\t\t\t\tpoiOptions.POIOptions.Text = \"\";\r\n\t\t\t\t\t\tpoiOptions.POIOptions.AlwaysOnScreen = false;\r\n\t\t\t\t\t\tmapObj.createPOI(areaName + \"/\" + mapObj._poiParentName + \"/\" + mapObj._poiParentName + \"_end\", poiOptions);\t\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\tmapObj._drawPolyLineStatus = 2;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tvar line = mapObj._currentLine,\r\n\t\t\t\t\t\t\ttempPosV3 = Q3D.vector3(currPosV3),\r\n\t\t\t\t\t\t\tnodePos = Q3D.vector3(polylineAppend.getPosition());\r\n\t\t\t\t\t\ttempPosV3.subtract(nodePos);\r\n\t\t\t\t\t\tline.addPoint(tempPosV3.get());\r\n\t\t\t\t\t\tvar count = line.getPointCount();\r\n\t\t\t\t\t\tline.setPoint(count - 2, tempPosV3.get());\r\n\t\t\t\t\t\tif(defaultOptions.ShowDistance) {\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tvar sartPt = line.getPoint(count - 3),\r\n\t\t\t\t\t\t\t\tendPt = line.getPoint(count - 2);\r\n\t\t\t\t\t\t\tvar dx = endPt.x - sartPt.x,\r\n\t\t\t\t\t\t\t\tdy = endPt.y - sartPt.y,\r\n\t\t\t\t\t\t\t\tdz = endPt.z - sartPt.z;\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar distance = Math.sqrt(dx * dx + dy * dy + dz * dz);\r\n\t\t\t\t\t\t\t//POI\r\n\t\t\t\t\t\t\tpoiOptions.POIOptions.Text = Q3D.Util.formatNum(distance, 2) + \" \";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//POI\t\t\t\t\t\r\n\t\t\t\t\t\tpoiOptions.Position = Q3D.vector3(currPosV3);\r\n\t\t\t\t\t\tmapObj.createPOI(areaName + \"/\" + mapObj._poiParentName + \"/_rulerPOI\" + mapObj.guid(), poiOptions);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\t\r\n\t\t});\t\r\n\t\t\r\n\t\t//\r\n\t\tthis.attachMouseEvent(\"OnMouseMove\", \"_drawRulerPolyline\", function(options){\t\t\t\t\t\t\r\n\t\t\tif(mapObj._drawPolyLineStatus === 2 && options.GroundCoord != null ) {\t\t\t\t\t\r\n\t\t\t\tvar area = mapObj.getArea(areaName),\r\n\t\t\t\t\tcurrPosV3 = area.toLocalPos(options.GroundCoord);\t\t\t\t\t\t\r\n\t\t\t\t//line\r\n\t\t\t\tvar line = mapObj._currentLine,\r\n\t\t\t\t\ttempPosV3 = Q3D.vector3(currPosV3),\r\n\t\t\t\t\tnodePos = Q3D.vector3(polylineAppend.getPosition()),\r\n\t\t\t\t\tcount = line.getPointCount();\r\n\t\t\t\ttempPosV3.subtract(nodePos);\r\n\t\t\t\tline.setPoint(count - 1, tempPosV3.get());\r\n\t\t\t\t//POI\r\n\t\t\t\tvar poiEndAppend = mapObj.getSceneNode(areaName, mapObj._poiParentName + \"_end\");\r\n\t\t\t\tif(poiEndAppend != null) {\r\n\t\t\t\t\tpoiEndAppend.setPosition(currPosV3);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t});\t\t\r\n\t\t\r\n\t\t//\r\n\t\tthis.attachMouseEvent(\"OnRButtonDblClk\", \"_drawRulerPolyline\", function(options){\r\n\t\t\tif(mapObj._drawPolyLineStatus === 2 && options.GroundCoord != null) {\t\t\t\t\t\r\n\t\t\t\tvar area = mapObj.getArea(areaName),\r\n\t\t\t\t\tcurrPosV3 = area.toLocalPos(options.GroundCoord);\t\t\t\t\t\t\r\n\t\t\t\t//\r\n\t\t\t\tmapObj.setMouseEvent(\"OnMouseMove\", \"_drawRulerPolyline\", false);\r\n\t\t\t\t//line\t\t\t\t\t\r\n\t\t\t\tvar line = mapObj._currentLine,\r\n\t\t\t\t\ttempPosV3 = Q3D.vector3(currPosV3),\r\n\t\t\t\t\tnodePos = Q3D.vector3(polylineAppend.getPosition()),\r\n\t\t\t\t\tcount = line.getPointCount();\r\n\t\t\t\ttempPosV3.subtract(nodePos);\r\n\t\t\t\tline.setPoint(count - 1, tempPosV3.get());\r\n\t\t\t\t//POItext\r\n\t\t\t\tvar text = \"\";\r\n\t\t\t\tif(defaultOptions.ShowDistance) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tvar distance = 0;\r\n\t\t\t\t\tfor(var i = 1; i <= count - 1; ++i) {\t\t\r\n\t\t\t\t\t\tvar sartPt = line.getPoint(i - 1),\r\n\t\t\t\t\t\t\tendPt = line.getPoint(i);\r\n\t\t\t\t\t\tvar dx = endPt.x - sartPt.x,\r\n\t\t\t\t\t\t\tdy = endPt.y - sartPt.y,\r\n\t\t\t\t\t\t\tdz = endPt.z - sartPt.z;\r\n\t\t\t\t\t\tdistance += Math.sqrt(dx * dx + dy * dy + dz * dz);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttext = \"\" + Q3D.Util.formatNum(distance, 2) + \" \";\r\n\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t\tvar poiEndAppend = mapObj.getSceneNode(areaName, mapObj._poiParentName + \"_end\");\r\n\t\t\t\tif(poiEndAppend != null) {\r\n\t\t\t\t\tpoiEndAppend.setPosition(currPosV3);\r\n\t\t\t\t\tpoiEndAppend.asPOI().setAlwaysOnScreen(1);\r\n\t\t\t\t\tpoiEndAppend.asPOI().setText(text);\r\n\t\t\t\t}\r\n\t\t\t\t//\r\n\t\t\t\tmapObj._currentLine = null;\r\n\t\t\t\tmapObj._poiParentName = \"\";\r\n\t\t\t\tmapObj._drawPolyLineStatus = 1;\r\n\t\t\t\t//\r\n\t\t\t\tmapObj.setMouseEvent(\"OnMouseMove\", \"_drawRulerPolyline\", true);\r\n\t\t\t}\t\t\t\t\t\r\n\t\t});\r\n\t\r\n\t\t//Ctrl+\r\n\t\tthis.attachMouseEvent(\"OnRButtonDown\", \"_drawRulerPolyline\", function(options){\r\n\t\t\tif(mapObj._drawPolyLineStatus === 2 && options.CtrlPressDown) {\r\n\t\t\t\tvar lineCount = polylineAppend.getLineCount(),\r\n\t\t\t\t\tline = mapObj._currentLine;\r\n\t\t\t\t//\r\n\t\t\t\tif(lineCount > 0) {\r\n\t\t\t\t\tif(line != null) {\r\n\t\t\t\t\t\tline.removeAll();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpolylineAppend.removeLine(lineCount - 1);\r\n\t\t\t\t}\t\r\n\t\t\t\t//POI\r\n\t\t\t\tmapObj.destroySceneNode(areaName, mapObj._poiParentName);\r\n\t\t\t\t//\r\n\t\t\t\tmapObj._currentLine = null;\r\n\t\t\t\tmapObj._poiParentName = \"\";\r\n\t\t\t\tmapObj._drawPolyLineStatus = 1;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t// @method clearPolyline(areaName: String): this\r\n    // drawPolyline\r\n\tclearPolyline: function(areaName) {\r\n\t\t//POI\r\n\t\tthis.destroySceneNode(areaName, \"_rulerPolylinesAndPOI\");\r\n\t\t//\r\n\t\tthis.detachMouseEvent(\"OnLButtonDown\", \"_drawRulerPolyline\");\r\n\t\tthis.detachMouseEvent(\"OnMouseMove\", \"_drawRulerPolyline\");\r\n\t\tthis.detachMouseEvent(\"OnRButtonDblClk\", \"_drawRulerPolyline\");\r\n\t\tthis.detachMouseEvent(\"OnRButtonDown\", \"_drawRulerPolyline\");\r\n\t\t//\r\n\t\tdelete this._currentLine;\r\n\t\tdelete this._poiParentName;\r\n\t\tdelete this._drawPolyLineStatus;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n    // @method disableDistanceTool(): this\r\n    // \r\n    disableDistanceTool: function() {\r\n        this._map3d.clearDist();\r\n        this.detachMouseEvent(\"OnLButtonDown\", \"_laserDist\"); \r\n        this.detachMouseEvent(\"OnLButtonDown\", \"_rulerDist\"); \r\n        this.detachMouseEvent(\"OnMouseMove\", \"_rulerDist\");\r\n        return this;\r\n    },\r\n\t\r\n    // @method createEagleEyeMap(nodePath: String, options: EagleEye options): this\r\n    // \r\n\tcreateEagleEyeMap: function(nodePath, options) {\t\t\r\n\t\tvar defaultOptions = {\r\n\t\t\tEagleEyePosition: null,\t\t//Vector3\r\n\t\t\tEagleEyeAbsPos: null,\t\t//Vector3d\t\r\n\t\t\tEagleEyeOrient: null,\t\t//Vector3\r\n\t\t\tIndicatorOptions: {\r\n\t\t\t\tIcon: \"\",\t\t\t\t//\r\n\t\t\t\tIconSize: null,\t\t\t//Vector2\r\n\t\t\t\tScale: null\t\t\t\t//Vector3\r\n\t\t\t},\r\n\t\t\tViewPortOptions: {\r\n\t\t\t\tLeft: 0,\t\t\t//\r\n\t\t\t\tTop: 0.70,\t\t\t//\r\n\t\t\t\tWidth: 0.3,\t\t\t//\r\n\t\t\t\tHeight: 0.3,\t\t//\r\n\t\t\t\tZOrder: 2\t\t\t\t\r\n\t\t\t},\r\n\t\t\tInvisibleIDArray: null,\t\t//visID\r\n\t\t\tBackgroundColor: null,\t\t//ColourValue    \r\n\t\t};\r\n\t\t\r\n\t\tQ3D.Util.jQueryExtend(true, defaultOptions, options);\t\t\r\n\r\n        var path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];    \r\n            \r\n\t\t//localViewportCamera\r\n\t\tvar cam = this.createCommonNode(areaName + \"/\" + nodeName, Q3D.Enums.sceneNodeType.SNODE_LocalViewCamera);\r\n\t\tif(!cam) return;\r\n\t\tcam = cam.asCamera();\r\n\t\tvar localViewCam = cam.asLocalViewCamera();\r\n\t\tif(defaultOptions.EagleEyePosition != null) {\r\n\t\t\tlocalViewCam.setPosition(defaultOptions.EagleEyePosition.get());\r\n\t\t}\r\n\t\telse if(defaultOptions.EagleEyeAbsPos != null) {\r\n\t\t\tlocalViewCam.setAbsPos(defaultOptions.EagleEyeAbsPos.get());\r\n\t\t}\r\n\t\t\r\n\t\tif(defaultOptions.EagleEyeOrient != null) {\r\n\t\t\tlocalViewCam.setOrientation(defaultOptions.EagleEyeOrient.get(), Q3D.Enums.orientationType.World);\r\n\t\t}\r\n\t\t//Viewport\r\n\t\tvar rtManager = this._map3d.getRenderTargetManager();\r\n\t\trtManager.getMainTarget().addViewport(localViewCam, defaultOptions.ViewPortOptions.Left, defaultOptions.ViewPortOptions.Top, defaultOptions.ViewPortOptions.Width, defaultOptions.ViewPortOptions.Height, defaultOptions.ViewPortOptions.ZOrder);\r\n\t\t//ViewPort\r\n\t\tvar viewport = cam.getViewport();\r\n\t\tif(defaultOptions.BackgroundColor != null) {\r\n\t\t\tviewport.setBackgroundColour(defaultOptions.BackgroundColor.get());\r\n\t\t}\r\n\t\t//POI\r\n\t\tvar mainCamera = this._map3d.getWorldManager().getMainCamera(0),\r\n\t\t\tposV3d = mainCamera.getAbsPos(),\r\n\t\t\torientation = mainCamera.getOrientation(Q3D.Enums.orientationType.World);\r\n\t\t\t\r\n\t\tthis._map3d.setCameraListener(mainCamera);\t\r\n\t\tposV3d.y = 5; \r\n\t\r\n\t\tvar poiOptions = {\r\n\t\t\tPosition: Q3D.vector3(Q3D.vector3d(posV3d).toLocalPos(areaName)),\r\n\t\t\tOrientation: Q3D.vector3(-90, 0, orientation.z),\r\n\t\t\tOrientationType: Q3D.Enums.nodeOrientationType.World,\r\n\t\t\tScale: defaultOptions.IndicatorOptions.Scale,\r\n\t\t\tPOIOptions: {\r\n\t\t\t\tIcon: defaultOptions.IndicatorOptions.Icon,\r\n\t\t\t\tIconSize: defaultOptions.IndicatorOptions.IconSize,\r\n\t\t\t\tText: \"\",\r\n\t\t\t\tPOILayout: Q3D.Enums.poiLayOut.Center,\r\n\t\t\t\tUIType: Q3D.Enums.poiUIType.Normal,\r\n\t\t\t\tLocation: Q3D.Enums.poiImagePositionType.POI_LOCATE_NONE,\r\n\t\t\t\tAlwaysOnScreen: true,\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\tvar pathOfPOI = areaName + \"/\" + nodeName + \"_eagleEyeIndicator\";\r\n\t\tvar poiNode = this.createPOI(pathOfPOI, poiOptions);\r\n\t\tpoiNode.setObjectVisibleID(0);\r\n\t\tmainCamera.enableVisID(0, 0);\r\n\t\t//\r\n\t\tif(defaultOptions.InvisibleIDArray != null) {\r\n\t\t\tfor(var i = 0, len = defaultOptions.InvisibleIDArray.length; i < len; ++i) {\r\n\t\t\t\tlocalViewCam.enableVisID(defaultOptions.InvisibleIDArray[i], 0);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//POI\r\n\t\tthis._eagleEyeIndicatorPath = pathOfPOI;\t\t\r\n\t\t//\r\n\t\tthis.on(\"OnCameraUpdate\", function() {\r\n\t\t\tvar eagleEyeIndicator = mapObj.getSceneNode(mapObj._eagleEyeIndicatorPath);\r\n\t\t\tif(eagleEyeIndicator != null) {\r\n\t\t\t\tvar mainCamera = mapObj._map3d.getWorldManager().getMainCamera(0),\r\n\t\t\t\t\tposV3d = mainCamera.getAbsPos(),\r\n\t\t\t\t\torientation = mainCamera.getOrientation(Q3D.Enums.orientationType.World);\r\n\t\t\t\tposV3d.y = 10;\r\n\t\t\t\teagleEyeIndicator.setAbsPos(posV3d);\r\n\t\t\t\teagleEyeIndicator.setOrientation(Q3D.vector3(-90, 0, orientation.z).get(), Q3D.Enums.nodeOrientationType.World)\r\n\t\t\t}\t\r\n\t\t});\t\r\n\t\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t// @method removeEagleEyeMap(nodePath: String): this\r\n    // \r\n\tremoveEagleEyeMap: function(nodePath) {\t\r\n\t\tvar sNode = this.getSceneNode(nodePath);\r\n\t\tif(!sNode) return;\r\n        \r\n        var path = nodePath.split(\"/\"),\r\n            nodeName = path[path.length - 1],\r\n            areaName = path[0];\r\n\t\t\r\n\t\tthis.off(\"OnCameraUpdate\");\r\n\t\t//Viewport\r\n\t\tvar rtManager = this._map3d.getRenderTargetManager();\r\n\t\trtManager.getMainTarget().removeViewport(sNode.asCamera());\r\n\t\t\t\t\t\t\t\r\n\t\tthis.destroySceneNode(areaName, nodeName);\r\n\t\tthis.destroySceneNode(areaName, nodeName + \"_eagleEyeIndicator\");\r\n\t\tdelete this._eagleEyeIndicatorPath;\t\r\n\t\treturn this;\r\n\t},\r\n});","// @namespace Map\r\n// @section \r\nQ3D.Map.include({        \r\n    \r\n    // @method rayCasting(polygon: Array, p: Vector3): String\r\n    // qpolygonpolygon\r\n    // 'on''in''out'\r\n    rayCasting: function(poly, p) {\r\n        //            \r\n        if ( !Q3D.Util.isArray(poly) || poly.length < 3)\r\n            return null;\r\n        var px = p.x,\r\n            py = p.z,\r\n            flag = false;\r\n\r\n        for (var i = 0, l = poly.length, j = l - 1; i < l; j = i, i++) {\r\n            var sx = poly[i].x,\r\n                sy = poly[i].z,\r\n                tx = poly[j].x,\r\n                ty = poly[j].z;\r\n\r\n                // \r\n                if ((sx === px && sy === py) || (tx === px && ty === py)) {\r\n                    return 'on';\r\n                }\r\n\r\n                // \r\n                if ((sy < py && ty >= py) || (sy >= py && ty < py)) {\r\n                    //  Y  X \r\n                    var x = sx + (py - sy) * (tx - sx) / (ty - sy);\r\n\r\n                        // \r\n                        if (x === px) {\r\n                            return 'on';\r\n                        }\r\n\r\n                        // \r\n                        if (x > px) {\r\n                            flag = !flag;\r\n                        }\r\n                }\r\n        }\r\n\r\n        // \r\n        return flag ? 'in' : 'out';        \r\n    },\r\n    \r\n    // @method windingNumber(polygon: Array, p: Vector3): String\r\n    // \r\n    // 'on''in''out'\r\n    windingNumber: function(poly,p) {\r\n         //            \r\n        if ( !Q3D.Util.isArray(poly) || poly.length < 3)\r\n            return null;\r\n        var px = p.x,\r\n            py = p.z,\r\n            sum = 0;\r\n\r\n            for (var i = 0, l = poly.length, j = l - 1; i < l; j = i, i++) {\r\n                var sx = poly[i].x,\r\n                sy = poly[i].z,\r\n                tx = poly[j].x,\r\n                ty = poly[j].z;\r\n\r\n                    // \r\n                    if ((sx - px) * (px - tx) >= 0 && (sy - py) * (py - ty) >= 0 && (px - sx) * (ty - sy) === (py - sy) * (tx - sx)) {\r\n                        return 'on';\r\n                    }\r\n\r\n                    // \r\n                    var angle = Math.atan2(sy - py, sx - px) - Math.atan2(ty - py, tx - px);\r\n\r\n                    // -  \r\n                    if (angle >= Math.PI) {\r\n                        angle = angle - Math.PI * 2;\r\n                    } else if (angle <= -Math.PI) {\r\n                        angle = angle + Math.PI * 2;\r\n                    }\r\n\r\n                    sum += angle;\r\n            }\r\n\r\n            // \r\n            return Math.round(sum / Math.PI) === 0 ? 'out' : 'in';\r\n    },\r\n    \r\n    //GUID\r\n    guid: function() {\r\n        function S4() {\r\n           return (((1+Math.random())*0x10000)|0).toString(16).substring(1);\r\n        }\r\n        return (S4()+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+S4()+S4());\r\n    },\r\n    \r\n    // @method createPolyLine(nodePath: String, options: Polyline options): QLineNode\r\n    // Node\"/[]/\" QLineNode \r\n    createPolyLine: function (nodePath, options) {\r\n        var defaultCreateOption = {            \r\n            Material: null,\r\n            SpecialTransparent: false, //\r\n            LinePoints: [],\r\n            LineOptions: {\r\n                LineType: Q3D.Enums.lineType.StraightLine,\r\n                BesselDim: 2, //\r\n                Subdivision: 20, //\r\n                LineWidth: 2,\r\n                WrapLen: 2,//\r\n                //\r\n                Color: Q3D.colourValue(\"#0000FF\", 1), //\r\n                Alpha: 1, //\r\n            },\r\n            OnLineCreated: null\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\r\n        \r\n        try {\r\n            \r\n            //            \r\n            if ( defaultCreateOption.LinePoints.length < 1)\r\n                return null;\r\n            for (var i = 0; i < defaultCreateOption.LinePoints.length; i++) {\r\n                if (defaultCreateOption.LinePoints[i].length < 2)\r\n                    return null;\r\n            }            \r\n            \r\n            var nodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_Line);\r\n            if (nodeCreated != null) {\r\n                \r\n                if (defaultCreateOption.OnLineCreated) {\r\n                    mapObj._map3d.setSceneNodeListener(nodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(nodeCreated), defaultCreateOption.OnLineCreated);\r\n                }                \r\n                nodeCreated.trackAllResource();    \r\n                \r\n                var polylineAppend = nodeCreated.asLine();\r\n                polylineAppend.setSpecialTransparent(defaultCreateOption.SpecialTransparent ? 1 : 0);\r\n                \r\n                //\r\n                var material = null;\r\n                var _rm = this._map3d.getResourceManager();\r\n                if (defaultCreateOption.Material != null) {\r\n                    polylineAppend.setMaterial(defaultCreateOption.Material);\r\n                } else {\r\n                    var tempMatName = \"defaultMaterialForLine-\" + this.guid(); //\r\n                    var _res = _rm.getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n                    if (_res == null) {\r\n                        material = this.createSimpleMaterial(tempMatName, {\r\n                                Alpha: defaultCreateOption.LineOptions.Alpha,\r\n                                EmissiveColor: defaultCreateOption.LineOptions.Color,\r\n                            });\r\n                    } else {\r\n                        material = _res.asMaterial();\r\n                        material.setAlpha(defaultCreateOption.LineOptions.Alpha);\r\n                        material.setEmissiveColor(defaultCreateOption.LineOptions.Color.get());\r\n                    }                 \r\n                    polylineAppend.setMaterial(tempMatName);\r\n                }\r\n                \r\n                var Lines = [];\r\n                //setPosition\r\n                var startPt = null;                \r\n                for (var i = 0; i < defaultCreateOption.LinePoints.length; i++) {\r\n                    var Line = polylineAppend.addLine();\r\n                    Line.setLineType(defaultCreateOption.LineOptions.LineType);\r\n                    if (defaultCreateOption.LineOptions.LineType == Q3D.Enums.lineType.Bessel) {\r\n                        Line.setBesselDim(defaultCreateOption.LineOptions.BesselDim);\r\n                        Line.setSubdivision(defaultCreateOption.LineOptions.Subdivision);\r\n                    }\r\n                    \r\n                    Line.setLineWidth(defaultCreateOption.LineOptions.LineWidth);\r\n                    Line.setWrapLen(defaultCreateOption.LineOptions.WrapLen);\r\n                    var currentLinePoints = defaultCreateOption.LinePoints[i];                    \r\n                    for (var j = 0; j < currentLinePoints.length; j++) {\r\n                        var currPt = null;\r\n                        if (typeof(currentLinePoints[j]) == \"string\") {\r\n                            currPt = currentLinePoints[j].toVector3();\r\n                        } else {\r\n                            currPt = currentLinePoints[j];                            \r\n                        } \r\n                        if ( i == 0 && j == 0){\r\n                            startPt = currPt.clone();\r\n                        }\r\n                        Line.addPoint(currPt.subtract(startPt).get());\r\n                    }\r\n                    Lines.push(Line);\r\n                }\r\n                if (startPt != null) {\r\n                    polylineAppend.setPosition( startPt.get() );\r\n                    polylineAppend.centralize();\r\n                }\r\n                \r\n                /*\r\n                if (Q3D.Util.isFunction(defaultCreateOption.OnLineCreated)) {\r\n                    setTimeout(function () {\r\n                        defaultCreateOption.OnLineCreated(polylineAppend);\r\n                    }, 100)\r\n                }*/\r\n                \r\n                return polylineAppend;\r\n            } else {\r\n                return null;\r\n            }\r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createPolyLine: \" + e.message);    \r\n            return null;\r\n        }\r\n        return null;\r\n    },\r\n    \r\n    // @method createPolygon(nodePath: String, options: Polygon options): QVecModelNode\r\n    // Node\"/[]/\" QVecModelNode \r\n    createPolygon: function (nodePath, options) {\r\n        var defaultCreateOption = {\r\n            Material: null,\r\n            SpecialTransparent: false, //\r\n            Points: [],//\r\n            Color: Q3D.colourValue(\"#0000FF\", 1), \r\n            Alpha: 1, //\r\n            Direction: 1, //\r\n            OnPolygonCreated: null\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\r\n        try {\r\n            \r\n            //            \r\n            if ( defaultCreateOption.Points.length < 3)\r\n                return null;\r\n            \r\n            var vecNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_VecModel);  \r\n            if (vecNodeCreated != null) {\r\n                \r\n                 if (defaultCreateOption.OnPolygonCreated) {\r\n                    mapObj._map3d.setSceneNodeListener(vecNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(vecNodeCreated), defaultCreateOption.OnPolygonCreated);\r\n                }                \r\n                vecNodeCreated.trackAllResource();    \r\n                \r\n                var vecNodeAppend = vecNodeCreated.asVecModel();               \r\n                var vecPolygon = vecNodeAppend.createVecModel(Q3D.Enums.vecModelType.QPolygon).asPolygon();\r\n                vecNodeAppend.setSpecialTransparent(defaultCreateOption.SpecialTransparent ? 1 : 0);\r\n                var startPt = null;         \r\n                \r\n                //\r\n                var ptCnt = defaultCreateOption.Points.length;\r\n               // if (defaultCreateOption.Points[0].equals(defaultCreateOption.Points[ptCnt-1]))\r\n               //     ptCnt--;\r\n                    \r\n                for (var i = 0; i < ptCnt; i++) {\r\n                    var currPt = null;\r\n                    if (typeof(defaultCreateOption.Points[i]) == \"string\") {\r\n                        currPt = defaultCreateOption.Points[i].toVector3();\r\n                    } else {\r\n                        currPt = defaultCreateOption.Points[i];                            \r\n                    } \r\n                    if ( i == 0){\r\n                        startPt = currPt.clone();\r\n                    } else if ( i == ptCnt - 1 ) {\r\n                        if (startPt.equals(currPt)) //\r\n                            continue;\r\n                    }\r\n                    vecPolygon.addPoint(currPt.subtract(startPt).get());   \r\n                }\r\n                if (startPt != null)\r\n                    vecNodeAppend.setPosition( startPt.get() );\r\n                vecPolygon.setDirection( defaultCreateOption.Direction ); //    \r\n\t\t\t\tvecNodeAppend.resetCenter();\r\n                \r\n                //\r\n                var material = null;\r\n                var _rm = this._map3d.getResourceManager();\r\n                if (defaultCreateOption.Material != null) {\r\n                    vecNodeAppend.setMaterial(0, defaultCreateOption.Material);\r\n                } else {\r\n                    var tempMatName = \"defaultMaterialForPolygon-\" + this.guid(); //\r\n                    var _res = _rm.getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n                    if (_res == null) {\r\n                        material = this.createSimpleMaterial(tempMatName, {\r\n                                Alpha: defaultCreateOption.Alpha,\r\n                                EmissiveColor: defaultCreateOption.Color,\r\n                            });\r\n                    } else {\r\n                        material = _res.asMaterial();\r\n                        material.setAlpha(defaultCreateOption.Alpha);\r\n                        material.setEmissiveColor(defaultCreateOption.Color.get());\r\n                    }                 \r\n                    vecNodeAppend.setMaterial(0,tempMatName);\r\n                }\r\n                \r\n                /*\r\n                setTimeout(function () {\r\n                    if (Q3D.Util.isFunction(defaultCreateOption.OnPolygonCreated)) {\r\n                        defaultCreateOption.OnPolygonCreated(vecNodeAppend);\r\n                    }\r\n                }, 100)\r\n                */\r\n\r\n                return vecNodeAppend;\r\n            }\r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createPolygon: \" + e.message);\r\n            return null;\r\n        }\r\n        return null;\r\n    },\r\n    \r\n    // @method createPrism(nodePath: String, options: Prism options): QVecModelNode\r\n    // Node\"/[]/\" QVecModelNode    \r\n    createPrism: function (nodePath, options) {\r\n        var defaultCreateOption = {\r\n            Material: null,//0  1  2 \r\n            SpecialTransparent: false, //\r\n            Color: Q3D.colourValue(\"#0000FF\", 1), //\r\n            Alpha: 1, //\r\n            Points: [],//\r\n            Anchor: null,// Vector3            \r\n\t\t\tIgnoreFloor: true,\r\n            Height: 5,\r\n            OnPrismCreated: null\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\r\n        try {\r\n            \r\n            //            \r\n            if ( defaultCreateOption.Points.length < 3)\r\n                return null;\r\n\r\n            var vecNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_VecModel);\r\n            if (vecNodeCreated != null) {\r\n                \r\n                if (defaultCreateOption.OnPrismCreated) {\r\n                    mapObj._map3d.setSceneNodeListener(vecNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(vecNodeCreated), defaultCreateOption.OnPrismCreated);\r\n                }                \r\n                vecNodeCreated.trackAllResource();    \r\n                \r\n                var vecNodeAppend = vecNodeCreated.asVecModel();               \r\n                var vecPrism = vecNodeAppend.createVecModel(Q3D.Enums.vecModelType.QPrism).asPrism();\r\n                vecNodeAppend.setSpecialTransparent(defaultCreateOption.SpecialTransparent ? 1 : 0);\r\n                var startPt = null;         \r\n                for (var i = 0; i < defaultCreateOption.Points.length; i++) {\r\n                    var currPt = null;\r\n                    if (typeof(defaultCreateOption.Points[i]) == \"string\") {\r\n                        currPt = defaultCreateOption.Points[i].toVector3();\r\n                    } else {\r\n                        currPt = defaultCreateOption.Points[i];                            \r\n                    } \r\n                    if ( i == 0){\r\n                        startPt = currPt.clone();\r\n                    }\r\n                    vecPrism.addPoint(currPt.subtract(startPt).get());   \r\n                }\r\n                if (startPt != null)\r\n                    vecNodeAppend.setPosition( startPt.get() );\r\n                vecNodeAppend.resetCenter();\r\n                \r\n                //Anchor\r\n                if (defaultCreateOption.Anchor) {\r\n                    vecPrism.setAnchor(defaultCreateOption.Anchor.get());\r\n                } else {\r\n                    vecPrism.keepVertical();\r\n                    vecPrism.setHeight(defaultCreateOption.Height);\r\n                }      \r\n                \r\n                vecPrism.ignoreFloor(defaultCreateOption.IgnoreFloor);                \r\n                \r\n                //\r\n                var material = null;\r\n                var _rm = this._map3d.getResourceManager();\r\n                if (defaultCreateOption.Material != null) {\r\n                    if (Q3D.Util.isArray(defaultCreateOption.Material)) {\r\n                        for (var i = 0; i <= defaultCreateOption.Material.length; i++) {\r\n                            vecNodeAppend.setMaterial(i, defaultCreateOption.Material[i]);\r\n                            if ( i == 2) break;\r\n                        }\r\n                    } else {\r\n                        vecNodeAppend.setMaterial(0, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(1, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(2, defaultCreateOption.Material);\r\n                    }\r\n                } else {\r\n                    var tempMatName = \"defaultMaterialForPrism-\" + this.guid(); //\r\n                    var _res = _rm.getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n                    if (_res == null) {\r\n                        material = this.createSimpleMaterial(tempMatName, {\r\n                                Alpha: defaultCreateOption.Alpha,\r\n                                DiffuseColor: defaultCreateOption.Color,\r\n                            });\r\n                    } else {\r\n                        material = _res.asMaterial();\r\n                        material.setAlpha(defaultCreateOption.Alpha);\r\n                        material.setEmissiveColor(defaultCreateOption.Color.get());\r\n                    }                 \r\n                    vecNodeAppend.setMaterial(0, tempMatName);\r\n                    vecNodeAppend.setMaterial(1, tempMatName);\r\n                    vecNodeAppend.setMaterial(2, tempMatName);\r\n                }\r\n                \r\n                /*\r\n                setTimeout(function () {\r\n                    if (Q3D.Util.isFunction(defaultCreateOption.OnPrismCreated)) {\r\n                        defaultCreateOption.OnPrismCreated(vecNodeAppend);\r\n                    }\r\n                }, 100)\r\n                */\r\n\r\n                return vecNodeAppend;\r\n            }\r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createPrism: \" + e.message);\r\n            return null;\r\n        }\r\n        return null;\r\n    },\r\n    \r\n    // @method createPipe(nodePath: String, options: Pipe options): QVecModelNode\r\n    // Node\"/[]/\" QVecModelNode    \r\n    createPipe: function (nodePath, options) {\r\n        var defaultCreateOption = {\r\n            Material: null, //\r\n            SpecialTransparent: false, //\r\n            Color: Q3D.colourValue(\"#0000FF\", 1), //\r\n            Alpha: 1, //\r\n            Points: [],\r\n            Radius: [],//    \r\n            CrossPieces: 24, //            \r\n            OnPipeCreated: null\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\r\n        try {\r\n            \r\n            //            \r\n            if ( defaultCreateOption.Points.length < 2 || defaultCreateOption.Radius.length == 0 || defaultCreateOption.Radius.length > 2)\r\n                return null;\r\n\r\n            var vecNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_VecModel);           \r\n            if (vecNodeCreated != null) {\r\n                \r\n                if (defaultCreateOption.OnPipeCreated) {\r\n                    mapObj._map3d.setSceneNodeListener(vecNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(vecNodeCreated), defaultCreateOption.OnPipeCreated);\r\n                }                \r\n                vecNodeCreated.trackAllResource();   \r\n                \r\n                var vecNodeAppend = vecNodeCreated.asVecModel();               \r\n                var vecPipe = vecNodeAppend.createVecModel(Q3D.Enums.vecModelType.QPipe).asPipe();     \r\n                vecNodeAppend.setSpecialTransparent(defaultCreateOption.SpecialTransparent ? 1 : 0);\r\n                \r\n                var startPt = null;         \r\n                for (var i = 0; i < defaultCreateOption.Points.length; i++) {\r\n                    var currPt = null;\r\n                    if (typeof(defaultCreateOption.Points[i]) == \"string\") {\r\n                        currPt = defaultCreateOption.Points[i].toArcVertex();\r\n                    } else {\r\n                        currPt = defaultCreateOption.Points[i];\r\n                    } \r\n                    if ( i == 0){\r\n                        startPt = currPt.clone();\r\n                    }\r\n                    vecPipe.addPoint(currPt.subtract(startPt).get());   \r\n                }\r\n                if (startPt != null)\r\n                    vecNodeAppend.setPosition( startPt.getPos() );\r\n                vecNodeAppend.resetCenter();\r\n                \r\n                if (defaultCreateOption.Radius.length == 1) {\r\n                    vecPipe.setRadiusInner(0);\r\n                    vecPipe.setRadiusOuter(defaultCreateOption.Radius[0]);\r\n                } else {\r\n                    vecPipe.setRadiusInner( Math.min(+defaultCreateOption.Radius[0], +defaultCreateOption.Radius[1]) );\r\n                    vecPipe.setRadiusOuter( Math.max(+defaultCreateOption.Radius[0], +defaultCreateOption.Radius[1]) );\r\n                }\r\n                vecPipe.setCrossPieces(defaultCreateOption.CrossPieces);\r\n                \r\n                //\r\n                var material = null;\r\n                var _rm = this._map3d.getResourceManager();\r\n                if (defaultCreateOption.Material != null) {\r\n                    if (Q3D.Util.isArray(defaultCreateOption.Material)) {\r\n                        for (var i = 0; i <= defaultCreateOption.Material.length; i++) {\r\n                            vecNodeAppend.setMaterial(i, defaultCreateOption.Material[i]);\r\n                            if ( i == 3) break;\r\n                        }\r\n                    } else {\r\n                        vecNodeAppend.setMaterial(0, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(1, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(2, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(3, defaultCreateOption.Material);\r\n                    }\r\n                } else {\r\n                    var tempMatName = \"defaultMaterialForPipe-\" + this.guid(); //\r\n                    var _res = _rm.getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n                    if (_res == null) {\r\n                        material = this.createSimpleMaterial(tempMatName, {\r\n                                Alpha: defaultCreateOption.Alpha,\r\n                                DiffuseColor: defaultCreateOption.Color,\r\n                            });\r\n                    } else {\r\n                        material = _res.asMaterial();\r\n                        material.setAlpha(defaultCreateOption.Alpha);\r\n                        material.setEmissiveColor(defaultCreateOption.Color.get());\r\n                    }                 \r\n                    vecNodeAppend.setMaterial(0, tempMatName);\r\n                    vecNodeAppend.setMaterial(1, tempMatName);\r\n                    vecNodeAppend.setMaterial(2, tempMatName);\r\n                    vecNodeAppend.setMaterial(3, tempMatName);\r\n                }\r\n                \r\n                /*\r\n                setTimeout(function () {\r\n                    if (Q3D.Util.isFunction(defaultCreateOption.OnPipeCreated)) {\r\n                        defaultCreateOption.OnPipeCreated(vecNodeAppend);\r\n                    }\r\n                }, 100)\r\n                */\r\n\r\n                return vecNodeAppend;\r\n            }\r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createPipe: \" + e.message);\r\n            return null;\r\n        }\r\n        return null;\r\n    },   \r\n    // @method createWalls(nodePath: String, options: Walls options): QVecModelNode\r\n    // Node\"/[]/\" QVecModelNode    \r\n    createWalls: function (nodePath, options) {\r\n        var defaultCreateOption = {\r\n            Material: null,//50  1  2  3  4 addMaterial \r\n\t\t\tSpecialTransparent: false, //   \r\n            Color: Q3D.colourValue(\"#0000FF\", 1), //\r\n            Alpha: 1, //            \r\n            IgnoreFloor: false,\r\n            IgnoreCeil: false,\r\n            Height: 5,//\r\n            Width: 2,//\r\n             //wall\r\n            Corners: [],//Vector3\r\n            IsClosed: false,//\r\n            SizeOfWalls: [],//wall{wallID:1,width:1.0, height:2.5}wallID\r\n            MatOfWalls: [],//wall{wallID:1,data:[{compID:1, mtrID:2},{compID:2, mtrID:2}]}\r\n            OnWallsCreated: null\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\r\n        try {            \r\n            \r\n            //            \r\n            if ( defaultCreateOption.Corners.length < 2 )\r\n                return null;\r\n\r\n            var vecNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_VecModel);           \r\n            if (vecNodeCreated != null) {\r\n                \r\n                if (defaultCreateOption.OnWallsCreated) {\r\n                    mapObj._map3d.setSceneNodeListener(vecNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(vecNodeCreated), defaultCreateOption.OnWallsCreated);\r\n                }                \r\n                vecNodeCreated.trackAllResource();   \r\n                \r\n                var vecNodeAppend = vecNodeCreated.asVecModel();\r\n                var vecWalls = vecNodeAppend.createVecModel(Q3D.Enums.vecModelType.QWalls).asWalls();\r\n                vecNodeAppend.setSpecialTransparent(defaultCreateOption.SpecialTransparent ? 1 : 0);\r\n                vecWalls.setDefaultSize(defaultCreateOption.Width, defaultCreateOption.Height);\r\n                if (defaultCreateOption.IgnoreCeil) {\r\n                    vecWalls.ignoreCeil(1);\r\n                }\r\n                if (defaultCreateOption.IgnoreFloor) {\r\n                    vecWalls.ignoreFloor(1);\r\n                }\r\n                \r\n                //          \r\n                var material = null;\r\n                var _rm = this._map3d.getResourceManager();                \r\n                if (defaultCreateOption.Material != null) {\r\n                    if (Q3D.Util.isArray(defaultCreateOption.Material)) {\r\n                        for (var i = 0; i <= defaultCreateOption.Material.length; i++) {\r\n                            if (i <= 4)\r\n                                vecNodeAppend.setMaterial(i, defaultCreateOption.Material[i]);\r\n                            else\r\n                                vecNodeAppend.addMaterial(defaultCreateOption.Material[i]);\r\n                        }\r\n                    } else {\r\n                        vecNodeAppend.setMaterial(0, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(1, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(2, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(3, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(4, defaultCreateOption.Material);\r\n                    }\r\n                } else {\r\n                    var tempMatName = \"defaultMaterialForWalls-\" + this.guid(); //\r\n                    var _res = _rm.getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n                    if (_res == null) {\r\n                        material = this.createSimpleMaterial(tempMatName, {\r\n                                Alpha: defaultCreateOption.Alpha,\r\n                                DiffuseColor: defaultCreateOption.Color,\r\n                            });\r\n                    } else {\r\n                        material = _res.asMaterial();\r\n                        material.setAlpha(defaultCreateOption.Alpha);\r\n                        material.setEmissiveColor(defaultCreateOption.Color.get());\r\n                    }                 \r\n                    vecNodeAppend.setMaterial(0, tempMatName);\r\n                    vecNodeAppend.setMaterial(1, tempMatName);\r\n                    vecNodeAppend.setMaterial(2, tempMatName);\r\n                    vecNodeAppend.setMaterial(3, tempMatName);   \r\n                    vecNodeAppend.setMaterial(4, tempMatName);   \r\n                }\r\n                \r\n                //\r\n                var startPt = null;         \r\n                for (var i = 0; i < defaultCreateOption.Corners.length; i++) {\r\n                    var currPt = null;\r\n                    if (typeof(defaultCreateOption.Corners[i]) == \"string\") {\r\n                        currPt = defaultCreateOption.Corners[i].toVector3();\r\n                    } else {\r\n                        currPt = defaultCreateOption.Corners[i];                            \r\n                    } \r\n                    if ( i == 0){\r\n                        startPt = currPt.clone();\r\n                    }\r\n                    vecWalls.addCorner(i, currPt.subtract(startPt).get());   \r\n                    \r\n                    if (i > 0) {\r\n                        vecWalls.constructWall(i - 1, i - 1, i);\r\n                    }                    \r\n                }\r\n                if(defaultCreateOption.IsClosed) {\r\n                    vecWalls.constructWall(defaultCreateOption.Corners.length - 1,defaultCreateOption.Corners.length - 1,0);\r\n                }\r\n                if (startPt != null)\r\n                    vecNodeAppend.setPosition( startPt.get() );\r\n                vecNodeAppend.resetCenter();\r\n                \r\n                //\r\n                if (defaultCreateOption.SizeOfWalls.length > 0) {\r\n                    for (var j = 0; j < defaultCreateOption.SizeOfWalls.length; j++) { \r\n                        var wall = defaultCreateOption.SizeOfWalls[j];\r\n                        vecWalls.setWallSize(wall.wallID, wall.width, wall.height);\r\n                    }\r\n                }\r\n                if (defaultCreateOption.MatOfWalls.length > 0) {\r\n                    for (var j = 0; j < defaultCreateOption.MatOfWalls.length; j++) { \r\n                        var mat = defaultCreateOption.MatOfWalls[j];\r\n                        var wallID = mat.wallID;\r\n                        var data = mat.data;\r\n                        for (var k = 0; k < data.length; k++) {\r\n                            vecWalls.setWallMaterial(wallID, data[k].compID, data[k].mtrID);\r\n                        }\r\n                        \r\n                    }\r\n                }                \r\n                \r\n                /*\r\n                setTimeout(function () {\r\n\r\n                    if ($.isFunction(defaultCreateOption.OnWallsCreated)) {\r\n                        defaultCreateOption.OnWallsCreated(vecNodeAppend);\r\n                    }\r\n                }, 100)\r\n                */\r\n\r\n                return vecNodeAppend;\r\n            }\r\n        }\r\n        catch (e) {\r\n            this.showNotice(\"\", \"createWalls: \" + e.message);\r\n            return null;\r\n        }\r\n        return null;\r\n    },\r\n    \r\n    // @method createCylinder(nodePath: String, options: Cylinder options): QVecModelNode\r\n    // Node\"/[]/\" QVecModelNode    \r\n    createCylinder: function (nodePath, options) {\r\n        var defaultCreateOption = {            \r\n            Material: null, //\r\n            SpecialTransparent: false, //\r\n            Color: Q3D.colourValue(\"#0000FF\", 1), //\r\n            Alpha: 1, //\r\n            Center: null, // Vector3        \r\n            Anchor: null,// Vector3\r\n            Radius: 10, //\r\n            Height: 50,//\r\n            Pieces: 36, //    \r\n            OnCylinderCreated: null\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\r\n        try {\r\n            \r\n            var vecNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_VecModel);               \r\n            if (vecNodeCreated != null) {\r\n                \r\n                if (defaultCreateOption.OnCylinderCreated) {\r\n                    mapObj._map3d.setSceneNodeListener(vecNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(vecNodeCreated), defaultCreateOption.OnCylinderCreated);\r\n                }                \r\n                vecNodeCreated.trackAllResource();   \r\n                \r\n                var vecNodeAppend = vecNodeCreated.asVecModel();               \r\n                var vecCylinder = vecNodeAppend.createVecModel(Q3D.Enums.vecModelType.QCylinder).asCylinder();    \r\n                vecNodeAppend.setSpecialTransparent(defaultCreateOption.SpecialTransparent ? 1 : 0);\r\n\r\n                if (defaultCreateOption.Center) {\r\n                    vecNodeCreated.setPosition(defaultCreateOption.Center.get());\r\n                }\r\n                \r\n                //Anchor\r\n                if (defaultCreateOption.Anchor) {\r\n                    vecCylinder.setAnchor(defaultCreateOption.Anchor.get());\r\n                } else {\r\n                    vecCylinder.keepVertical();\r\n                    vecCylinder.setHeight(defaultCreateOption.Height);\r\n                }          \r\n                vecCylinder.setRadius(defaultCreateOption.Radius);\r\n                vecCylinder.setPieces(defaultCreateOption.Pieces);                \r\n                \r\n                //\r\n                var material = null;\r\n                var _rm = this._map3d.getResourceManager();\r\n                if (defaultCreateOption.Material != null) {\r\n                    if (Q3D.Util.isArray(defaultCreateOption.Material)) {\r\n                        for (var i = 0; i <= defaultCreateOption.Material.length; i++) {\r\n                            vecNodeAppend.setMaterial(i, defaultCreateOption.Material[i]);\r\n                            if ( i == 2) break;\r\n                        }\r\n                    } else {\r\n                        vecNodeAppend.setMaterial(0, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(1, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(2, defaultCreateOption.Material);\r\n                    }\r\n                } else {\r\n                    var tempMatName = \"defaultMaterialForCylinder-\" + this.guid(); //\r\n                    var _res = _rm.getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n                    if (_res == null) {\r\n                        material = this.createSimpleMaterial(tempMatName, {\r\n                                Alpha: defaultCreateOption.Alpha,\r\n                                DiffuseColor: defaultCreateOption.Color,\r\n                            });\r\n                    } else {\r\n                        material = _res.asMaterial();\r\n                        material.setAlpha(defaultCreateOption.Alpha);\r\n                        material.setEmissiveColor(defaultCreateOption.Color.get());\r\n                    }                 \r\n                    vecNodeAppend.setMaterial(0, tempMatName);\r\n                    vecNodeAppend.setMaterial(1, tempMatName);\r\n                    vecNodeAppend.setMaterial(2, tempMatName);\r\n                }\r\n                \r\n                /*\r\n                setTimeout(function () {\r\n                    if (Q3D.Util.isFunction(defaultCreateOption.OnCylinderCreated)) {\r\n                        defaultCreateOption.OnCylinderCreated(vecNodeAppend);\r\n                    }\r\n                }, 100)\r\n                */\r\n\r\n                return vecNodeAppend;\r\n            }\r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createCylinder: \" + e.message);\r\n            return null;\r\n        }\r\n        \r\n        return  null;\r\n    },   \r\n    \r\n    // @method createSphere(nodePath: String, options: Sphere options): QVecModelNode\r\n    // Node\"/[]/\" QVecModelNode    \r\n    createSphere: function (nodePath, options) {\r\n        var defaultCreateOption = {            \r\n            Material: null, //\r\n            SpecialTransparent: false, //\r\n            Color: Q3D.colourValue(\"#0000FF\", 1), //\r\n            Alpha: 1, //\r\n\t\t\tCenter: null,  //Vector3()\r\n            Radius: 10, //\r\n            OnSphereCreated: null\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\r\n        try {       \r\n            var vecNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_VecModel);               \r\n            if (vecNodeCreated != null) {\r\n                \r\n                if (defaultCreateOption.OnSphereCreated) {\r\n                    mapObj._map3d.setSceneNodeListener(vecNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(vecNodeCreated), defaultCreateOption.OnSphereCreated);\r\n                }                \r\n                vecNodeCreated.trackAllResource();\r\n                \r\n                var vecNodeAppend = vecNodeCreated.asVecModel();               \r\n                var vecSphere = vecNodeAppend.createVecModel(Q3D.Enums.vecModelType.QSphere).asSphere();  \r\n                vecNodeAppend.setSpecialTransparent(defaultCreateOption.SpecialTransparent ? 1 : 0);\r\n\t\t\t\tif(defaultCreateOption.Center != null) {\r\n\t\t\t\t\tvecNodeCreated.setPosition(defaultCreateOption.Center.get());\r\n\t\t\t\t}\t\t\t\t\r\n                vecSphere.setRadius(defaultCreateOption.Radius);                            \r\n                //\r\n                var material = null;\r\n                var _rm = this._map3d.getResourceManager();\r\n                if (defaultCreateOption.Material != null) {\r\n                    vecNodeAppend.setMaterial(0, defaultCreateOption.Material);   \r\n                } else {\r\n                    var tempMatName = \"defaultMaterialForSphere-\" + this.guid(); //\r\n                    var _res = _rm.getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n                    if (_res == null) {\r\n                        material = this.createSimpleMaterial(tempMatName, {\r\n                                Alpha: defaultCreateOption.Alpha,\r\n                                DiffuseColor: defaultCreateOption.Color,\r\n                            });\r\n                    } else {\r\n                        material = _res.asMaterial();\r\n                        material.setAlpha(defaultCreateOption.Alpha);\r\n                        material.setEmissiveColor(defaultCreateOption.Color.get());\r\n                    }                 \r\n                    vecNodeAppend.setMaterial(0, tempMatName);\r\n                }\r\n                \r\n                /*\r\n                setTimeout(function () {\r\n                    if (Q3D.Util.isFunction(defaultCreateOption.OnSphereCreated)) {\r\n                        defaultCreateOption.OnSphereCreated(vecNodeAppend);\r\n                    }\r\n                }, 100)\r\n                */\r\n\r\n                return vecNodeAppend;\r\n            }\r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createSphere: \" + e.message);\r\n            return null;\r\n        }\r\n        \r\n        return  null;\r\n    },  \r\n\t\r\n\t// @method createCone(nodePath: String, options: Cone options): QVecModelNode\r\n    // Node\"/[]/\" QVecModelNode    \r\n    createCone: function (nodePath, options) {\r\n        var defaultCreateOption = {            \r\n            Material: null, //\r\n            SpecialTransparent: false, //\r\n            Color: Q3D.colourValue(\"#0000FF\", 1), //\r\n            Alpha: 1, //\r\n            Center: null, // Vector3        \r\n            Anchor: null,// Vector3\r\n            Radius: 10, //\r\n            Height: 50,//\r\n            Pieces: 36, //    \r\n            OnConeCreated: null\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\r\n        try {\r\n            \r\n            var vecNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_VecModel);               \r\n            if (vecNodeCreated != null) {\r\n                \r\n                if (defaultCreateOption.OnConeCreated) {\r\n                    mapObj._map3d.setSceneNodeListener(vecNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(vecNodeCreated), defaultCreateOption.OnCylinderCreated);\r\n                }                \r\n                vecNodeCreated.trackAllResource();   \r\n                \r\n                var vecNodeAppend = vecNodeCreated.asVecModel();               \r\n                var vecCone = vecNodeAppend.createVecModel(Q3D.Enums.vecModelType.QCone).asCone();    \r\n                vecNodeAppend.setSpecialTransparent(defaultCreateOption.SpecialTransparent ? 1 : 0);\r\n\r\n                if (defaultCreateOption.Center) {\r\n                    vecNodeCreated.setPosition(defaultCreateOption.Center.get());\r\n                }\r\n                \r\n                //Anchor\r\n                if (defaultCreateOption.Anchor) {\r\n                    vecCone.setAnchor(defaultCreateOption.Anchor.get());\r\n                } else {\r\n                    vecCone.keepVertical();\r\n                    vecCone.setHeight(defaultCreateOption.Height);\r\n                }          \r\n                vecCone.setRadius(defaultCreateOption.Radius);\r\n                vecCone.setPieces(defaultCreateOption.Pieces);                \r\n                \r\n                //\r\n                var material = null;\r\n                var _rm = this._map3d.getResourceManager();\r\n                if (defaultCreateOption.Material != null) {\r\n                    if (Q3D.Util.isArray(defaultCreateOption.Material)) {\r\n                        for (var i = 0; i <= defaultCreateOption.Material.length; i++) {\r\n                            vecNodeAppend.setMaterial(i, defaultCreateOption.Material[i]);\r\n                            if ( i == 2) break;\r\n                        }\r\n                    } else {\r\n                        vecNodeAppend.setMaterial(0, defaultCreateOption.Material);\r\n                        vecNodeAppend.setMaterial(1, defaultCreateOption.Material);\r\n                    }\r\n                } else {\r\n                    var tempMatName = \"defaultMaterialForCone-\" + this.guid(); //\r\n                    var _res = _rm.getResource(Q3D.Enums.resourceType.MATERIAL, tempMatName);\r\n                    if (_res == null) {\r\n                        material = this.createSimpleMaterial(tempMatName, {\r\n                                Alpha: defaultCreateOption.Alpha,\r\n                                DiffuseColor: defaultCreateOption.Color,\r\n                            });\r\n                    } else {\r\n                        material = _res.asMaterial();\r\n                        material.setAlpha(defaultCreateOption.Alpha);\r\n                        material.setEmissiveColor(defaultCreateOption.Color.get());\r\n                    }                 \r\n                    vecNodeAppend.setMaterial(0, tempMatName);\r\n                    vecNodeAppend.setMaterial(1, tempMatName);\r\n                }                \r\n                \r\n                return vecNodeAppend;\r\n            }\r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createCone: \" + e.message);\r\n            return null;\r\n        }\r\n        \r\n        return  null;\r\n    },   \r\n\t\r\n    // @method createParticle(nodePath: String, options: Particle options): QParticleNode\r\n    // Node\"/[]/\" QParticleNode    \r\n    createParticle: function (nodePath, options) {\r\n        var defaultCreateOption = {\r\n            Position: null, // Vector3\r\n            Orientation: null,\r\n            OrientationType: Q3D.Enums.nodeOrientationType.Self,\r\n            ParticleFile: null, //Particle/fire.par\r\n            OnParticleCreated: null\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\r\n\r\n        try {\r\n            \r\n            var ParticleNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_ParticleSystem);              \r\n            if (ParticleNodeCreated != null) {\r\n                \r\n                if (defaultCreateOption.OnParticleCreated) {\r\n                    mapObj._map3d.setSceneNodeListener(ParticleNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(ParticleNodeCreated), defaultCreateOption.OnParticleCreated);\r\n                }                \r\n                ParticleNodeCreated.trackAllResource();\r\n                \r\n                var ParticleAppend = ParticleNodeCreated.asParticle();\r\n                ParticleAppend.loadParticleSystem(defaultCreateOption.ParticleFile);\r\n\r\n                if (defaultCreateOption.Position != null) {\r\n                    ParticleAppend.setPosition(defaultCreateOption.Position.get());\r\n                }\r\n                \r\n                if (defaultCreateOption.Orientation != null) {\r\n                    ParticleAppend.setOrientation(defaultCreateOption.Orientation, defaultCreateOption.OrientationType);\r\n                }                \r\n                \r\n                /*\r\n                if ($.isFunction(defaultCreateOption.OnParticleCreated)) {\r\n                    setTimeout(function () {\r\n                        defaultCreateOption.OnParticleCreated(ParticleAppend);\r\n                    }, 100)\r\n                }        \r\n\t\t\t\tParticleAppend.loadAllResource();\r\n                */\r\n                \r\n                return ParticleAppend;\r\n            } \r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createParticle: \" + e.message);\r\n            return null;\r\n        }\r\n        return null;\r\n    },\r\n    \r\n    // createDirectLight(nodePath: String, options: Light options): QLightNode\r\n    // Node\"/[]/\" QLightNode    \r\n    createDirectLight: function (nodePath, options) {\r\n        var defaultCreateOption = {\r\n            OnDirectLightCreated: null\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\r\n\r\n        try {            \r\n            var LightNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_Light);              \r\n            if (LightNodeCreated != null) {\r\n                \r\n                if (defaultCreateOption.OnDirectLightCreated) {\r\n                    mapObj._map3d.setSceneNodeListener(LightNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(LightNodeCreated), defaultCreateOption.OnDirectLightCreated);\r\n                }                \r\n                LightNodeCreated.trackAllResource();\r\n                \r\n                var LightAppend = LightNodeCreated.asLight();\r\n                LightAppend.setLightType(Q3D.Enums.lightType.Parallel);\r\n                \r\n                /*\r\n                if ($.isFunction(defaultCreateOption.OnDirectLightCreated)) {\r\n                    setTimeout(function () {\r\n                        defaultCreateOption.OnDirectLightCreated(LightAppend);\r\n                    }, 100)\r\n                }       \r\n                */\r\n                return LightAppend;\r\n            } \r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createDirectLight: \" + e.message);\r\n            return null;\r\n        }\r\n        return null;\r\n    },\r\n    \r\n    // @method createDecal(nodePath: String, options: PolygonDecal options): QDecalNode\r\n    // Node\"/[]/\" QDecalNode \r\n    createDecal: function (nodePath, options) {\r\n        var defaultCreateOption = {\r\n            Points: [],//Vector3\r\n            Resolution: 1.0, ///\r\n            MaxHeight: 100, //\r\n            BackColor: null, //null\r\n            FillColor: Q3D.colourValue(\"#0000FF\", 0.6), //\r\n            LineColor: Q3D.colourValue(\"#0000FF\", 1.0), //\r\n            LineWidth: 1, //\r\n            FillMode: Q3D.Enums.DecalTexFillMode.FillAndFrame, //\r\n            OnDecalCreated: null\r\n        }\r\n        Q3D.Util.jQueryExtend(true, defaultCreateOption, options);\r\n        try {\r\n            \r\n            //            \r\n            if ( defaultCreateOption.Points.length < 3)\r\n                return null;\r\n            \r\n            var _pts = defaultCreateOption.Points.slice();\r\n            var _minX = _pts[0].x, _maxX = _pts[0].x, _minY = _pts[0].z, _maxY = _pts[0].z;\r\n            for (var i = 1; i < _pts.length; i++) {\r\n                _minX = Math.min(_minX, _pts[i].x);\r\n                _minY = Math.min(_minY, _pts[i].z);\r\n                _maxX = Math.max(_maxX, _pts[i].x);\r\n                _maxY = Math.max(_maxY, _pts[i].z);\r\n            }\r\n            var _sizeX = _maxX- _minX, _sizeY = _maxY - _minY;\r\n            var _pos = Q3D.vector3((_maxX+_minX) / 2, defaultCreateOption.MaxHeight, (_maxY+_minY) / 2);\r\n            var _v3list = this._map3d.getWorldManager().createEmptyQVector3List();//v2list\r\n            for (var i = 0; i < _pts.length; i++) {\r\n                _v3list.add(Q3D.vector3((_pts[i].x - _minX) / defaultCreateOption.Resolution,\r\n                (_pts[i].z - _minY) / defaultCreateOption.Resolution,0).get());\r\n            }            \r\n            //\r\n            var _imageX = _sizeX / defaultCreateOption.Resolution, _imageY = _sizeY / defaultCreateOption.Resolution;\r\n            var _rm = this._map3d.getResourceManager();\r\n            var _resourceName = \"DecalTexture-\" + this.guid();\r\n        \tvar _tex = _rm.registerResource(Q3D.Enums.resourceType.TEXTURE, _resourceName).asTexture();\r\n            var _canvas = _tex.createEmpty2DWithCanvas(_imageX, _imageY);\r\n            if(defaultCreateOption.BackColor != null)\r\n            \t_canvas.clear(defaultCreateOption.BackColor.get());\r\n            _canvas.setFillColor(defaultCreateOption.FillColor.get());\r\n\t\t\t_canvas.setLineColor(defaultCreateOption.LineColor.get());\r\n            _canvas.setFillMode(defaultCreateOption.FillMode);\r\n            _canvas.setLineWidth(defaultCreateOption.LineWidth);\r\n            _canvas.drawPolygon(_v3list);\r\n            _tex.flushCanvas();\r\n            //_canvas.save(\"d:/test.png\");\r\n            \r\n            var decalNodeCreated = this.createCommonNode(nodePath, Q3D.Enums.sceneNodeType.SNODE_Decal);  \r\n            if (decalNodeCreated != null) {\r\n                \r\n                if (defaultCreateOption.OnDecalCreated) {\r\n                    mapObj._map3d.setSceneNodeListener(decalNodeCreated);\r\n                    mapObj.attachUIEvent(\"onSceneNodeAllResourceCompleted\", mapObj.getSceneNodeFullName(decalNodeCreated), defaultCreateOption.OnDecalCreated);\r\n                }             \r\n                decalNodeCreated.trackAllResource(); \r\n                \r\n                var decalNodeAppend = decalNodeCreated.asDecal();            \r\n                decalNodeAppend.setPosition(_pos.get());\r\n                decalNodeAppend.pitch(-90,0);\r\n        \t\tdecalNodeAppend.setWidth(_sizeX);\r\n        \t\tdecalNodeAppend.setHeight(_sizeY);\r\n        \t\tdecalNodeAppend.setLength(defaultCreateOption.MaxHeight+10);\r\n                decalNodeAppend.setMode(Q3D.Enums.DecalMode.OpBlendAlpha);\r\n                decalNodeAppend.setMainTexture(_resourceName);     \t\t\t          \r\n\r\n                return decalNodeAppend;\r\n            }\r\n        } catch (e) {\r\n            this.showNotice(\"\", \"createDecal: \" + e.message);\r\n            return null;\r\n        }\r\n        return null;\r\n    },\r\n});"]}